<!-- Generated by SpecStory, Markdown v2.0.0 -->

<!-- cursor Session 69cfb6f0-ada3-4dce-b9bd-866886e2ae9b (2025-11-16 08:37Z) -->

# Update business stall status on dashboard (2025-11-16 08:37Z)

_**User (2025-11-16 05:55Z)**_

look at the Dashboard of Admin, Business stall Status should also reflect the sold out not sold out status 



---

_**Agent (model default, mode Plan)**_

<think><details><summary>Thought Process</summary>
**Planning project analysis**

I need to stick to the plan without modifying it. I have my read-only tools ready, so I'll start by asking clarifying questions unless the task is simple. For the admin dashboard, it looks like I need to reflect the sold-out status of business stalls. I wonder what defines “sold out” and whether there's an existing field for quantity or slots. Also, I need to check which page or component to focus on for the UI. After analyzing, I'll create a plan before making any edits.
**Asking initial questions**

I need to start by asking my critical questions right away, as the instructions suggest. A quick pre-read is only acceptable if it involves five or fewer files, so I should go ahead and ask. After that, I can still inspect the code while I wait. I plan to run `list_dir` and possibly `codebase_search` after that. I should keep my questions concise and focused, so here they are:

1. How do we determine if a stall is sold out? Is it when available slots are zero, a boolean field like isSoldOut exists, or something else?  
2. [Next question is pending.]
**Clarifying status location**

I need to determine where the status should appear. Should it be in the admin dashboard's table listing business stalls, or is there a better location, like a card or detail page? That should cover the key concerns. Once I have clarity on that, I can proceed with calling `multi_tool_use.parallel` to run `list_dir` on the workspace root and possibly perform a `codebase_search` with the query for the "Admin Dashboard component." Then, I'll move forward based on the findings.</details></think>

---

I’ll clarify how you define “sold out” and where exactly you want it shown, then I’ll scan your codebase to locate the Admin Dashboard and stall models so I can propose precise changes.

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_directory** • Listed directory undefined • **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "Where is the Admin Dashboard UI implemented?" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `src/dashboard.jsx` | L797-820 |
| `src/ManageStocks.jsx` | L69 |
| `src/App.jsx` | L76 |
| `src/dashboard.jsx` | L31 |
| `src/dashboard.jsx` | L28-60 |
| `src/dashboard.jsx` | L737-802 |
| `src/components/Sidebar.jsx` | L39 |
| `src/components/admin/ChickenStocksAndStallStatus.jsx` | L64 |
| `src/Reports.jsx` | L42 |
| `src/components/admin/ExpensesOverview.jsx` | L57 |
| `src/components/Layout.jsx` | L63 |
| `src/Reports.jsx` | L444-497 |
| `src/components/UserManagement.jsx` | L56 |
| `src/components/UserManagement.jsx` | L50-80 |
| `src/components/Layout.jsx` | L187-220 |

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Opening dashboard files**

I need to open `ChickenStocksAndStallStatus.jsx` along with relevant portions of `dashboard.jsx` to examine both the admin and staff logic. It seems important to look at the `stallsStatus` and possibly the current stall status as well. I’ll use the `read_file` snippets to get those details. This should help me clearly understand how everything is functioning together. Let’s make sure I gather all the necessary information!</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/dashboard.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/components/admin/ChickenStocksAndStallStatus.jsx</summary>

</details>
</tool-use>

---



---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/utils/staffReportsToday.js</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Considering stall status updates**

I'm looking to compute sold-out status per stall using `fetchTodayStockStatus`, but that's for individual stall IDs. For an admin listing of all stalls, querying the `stock_status_history` table and mapping by stall ID seems cleaner than making multiple queries. I'll implement `loadStallsStatus` to combine data from `stalls` and `stock_status_history`. First, I need to check the database columns in the relevant documentation to ensure I have the right names.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: docs/stock_status_history.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: docs/stall_status_history.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Evaluating admin dashboard requirements**

The current Business Stalls Status on the admin dashboard only shows the business status. However, there's a need to also display whether each stall is sold out or not sold out. This means the dashboard should show both business status (like active or inactive) and stock status (sold out or not sold out) for today. There’s already a feature for staff to view their own stall's stock, so it makes sense to aggregate all statuses for the admin view.
**Modifying the loadStallsStatus function**

I need to plan how to modify `loadStallsStatus` in `dashboard.jsx`. Currently, we select stall details, but I want to add stock status. First, I’ll query the `stalls` table as before, then query `stock_status_history` for today's date to get stock information for all stall IDs. I’ll map this data by stall ID and merge it with our existing stallsStatus state. 

In the Business Stalls Status card, I'll show both business and stock status with badges. I'll reuse `getStatusBadgeColor` for business statuses and introduce `getStockStatusBadgeColor` for stock statuses. The UI will display the stall name, location, and stacked badges, ensuring to use the proper DaisyUI classes.
**Seeking user clarification**

Before moving forward, I need to ask the user some clarifying questions. It’s clear from the documentation that "stock_status" is separate from business status. The user mentioned wanting the Business Stall Status to reflect sold-out status too. They might not have specific layout preferences, but I should consider sensible defaults.

I have two implementation options: combining the statuses into one label (like "Active • Sold Out") or using two separate badges. The latter is primarily a UI decision. A more important question is whether the sold-out indicator should reflect today's status only, given that stock status is updated daily. Based on the context, they probably want to see the status for today.
**Planning stock status updates**

It's pretty clear that "today's stock status" indicates the current day's status. I might ask the user a quick question about whether they prefer a separate badge or combined text for the status, but they probably won't mind either way. However, the instructions only suggest asking critical questions when necessary, and I feel like I have enough information.

The plan is to show today's sold-out/not-sold-out status next to each stall based on stock_status_history. I also think we need to show a not-sold-out status for stalls with no records yet. That aligns with the default in `fetchTodayStockStatus`. I may check `Reports.jsx` for relevant usage, but it might not be essential. Lastly, since I'm in plan mode, I’ll call `create_plan` with the necessary details and summarize the steps to modify `loadStallsStatus` and the UI.
**Creating a plan for dashboard update**

I need the code references for the Business Stalls Status in `dashboard.jsx`, specifically lines 911-955. I should communicate this to the user, but first, I must call the `create_plan` tool after researching. The plan title needs to be formatted as a level 1 markdown heading, though the user prefers using (### or ##) headings. I’ll prioritize the tool specs and use a level 1 heading.

Then, I should outline the plan, detailing how we'll update the dashboard to show each stall's sold-out status using `stock_status_history`. I'll include steps for updating the data layer, adjusting the UI, and optional helper functions, along with testing considerations. Finally, I'll add a few todos and then call `create_plan`.</details></think>

---

Cancelled

---

_**User (2025-11-16 05:55Z)**_

this is a repeated reminder:



before implementation, review codes, avoid duplication and misplaced logic at all costs

use tools and mcp if needed,

run tests, then code, then test again

alright, you may now proceed with the plan

---

_**Agent (model default, mode Agent)**_



---

I’ll first inspect your scripts and the dashboard logic, then I’ll wire in today’s sold-out status for each stall in the admin card, keeping logic shared with existing helpers, and finally run the build/tests again to ensure everything passes.

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: package.json</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] Extend Dashboard.loadStallsStatus to join today’s stock_status_history data for all stalls and attach stockStatus to each stall entry.
- [ ] Update the Business Stalls Statuses card in dashboard.jsx to render an additional Sold Out / Not Sold Out badge per stall using DaisyUI badge classes.

</details>
</tool-use>

---

I'll first extend the dashboard data loader to bring in today's sold-out status per stall, then update the Business Stalls card UI, and finally run lint/tests to ensure everything is clean.

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/dashboard.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;dc73a897-9a48-4908-998c-8007695018d8&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;      };\n  \n-     // Load stalls status data\n+     // Load stalls status data, including today&#39;s stock sold-out status\n      const loadStallsStatus = async () =&gt; {\n          try {\n-             const { data, error } = await supabase\n+             // First load all business stalls\n+             const { data: stallsData, error: stallsError } = await supabase\n                  .from(&#39;stalls&#39;)\n                  .select(&#39;stall_id, stall_name, location, status&#39;)\n                  .order(&#39;stall_name&#39;);\n  \n-             if (error) throw error;\n-             setStallsStatus(data || []);\n+             if (stallsError) throw stallsError;\n+ \n+             const stalls = stallsData || [];\n+ \n+             // If there are no stalls, we can short-circuit\n+             if (stalls.length === 0) {\n+                 setStallsStatus([]);\n+                 return;\n+             }\n+ \n+             // Build today&#39;s date range in PH timezone (same logic as staffReportsToday helpers)\n+             const today = getPHDate();\n+             const todayStr = getPHDateString(today);\n+ \n+             // Fetch today&#39;s stock status for all stalls in a single query\n+             const stallIds = stalls.map((stall) =&gt; stall.stall_id);\n+             const { data: stockStatusData, error: stockStatusError } = await supabase\n+                 .from(&#39;stock_status_history&#39;)\n+                 .select(&#39;stall_id, stock_status, stock_level, date&#39;)\n+                 .in(&#39;stall_id&#39;, stallIds)\n+                 .eq(&#39;date&#39;, todayStr);\n+ \n+             if (stockStatusError) throw stockStatusError;\n+ \n+             // Build a lookup map for today&#39;s stock status per stall\n+             const stockStatusByStallId = {};\n+             (stockStatusData || []).forEach((row) =&gt; {\n+                 stockStatusByStallId[row.stall_id] = {\n+                     stockStatus: row.stock_status || &#39;not_sold_out&#39;,\n+                     stockLevel:\n+                         typeof row.stock_level === &#39;number&#39;\n+                             ? row.stock_level\n+                             : Number(row.stock_level || 0),\n+                 };\n+             });\n+ \n+             // Merge business status with today&#39;s stock status, defaulting to not_sold_out\n+             const merged = stalls.map((stall) =&gt; {\n+                 const stockInfo = stockStatusByStallId[stall.stall_id] || {\n+                     stockStatus: &#39;not_sold_out&#39;,\n+                     stockLevel: null,\n+                 };\n+ \n+                 return {\n+                     ...stall,\n+                     stockStatus: stockInfo.stockStatus,\n+                     stockLevel: stockInfo.stockLevel,\n+                 };\n+             });\n+ \n+             setStallsStatus(merged);\n          } catch (err) {\n              console.error(&#39;Error loading stalls status:&#39;, err);&quot;,
        &quot;oldStart&quot;: 317,
        &quot;newStart&quot;: 317,
        &quot;oldLines&quot;: 14,
        &quot;newLines&quot;: 64,
        &quot;linesRemoved&quot;: 4,
        &quot;linesAdded&quot;: 54
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/dashboard.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect, useMemo } from &#39;react&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport { isAdmin } from &#39;./utils/roleUtils&#39;;\nimport { getPHDateString, getPHDate, formatPHDate, getPHDateDaysAgo, parseSaleDate } from &#39;./utils/dateUtils&#39;;\nimport {\n    restrictToStaffStallAndToday,\n    fetchCurrentStallStockForStaff,\n    fetchTodaySalesTotalForStaff,\n    fetchTodayStockStatus,\n    saveTodayStockStatus,\n} from &#39;./utils/staffReportsToday&#39;;\nimport Layout from &#39;./components/Layout&#39;;\n// Charts\nimport {\n    Chart as ChartJS,\n    ArcElement,\n    BarElement,\n    LineElement,\n    PointElement,\n    CategoryScale,\n    LinearScale,\n    Tooltip,\n    Legend,\n    Title,\n} from &#39;chart.js&#39;;\nimport { Doughnut, Bar, Line } from &#39;react-chartjs-2&#39;;\n\nChartJS.register(ArcElement, BarElement, LineElement, PointElement, CategoryScale, LinearScale, Tooltip, Legend, Title);\n\nfunction Dashboard() {\n    const [userProfile, setUserProfile] = useState(null);\n    const [loading, setLoading] = useState(true);\n    \n    // Chart data states\n    const [salesByStall, setSalesByStall] = useState([]);\n    const [stockByStall, setStockByStall] = useState([]);\n    const [salesVsExpense, setSalesVsExpense] = useState({ sales: 0, expenses: 0 });\n    const [bestSellers, setBestSellers] = useState([]);\n    const [last7DaysSales, setLast7DaysSales] = useState([]);\n    const [chartsLoading, setChartsLoading] = useState(true);\n    const [stallsStatus, setStallsStatus] = useState([]);\n    \n    // Line chart states\n    const [timeBasedSales, setTimeBasedSales] = useState([]);\n    const [selectedStall, setSelectedStall] = useState(&#39;all&#39;);\n    const [timePeriod, setTimePeriod] = useState(&#39;yesterday&#39;);\n    const [availableStalls, setAvailableStalls] = useState([]);\n\n    // Staff dashboard states\n    const [staffTransactions, setStaffTransactions] = useState([]);\n    const [staffStatistics, setStaffStatistics] = useState({\n        totalSales: 0,\n        stockDistributed: 0,\n        stockStatus: &#39;not_sold_out&#39;,\n    });\n    const [staffCardsLoading, setStaffCardsLoading] = useState(true);\n    const [updatingStockStatus, setUpdatingStockStatus] = useState(false);\n\n    // Load sales by stall data\n    const loadSalesByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    stall_id,\n                    total_amount,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallSales = {};\n            data?.forEach(sale =&gt; {\n                const stallId = sale.stall_id;\n                const stallName = sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallSales[stallId]) {\n                    stallSales[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_sales: 0,\n                        transaction_count: 0\n                    };\n                }\n                stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n                stallSales[stallId].transaction_count += 1;\n            });\n\n            setSalesByStall(Object.values(stallSales));\n        } catch (err) {\n            console.error(&#39;Error loading sales by stall:&#39;, err);\n        }\n    };\n\n    // Load stock by stall data\n    const loadStockByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stall_stocks&#39;)\n                .select(&#96;\n                    stall_id,\n                    quantity,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallStock = {};\n            data?.forEach(stock =&gt; {\n                const stallId = stock.stall_id;\n                const stallName = stock.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallStock[stallId]) {\n                    stallStock[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_stock: 0\n                    };\n                }\n                stallStock[stallId].total_stock += Number(stock.quantity || 0);\n            });\n\n            setStockByStall(Object.values(stallStock));\n        } catch (err) {\n            console.error(&#39;Error loading stock by stall:&#39;, err);\n        }\n    };\n\n    // Load sales vs expenses data\n    const loadSalesVsExpense = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            // Get total sales\n            const { data: salesData, error: salesError } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;total_amount&#39;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (salesError) throw salesError;\n\n            // Get total expenses\n            const { data: expensesData, error: expensesError } = await supabase\n                .from(&#39;expenses&#39;)\n                .select(&#39;cost&#39;)\n                .gte(&#39;date&#39;, twelveMonthsAgoStr);\n\n            if (expensesError) throw expensesError;\n\n            const totalSales = salesData?.reduce((sum, sale) =&gt; sum + Number(sale.total_amount || 0), 0) || 0;\n            const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + Number(expense.cost || 0), 0) || 0;\n\n            setSalesVsExpense({ sales: totalSales, expenses: totalExpenses });\n        } catch (err) {\n            console.error(&#39;Error loading sales vs expenses:&#39;, err);\n        }\n    };\n\n    // Load best sellers data\n    const loadBestSellers = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    quantity_sold,\n                    menu_items(item_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (error) throw error;\n\n            // Group by item and calculate totals\n            const itemSales = {};\n            data?.forEach(sale =&gt; {\n                const itemName = sale.menu_items?.item_name || &#39;Unknown Item&#39;;\n                \n                if (!itemSales[itemName]) {\n                    itemSales[itemName] = {\n                        item_name: itemName,\n                        units_sold: 0\n                    };\n                }\n                itemSales[itemName].units_sold += Number(sale.quantity_sold || 0);\n            });\n\n            // Sort by units sold and take top 4\n            const sortedItems = Object.values(itemSales)\n                .sort((a, b) =&gt; b.units_sold - a.units_sold)\n                .slice(0, 4);\n\n            setBestSellers(sortedItems);\n        } catch (err) {\n            console.error(&#39;Error loading best sellers:&#39;, err);\n        }\n    };\n\n    // Load time-based sales data for line chart\n    const loadTimeBasedSales = async () =&gt; {\n        try {\n            let startDate, endDate, groupBy;\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            \n            if (timePeriod === &#39;yesterday&#39;) {\n                // Show yesterday in context of last 7 days for better visualization\n                const yesterday = new Date(now);\n                yesterday.setDate(yesterday.getDate() - 1);\n                startDate = new Date(yesterday);\n                startDate.setDate(startDate.getDate() - 6); // Go back 6 more days (7 days total)\n                endDate = new Date(yesterday);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;week&#39;) {\n                // Last 7 days including today\n                startDate = new Date(now);\n                startDate.setDate(startDate.getDate() - 6);\n                endDate = new Date(now);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;month&#39;) {\n                // Last 12 months\n                startDate = new Date(now);\n                startDate.setMonth(startDate.getMonth() - 11);\n                startDate.setDate(1);\n                endDate = new Date(now);\n                groupBy = &#39;month&#39;;\n            }\n\n            const startDateStr = getPHDateString(startDate);\n            const endDateStr = getPHDateString(endDate);\n\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_date,\n                    total_amount,\n                    stall_id,\n                    stalls(stall_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, startDateStr)\n                .lte(&#39;sale_date&#39;, endDateStr)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            // Filter by selected stall if not &#39;all&#39;\n            if (selectedStall !== &#39;all&#39;) {\n                query = query.eq(&#39;stall_id&#39;, selectedStall);\n            }\n\n            const { data, error } = await query;\n\n            if (error) throw error;\n\n            // Group data by time period - parse sale_date as PH date\n            const groupedData = {};\n            data?.forEach(sale =&gt; {\n                // Parse sale_date string (YYYY-MM-DD) as PH date\n                const saleDateStr = parseSaleDate(sale.sale_date);\n                let key;\n\n                if (groupBy === &#39;day&#39;) {\n                    key = saleDateStr; // Already YYYY-MM-DD format\n                } else if (groupBy === &#39;month&#39;) {\n                    const [year, month] = saleDateStr.split(&#39;-&#39;);\n                    key = &#96;${year}-${month}&#96;;\n                }\n\n                if (!groupedData[key]) {\n                    groupedData[key] = {\n                        period: key,\n                        sales: 0,\n                        transactions: 0\n                    };\n                }\n                groupedData[key].sales += Number(sale.total_amount || 0);\n                groupedData[key].transactions += 1;\n            });\n\n            // Convert to array and sort\n            const timeBasedData = Object.values(groupedData).sort((a, b) =&gt; {\n                if (groupBy === &#39;day&#39;) {\n                    return a.period.localeCompare(b.period);\n                } else if (groupBy === &#39;month&#39;) {\n                    return a.period.localeCompare(b.period);\n                }\n                return 0;\n            });\n\n            setTimeBasedSales(timeBasedData);\n        } catch (err) {\n            console.error(&#39;Error loading time-based sales:&#39;, err);\n        }\n    };\n\n    // Load available stalls for dropdown\n    const loadAvailableStalls = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (error) throw error;\n            setAvailableStalls(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading stalls:&#39;, err);\n        }\n    };\n\n    // Load stalls status data, including today&#39;s stock sold-out status\n    const loadStallsStatus = async () =&gt; {\n        try {\n            // First load all business stalls\n            const { data: stallsData, error: stallsError } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name, location, status&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (stallsError) throw stallsError;\n\n            const stalls = stallsData || [];\n\n            // If there are no stalls, we can short-circuit\n            if (stalls.length === 0) {\n                setStallsStatus([]);\n                return;\n            }\n\n            // Build today&#39;s date range in PH timezone (same logic as staffReportsToday helpers)\n            const today = getPHDate();\n            const todayStr = getPHDateString(today);\n\n            // Fetch today&#39;s stock status for all stalls in a single query\n            const stallIds = stalls.map((stall) =&gt; stall.stall_id);\n            const { data: stockStatusData, error: stockStatusError } = await supabase\n                .from(&#39;stock_status_history&#39;)\n                .select(&#39;stall_id, stock_status, stock_level, date&#39;)\n                .in(&#39;stall_id&#39;, stallIds)\n                .eq(&#39;date&#39;, todayStr);\n\n            if (stockStatusError) throw stockStatusError;\n\n            // Build a lookup map for today&#39;s stock status per stall\n            const stockStatusByStallId = {};\n            (stockStatusData || []).forEach((row) =&gt; {\n                stockStatusByStallId[row.stall_id] = {\n                    stockStatus: row.stock_status || &#39;not_sold_out&#39;,\n                    stockLevel:\n                        typeof row.stock_level === &#39;number&#39;\n                            ? row.stock_level\n                            : Number(row.stock_level || 0),\n                };\n            });\n\n            // Merge business status with today&#39;s stock status, defaulting to not_sold_out\n            const merged = stalls.map((stall) =&gt; {\n                const stockInfo = stockStatusByStallId[stall.stall_id] || {\n                    stockStatus: &#39;not_sold_out&#39;,\n                    stockLevel: null,\n                };\n\n                return {\n                    ...stall,\n                    stockStatus: stockInfo.stockStatus,\n                    stockLevel: stockInfo.stockLevel,\n                };\n            });\n\n            setStallsStatus(merged);\n        } catch (err) {\n            console.error(&#39;Error loading stalls status:&#39;, err);\n        }\n    };\n\n    // Staff: load recent transactions for today for their stall\n    const loadStaffRecentTransactions = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_id,\n                    sale_date,\n                    quantity_sold,\n                    total_amount,\n                    payment_method,\n                    stall_id,\n                    product_id,\n                    stalls(stall_name),\n                    menu_items(item_name)\n                &#96;);\n\n            query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n            const { data, error } = await query\n                .order(&#39;sale_date&#39;, { ascending: false })\n                .limit(10);\n\n            if (error) throw error;\n            setStaffTransactions(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading staff recent transactions:&#39;, err);\n        }\n    };\n\n    // Staff: load key statistics for today for their stall\n    const loadStaffStatistics = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            const [stockDistributed, totalSales, stockStatusInfo] = await Promise.all([\n                fetchCurrentStallStockForStaff(userProfile),\n                fetchTodaySalesTotalForStaff(userProfile),\n                fetchTodayStockStatus(userProfile.stall_id),\n            ]);\n\n            setStaffStatistics({\n                totalSales: totalSales || 0,\n                stockDistributed: stockDistributed || 0,\n                stockStatus: stockStatusInfo?.stockStatus || &#39;not_sold_out&#39;,\n            });\n        } catch (err) {\n            console.error(&#39;Error loading staff statistics:&#39;, err);\n        }\n    };\n\n    const loadStaffDashboardData = async () =&gt; {\n        setStaffCardsLoading(true);\n        try {\n            await Promise.all([\n                loadStaffRecentTransactions(),\n                loadStaffStatistics(),\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading staff dashboard data:&#39;, err);\n        } finally {\n            setStaffCardsLoading(false);\n        }\n    };\n\n    const handleToggleStockStatus = async () =&gt; {\n        if (!userProfile) return;\n\n        const nextStatus =\n            staffStatistics.stockStatus === &#39;sold_out&#39; ? &#39;not_sold_out&#39; : &#39;sold_out&#39;;\n\n        setUpdatingStockStatus(true);\n        try {\n            await saveTodayStockStatus(\n                userProfile.stall_id,\n                staffStatistics.stockDistributed,\n                nextStatus\n            );\n            setStaffStatistics((prev) =&gt; ({\n                ...prev,\n                stockStatus: nextStatus,\n            }));\n        } catch (err) {\n            console.error(&#39;Error toggling stock status:&#39;, err);\n        } finally {\n            setUpdatingStockStatus(false);\n        }\n    };\n\n    // Load last 7 days sales data\n    const loadLast7DaysSales = async () =&gt; {\n        try {\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            const today = getPHDateString(now);\n            \n            // Get 7 days ago (including today, so 6 days back)\n            const sevenDaysAgo = new Date(now);\n            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 6);\n            const sevenDaysAgoStr = getPHDateString(sevenDaysAgo);\n\n            console.log(&#39;Loading sales from:&#39;, sevenDaysAgoStr, &#39;to:&#39;, today);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;sale_date, total_amount&#39;)\n                .gte(&#39;sale_date&#39;, sevenDaysAgoStr)\n                .lte(&#39;sale_date&#39;, today)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            if (error) throw error;\n\n            // Group by date and calculate daily totals - parse sale_date as PH date\n            const dailySales = {};\n            data?.forEach(sale =&gt; {\n                const date = parseSaleDate(sale.sale_date);\n                if (!dailySales[date]) {\n                    dailySales[date] = 0;\n                }\n                dailySales[date] += Number(sale.total_amount || 0);\n            });\n\n            // Create array for last 7 days (including today)\n            const last7Days = [];\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const dayName = formatPHDate(dateStr, { weekday: &#39;short&#39; });\n                \n                last7Days.push({\n                    date: dateStr,\n                    day: dayName,\n                    sales: dailySales[dateStr] || 0\n                });\n            }\n\n            console.log(&#39;Last 7 days data:&#39;, last7Days);\n            setLast7DaysSales(last7Days);\n        } catch (err) {\n            console.error(&#39;Error loading last 7 days sales:&#39;, err);\n        }\n    };\n\n    // Load all chart data\n    const loadChartData = async () =&gt; {\n        setChartsLoading(true);\n        try {\n            await Promise.all([\n                loadSalesByStall(),\n                loadStockByStall(),\n                loadSalesVsExpense(),\n                loadBestSellers(),\n                loadLast7DaysSales(),\n                loadAvailableStalls(),\n                loadTimeBasedSales(),\n                loadStallsStatus()\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading chart data:&#39;, err);\n        } finally {\n            setChartsLoading(false);\n        }\n    };\n\n    // Refresh all chart data\n    const refreshChartData = async () =&gt; {\n        console.log(&#39;Refreshing chart data...&#39;);\n        await loadChartData();\n    };\n\n    // Chart datasets\n    const donutSalesByStall = useMemo(() =&gt; ({\n        labels: salesByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Sales Count&#39;,\n                data: salesByStall.map(stall =&gt; stall.transaction_count),\n                backgroundColor: [&#39;#60a5fa&#39;, &#39;#f472b6&#39;, &#39;#34d399&#39;, &#39;#fbbf24&#39;, &#39;#a78bfa&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesByStall]);\n\n    const donutStockByStall = useMemo(() =&gt; ({\n        labels: stockByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Stock Qty&#39;,\n                data: stockByStall.map(stall =&gt; stall.total_stock),\n                backgroundColor: [&#39;#fbbf24&#39;, &#39;#818cf8&#39;, &#39;#f87171&#39;, &#39;#34d399&#39;, &#39;#f472b6&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [stockByStall]);\n\n    const donutSalesVsExpense = useMemo(() =&gt; ({\n        labels: [&#39;Sales&#39;, &#39;Expenses&#39;],\n        datasets: [\n            {\n                label: &#39;Amount&#39;,\n                data: [salesVsExpense.sales, salesVsExpense.expenses],\n                backgroundColor: [&#39;#22d3ee&#39;, &#39;#f97316&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesVsExpense]);\n\n    const donutBestSeller = useMemo(() =&gt; ({\n        labels: bestSellers.map(item =&gt; item.item_name),\n        datasets: [\n            {\n                label: &#39;Units Sold&#39;,\n                data: bestSellers.map(item =&gt; item.units_sold),\n                backgroundColor: [&#39;#86efac&#39;, &#39;#93c5fd&#39;, &#39;#fda4af&#39;, &#39;#fde68a&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [bestSellers]);\n\n    const last7DaysBar = useMemo(() =&gt; ({\n        labels: last7DaysSales.map(day =&gt; day.day),\n        datasets: [\n            {\n                label: &#39;Sales (PHP)&#39;,\n                data: last7DaysSales.map(day =&gt; day.sales),\n                backgroundColor: &#39;#60a5fa&#39;,\n                borderRadius: 6,\n            },\n        ],\n    }), [last7DaysSales]);\n\n    const timeBasedLine = useMemo(() =&gt; {\n        // Create complete date range for proper labeling\n        let allLabels = [];\n        let allData = [];\n        \n        if (timePeriod === &#39;yesterday&#39;) {\n            // Show yesterday in context of last 7 days\n            const now = getPHDate();\n            const yesterday = new Date(now);\n            yesterday.setDate(yesterday.getDate() - 1);\n            \n            // Generate last 7 days ending with yesterday\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(yesterday);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;week&#39;) {\n            // Generate last 7 days including today\n            const now = getPHDate();\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;month&#39;) {\n            // Generate all 12 months\n            const now = getPHDate();\n            for (let i = 11; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setMonth(date.getMonth() - i);\n                const year = date.getFullYear();\n                const month = String(date.getMonth() + 1).padStart(2, &#39;0&#39;);\n                const periodKey = &#96;${year}-${month}&#96;;\n                const label = formatPHDate(getPHDateString(date), { month: &#39;short&#39;, year: &#39;numeric&#39; });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this month\n                const salesData = timeBasedSales.find(item =&gt; item.period === periodKey);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        }\n\n        return {\n            labels: allLabels,\n            datasets: [\n                {\n                    label: &#39;Sales (₱)&#39;,\n                    data: allData,\n                    borderColor: &#39;#3B82F6&#39;,\n                    backgroundColor: &#39;rgba(59, 130, 246, 0.1)&#39;,\n                    borderWidth: 3,\n                    fill: true,\n                    tension: 0.4,\n                    pointBackgroundColor: allData.map((_, index) =&gt; {\n                        // Highlight the last point (yesterday) if in yesterday view\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return &#39;#10b981&#39;; // Green color for yesterday\n                        }\n                        return &#39;#3B82F6&#39;;\n                    }),\n                    pointBorderColor: &#39;#ffffff&#39;,\n                    pointBorderWidth: 2,\n                    pointRadius: allData.map((_, index) =&gt; {\n                        // Make yesterday&#39;s point slightly larger\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return 8;\n                        }\n                        return 6;\n                    }),\n                    pointHoverRadius: 10,\n                },\n            ],\n        };\n    }, [timeBasedSales, timePeriod, last7DaysSales]);\n\n    const donutOptions = useMemo(() =&gt; ({\n        plugins: {\n            legend: { position: &#39;bottom&#39; },\n            title: { display: false },\n        },\n        cutout: &#39;65%&#39;,\n        maintainAspectRatio: false,\n    }), []);\n\n    const barOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { display: false },\n            title: { display: false },\n            tooltip: { mode: &#39;index&#39;, intersect: false },\n        },\n        scales: {\n            x: { grid: { display: false } },\n            y: { grid: { color: &#39;rgba(0,0,0,0.05)&#39; }, beginAtZero: true },\n        },\n        maintainAspectRatio: false,\n    }), []);\n\n    const lineOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { \n                display: true,\n                position: &#39;top&#39;,\n                labels: {\n                    color: &#39;#374151&#39;,\n                    font: { size: 12 }\n                }\n            },\n            title: { display: false },\n            tooltip: { \n                mode: &#39;index&#39;, \n                intersect: false,\n                backgroundColor: &#39;#1F2937&#39;,\n                titleColor: &#39;#F9FAFB&#39;,\n                bodyColor: &#39;#F9FAFB&#39;,\n                borderColor: &#39;#374151&#39;,\n                borderWidth: 1,\n                callbacks: {\n                    label: function(context) {\n                        return &#96;Sales: ₱${Number(context.parsed.y).toLocaleString()}&#96;;\n                    }\n                }\n            },\n        },\n        scales: {\n            x: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { color: &#39;#6B7280&#39; }\n            },\n            y: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { \n                    color: &#39;#6B7280&#39;,\n                    callback: function(value) {\n                        return &#39;₱&#39; + Number(value).toLocaleString();\n                    }\n                },\n                beginAtZero: true \n            },\n        },\n        maintainAspectRatio: false,\n        interaction: {\n            intersect: false,\n            mode: &#39;index&#39;\n        }\n    }), []);\n\n    // Reload time-based sales when controls change\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            loadTimeBasedSales();\n        }\n    }, [selectedStall, timePeriod]);\n\n    // Refresh chart data periodically and on mount for admin\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            // Initial load\n            loadChartData();\n            \n            // Set up periodic refresh every 30 seconds\n            const refreshInterval = setInterval(() =&gt; {\n                refreshChartData();\n            }, 30000);\n\n            // Cleanup interval on unmount\n            return () =&gt; clearInterval(refreshInterval);\n        }\n    }, [userProfile?.role]);\n\n    // Load staff dashboard data for staff\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;staff&#39;) {\n            loadStaffDashboardData();\n        }\n    }, [userProfile?.role]);\n\n    useEffect(() =&gt; {\n        const getUser = async () =&gt; {\n            const { data: { user } } = await supabase.auth.getUser();\n\n            if (user) {\n                // Fetch profile info from your database\n                const { data: profile, error } = await supabase\n                    .from(&#39;profiles&#39;)\n                    .select(&#39;role, full_name, stall_id, status&#39;)\n                    .eq(&#39;id&#39;, user.id)\n                    .single();\n\n                if (error) {\n                    console.error(&#39;Error fetching profile:&#39;, error);\n                } else {\n                    setUserProfile(profile);\n                    console.log(&#39;Profile loaded:&#39;, profile);\n                }\n            }\n\n            setLoading(false);\n        };\n\n        getUser();\n    }, []);\n\n    if (loading) {\n        return (\n            &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n                &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n            &lt;/div&gt;\n        );\n    }\n\n    return (\n        &lt;Layout userProfile={userProfile}&gt;\n            &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n                &lt;div className=\&quot;mb-6\&quot;&gt;\n                    &lt;h1 className=\&quot;text-3xl font-bold text-primary\&quot;&gt;\n                        {isAdmin(userProfile) ? &#39;Admin Dashboard&#39; : &#39;Staff Dashboard&#39;}\n                    &lt;/h1&gt;\n                    {!isAdmin(userProfile) &amp;&amp; (\n                        &lt;p className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                            Today • My Stall\n                        &lt;/p&gt;\n                    )}\n                &lt;/div&gt;\n\n                {isAdmin(userProfile) ? (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-3 gap-6\&quot;&gt;\n                        {/* Combined: Sales over time by stall (spans 2 columns) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl lg:col-span-2\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title\&quot;&gt;Sales Summary&lt;/h2&gt;\n                                    &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={selectedStall}\n                                                onChange={(e) =&gt; setSelectedStall(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;all\&quot;&gt;All Stalls&lt;/option&gt;\n                                                {availableStalls.map(stall =&gt; (\n                                                    &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                                        {stall.stall_name}\n                                                    &lt;/option&gt;\n                                                ))}\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={timePeriod}\n                                                onChange={(e) =&gt; setTimePeriod(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;yesterday\&quot;&gt;Yesterday&lt;/option&gt;\n                                                &lt;option value=\&quot;week\&quot;&gt;Last 7 Days&lt;/option&gt;\n                                                &lt;option value=\&quot;month\&quot;&gt;Last 12 Months&lt;/option&gt;\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                &lt;/div&gt;\n                                &lt;div className=\&quot;h-80\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Line data={timeBasedLine} options={lineOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Stocks per stall */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Stocks per Stall&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutStockByStall} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Sales vs Expense */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Sales vs Expense&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutSalesVsExpense} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Best seller */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Best Seller&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutBestSeller} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Business Stalls Statuses */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Business Stalls Statuses&lt;/h2&gt;\n                                &lt;div className=\&quot;space-y-3\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full py-8\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : stallsStatus.length === 0 ? (\n                                        &lt;div className=\&quot;text-base-content/50 text-center py-4\&quot;&gt;\n                                            No stalls available.\n                                        &lt;/div&gt;\n                                    ) : (\n                                        stallsStatus.map((stall) =&gt; {\n                                            const getStatusBadgeColor = (status) =&gt; {\n                                                switch (status) {\n                                                    case &#39;active&#39;:\n                                                        return &#39;badge-success&#39;;\n                                                    case &#39;inactive&#39;:\n                                                        return &#39;badge-error&#39;;\n                                                    case &#39;under maintenance&#39;:\n                                                        return &#39;badge-warning&#39;;\n                                                    default:\n                                                        return &#39;badge-neutral&#39;;\n                                                }\n                                            };\n                                            return (\n                                                &lt;div key={stall.stall_id} className=\&quot;flex items-center justify-between p-3 bg-base-200 rounded-lg\&quot;&gt;\n                                                    &lt;div className=\&quot;flex-1\&quot;&gt;\n                                                        &lt;div className=\&quot;font-semibold\&quot;&gt;{stall.stall_name}&lt;/div&gt;\n                                                        {stall.location &amp;&amp; (\n                                                            &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;{stall.location}&lt;/div&gt;\n                                                        )}\n                                                    &lt;/div&gt;\n                                                    &lt;span className={&#96;badge ${getStatusBadgeColor(stall.status)}&#96;}&gt;\n                                                        {stall.status || &#39;N/A&#39;}\n                                                    &lt;/span&gt;\n                                                &lt;/div&gt;\n                                            );\n                                        })\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                    &lt;/div&gt;\n                ) : (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n                        {/* Staff: Recent Transactions (Today, My Stall) */}\n                    &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                        &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Today&amp;apos;s Recent Transactions&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : staffTransactions.length === 0 ? (\n                                    &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;\n                                        No transactions recorded yet for today.\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;overflow-x-auto max-h-80\&quot;&gt;\n                                        &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                                            &lt;thead&gt;\n                                                &lt;tr&gt;\n                                                    &lt;th&gt;Time&lt;/th&gt;\n                                                    &lt;th&gt;Item&lt;/th&gt;\n                                                    &lt;th&gt;Qty&lt;/th&gt;\n                                                    &lt;th&gt;Amount&lt;/th&gt;\n                                                    &lt;th&gt;Payment&lt;/th&gt;\n                                                &lt;/tr&gt;\n                                            &lt;/thead&gt;\n                                            &lt;tbody&gt;\n                                                {staffTransactions.map((tx) =&gt; (\n                                                    &lt;tr key={tx.sale_id}&gt;\n                                                        &lt;td&gt;{tx.sale_date}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.quantity_sold}&lt;/td&gt;\n                                                        &lt;td className=\&quot;text-success font-semibold\&quot;&gt;\n                                                            ₱{Number(tx.total_amount || 0).toFixed(2)}\n                                                        &lt;/td&gt;\n                                                        &lt;td&gt;\n                                                            &lt;span className={&#96;badge ${tx.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                                                {tx.payment_method}\n                                                            &lt;/span&gt;\n                                                        &lt;/td&gt;\n                                                    &lt;/tr&gt;\n                                                ))}\n                                            &lt;/tbody&gt;\n                                        &lt;/table&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Staff: Key Statistics (Today, My Stall) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-accent\&quot;&gt;Today&amp;apos;s Key Statistics&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-4\&quot;&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Stock Distributed&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-success\&quot;&gt;\n                                                {staffStatistics.stockDistributed.toFixed(2)} kg\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Sales&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-primary\&quot;&gt;\n                                                ₱{staffStatistics.totalSales.toFixed(2)}\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Stock Status&lt;/div&gt;\n                                            &lt;div className=\&quot;flex items-center gap-3 mt-2\&quot;&gt;\n                                                &lt;button\n                                                    type=\&quot;button\&quot;\n                                                    className=\&quot;btn btn-sm btn-outline\&quot;\n                                                    onClick={handleToggleStockStatus}\n                                                    disabled={updatingStockStatus}\n                                                &gt;\n                                                    &lt;span\n                                                        className={&#96;badge badge-lg ${\n                                                            staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                                ? &#39;badge-error&#39;\n                                                                : &#39;badge-success&#39;\n                                                        }&#96;}\n                                                    &gt;\n                                                        {staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                            ? &#39;Sold Out&#39;\n                                                            : &#39;Not Sold Out&#39;}\n                                                    &lt;/span&gt;\n                                                &lt;/button&gt;\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                )}\n            &lt;/div&gt;\n        &lt;/Layout&gt;\n    );\n}\n\nexport default Dashboard;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Extend Dashboard.loadStallsStatus to join today’s stock_status_history data for all stalls and attach stockStatus to each stall entry.
- [-] Update the Business Stalls Statuses card in dashboard.jsx to render an additional Sold Out / Not Sold Out badge per stall using DaisyUI badge classes.

</details>
</tool-use>

---

I’ve wired the data side so each stall now carries today’s sold-out status; next I’ll tweak the Business Stalls card UI to show a clear Sold Out / Not Sold Out badge using DaisyUI classes.

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/dashboard.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;e8792b54-759a-4ba6-827c-c14b78f7918b&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                                      ) : (\n                                          stallsStatus.map((stall) =&gt; {\n-                                             const getStatusBadgeColor = (status) =&gt; {\n+                                             const getBusinessStatusBadgeColor = (status) =&gt; {\n                                                  switch (status) {\n                                                      case &#39;active&#39;:&quot;,
        &quot;oldStart&quot;: 974,
        &quot;newStart&quot;: 974,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                                                  }\n                                              };\n+ \n+                                             const getStockStatusBadgeColor = (stockStatus) =&gt; {\n+                                                 switch (stockStatus) {\n+                                                     case &#39;sold_out&#39;:\n+                                                         return &#39;badge-error&#39;;\n+                                                     case &#39;not_sold_out&#39;:\n+                                                     default:\n+                                                         return &#39;badge-success&#39;;\n+                                                 }\n+                                             };\n+ \n+                                             const stockStatusLabel =\n+                                                 stall.stockStatus === &#39;sold_out&#39;\n+                                                     ? &#39;Sold Out&#39;\n+                                                     : &#39;Not Sold Out&#39;;\n+ \n                                              return (\n-                                                 &lt;div key={stall.stall_id} className=\&quot;flex items-center justify-between p-3 bg-base-200 rounded-lg\&quot;&gt;\n+                                                 &lt;div\n+                                                     key={stall.stall_id}\n+                                                     className=\&quot;flex items-center justify-between p-3 bg-base-200 rounded-lg\&quot;\n+                                                 &gt;\n                                                      &lt;div className=\&quot;flex-1\&quot;&gt;\n                                                          &lt;div className=\&quot;font-semibold\&quot;&gt;{stall.stall_name}&lt;/div&gt;\n                                                          {stall.location &amp;&amp; (\n-                                                             &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;{stall.location}&lt;/div&gt;\n+                                                             &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;\n+                                                                 {stall.location}\n+                                                             &lt;/div&gt;\n                                                          )}\n                                                      &lt;/div&gt;\n-                                                     &lt;span className={&#96;badge ${getStatusBadgeColor(stall.status)}&#96;}&gt;\n-                                                         {stall.status || &#39;N/A&#39;}\n-                                                     &lt;/span&gt;\n+                                                     &lt;div className=\&quot;flex flex-col items-end gap-1\&quot;&gt;\n+                                                         &lt;span\n+                                                             className={&#96;badge ${getBusinessStatusBadgeColor(\n+                                                                 stall.status\n+                                                             )}&#96;}\n+                                                         &gt;\n+                                                             {stall.status || &#39;N/A&#39;}\n+                                                         &lt;/span&gt;\n+                                                         &lt;span\n+                                                             className={&#96;badge ${getStockStatusBadgeColor(\n+                                                                 stall.stockStatus\n+                                                             )}&#96;}\n+                                                         &gt;\n+                                                             {stockStatusLabel}\n+                                                         &lt;/span&gt;\n+                                                     &lt;/div&gt;\n                                                  &lt;/div&gt;\n                                              );&quot;,
        &quot;oldStart&quot;: 986,
        &quot;newStart&quot;: 986,
        &quot;oldLines&quot;: 15,
        &quot;newLines&quot;: 49,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 39
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/dashboard.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect, useMemo } from &#39;react&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport { isAdmin } from &#39;./utils/roleUtils&#39;;\nimport { getPHDateString, getPHDate, formatPHDate, getPHDateDaysAgo, parseSaleDate } from &#39;./utils/dateUtils&#39;;\nimport {\n    restrictToStaffStallAndToday,\n    fetchCurrentStallStockForStaff,\n    fetchTodaySalesTotalForStaff,\n    fetchTodayStockStatus,\n    saveTodayStockStatus,\n} from &#39;./utils/staffReportsToday&#39;;\nimport Layout from &#39;./components/Layout&#39;;\n// Charts\nimport {\n    Chart as ChartJS,\n    ArcElement,\n    BarElement,\n    LineElement,\n    PointElement,\n    CategoryScale,\n    LinearScale,\n    Tooltip,\n    Legend,\n    Title,\n} from &#39;chart.js&#39;;\nimport { Doughnut, Bar, Line } from &#39;react-chartjs-2&#39;;\n\nChartJS.register(ArcElement, BarElement, LineElement, PointElement, CategoryScale, LinearScale, Tooltip, Legend, Title);\n\nfunction Dashboard() {\n    const [userProfile, setUserProfile] = useState(null);\n    const [loading, setLoading] = useState(true);\n    \n    // Chart data states\n    const [salesByStall, setSalesByStall] = useState([]);\n    const [stockByStall, setStockByStall] = useState([]);\n    const [salesVsExpense, setSalesVsExpense] = useState({ sales: 0, expenses: 0 });\n    const [bestSellers, setBestSellers] = useState([]);\n    const [last7DaysSales, setLast7DaysSales] = useState([]);\n    const [chartsLoading, setChartsLoading] = useState(true);\n    const [stallsStatus, setStallsStatus] = useState([]);\n    \n    // Line chart states\n    const [timeBasedSales, setTimeBasedSales] = useState([]);\n    const [selectedStall, setSelectedStall] = useState(&#39;all&#39;);\n    const [timePeriod, setTimePeriod] = useState(&#39;yesterday&#39;);\n    const [availableStalls, setAvailableStalls] = useState([]);\n\n    // Staff dashboard states\n    const [staffTransactions, setStaffTransactions] = useState([]);\n    const [staffStatistics, setStaffStatistics] = useState({\n        totalSales: 0,\n        stockDistributed: 0,\n        stockStatus: &#39;not_sold_out&#39;,\n    });\n    const [staffCardsLoading, setStaffCardsLoading] = useState(true);\n    const [updatingStockStatus, setUpdatingStockStatus] = useState(false);\n\n    // Load sales by stall data\n    const loadSalesByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    stall_id,\n                    total_amount,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallSales = {};\n            data?.forEach(sale =&gt; {\n                const stallId = sale.stall_id;\n                const stallName = sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallSales[stallId]) {\n                    stallSales[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_sales: 0,\n                        transaction_count: 0\n                    };\n                }\n                stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n                stallSales[stallId].transaction_count += 1;\n            });\n\n            setSalesByStall(Object.values(stallSales));\n        } catch (err) {\n            console.error(&#39;Error loading sales by stall:&#39;, err);\n        }\n    };\n\n    // Load stock by stall data\n    const loadStockByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stall_stocks&#39;)\n                .select(&#96;\n                    stall_id,\n                    quantity,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallStock = {};\n            data?.forEach(stock =&gt; {\n                const stallId = stock.stall_id;\n                const stallName = stock.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallStock[stallId]) {\n                    stallStock[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_stock: 0\n                    };\n                }\n                stallStock[stallId].total_stock += Number(stock.quantity || 0);\n            });\n\n            setStockByStall(Object.values(stallStock));\n        } catch (err) {\n            console.error(&#39;Error loading stock by stall:&#39;, err);\n        }\n    };\n\n    // Load sales vs expenses data\n    const loadSalesVsExpense = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            // Get total sales\n            const { data: salesData, error: salesError } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;total_amount&#39;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (salesError) throw salesError;\n\n            // Get total expenses\n            const { data: expensesData, error: expensesError } = await supabase\n                .from(&#39;expenses&#39;)\n                .select(&#39;cost&#39;)\n                .gte(&#39;date&#39;, twelveMonthsAgoStr);\n\n            if (expensesError) throw expensesError;\n\n            const totalSales = salesData?.reduce((sum, sale) =&gt; sum + Number(sale.total_amount || 0), 0) || 0;\n            const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + Number(expense.cost || 0), 0) || 0;\n\n            setSalesVsExpense({ sales: totalSales, expenses: totalExpenses });\n        } catch (err) {\n            console.error(&#39;Error loading sales vs expenses:&#39;, err);\n        }\n    };\n\n    // Load best sellers data\n    const loadBestSellers = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    quantity_sold,\n                    menu_items(item_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (error) throw error;\n\n            // Group by item and calculate totals\n            const itemSales = {};\n            data?.forEach(sale =&gt; {\n                const itemName = sale.menu_items?.item_name || &#39;Unknown Item&#39;;\n                \n                if (!itemSales[itemName]) {\n                    itemSales[itemName] = {\n                        item_name: itemName,\n                        units_sold: 0\n                    };\n                }\n                itemSales[itemName].units_sold += Number(sale.quantity_sold || 0);\n            });\n\n            // Sort by units sold and take top 4\n            const sortedItems = Object.values(itemSales)\n                .sort((a, b) =&gt; b.units_sold - a.units_sold)\n                .slice(0, 4);\n\n            setBestSellers(sortedItems);\n        } catch (err) {\n            console.error(&#39;Error loading best sellers:&#39;, err);\n        }\n    };\n\n    // Load time-based sales data for line chart\n    const loadTimeBasedSales = async () =&gt; {\n        try {\n            let startDate, endDate, groupBy;\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            \n            if (timePeriod === &#39;yesterday&#39;) {\n                // Show yesterday in context of last 7 days for better visualization\n                const yesterday = new Date(now);\n                yesterday.setDate(yesterday.getDate() - 1);\n                startDate = new Date(yesterday);\n                startDate.setDate(startDate.getDate() - 6); // Go back 6 more days (7 days total)\n                endDate = new Date(yesterday);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;week&#39;) {\n                // Last 7 days including today\n                startDate = new Date(now);\n                startDate.setDate(startDate.getDate() - 6);\n                endDate = new Date(now);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;month&#39;) {\n                // Last 12 months\n                startDate = new Date(now);\n                startDate.setMonth(startDate.getMonth() - 11);\n                startDate.setDate(1);\n                endDate = new Date(now);\n                groupBy = &#39;month&#39;;\n            }\n\n            const startDateStr = getPHDateString(startDate);\n            const endDateStr = getPHDateString(endDate);\n\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_date,\n                    total_amount,\n                    stall_id,\n                    stalls(stall_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, startDateStr)\n                .lte(&#39;sale_date&#39;, endDateStr)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            // Filter by selected stall if not &#39;all&#39;\n            if (selectedStall !== &#39;all&#39;) {\n                query = query.eq(&#39;stall_id&#39;, selectedStall);\n            }\n\n            const { data, error } = await query;\n\n            if (error) throw error;\n\n            // Group data by time period - parse sale_date as PH date\n            const groupedData = {};\n            data?.forEach(sale =&gt; {\n                // Parse sale_date string (YYYY-MM-DD) as PH date\n                const saleDateStr = parseSaleDate(sale.sale_date);\n                let key;\n\n                if (groupBy === &#39;day&#39;) {\n                    key = saleDateStr; // Already YYYY-MM-DD format\n                } else if (groupBy === &#39;month&#39;) {\n                    const [year, month] = saleDateStr.split(&#39;-&#39;);\n                    key = &#96;${year}-${month}&#96;;\n                }\n\n                if (!groupedData[key]) {\n                    groupedData[key] = {\n                        period: key,\n                        sales: 0,\n                        transactions: 0\n                    };\n                }\n                groupedData[key].sales += Number(sale.total_amount || 0);\n                groupedData[key].transactions += 1;\n            });\n\n            // Convert to array and sort\n            const timeBasedData = Object.values(groupedData).sort((a, b) =&gt; {\n                if (groupBy === &#39;day&#39;) {\n                    return a.period.localeCompare(b.period);\n                } else if (groupBy === &#39;month&#39;) {\n                    return a.period.localeCompare(b.period);\n                }\n                return 0;\n            });\n\n            setTimeBasedSales(timeBasedData);\n        } catch (err) {\n            console.error(&#39;Error loading time-based sales:&#39;, err);\n        }\n    };\n\n    // Load available stalls for dropdown\n    const loadAvailableStalls = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (error) throw error;\n            setAvailableStalls(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading stalls:&#39;, err);\n        }\n    };\n\n    // Load stalls status data, including today&#39;s stock sold-out status\n    const loadStallsStatus = async () =&gt; {\n        try {\n            // First load all business stalls\n            const { data: stallsData, error: stallsError } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name, location, status&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (stallsError) throw stallsError;\n\n            const stalls = stallsData || [];\n\n            // If there are no stalls, we can short-circuit\n            if (stalls.length === 0) {\n                setStallsStatus([]);\n                return;\n            }\n\n            // Build today&#39;s date range in PH timezone (same logic as staffReportsToday helpers)\n            const today = getPHDate();\n            const todayStr = getPHDateString(today);\n\n            // Fetch today&#39;s stock status for all stalls in a single query\n            const stallIds = stalls.map((stall) =&gt; stall.stall_id);\n            const { data: stockStatusData, error: stockStatusError } = await supabase\n                .from(&#39;stock_status_history&#39;)\n                .select(&#39;stall_id, stock_status, stock_level, date&#39;)\n                .in(&#39;stall_id&#39;, stallIds)\n                .eq(&#39;date&#39;, todayStr);\n\n            if (stockStatusError) throw stockStatusError;\n\n            // Build a lookup map for today&#39;s stock status per stall\n            const stockStatusByStallId = {};\n            (stockStatusData || []).forEach((row) =&gt; {\n                stockStatusByStallId[row.stall_id] = {\n                    stockStatus: row.stock_status || &#39;not_sold_out&#39;,\n                    stockLevel:\n                        typeof row.stock_level === &#39;number&#39;\n                            ? row.stock_level\n                            : Number(row.stock_level || 0),\n                };\n            });\n\n            // Merge business status with today&#39;s stock status, defaulting to not_sold_out\n            const merged = stalls.map((stall) =&gt; {\n                const stockInfo = stockStatusByStallId[stall.stall_id] || {\n                    stockStatus: &#39;not_sold_out&#39;,\n                    stockLevel: null,\n                };\n\n                return {\n                    ...stall,\n                    stockStatus: stockInfo.stockStatus,\n                    stockLevel: stockInfo.stockLevel,\n                };\n            });\n\n            setStallsStatus(merged);\n        } catch (err) {\n            console.error(&#39;Error loading stalls status:&#39;, err);\n        }\n    };\n\n    // Staff: load recent transactions for today for their stall\n    const loadStaffRecentTransactions = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_id,\n                    sale_date,\n                    quantity_sold,\n                    total_amount,\n                    payment_method,\n                    stall_id,\n                    product_id,\n                    stalls(stall_name),\n                    menu_items(item_name)\n                &#96;);\n\n            query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n            const { data, error } = await query\n                .order(&#39;sale_date&#39;, { ascending: false })\n                .limit(10);\n\n            if (error) throw error;\n            setStaffTransactions(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading staff recent transactions:&#39;, err);\n        }\n    };\n\n    // Staff: load key statistics for today for their stall\n    const loadStaffStatistics = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            const [stockDistributed, totalSales, stockStatusInfo] = await Promise.all([\n                fetchCurrentStallStockForStaff(userProfile),\n                fetchTodaySalesTotalForStaff(userProfile),\n                fetchTodayStockStatus(userProfile.stall_id),\n            ]);\n\n            setStaffStatistics({\n                totalSales: totalSales || 0,\n                stockDistributed: stockDistributed || 0,\n                stockStatus: stockStatusInfo?.stockStatus || &#39;not_sold_out&#39;,\n            });\n        } catch (err) {\n            console.error(&#39;Error loading staff statistics:&#39;, err);\n        }\n    };\n\n    const loadStaffDashboardData = async () =&gt; {\n        setStaffCardsLoading(true);\n        try {\n            await Promise.all([\n                loadStaffRecentTransactions(),\n                loadStaffStatistics(),\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading staff dashboard data:&#39;, err);\n        } finally {\n            setStaffCardsLoading(false);\n        }\n    };\n\n    const handleToggleStockStatus = async () =&gt; {\n        if (!userProfile) return;\n\n        const nextStatus =\n            staffStatistics.stockStatus === &#39;sold_out&#39; ? &#39;not_sold_out&#39; : &#39;sold_out&#39;;\n\n        setUpdatingStockStatus(true);\n        try {\n            await saveTodayStockStatus(\n                userProfile.stall_id,\n                staffStatistics.stockDistributed,\n                nextStatus\n            );\n            setStaffStatistics((prev) =&gt; ({\n                ...prev,\n                stockStatus: nextStatus,\n            }));\n        } catch (err) {\n            console.error(&#39;Error toggling stock status:&#39;, err);\n        } finally {\n            setUpdatingStockStatus(false);\n        }\n    };\n\n    // Load last 7 days sales data\n    const loadLast7DaysSales = async () =&gt; {\n        try {\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            const today = getPHDateString(now);\n            \n            // Get 7 days ago (including today, so 6 days back)\n            const sevenDaysAgo = new Date(now);\n            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 6);\n            const sevenDaysAgoStr = getPHDateString(sevenDaysAgo);\n\n            console.log(&#39;Loading sales from:&#39;, sevenDaysAgoStr, &#39;to:&#39;, today);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;sale_date, total_amount&#39;)\n                .gte(&#39;sale_date&#39;, sevenDaysAgoStr)\n                .lte(&#39;sale_date&#39;, today)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            if (error) throw error;\n\n            // Group by date and calculate daily totals - parse sale_date as PH date\n            const dailySales = {};\n            data?.forEach(sale =&gt; {\n                const date = parseSaleDate(sale.sale_date);\n                if (!dailySales[date]) {\n                    dailySales[date] = 0;\n                }\n                dailySales[date] += Number(sale.total_amount || 0);\n            });\n\n            // Create array for last 7 days (including today)\n            const last7Days = [];\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const dayName = formatPHDate(dateStr, { weekday: &#39;short&#39; });\n                \n                last7Days.push({\n                    date: dateStr,\n                    day: dayName,\n                    sales: dailySales[dateStr] || 0\n                });\n            }\n\n            console.log(&#39;Last 7 days data:&#39;, last7Days);\n            setLast7DaysSales(last7Days);\n        } catch (err) {\n            console.error(&#39;Error loading last 7 days sales:&#39;, err);\n        }\n    };\n\n    // Load all chart data\n    const loadChartData = async () =&gt; {\n        setChartsLoading(true);\n        try {\n            await Promise.all([\n                loadSalesByStall(),\n                loadStockByStall(),\n                loadSalesVsExpense(),\n                loadBestSellers(),\n                loadLast7DaysSales(),\n                loadAvailableStalls(),\n                loadTimeBasedSales(),\n                loadStallsStatus()\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading chart data:&#39;, err);\n        } finally {\n            setChartsLoading(false);\n        }\n    };\n\n    // Refresh all chart data\n    const refreshChartData = async () =&gt; {\n        console.log(&#39;Refreshing chart data...&#39;);\n        await loadChartData();\n    };\n\n    // Chart datasets\n    const donutSalesByStall = useMemo(() =&gt; ({\n        labels: salesByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Sales Count&#39;,\n                data: salesByStall.map(stall =&gt; stall.transaction_count),\n                backgroundColor: [&#39;#60a5fa&#39;, &#39;#f472b6&#39;, &#39;#34d399&#39;, &#39;#fbbf24&#39;, &#39;#a78bfa&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesByStall]);\n\n    const donutStockByStall = useMemo(() =&gt; ({\n        labels: stockByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Stock Qty&#39;,\n                data: stockByStall.map(stall =&gt; stall.total_stock),\n                backgroundColor: [&#39;#fbbf24&#39;, &#39;#818cf8&#39;, &#39;#f87171&#39;, &#39;#34d399&#39;, &#39;#f472b6&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [stockByStall]);\n\n    const donutSalesVsExpense = useMemo(() =&gt; ({\n        labels: [&#39;Sales&#39;, &#39;Expenses&#39;],\n        datasets: [\n            {\n                label: &#39;Amount&#39;,\n                data: [salesVsExpense.sales, salesVsExpense.expenses],\n                backgroundColor: [&#39;#22d3ee&#39;, &#39;#f97316&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesVsExpense]);\n\n    const donutBestSeller = useMemo(() =&gt; ({\n        labels: bestSellers.map(item =&gt; item.item_name),\n        datasets: [\n            {\n                label: &#39;Units Sold&#39;,\n                data: bestSellers.map(item =&gt; item.units_sold),\n                backgroundColor: [&#39;#86efac&#39;, &#39;#93c5fd&#39;, &#39;#fda4af&#39;, &#39;#fde68a&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [bestSellers]);\n\n    const last7DaysBar = useMemo(() =&gt; ({\n        labels: last7DaysSales.map(day =&gt; day.day),\n        datasets: [\n            {\n                label: &#39;Sales (PHP)&#39;,\n                data: last7DaysSales.map(day =&gt; day.sales),\n                backgroundColor: &#39;#60a5fa&#39;,\n                borderRadius: 6,\n            },\n        ],\n    }), [last7DaysSales]);\n\n    const timeBasedLine = useMemo(() =&gt; {\n        // Create complete date range for proper labeling\n        let allLabels = [];\n        let allData = [];\n        \n        if (timePeriod === &#39;yesterday&#39;) {\n            // Show yesterday in context of last 7 days\n            const now = getPHDate();\n            const yesterday = new Date(now);\n            yesterday.setDate(yesterday.getDate() - 1);\n            \n            // Generate last 7 days ending with yesterday\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(yesterday);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;week&#39;) {\n            // Generate last 7 days including today\n            const now = getPHDate();\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;month&#39;) {\n            // Generate all 12 months\n            const now = getPHDate();\n            for (let i = 11; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setMonth(date.getMonth() - i);\n                const year = date.getFullYear();\n                const month = String(date.getMonth() + 1).padStart(2, &#39;0&#39;);\n                const periodKey = &#96;${year}-${month}&#96;;\n                const label = formatPHDate(getPHDateString(date), { month: &#39;short&#39;, year: &#39;numeric&#39; });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this month\n                const salesData = timeBasedSales.find(item =&gt; item.period === periodKey);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        }\n\n        return {\n            labels: allLabels,\n            datasets: [\n                {\n                    label: &#39;Sales (₱)&#39;,\n                    data: allData,\n                    borderColor: &#39;#3B82F6&#39;,\n                    backgroundColor: &#39;rgba(59, 130, 246, 0.1)&#39;,\n                    borderWidth: 3,\n                    fill: true,\n                    tension: 0.4,\n                    pointBackgroundColor: allData.map((_, index) =&gt; {\n                        // Highlight the last point (yesterday) if in yesterday view\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return &#39;#10b981&#39;; // Green color for yesterday\n                        }\n                        return &#39;#3B82F6&#39;;\n                    }),\n                    pointBorderColor: &#39;#ffffff&#39;,\n                    pointBorderWidth: 2,\n                    pointRadius: allData.map((_, index) =&gt; {\n                        // Make yesterday&#39;s point slightly larger\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return 8;\n                        }\n                        return 6;\n                    }),\n                    pointHoverRadius: 10,\n                },\n            ],\n        };\n    }, [timeBasedSales, timePeriod, last7DaysSales]);\n\n    const donutOptions = useMemo(() =&gt; ({\n        plugins: {\n            legend: { position: &#39;bottom&#39; },\n            title: { display: false },\n        },\n        cutout: &#39;65%&#39;,\n        maintainAspectRatio: false,\n    }), []);\n\n    const barOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { display: false },\n            title: { display: false },\n            tooltip: { mode: &#39;index&#39;, intersect: false },\n        },\n        scales: {\n            x: { grid: { display: false } },\n            y: { grid: { color: &#39;rgba(0,0,0,0.05)&#39; }, beginAtZero: true },\n        },\n        maintainAspectRatio: false,\n    }), []);\n\n    const lineOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { \n                display: true,\n                position: &#39;top&#39;,\n                labels: {\n                    color: &#39;#374151&#39;,\n                    font: { size: 12 }\n                }\n            },\n            title: { display: false },\n            tooltip: { \n                mode: &#39;index&#39;, \n                intersect: false,\n                backgroundColor: &#39;#1F2937&#39;,\n                titleColor: &#39;#F9FAFB&#39;,\n                bodyColor: &#39;#F9FAFB&#39;,\n                borderColor: &#39;#374151&#39;,\n                borderWidth: 1,\n                callbacks: {\n                    label: function(context) {\n                        return &#96;Sales: ₱${Number(context.parsed.y).toLocaleString()}&#96;;\n                    }\n                }\n            },\n        },\n        scales: {\n            x: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { color: &#39;#6B7280&#39; }\n            },\n            y: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { \n                    color: &#39;#6B7280&#39;,\n                    callback: function(value) {\n                        return &#39;₱&#39; + Number(value).toLocaleString();\n                    }\n                },\n                beginAtZero: true \n            },\n        },\n        maintainAspectRatio: false,\n        interaction: {\n            intersect: false,\n            mode: &#39;index&#39;\n        }\n    }), []);\n\n    // Reload time-based sales when controls change\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            loadTimeBasedSales();\n        }\n    }, [selectedStall, timePeriod]);\n\n    // Refresh chart data periodically and on mount for admin\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            // Initial load\n            loadChartData();\n            \n            // Set up periodic refresh every 30 seconds\n            const refreshInterval = setInterval(() =&gt; {\n                refreshChartData();\n            }, 30000);\n\n            // Cleanup interval on unmount\n            return () =&gt; clearInterval(refreshInterval);\n        }\n    }, [userProfile?.role]);\n\n    // Load staff dashboard data for staff\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;staff&#39;) {\n            loadStaffDashboardData();\n        }\n    }, [userProfile?.role]);\n\n    useEffect(() =&gt; {\n        const getUser = async () =&gt; {\n            const { data: { user } } = await supabase.auth.getUser();\n\n            if (user) {\n                // Fetch profile info from your database\n                const { data: profile, error } = await supabase\n                    .from(&#39;profiles&#39;)\n                    .select(&#39;role, full_name, stall_id, status&#39;)\n                    .eq(&#39;id&#39;, user.id)\n                    .single();\n\n                if (error) {\n                    console.error(&#39;Error fetching profile:&#39;, error);\n                } else {\n                    setUserProfile(profile);\n                    console.log(&#39;Profile loaded:&#39;, profile);\n                }\n            }\n\n            setLoading(false);\n        };\n\n        getUser();\n    }, []);\n\n    if (loading) {\n        return (\n            &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n                &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n            &lt;/div&gt;\n        );\n    }\n\n    return (\n        &lt;Layout userProfile={userProfile}&gt;\n            &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n                &lt;div className=\&quot;mb-6\&quot;&gt;\n                    &lt;h1 className=\&quot;text-3xl font-bold text-primary\&quot;&gt;\n                        {isAdmin(userProfile) ? &#39;Admin Dashboard&#39; : &#39;Staff Dashboard&#39;}\n                    &lt;/h1&gt;\n                    {!isAdmin(userProfile) &amp;&amp; (\n                        &lt;p className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                            Today • My Stall\n                        &lt;/p&gt;\n                    )}\n                &lt;/div&gt;\n\n                {isAdmin(userProfile) ? (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-3 gap-6\&quot;&gt;\n                        {/* Combined: Sales over time by stall (spans 2 columns) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl lg:col-span-2\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title\&quot;&gt;Sales Summary&lt;/h2&gt;\n                                    &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={selectedStall}\n                                                onChange={(e) =&gt; setSelectedStall(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;all\&quot;&gt;All Stalls&lt;/option&gt;\n                                                {availableStalls.map(stall =&gt; (\n                                                    &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                                        {stall.stall_name}\n                                                    &lt;/option&gt;\n                                                ))}\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={timePeriod}\n                                                onChange={(e) =&gt; setTimePeriod(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;yesterday\&quot;&gt;Yesterday&lt;/option&gt;\n                                                &lt;option value=\&quot;week\&quot;&gt;Last 7 Days&lt;/option&gt;\n                                                &lt;option value=\&quot;month\&quot;&gt;Last 12 Months&lt;/option&gt;\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                &lt;/div&gt;\n                                &lt;div className=\&quot;h-80\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Line data={timeBasedLine} options={lineOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Stocks per stall */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Stocks per Stall&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutStockByStall} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Sales vs Expense */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Sales vs Expense&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutSalesVsExpense} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Best seller */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Best Seller&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutBestSeller} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Business Stalls Statuses */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Business Stalls Statuses&lt;/h2&gt;\n                                &lt;div className=\&quot;space-y-3\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full py-8\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : stallsStatus.length === 0 ? (\n                                        &lt;div className=\&quot;text-base-content/50 text-center py-4\&quot;&gt;\n                                            No stalls available.\n                                        &lt;/div&gt;\n                                    ) : (\n                                        stallsStatus.map((stall) =&gt; {\n                                            const getBusinessStatusBadgeColor = (status) =&gt; {\n                                                switch (status) {\n                                                    case &#39;active&#39;:\n                                                        return &#39;badge-success&#39;;\n                                                    case &#39;inactive&#39;:\n                                                        return &#39;badge-error&#39;;\n                                                    case &#39;under maintenance&#39;:\n                                                        return &#39;badge-warning&#39;;\n                                                    default:\n                                                        return &#39;badge-neutral&#39;;\n                                                }\n                                            };\n\n                                            const getStockStatusBadgeColor = (stockStatus) =&gt; {\n                                                switch (stockStatus) {\n                                                    case &#39;sold_out&#39;:\n                                                        return &#39;badge-error&#39;;\n                                                    case &#39;not_sold_out&#39;:\n                                                    default:\n                                                        return &#39;badge-success&#39;;\n                                                }\n                                            };\n\n                                            const stockStatusLabel =\n                                                stall.stockStatus === &#39;sold_out&#39;\n                                                    ? &#39;Sold Out&#39;\n                                                    : &#39;Not Sold Out&#39;;\n\n                                            return (\n                                                &lt;div\n                                                    key={stall.stall_id}\n                                                    className=\&quot;flex items-center justify-between p-3 bg-base-200 rounded-lg\&quot;\n                                                &gt;\n                                                    &lt;div className=\&quot;flex-1\&quot;&gt;\n                                                        &lt;div className=\&quot;font-semibold\&quot;&gt;{stall.stall_name}&lt;/div&gt;\n                                                        {stall.location &amp;&amp; (\n                                                            &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                                                                {stall.location}\n                                                            &lt;/div&gt;\n                                                        )}\n                                                    &lt;/div&gt;\n                                                    &lt;div className=\&quot;flex flex-col items-end gap-1\&quot;&gt;\n                                                        &lt;span\n                                                            className={&#96;badge ${getBusinessStatusBadgeColor(\n                                                                stall.status\n                                                            )}&#96;}\n                                                        &gt;\n                                                            {stall.status || &#39;N/A&#39;}\n                                                        &lt;/span&gt;\n                                                        &lt;span\n                                                            className={&#96;badge ${getStockStatusBadgeColor(\n                                                                stall.stockStatus\n                                                            )}&#96;}\n                                                        &gt;\n                                                            {stockStatusLabel}\n                                                        &lt;/span&gt;\n                                                    &lt;/div&gt;\n                                                &lt;/div&gt;\n                                            );\n                                        })\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                    &lt;/div&gt;\n                ) : (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n                        {/* Staff: Recent Transactions (Today, My Stall) */}\n                    &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                        &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Today&amp;apos;s Recent Transactions&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : staffTransactions.length === 0 ? (\n                                    &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;\n                                        No transactions recorded yet for today.\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;overflow-x-auto max-h-80\&quot;&gt;\n                                        &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                                            &lt;thead&gt;\n                                                &lt;tr&gt;\n                                                    &lt;th&gt;Time&lt;/th&gt;\n                                                    &lt;th&gt;Item&lt;/th&gt;\n                                                    &lt;th&gt;Qty&lt;/th&gt;\n                                                    &lt;th&gt;Amount&lt;/th&gt;\n                                                    &lt;th&gt;Payment&lt;/th&gt;\n                                                &lt;/tr&gt;\n                                            &lt;/thead&gt;\n                                            &lt;tbody&gt;\n                                                {staffTransactions.map((tx) =&gt; (\n                                                    &lt;tr key={tx.sale_id}&gt;\n                                                        &lt;td&gt;{tx.sale_date}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.quantity_sold}&lt;/td&gt;\n                                                        &lt;td className=\&quot;text-success font-semibold\&quot;&gt;\n                                                            ₱{Number(tx.total_amount || 0).toFixed(2)}\n                                                        &lt;/td&gt;\n                                                        &lt;td&gt;\n                                                            &lt;span className={&#96;badge ${tx.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                                                {tx.payment_method}\n                                                            &lt;/span&gt;\n                                                        &lt;/td&gt;\n                                                    &lt;/tr&gt;\n                                                ))}\n                                            &lt;/tbody&gt;\n                                        &lt;/table&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Staff: Key Statistics (Today, My Stall) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-accent\&quot;&gt;Today&amp;apos;s Key Statistics&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-4\&quot;&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Stock Distributed&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-success\&quot;&gt;\n                                                {staffStatistics.stockDistributed.toFixed(2)} kg\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Sales&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-primary\&quot;&gt;\n                                                ₱{staffStatistics.totalSales.toFixed(2)}\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Stock Status&lt;/div&gt;\n                                            &lt;div className=\&quot;flex items-center gap-3 mt-2\&quot;&gt;\n                                                &lt;button\n                                                    type=\&quot;button\&quot;\n                                                    className=\&quot;btn btn-sm btn-outline\&quot;\n                                                    onClick={handleToggleStockStatus}\n                                                    disabled={updatingStockStatus}\n                                                &gt;\n                                                    &lt;span\n                                                        className={&#96;badge badge-lg ${\n                                                            staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                                ? &#39;badge-error&#39;\n                                                                : &#39;badge-success&#39;\n                                                        }&#96;}\n                                                    &gt;\n                                                        {staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                            ? &#39;Sold Out&#39;\n                                                            : &#39;Not Sold Out&#39;}\n                                                    &lt;/span&gt;\n                                                &lt;/button&gt;\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                )}\n            &lt;/div&gt;\n        &lt;/Layout&gt;\n    );\n}\n\nexport default Dashboard;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Extend Dashboard.loadStallsStatus to join today’s stock_status_history data for all stalls and attach stockStatus to each stall entry.
- [x] Update the Business Stalls Statuses card in dashboard.jsx to render an additional Sold Out / Not Sold Out badge per stall using DaisyUI badge classes.

</details>
</tool-use>

---

I’ve updated the dashboard UI so each business stall row now shows both its business status and a Sold Out / Not Sold Out badge derived from today’s stock history. Next I’ll run lint/tests and then you can visually confirm it on the Admin Dashboard.

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main && npm test</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main && npm test
```

```
At C:\Users\ADZ\AppData\Local\Temp\ps-script-2a1f7cba-ec2d-4aa5-82a3-54e36c8f6279.ps1:7 char:40
+ cd C:\Users\ADZ\Desktop\itpm-proj-main &amp;&amp; npm test
+                                        ~~
The token &#39;&amp;&amp;&#39; is not a valid statement separator in this version.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : InvalidEndOfLine
 

```
</details>
</tool-use>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  142:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  556:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  604:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  713:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  724:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  793:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  809:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  816:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---



---

### What I implemented

- **Business Stalls now show Sold Out / Not Sold Out on the Admin Dashboard**  
  - The `Business Stalls Statuses` card in `dashboard.jsx` now reads today’s stock status from `stock_status_history` and merges it with each stall:
    - It first loads stalls from `stalls` (`stall_id, stall_name, location, status`).
    - It then queries `stock_status_history` for **today (PH timezone)** for all those `stall_id`s and builds a lookup of `stockStatus`/`stockLevel` per stall.
    - Each `stall` in `stallsStatus` now has `stockStatus` (`'sold_out'` or `'not_sold_out'`) and `stockLevel`.
- **UI changes on the Admin Dashboard card**
  - For each stall row, the right side now shows **two badges** using DaisyUI classes:
    - **Business status badge** (existing logic, unchanged visually):  
      - `active` → `badge badge-success`  
      - `inactive` → `badge badge-error`  
      - `under maintenance` → `badge badge-warning`
    - **New stock status badge**:
      - `sold_out` → `badge badge-error` with label **“Sold Out”**  
      - `not_sold_out` (or missing entry for today) → `badge badge-success` with label **“Not Sold Out”**

### How it behaves

- When staff toggle their stall to **Sold Out / Not Sold Out** (via their dashboard, which already calls `saveTodayStockStatus`), the change is written into `stock_status_history`.
- On the Admin Dashboard:
  - Each stall’s **stock badge** now reflects that **Sold Out / Not Sold Out** state for **today**.
  - If there’s no entry for a stall in `stock_status_history` for today, it **defaults to Not Sold Out**, matching your helper behavior.

If you want, I can next clean up some of the existing ESLint warnings/errors in `dashboard.jsx` and related files, but they don’t affect this sold-out display feature.

---

_**User (2025-11-16 05:55Z)**_

in this layout, just make it list in tables: Stall, Active Status, Sold Out Status.

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Investigating code changes**

I'm looking at the implementation details for the stall column, making sure to include the stall name and a small location. I think it’s important to also keep the badge color helpers inside the map. It sounds like they want me to run tests after the code changes, but since I've already run lint and noted some unrelated errors, I don't believe it's necessary to do that again for such a minor adjustment. I’ll use apply_patch with the right context.</details></think>

---

I’ll switch the Business Stalls card back to a DaisyUI table with three columns (Stall, Active Status, Sold Out Status) while keeping the sold-out logic you already have wired up.

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/dashboard.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;74b5a986-51b0-4055-89f7-6730a5de1e1f&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                              &lt;div className=\&quot;card-body\&quot;&gt;\n                                  &lt;h2 className=\&quot;card-title\&quot;&gt;Business Stalls Statuses&lt;/h2&gt;\n-                                 &lt;div className=\&quot;space-y-3\&quot;&gt;\n-                                     {chartsLoading ? (\n-                                         &lt;div className=\&quot;flex items-center justify-center h-full py-8\&quot;&gt;\n-                                             &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n-                                         &lt;/div&gt;\n-                                     ) : stallsStatus.length === 0 ? (\n-                                         &lt;div className=\&quot;text-base-content/50 text-center py-4\&quot;&gt;\n-                                             No stalls available.\n-                                         &lt;/div&gt;\n-                                     ) : (\n-                                         stallsStatus.map((stall) =&gt; {\n-                                             const getBusinessStatusBadgeColor = (status) =&gt; {\n-                                                 switch (status) {\n-                                                     case &#39;active&#39;:\n-                                                         return &#39;badge-success&#39;;\n-                                                     case &#39;inactive&#39;:\n-                                                         return &#39;badge-error&#39;;\n-                                                     case &#39;under maintenance&#39;:\n-                                                         return &#39;badge-warning&#39;;\n-                                                     default:\n-                                                         return &#39;badge-neutral&#39;;\n-                                                 }\n-                                             };\n+                                 {chartsLoading ? (\n+                                     &lt;div className=\&quot;flex items-center justify-center h-full py-8\&quot;&gt;\n+                                         &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n+                                     &lt;/div&gt;\n+                                 ) : stallsStatus.length === 0 ? (\n+                                     &lt;div className=\&quot;text-base-content/50 text-center py-4\&quot;&gt;\n+                                         No stalls available.\n+                                     &lt;/div&gt;\n+                                 ) : (\n+                                     &lt;div className=\&quot;overflow-x-auto\&quot;&gt;\n+                                         &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n+                                             &lt;thead&gt;\n+                                                 &lt;tr&gt;\n+                                                     &lt;th&gt;Stall&lt;/th&gt;\n+                                                     &lt;th&gt;Active Status&lt;/th&gt;\n+                                                     &lt;th&gt;Sold Out Status&lt;/th&gt;\n+                                                 &lt;/tr&gt;\n+                                             &lt;/thead&gt;\n+                                             &lt;tbody&gt;\n+                                                 {stallsStatus.map((stall) =&gt; {\n+                                                     const getBusinessStatusBadgeColor = (status) =&gt; {\n+                                                         switch (status) {\n+                                                             case &#39;active&#39;:\n+                                                                 return &#39;badge-success&#39;;\n+                                                             case &#39;inactive&#39;:\n+                                                                 return &#39;badge-error&#39;;\n+                                                             case &#39;under maintenance&#39;:\n+                                                                 return &#39;badge-warning&#39;;\n+                                                             default:\n+                                                                 return &#39;badge-neutral&#39;;\n+                                                         }\n+                                                     };\n  \n-                                             const getStockStatusBadgeColor = (stockStatus) =&gt; {\n-                                                 switch (stockStatus) {\n-                                                     case &#39;sold_out&#39;:\n-                                                         return &#39;badge-error&#39;;\n-                                                     case &#39;not_sold_out&#39;:\n-                                                     default:\n-                                                         return &#39;badge-success&#39;;\n-                                                 }\n-                                             };\n+                                                     const getStockStatusBadgeColor = (stockStatus) =&gt; {\n+                                                         switch (stockStatus) {\n+                                                             case &#39;sold_out&#39;:\n+                                                                 return &#39;badge-error&#39;;\n+                                                             case &#39;not_sold_out&#39;:\n+                                                             default:\n+                                                                 return &#39;badge-success&#39;;\n+                                                         }\n+                                                     };\n  \n-                                             const stockStatusLabel =\n-                                                 stall.stockStatus === &#39;sold_out&#39;\n-                                                     ? &#39;Sold Out&#39;\n-                                                     : &#39;Not Sold Out&#39;;\n+                                                     const stockStatusLabel =\n+                                                         stall.stockStatus === &#39;sold_out&#39;\n+                                                             ? &#39;Sold Out&#39;\n+                                                             : &#39;Not Sold Out&#39;;\n  \n-                                             return (\n-                                                 &lt;div\n-                                                     key={stall.stall_id}\n-                                                     className=\&quot;flex items-center justify-between p-3 bg-base-200 rounded-lg\&quot;\n-                                                 &gt;\n-                                                     &lt;div className=\&quot;flex-1\&quot;&gt;\n-                                                         &lt;div className=\&quot;font-semibold\&quot;&gt;{stall.stall_name}&lt;/div&gt;\n-                                                         {stall.location &amp;&amp; (\n-                                                             &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;\n-                                                                 {stall.location}\n-                                                             &lt;/div&gt;\n-                                                         )}\n-                                                     &lt;/div&gt;\n-                                                     &lt;div className=\&quot;flex flex-col items-end gap-1\&quot;&gt;\n-                                                         &lt;span\n-                                                             className={&#96;badge ${getBusinessStatusBadgeColor(\n-                                                                 stall.status\n-                                                             )}&#96;}\n-                                                         &gt;\n-                                                             {stall.status || &#39;N/A&#39;}\n-                                                         &lt;/span&gt;\n-                                                         &lt;span\n-                                                             className={&#96;badge ${getStockStatusBadgeColor(\n-                                                                 stall.stockStatus\n-                                                             )}&#96;}\n-                                                         &gt;\n-                                                             {stockStatusLabel}\n-                                                         &lt;/span&gt;\n-                                                     &lt;/div&gt;\n-                                                 &lt;/div&gt;\n-                                             );\n-                                         })\n-                                     )}\n-                                 &lt;/div&gt;\n+                                                     return (\n+                                                         &lt;tr key={stall.stall_id}&gt;\n+                                                             &lt;td&gt;\n+                                                                 &lt;div className=\&quot;font-semibold\&quot;&gt;\n+                                                                     {stall.stall_name}\n+                                                                 &lt;/div&gt;\n+                                                                 {stall.location &amp;&amp; (\n+                                                                     &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;\n+                                                                         {stall.location}\n+                                                                     &lt;/div&gt;\n+                                                                 )}\n+                                                             &lt;/td&gt;\n+                                                             &lt;td&gt;\n+                                                                 &lt;span\n+                                                                     className={&#96;badge ${getBusinessStatusBadgeColor(\n+                                                                         stall.status\n+                                                                     )}&#96;}\n+                                                                 &gt;\n+                                                                     {stall.status || &#39;N/A&#39;}\n+                                                                 &lt;/span&gt;\n+                                                             &lt;/td&gt;\n+                                                             &lt;td&gt;\n+                                                                 &lt;span\n+                                                                     className={&#96;badge ${getStockStatusBadgeColor(\n+                                                                         stall.stockStatus\n+                                                                     )}&#96;}\n+                                                                 &gt;\n+                                                                     {stockStatusLabel}\n+                                                                 &lt;/span&gt;\n+                                                             &lt;/td&gt;\n+                                                         &lt;/tr&gt;\n+                                                     );\n+                                                 })}\n+                                             &lt;/tbody&gt;\n+                                         &lt;/table&gt;\n+                                     &lt;/div&gt;\n+                                 )}\n                              &lt;/div&gt;\n                          &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 963,
        &quot;newStart&quot;: 963,
        &quot;oldLines&quot;: 77,
        &quot;newLines&quot;: 89,
        &quot;linesRemoved&quot;: 70,
        &quot;linesAdded&quot;: 82
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/dashboard.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect, useMemo } from &#39;react&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport { isAdmin } from &#39;./utils/roleUtils&#39;;\nimport { getPHDateString, getPHDate, formatPHDate, getPHDateDaysAgo, parseSaleDate } from &#39;./utils/dateUtils&#39;;\nimport {\n    restrictToStaffStallAndToday,\n    fetchCurrentStallStockForStaff,\n    fetchTodaySalesTotalForStaff,\n    fetchTodayStockStatus,\n    saveTodayStockStatus,\n} from &#39;./utils/staffReportsToday&#39;;\nimport Layout from &#39;./components/Layout&#39;;\n// Charts\nimport {\n    Chart as ChartJS,\n    ArcElement,\n    BarElement,\n    LineElement,\n    PointElement,\n    CategoryScale,\n    LinearScale,\n    Tooltip,\n    Legend,\n    Title,\n} from &#39;chart.js&#39;;\nimport { Doughnut, Bar, Line } from &#39;react-chartjs-2&#39;;\n\nChartJS.register(ArcElement, BarElement, LineElement, PointElement, CategoryScale, LinearScale, Tooltip, Legend, Title);\n\nfunction Dashboard() {\n    const [userProfile, setUserProfile] = useState(null);\n    const [loading, setLoading] = useState(true);\n    \n    // Chart data states\n    const [salesByStall, setSalesByStall] = useState([]);\n    const [stockByStall, setStockByStall] = useState([]);\n    const [salesVsExpense, setSalesVsExpense] = useState({ sales: 0, expenses: 0 });\n    const [bestSellers, setBestSellers] = useState([]);\n    const [last7DaysSales, setLast7DaysSales] = useState([]);\n    const [chartsLoading, setChartsLoading] = useState(true);\n    const [stallsStatus, setStallsStatus] = useState([]);\n    \n    // Line chart states\n    const [timeBasedSales, setTimeBasedSales] = useState([]);\n    const [selectedStall, setSelectedStall] = useState(&#39;all&#39;);\n    const [timePeriod, setTimePeriod] = useState(&#39;yesterday&#39;);\n    const [availableStalls, setAvailableStalls] = useState([]);\n\n    // Staff dashboard states\n    const [staffTransactions, setStaffTransactions] = useState([]);\n    const [staffStatistics, setStaffStatistics] = useState({\n        totalSales: 0,\n        stockDistributed: 0,\n        stockStatus: &#39;not_sold_out&#39;,\n    });\n    const [staffCardsLoading, setStaffCardsLoading] = useState(true);\n    const [updatingStockStatus, setUpdatingStockStatus] = useState(false);\n\n    // Load sales by stall data\n    const loadSalesByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    stall_id,\n                    total_amount,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallSales = {};\n            data?.forEach(sale =&gt; {\n                const stallId = sale.stall_id;\n                const stallName = sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallSales[stallId]) {\n                    stallSales[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_sales: 0,\n                        transaction_count: 0\n                    };\n                }\n                stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n                stallSales[stallId].transaction_count += 1;\n            });\n\n            setSalesByStall(Object.values(stallSales));\n        } catch (err) {\n            console.error(&#39;Error loading sales by stall:&#39;, err);\n        }\n    };\n\n    // Load stock by stall data\n    const loadStockByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stall_stocks&#39;)\n                .select(&#96;\n                    stall_id,\n                    quantity,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallStock = {};\n            data?.forEach(stock =&gt; {\n                const stallId = stock.stall_id;\n                const stallName = stock.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallStock[stallId]) {\n                    stallStock[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_stock: 0\n                    };\n                }\n                stallStock[stallId].total_stock += Number(stock.quantity || 0);\n            });\n\n            setStockByStall(Object.values(stallStock));\n        } catch (err) {\n            console.error(&#39;Error loading stock by stall:&#39;, err);\n        }\n    };\n\n    // Load sales vs expenses data\n    const loadSalesVsExpense = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            // Get total sales\n            const { data: salesData, error: salesError } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;total_amount&#39;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (salesError) throw salesError;\n\n            // Get total expenses\n            const { data: expensesData, error: expensesError } = await supabase\n                .from(&#39;expenses&#39;)\n                .select(&#39;cost&#39;)\n                .gte(&#39;date&#39;, twelveMonthsAgoStr);\n\n            if (expensesError) throw expensesError;\n\n            const totalSales = salesData?.reduce((sum, sale) =&gt; sum + Number(sale.total_amount || 0), 0) || 0;\n            const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + Number(expense.cost || 0), 0) || 0;\n\n            setSalesVsExpense({ sales: totalSales, expenses: totalExpenses });\n        } catch (err) {\n            console.error(&#39;Error loading sales vs expenses:&#39;, err);\n        }\n    };\n\n    // Load best sellers data\n    const loadBestSellers = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    quantity_sold,\n                    menu_items(item_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (error) throw error;\n\n            // Group by item and calculate totals\n            const itemSales = {};\n            data?.forEach(sale =&gt; {\n                const itemName = sale.menu_items?.item_name || &#39;Unknown Item&#39;;\n                \n                if (!itemSales[itemName]) {\n                    itemSales[itemName] = {\n                        item_name: itemName,\n                        units_sold: 0\n                    };\n                }\n                itemSales[itemName].units_sold += Number(sale.quantity_sold || 0);\n            });\n\n            // Sort by units sold and take top 4\n            const sortedItems = Object.values(itemSales)\n                .sort((a, b) =&gt; b.units_sold - a.units_sold)\n                .slice(0, 4);\n\n            setBestSellers(sortedItems);\n        } catch (err) {\n            console.error(&#39;Error loading best sellers:&#39;, err);\n        }\n    };\n\n    // Load time-based sales data for line chart\n    const loadTimeBasedSales = async () =&gt; {\n        try {\n            let startDate, endDate, groupBy;\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            \n            if (timePeriod === &#39;yesterday&#39;) {\n                // Show yesterday in context of last 7 days for better visualization\n                const yesterday = new Date(now);\n                yesterday.setDate(yesterday.getDate() - 1);\n                startDate = new Date(yesterday);\n                startDate.setDate(startDate.getDate() - 6); // Go back 6 more days (7 days total)\n                endDate = new Date(yesterday);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;week&#39;) {\n                // Last 7 days including today\n                startDate = new Date(now);\n                startDate.setDate(startDate.getDate() - 6);\n                endDate = new Date(now);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;month&#39;) {\n                // Last 12 months\n                startDate = new Date(now);\n                startDate.setMonth(startDate.getMonth() - 11);\n                startDate.setDate(1);\n                endDate = new Date(now);\n                groupBy = &#39;month&#39;;\n            }\n\n            const startDateStr = getPHDateString(startDate);\n            const endDateStr = getPHDateString(endDate);\n\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_date,\n                    total_amount,\n                    stall_id,\n                    stalls(stall_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, startDateStr)\n                .lte(&#39;sale_date&#39;, endDateStr)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            // Filter by selected stall if not &#39;all&#39;\n            if (selectedStall !== &#39;all&#39;) {\n                query = query.eq(&#39;stall_id&#39;, selectedStall);\n            }\n\n            const { data, error } = await query;\n\n            if (error) throw error;\n\n            // Group data by time period - parse sale_date as PH date\n            const groupedData = {};\n            data?.forEach(sale =&gt; {\n                // Parse sale_date string (YYYY-MM-DD) as PH date\n                const saleDateStr = parseSaleDate(sale.sale_date);\n                let key;\n\n                if (groupBy === &#39;day&#39;) {\n                    key = saleDateStr; // Already YYYY-MM-DD format\n                } else if (groupBy === &#39;month&#39;) {\n                    const [year, month] = saleDateStr.split(&#39;-&#39;);\n                    key = &#96;${year}-${month}&#96;;\n                }\n\n                if (!groupedData[key]) {\n                    groupedData[key] = {\n                        period: key,\n                        sales: 0,\n                        transactions: 0\n                    };\n                }\n                groupedData[key].sales += Number(sale.total_amount || 0);\n                groupedData[key].transactions += 1;\n            });\n\n            // Convert to array and sort\n            const timeBasedData = Object.values(groupedData).sort((a, b) =&gt; {\n                if (groupBy === &#39;day&#39;) {\n                    return a.period.localeCompare(b.period);\n                } else if (groupBy === &#39;month&#39;) {\n                    return a.period.localeCompare(b.period);\n                }\n                return 0;\n            });\n\n            setTimeBasedSales(timeBasedData);\n        } catch (err) {\n            console.error(&#39;Error loading time-based sales:&#39;, err);\n        }\n    };\n\n    // Load available stalls for dropdown\n    const loadAvailableStalls = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (error) throw error;\n            setAvailableStalls(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading stalls:&#39;, err);\n        }\n    };\n\n    // Load stalls status data, including today&#39;s stock sold-out status\n    const loadStallsStatus = async () =&gt; {\n        try {\n            // First load all business stalls\n            const { data: stallsData, error: stallsError } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name, location, status&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (stallsError) throw stallsError;\n\n            const stalls = stallsData || [];\n\n            // If there are no stalls, we can short-circuit\n            if (stalls.length === 0) {\n                setStallsStatus([]);\n                return;\n            }\n\n            // Build today&#39;s date range in PH timezone (same logic as staffReportsToday helpers)\n            const today = getPHDate();\n            const todayStr = getPHDateString(today);\n\n            // Fetch today&#39;s stock status for all stalls in a single query\n            const stallIds = stalls.map((stall) =&gt; stall.stall_id);\n            const { data: stockStatusData, error: stockStatusError } = await supabase\n                .from(&#39;stock_status_history&#39;)\n                .select(&#39;stall_id, stock_status, stock_level, date&#39;)\n                .in(&#39;stall_id&#39;, stallIds)\n                .eq(&#39;date&#39;, todayStr);\n\n            if (stockStatusError) throw stockStatusError;\n\n            // Build a lookup map for today&#39;s stock status per stall\n            const stockStatusByStallId = {};\n            (stockStatusData || []).forEach((row) =&gt; {\n                stockStatusByStallId[row.stall_id] = {\n                    stockStatus: row.stock_status || &#39;not_sold_out&#39;,\n                    stockLevel:\n                        typeof row.stock_level === &#39;number&#39;\n                            ? row.stock_level\n                            : Number(row.stock_level || 0),\n                };\n            });\n\n            // Merge business status with today&#39;s stock status, defaulting to not_sold_out\n            const merged = stalls.map((stall) =&gt; {\n                const stockInfo = stockStatusByStallId[stall.stall_id] || {\n                    stockStatus: &#39;not_sold_out&#39;,\n                    stockLevel: null,\n                };\n\n                return {\n                    ...stall,\n                    stockStatus: stockInfo.stockStatus,\n                    stockLevel: stockInfo.stockLevel,\n                };\n            });\n\n            setStallsStatus(merged);\n        } catch (err) {\n            console.error(&#39;Error loading stalls status:&#39;, err);\n        }\n    };\n\n    // Staff: load recent transactions for today for their stall\n    const loadStaffRecentTransactions = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_id,\n                    sale_date,\n                    quantity_sold,\n                    total_amount,\n                    payment_method,\n                    stall_id,\n                    product_id,\n                    stalls(stall_name),\n                    menu_items(item_name)\n                &#96;);\n\n            query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n            const { data, error } = await query\n                .order(&#39;sale_date&#39;, { ascending: false })\n                .limit(10);\n\n            if (error) throw error;\n            setStaffTransactions(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading staff recent transactions:&#39;, err);\n        }\n    };\n\n    // Staff: load key statistics for today for their stall\n    const loadStaffStatistics = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            const [stockDistributed, totalSales, stockStatusInfo] = await Promise.all([\n                fetchCurrentStallStockForStaff(userProfile),\n                fetchTodaySalesTotalForStaff(userProfile),\n                fetchTodayStockStatus(userProfile.stall_id),\n            ]);\n\n            setStaffStatistics({\n                totalSales: totalSales || 0,\n                stockDistributed: stockDistributed || 0,\n                stockStatus: stockStatusInfo?.stockStatus || &#39;not_sold_out&#39;,\n            });\n        } catch (err) {\n            console.error(&#39;Error loading staff statistics:&#39;, err);\n        }\n    };\n\n    const loadStaffDashboardData = async () =&gt; {\n        setStaffCardsLoading(true);\n        try {\n            await Promise.all([\n                loadStaffRecentTransactions(),\n                loadStaffStatistics(),\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading staff dashboard data:&#39;, err);\n        } finally {\n            setStaffCardsLoading(false);\n        }\n    };\n\n    const handleToggleStockStatus = async () =&gt; {\n        if (!userProfile) return;\n\n        const nextStatus =\n            staffStatistics.stockStatus === &#39;sold_out&#39; ? &#39;not_sold_out&#39; : &#39;sold_out&#39;;\n\n        setUpdatingStockStatus(true);\n        try {\n            await saveTodayStockStatus(\n                userProfile.stall_id,\n                staffStatistics.stockDistributed,\n                nextStatus\n            );\n            setStaffStatistics((prev) =&gt; ({\n                ...prev,\n                stockStatus: nextStatus,\n            }));\n        } catch (err) {\n            console.error(&#39;Error toggling stock status:&#39;, err);\n        } finally {\n            setUpdatingStockStatus(false);\n        }\n    };\n\n    // Load last 7 days sales data\n    const loadLast7DaysSales = async () =&gt; {\n        try {\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            const today = getPHDateString(now);\n            \n            // Get 7 days ago (including today, so 6 days back)\n            const sevenDaysAgo = new Date(now);\n            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 6);\n            const sevenDaysAgoStr = getPHDateString(sevenDaysAgo);\n\n            console.log(&#39;Loading sales from:&#39;, sevenDaysAgoStr, &#39;to:&#39;, today);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;sale_date, total_amount&#39;)\n                .gte(&#39;sale_date&#39;, sevenDaysAgoStr)\n                .lte(&#39;sale_date&#39;, today)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            if (error) throw error;\n\n            // Group by date and calculate daily totals - parse sale_date as PH date\n            const dailySales = {};\n            data?.forEach(sale =&gt; {\n                const date = parseSaleDate(sale.sale_date);\n                if (!dailySales[date]) {\n                    dailySales[date] = 0;\n                }\n                dailySales[date] += Number(sale.total_amount || 0);\n            });\n\n            // Create array for last 7 days (including today)\n            const last7Days = [];\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const dayName = formatPHDate(dateStr, { weekday: &#39;short&#39; });\n                \n                last7Days.push({\n                    date: dateStr,\n                    day: dayName,\n                    sales: dailySales[dateStr] || 0\n                });\n            }\n\n            console.log(&#39;Last 7 days data:&#39;, last7Days);\n            setLast7DaysSales(last7Days);\n        } catch (err) {\n            console.error(&#39;Error loading last 7 days sales:&#39;, err);\n        }\n    };\n\n    // Load all chart data\n    const loadChartData = async () =&gt; {\n        setChartsLoading(true);\n        try {\n            await Promise.all([\n                loadSalesByStall(),\n                loadStockByStall(),\n                loadSalesVsExpense(),\n                loadBestSellers(),\n                loadLast7DaysSales(),\n                loadAvailableStalls(),\n                loadTimeBasedSales(),\n                loadStallsStatus()\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading chart data:&#39;, err);\n        } finally {\n            setChartsLoading(false);\n        }\n    };\n\n    // Refresh all chart data\n    const refreshChartData = async () =&gt; {\n        console.log(&#39;Refreshing chart data...&#39;);\n        await loadChartData();\n    };\n\n    // Chart datasets\n    const donutSalesByStall = useMemo(() =&gt; ({\n        labels: salesByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Sales Count&#39;,\n                data: salesByStall.map(stall =&gt; stall.transaction_count),\n                backgroundColor: [&#39;#60a5fa&#39;, &#39;#f472b6&#39;, &#39;#34d399&#39;, &#39;#fbbf24&#39;, &#39;#a78bfa&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesByStall]);\n\n    const donutStockByStall = useMemo(() =&gt; ({\n        labels: stockByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Stock Qty&#39;,\n                data: stockByStall.map(stall =&gt; stall.total_stock),\n                backgroundColor: [&#39;#fbbf24&#39;, &#39;#818cf8&#39;, &#39;#f87171&#39;, &#39;#34d399&#39;, &#39;#f472b6&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [stockByStall]);\n\n    const donutSalesVsExpense = useMemo(() =&gt; ({\n        labels: [&#39;Sales&#39;, &#39;Expenses&#39;],\n        datasets: [\n            {\n                label: &#39;Amount&#39;,\n                data: [salesVsExpense.sales, salesVsExpense.expenses],\n                backgroundColor: [&#39;#22d3ee&#39;, &#39;#f97316&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesVsExpense]);\n\n    const donutBestSeller = useMemo(() =&gt; ({\n        labels: bestSellers.map(item =&gt; item.item_name),\n        datasets: [\n            {\n                label: &#39;Units Sold&#39;,\n                data: bestSellers.map(item =&gt; item.units_sold),\n                backgroundColor: [&#39;#86efac&#39;, &#39;#93c5fd&#39;, &#39;#fda4af&#39;, &#39;#fde68a&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [bestSellers]);\n\n    const last7DaysBar = useMemo(() =&gt; ({\n        labels: last7DaysSales.map(day =&gt; day.day),\n        datasets: [\n            {\n                label: &#39;Sales (PHP)&#39;,\n                data: last7DaysSales.map(day =&gt; day.sales),\n                backgroundColor: &#39;#60a5fa&#39;,\n                borderRadius: 6,\n            },\n        ],\n    }), [last7DaysSales]);\n\n    const timeBasedLine = useMemo(() =&gt; {\n        // Create complete date range for proper labeling\n        let allLabels = [];\n        let allData = [];\n        \n        if (timePeriod === &#39;yesterday&#39;) {\n            // Show yesterday in context of last 7 days\n            const now = getPHDate();\n            const yesterday = new Date(now);\n            yesterday.setDate(yesterday.getDate() - 1);\n            \n            // Generate last 7 days ending with yesterday\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(yesterday);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;week&#39;) {\n            // Generate last 7 days including today\n            const now = getPHDate();\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;month&#39;) {\n            // Generate all 12 months\n            const now = getPHDate();\n            for (let i = 11; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setMonth(date.getMonth() - i);\n                const year = date.getFullYear();\n                const month = String(date.getMonth() + 1).padStart(2, &#39;0&#39;);\n                const periodKey = &#96;${year}-${month}&#96;;\n                const label = formatPHDate(getPHDateString(date), { month: &#39;short&#39;, year: &#39;numeric&#39; });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this month\n                const salesData = timeBasedSales.find(item =&gt; item.period === periodKey);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        }\n\n        return {\n            labels: allLabels,\n            datasets: [\n                {\n                    label: &#39;Sales (₱)&#39;,\n                    data: allData,\n                    borderColor: &#39;#3B82F6&#39;,\n                    backgroundColor: &#39;rgba(59, 130, 246, 0.1)&#39;,\n                    borderWidth: 3,\n                    fill: true,\n                    tension: 0.4,\n                    pointBackgroundColor: allData.map((_, index) =&gt; {\n                        // Highlight the last point (yesterday) if in yesterday view\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return &#39;#10b981&#39;; // Green color for yesterday\n                        }\n                        return &#39;#3B82F6&#39;;\n                    }),\n                    pointBorderColor: &#39;#ffffff&#39;,\n                    pointBorderWidth: 2,\n                    pointRadius: allData.map((_, index) =&gt; {\n                        // Make yesterday&#39;s point slightly larger\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return 8;\n                        }\n                        return 6;\n                    }),\n                    pointHoverRadius: 10,\n                },\n            ],\n        };\n    }, [timeBasedSales, timePeriod, last7DaysSales]);\n\n    const donutOptions = useMemo(() =&gt; ({\n        plugins: {\n            legend: { position: &#39;bottom&#39; },\n            title: { display: false },\n        },\n        cutout: &#39;65%&#39;,\n        maintainAspectRatio: false,\n    }), []);\n\n    const barOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { display: false },\n            title: { display: false },\n            tooltip: { mode: &#39;index&#39;, intersect: false },\n        },\n        scales: {\n            x: { grid: { display: false } },\n            y: { grid: { color: &#39;rgba(0,0,0,0.05)&#39; }, beginAtZero: true },\n        },\n        maintainAspectRatio: false,\n    }), []);\n\n    const lineOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { \n                display: true,\n                position: &#39;top&#39;,\n                labels: {\n                    color: &#39;#374151&#39;,\n                    font: { size: 12 }\n                }\n            },\n            title: { display: false },\n            tooltip: { \n                mode: &#39;index&#39;, \n                intersect: false,\n                backgroundColor: &#39;#1F2937&#39;,\n                titleColor: &#39;#F9FAFB&#39;,\n                bodyColor: &#39;#F9FAFB&#39;,\n                borderColor: &#39;#374151&#39;,\n                borderWidth: 1,\n                callbacks: {\n                    label: function(context) {\n                        return &#96;Sales: ₱${Number(context.parsed.y).toLocaleString()}&#96;;\n                    }\n                }\n            },\n        },\n        scales: {\n            x: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { color: &#39;#6B7280&#39; }\n            },\n            y: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { \n                    color: &#39;#6B7280&#39;,\n                    callback: function(value) {\n                        return &#39;₱&#39; + Number(value).toLocaleString();\n                    }\n                },\n                beginAtZero: true \n            },\n        },\n        maintainAspectRatio: false,\n        interaction: {\n            intersect: false,\n            mode: &#39;index&#39;\n        }\n    }), []);\n\n    // Reload time-based sales when controls change\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            loadTimeBasedSales();\n        }\n    }, [selectedStall, timePeriod]);\n\n    // Refresh chart data periodically and on mount for admin\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            // Initial load\n            loadChartData();\n            \n            // Set up periodic refresh every 30 seconds\n            const refreshInterval = setInterval(() =&gt; {\n                refreshChartData();\n            }, 30000);\n\n            // Cleanup interval on unmount\n            return () =&gt; clearInterval(refreshInterval);\n        }\n    }, [userProfile?.role]);\n\n    // Load staff dashboard data for staff\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;staff&#39;) {\n            loadStaffDashboardData();\n        }\n    }, [userProfile?.role]);\n\n    useEffect(() =&gt; {\n        const getUser = async () =&gt; {\n            const { data: { user } } = await supabase.auth.getUser();\n\n            if (user) {\n                // Fetch profile info from your database\n                const { data: profile, error } = await supabase\n                    .from(&#39;profiles&#39;)\n                    .select(&#39;role, full_name, stall_id, status&#39;)\n                    .eq(&#39;id&#39;, user.id)\n                    .single();\n\n                if (error) {\n                    console.error(&#39;Error fetching profile:&#39;, error);\n                } else {\n                    setUserProfile(profile);\n                    console.log(&#39;Profile loaded:&#39;, profile);\n                }\n            }\n\n            setLoading(false);\n        };\n\n        getUser();\n    }, []);\n\n    if (loading) {\n        return (\n            &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n                &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n            &lt;/div&gt;\n        );\n    }\n\n    return (\n        &lt;Layout userProfile={userProfile}&gt;\n            &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n                &lt;div className=\&quot;mb-6\&quot;&gt;\n                    &lt;h1 className=\&quot;text-3xl font-bold text-primary\&quot;&gt;\n                        {isAdmin(userProfile) ? &#39;Admin Dashboard&#39; : &#39;Staff Dashboard&#39;}\n                    &lt;/h1&gt;\n                    {!isAdmin(userProfile) &amp;&amp; (\n                        &lt;p className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                            Today • My Stall\n                        &lt;/p&gt;\n                    )}\n                &lt;/div&gt;\n\n                {isAdmin(userProfile) ? (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-3 gap-6\&quot;&gt;\n                        {/* Combined: Sales over time by stall (spans 2 columns) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl lg:col-span-2\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title\&quot;&gt;Sales Summary&lt;/h2&gt;\n                                    &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={selectedStall}\n                                                onChange={(e) =&gt; setSelectedStall(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;all\&quot;&gt;All Stalls&lt;/option&gt;\n                                                {availableStalls.map(stall =&gt; (\n                                                    &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                                        {stall.stall_name}\n                                                    &lt;/option&gt;\n                                                ))}\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={timePeriod}\n                                                onChange={(e) =&gt; setTimePeriod(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;yesterday\&quot;&gt;Yesterday&lt;/option&gt;\n                                                &lt;option value=\&quot;week\&quot;&gt;Last 7 Days&lt;/option&gt;\n                                                &lt;option value=\&quot;month\&quot;&gt;Last 12 Months&lt;/option&gt;\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                &lt;/div&gt;\n                                &lt;div className=\&quot;h-80\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Line data={timeBasedLine} options={lineOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Stocks per stall */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Stocks per Stall&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutStockByStall} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Sales vs Expense */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Sales vs Expense&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutSalesVsExpense} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Best seller */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Best Seller&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutBestSeller} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Business Stalls Statuses */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Business Stalls Statuses&lt;/h2&gt;\n                                {chartsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-full py-8\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : stallsStatus.length === 0 ? (\n                                    &lt;div className=\&quot;text-base-content/50 text-center py-4\&quot;&gt;\n                                        No stalls available.\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;overflow-x-auto\&quot;&gt;\n                                        &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                                            &lt;thead&gt;\n                                                &lt;tr&gt;\n                                                    &lt;th&gt;Stall&lt;/th&gt;\n                                                    &lt;th&gt;Active Status&lt;/th&gt;\n                                                    &lt;th&gt;Sold Out Status&lt;/th&gt;\n                                                &lt;/tr&gt;\n                                            &lt;/thead&gt;\n                                            &lt;tbody&gt;\n                                                {stallsStatus.map((stall) =&gt; {\n                                                    const getBusinessStatusBadgeColor = (status) =&gt; {\n                                                        switch (status) {\n                                                            case &#39;active&#39;:\n                                                                return &#39;badge-success&#39;;\n                                                            case &#39;inactive&#39;:\n                                                                return &#39;badge-error&#39;;\n                                                            case &#39;under maintenance&#39;:\n                                                                return &#39;badge-warning&#39;;\n                                                            default:\n                                                                return &#39;badge-neutral&#39;;\n                                                        }\n                                                    };\n\n                                                    const getStockStatusBadgeColor = (stockStatus) =&gt; {\n                                                        switch (stockStatus) {\n                                                            case &#39;sold_out&#39;:\n                                                                return &#39;badge-error&#39;;\n                                                            case &#39;not_sold_out&#39;:\n                                                            default:\n                                                                return &#39;badge-success&#39;;\n                                                        }\n                                                    };\n\n                                                    const stockStatusLabel =\n                                                        stall.stockStatus === &#39;sold_out&#39;\n                                                            ? &#39;Sold Out&#39;\n                                                            : &#39;Not Sold Out&#39;;\n\n                                                    return (\n                                                        &lt;tr key={stall.stall_id}&gt;\n                                                            &lt;td&gt;\n                                                                &lt;div className=\&quot;font-semibold\&quot;&gt;\n                                                                    {stall.stall_name}\n                                                                &lt;/div&gt;\n                                                                {stall.location &amp;&amp; (\n                                                                    &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                                                                        {stall.location}\n                                                                    &lt;/div&gt;\n                                                                )}\n                                                            &lt;/td&gt;\n                                                            &lt;td&gt;\n                                                                &lt;span\n                                                                    className={&#96;badge ${getBusinessStatusBadgeColor(\n                                                                        stall.status\n                                                                    )}&#96;}\n                                                                &gt;\n                                                                    {stall.status || &#39;N/A&#39;}\n                                                                &lt;/span&gt;\n                                                            &lt;/td&gt;\n                                                            &lt;td&gt;\n                                                                &lt;span\n                                                                    className={&#96;badge ${getStockStatusBadgeColor(\n                                                                        stall.stockStatus\n                                                                    )}&#96;}\n                                                                &gt;\n                                                                    {stockStatusLabel}\n                                                                &lt;/span&gt;\n                                                            &lt;/td&gt;\n                                                        &lt;/tr&gt;\n                                                    );\n                                                })}\n                                            &lt;/tbody&gt;\n                                        &lt;/table&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                    &lt;/div&gt;\n                ) : (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n                        {/* Staff: Recent Transactions (Today, My Stall) */}\n                    &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                        &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Today&amp;apos;s Recent Transactions&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : staffTransactions.length === 0 ? (\n                                    &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;\n                                        No transactions recorded yet for today.\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;overflow-x-auto max-h-80\&quot;&gt;\n                                        &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                                            &lt;thead&gt;\n                                                &lt;tr&gt;\n                                                    &lt;th&gt;Time&lt;/th&gt;\n                                                    &lt;th&gt;Item&lt;/th&gt;\n                                                    &lt;th&gt;Qty&lt;/th&gt;\n                                                    &lt;th&gt;Amount&lt;/th&gt;\n                                                    &lt;th&gt;Payment&lt;/th&gt;\n                                                &lt;/tr&gt;\n                                            &lt;/thead&gt;\n                                            &lt;tbody&gt;\n                                                {staffTransactions.map((tx) =&gt; (\n                                                    &lt;tr key={tx.sale_id}&gt;\n                                                        &lt;td&gt;{tx.sale_date}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.quantity_sold}&lt;/td&gt;\n                                                        &lt;td className=\&quot;text-success font-semibold\&quot;&gt;\n                                                            ₱{Number(tx.total_amount || 0).toFixed(2)}\n                                                        &lt;/td&gt;\n                                                        &lt;td&gt;\n                                                            &lt;span className={&#96;badge ${tx.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                                                {tx.payment_method}\n                                                            &lt;/span&gt;\n                                                        &lt;/td&gt;\n                                                    &lt;/tr&gt;\n                                                ))}\n                                            &lt;/tbody&gt;\n                                        &lt;/table&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Staff: Key Statistics (Today, My Stall) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-accent\&quot;&gt;Today&amp;apos;s Key Statistics&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-4\&quot;&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Stock Distributed&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-success\&quot;&gt;\n                                                {staffStatistics.stockDistributed.toFixed(2)} kg\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Sales&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-primary\&quot;&gt;\n                                                ₱{staffStatistics.totalSales.toFixed(2)}\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Stock Status&lt;/div&gt;\n                                            &lt;div className=\&quot;flex items-center gap-3 mt-2\&quot;&gt;\n                                                &lt;button\n                                                    type=\&quot;button\&quot;\n                                                    className=\&quot;btn btn-sm btn-outline\&quot;\n                                                    onClick={handleToggleStockStatus}\n                                                    disabled={updatingStockStatus}\n                                                &gt;\n                                                    &lt;span\n                                                        className={&#96;badge badge-lg ${\n                                                            staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                                ? &#39;badge-error&#39;\n                                                                : &#39;badge-success&#39;\n                                                        }&#96;}\n                                                    &gt;\n                                                        {staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                            ? &#39;Sold Out&#39;\n                                                            : &#39;Not Sold Out&#39;}\n                                                    &lt;/span&gt;\n                                                &lt;/button&gt;\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                )}\n            &lt;/div&gt;\n        &lt;/Layout&gt;\n    );\n}\n\nexport default Dashboard;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

The Business Stalls card is now rendered as a DaisyUI table with three columns: **Stall** (name + location), **Active Status** (business status badge), and **Sold Out Status** (Sold Out / Not Sold Out badge).

---

_**User (2025-11-16 05:55Z)**_

in both the staff stock status and the admin role stock statuses, reverse the color coding of two statuses

---

_**Agent (model default, mode Agent)**_



---

I’ll update the stock-status badge helpers for both staff and admin views so that “Sold Out” and “Not Sold Out” swap their badge colors, keeping everything else unchanged.

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/dashboard.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;18ba468b-c569-45fd-9285-692607982425&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                                              &lt;/div&gt;\n                                          &lt;/div&gt;\n-                                         &lt;div className=\&quot;stat\&quot;&gt;\n-                                             &lt;div className=\&quot;stat-title\&quot;&gt;Stock Status&lt;/div&gt;\n-                                             &lt;div className=\&quot;flex items-center gap-3 mt-2\&quot;&gt;\n-                                                 &lt;button\n-                                                     type=\&quot;button\&quot;\n-                                                     className=\&quot;btn btn-sm btn-outline\&quot;\n-                                                     onClick={handleToggleStockStatus}\n-                                                     disabled={updatingStockStatus}\n-                                                 &gt;\n-                                                     &lt;span\n-                                                         className={&#96;badge badge-lg ${\n-                                                             staffStatistics.stockStatus === &#39;sold_out&#39;\n-                                                                 ? &#39;badge-error&#39;\n-                                                                 : &#39;badge-success&#39;\n-                                                         }&#96;}\n-                                                     &gt;\n-                                                         {staffStatistics.stockStatus === &#39;sold_out&#39;\n-                                                             ? &#39;Sold Out&#39;\n-                                                             : &#39;Not Sold Out&#39;}\n-                                                     &lt;/span&gt;\n-                                                 &lt;/button&gt;\n-                                             &lt;/div&gt;\n-                                         &lt;/div&gt;\n+                                             &lt;div className=\&quot;stat\&quot;&gt;\n+                                                 &lt;div className=\&quot;stat-title\&quot;&gt;Stock Status&lt;/div&gt;\n+                                                 &lt;div className=\&quot;flex items-center gap-3 mt-2\&quot;&gt;\n+                                                     &lt;button\n+                                                         type=\&quot;button\&quot;\n+                                                         className=\&quot;btn btn-sm btn-outline\&quot;\n+                                                         onClick={handleToggleStockStatus}\n+                                                         disabled={updatingStockStatus}\n+                                                     &gt;\n+                                                         &lt;span\n+                                                             className={&#96;badge badge-lg ${\n+                                                                 staffStatistics.stockStatus === &#39;sold_out&#39;\n+                                                                     ? &#39;badge-success&#39;\n+                                                                     : &#39;badge-error&#39;\n+                                                             }&#96;}\n+                                                         &gt;\n+                                                             {staffStatistics.stockStatus === &#39;sold_out&#39;\n+                                                                 ? &#39;Sold Out&#39;\n+                                                                 : &#39;Not Sold Out&#39;}\n+                                                         &lt;/span&gt;\n+                                                     &lt;/button&gt;\n+                                                 &lt;/div&gt;\n+                                             &lt;/div&gt;\n                                      &lt;/div&gt;\n                                  )}&quot;,
        &quot;oldStart&quot;: 1127,
        &quot;newStart&quot;: 1127,
        &quot;oldLines&quot;: 27,
        &quot;newLines&quot;: 27,
        &quot;linesRemoved&quot;: 23,
        &quot;linesAdded&quot;: 23
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/dashboard.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect, useMemo } from &#39;react&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport { isAdmin } from &#39;./utils/roleUtils&#39;;\nimport { getPHDateString, getPHDate, formatPHDate, getPHDateDaysAgo, parseSaleDate } from &#39;./utils/dateUtils&#39;;\nimport {\n    restrictToStaffStallAndToday,\n    fetchCurrentStallStockForStaff,\n    fetchTodaySalesTotalForStaff,\n    fetchTodayStockStatus,\n    saveTodayStockStatus,\n} from &#39;./utils/staffReportsToday&#39;;\nimport Layout from &#39;./components/Layout&#39;;\n// Charts\nimport {\n    Chart as ChartJS,\n    ArcElement,\n    BarElement,\n    LineElement,\n    PointElement,\n    CategoryScale,\n    LinearScale,\n    Tooltip,\n    Legend,\n    Title,\n} from &#39;chart.js&#39;;\nimport { Doughnut, Bar, Line } from &#39;react-chartjs-2&#39;;\n\nChartJS.register(ArcElement, BarElement, LineElement, PointElement, CategoryScale, LinearScale, Tooltip, Legend, Title);\n\nfunction Dashboard() {\n    const [userProfile, setUserProfile] = useState(null);\n    const [loading, setLoading] = useState(true);\n    \n    // Chart data states\n    const [salesByStall, setSalesByStall] = useState([]);\n    const [stockByStall, setStockByStall] = useState([]);\n    const [salesVsExpense, setSalesVsExpense] = useState({ sales: 0, expenses: 0 });\n    const [bestSellers, setBestSellers] = useState([]);\n    const [last7DaysSales, setLast7DaysSales] = useState([]);\n    const [chartsLoading, setChartsLoading] = useState(true);\n    const [stallsStatus, setStallsStatus] = useState([]);\n    \n    // Line chart states\n    const [timeBasedSales, setTimeBasedSales] = useState([]);\n    const [selectedStall, setSelectedStall] = useState(&#39;all&#39;);\n    const [timePeriod, setTimePeriod] = useState(&#39;yesterday&#39;);\n    const [availableStalls, setAvailableStalls] = useState([]);\n\n    // Staff dashboard states\n    const [staffTransactions, setStaffTransactions] = useState([]);\n    const [staffStatistics, setStaffStatistics] = useState({\n        totalSales: 0,\n        stockDistributed: 0,\n        stockStatus: &#39;not_sold_out&#39;,\n    });\n    const [staffCardsLoading, setStaffCardsLoading] = useState(true);\n    const [updatingStockStatus, setUpdatingStockStatus] = useState(false);\n\n    // Load sales by stall data\n    const loadSalesByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    stall_id,\n                    total_amount,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallSales = {};\n            data?.forEach(sale =&gt; {\n                const stallId = sale.stall_id;\n                const stallName = sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallSales[stallId]) {\n                    stallSales[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_sales: 0,\n                        transaction_count: 0\n                    };\n                }\n                stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n                stallSales[stallId].transaction_count += 1;\n            });\n\n            setSalesByStall(Object.values(stallSales));\n        } catch (err) {\n            console.error(&#39;Error loading sales by stall:&#39;, err);\n        }\n    };\n\n    // Load stock by stall data\n    const loadStockByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stall_stocks&#39;)\n                .select(&#96;\n                    stall_id,\n                    quantity,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallStock = {};\n            data?.forEach(stock =&gt; {\n                const stallId = stock.stall_id;\n                const stallName = stock.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallStock[stallId]) {\n                    stallStock[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_stock: 0\n                    };\n                }\n                stallStock[stallId].total_stock += Number(stock.quantity || 0);\n            });\n\n            setStockByStall(Object.values(stallStock));\n        } catch (err) {\n            console.error(&#39;Error loading stock by stall:&#39;, err);\n        }\n    };\n\n    // Load sales vs expenses data\n    const loadSalesVsExpense = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            // Get total sales\n            const { data: salesData, error: salesError } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;total_amount&#39;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (salesError) throw salesError;\n\n            // Get total expenses\n            const { data: expensesData, error: expensesError } = await supabase\n                .from(&#39;expenses&#39;)\n                .select(&#39;cost&#39;)\n                .gte(&#39;date&#39;, twelveMonthsAgoStr);\n\n            if (expensesError) throw expensesError;\n\n            const totalSales = salesData?.reduce((sum, sale) =&gt; sum + Number(sale.total_amount || 0), 0) || 0;\n            const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + Number(expense.cost || 0), 0) || 0;\n\n            setSalesVsExpense({ sales: totalSales, expenses: totalExpenses });\n        } catch (err) {\n            console.error(&#39;Error loading sales vs expenses:&#39;, err);\n        }\n    };\n\n    // Load best sellers data\n    const loadBestSellers = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    quantity_sold,\n                    menu_items(item_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (error) throw error;\n\n            // Group by item and calculate totals\n            const itemSales = {};\n            data?.forEach(sale =&gt; {\n                const itemName = sale.menu_items?.item_name || &#39;Unknown Item&#39;;\n                \n                if (!itemSales[itemName]) {\n                    itemSales[itemName] = {\n                        item_name: itemName,\n                        units_sold: 0\n                    };\n                }\n                itemSales[itemName].units_sold += Number(sale.quantity_sold || 0);\n            });\n\n            // Sort by units sold and take top 4\n            const sortedItems = Object.values(itemSales)\n                .sort((a, b) =&gt; b.units_sold - a.units_sold)\n                .slice(0, 4);\n\n            setBestSellers(sortedItems);\n        } catch (err) {\n            console.error(&#39;Error loading best sellers:&#39;, err);\n        }\n    };\n\n    // Load time-based sales data for line chart\n    const loadTimeBasedSales = async () =&gt; {\n        try {\n            let startDate, endDate, groupBy;\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            \n            if (timePeriod === &#39;yesterday&#39;) {\n                // Show yesterday in context of last 7 days for better visualization\n                const yesterday = new Date(now);\n                yesterday.setDate(yesterday.getDate() - 1);\n                startDate = new Date(yesterday);\n                startDate.setDate(startDate.getDate() - 6); // Go back 6 more days (7 days total)\n                endDate = new Date(yesterday);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;week&#39;) {\n                // Last 7 days including today\n                startDate = new Date(now);\n                startDate.setDate(startDate.getDate() - 6);\n                endDate = new Date(now);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;month&#39;) {\n                // Last 12 months\n                startDate = new Date(now);\n                startDate.setMonth(startDate.getMonth() - 11);\n                startDate.setDate(1);\n                endDate = new Date(now);\n                groupBy = &#39;month&#39;;\n            }\n\n            const startDateStr = getPHDateString(startDate);\n            const endDateStr = getPHDateString(endDate);\n\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_date,\n                    total_amount,\n                    stall_id,\n                    stalls(stall_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, startDateStr)\n                .lte(&#39;sale_date&#39;, endDateStr)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            // Filter by selected stall if not &#39;all&#39;\n            if (selectedStall !== &#39;all&#39;) {\n                query = query.eq(&#39;stall_id&#39;, selectedStall);\n            }\n\n            const { data, error } = await query;\n\n            if (error) throw error;\n\n            // Group data by time period - parse sale_date as PH date\n            const groupedData = {};\n            data?.forEach(sale =&gt; {\n                // Parse sale_date string (YYYY-MM-DD) as PH date\n                const saleDateStr = parseSaleDate(sale.sale_date);\n                let key;\n\n                if (groupBy === &#39;day&#39;) {\n                    key = saleDateStr; // Already YYYY-MM-DD format\n                } else if (groupBy === &#39;month&#39;) {\n                    const [year, month] = saleDateStr.split(&#39;-&#39;);\n                    key = &#96;${year}-${month}&#96;;\n                }\n\n                if (!groupedData[key]) {\n                    groupedData[key] = {\n                        period: key,\n                        sales: 0,\n                        transactions: 0\n                    };\n                }\n                groupedData[key].sales += Number(sale.total_amount || 0);\n                groupedData[key].transactions += 1;\n            });\n\n            // Convert to array and sort\n            const timeBasedData = Object.values(groupedData).sort((a, b) =&gt; {\n                if (groupBy === &#39;day&#39;) {\n                    return a.period.localeCompare(b.period);\n                } else if (groupBy === &#39;month&#39;) {\n                    return a.period.localeCompare(b.period);\n                }\n                return 0;\n            });\n\n            setTimeBasedSales(timeBasedData);\n        } catch (err) {\n            console.error(&#39;Error loading time-based sales:&#39;, err);\n        }\n    };\n\n    // Load available stalls for dropdown\n    const loadAvailableStalls = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (error) throw error;\n            setAvailableStalls(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading stalls:&#39;, err);\n        }\n    };\n\n    // Load stalls status data, including today&#39;s stock sold-out status\n    const loadStallsStatus = async () =&gt; {\n        try {\n            // First load all business stalls\n            const { data: stallsData, error: stallsError } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name, location, status&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (stallsError) throw stallsError;\n\n            const stalls = stallsData || [];\n\n            // If there are no stalls, we can short-circuit\n            if (stalls.length === 0) {\n                setStallsStatus([]);\n                return;\n            }\n\n            // Build today&#39;s date range in PH timezone (same logic as staffReportsToday helpers)\n            const today = getPHDate();\n            const todayStr = getPHDateString(today);\n\n            // Fetch today&#39;s stock status for all stalls in a single query\n            const stallIds = stalls.map((stall) =&gt; stall.stall_id);\n            const { data: stockStatusData, error: stockStatusError } = await supabase\n                .from(&#39;stock_status_history&#39;)\n                .select(&#39;stall_id, stock_status, stock_level, date&#39;)\n                .in(&#39;stall_id&#39;, stallIds)\n                .eq(&#39;date&#39;, todayStr);\n\n            if (stockStatusError) throw stockStatusError;\n\n            // Build a lookup map for today&#39;s stock status per stall\n            const stockStatusByStallId = {};\n            (stockStatusData || []).forEach((row) =&gt; {\n                stockStatusByStallId[row.stall_id] = {\n                    stockStatus: row.stock_status || &#39;not_sold_out&#39;,\n                    stockLevel:\n                        typeof row.stock_level === &#39;number&#39;\n                            ? row.stock_level\n                            : Number(row.stock_level || 0),\n                };\n            });\n\n            // Merge business status with today&#39;s stock status, defaulting to not_sold_out\n            const merged = stalls.map((stall) =&gt; {\n                const stockInfo = stockStatusByStallId[stall.stall_id] || {\n                    stockStatus: &#39;not_sold_out&#39;,\n                    stockLevel: null,\n                };\n\n                return {\n                    ...stall,\n                    stockStatus: stockInfo.stockStatus,\n                    stockLevel: stockInfo.stockLevel,\n                };\n            });\n\n            setStallsStatus(merged);\n        } catch (err) {\n            console.error(&#39;Error loading stalls status:&#39;, err);\n        }\n    };\n\n    // Staff: load recent transactions for today for their stall\n    const loadStaffRecentTransactions = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_id,\n                    sale_date,\n                    quantity_sold,\n                    total_amount,\n                    payment_method,\n                    stall_id,\n                    product_id,\n                    stalls(stall_name),\n                    menu_items(item_name)\n                &#96;);\n\n            query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n            const { data, error } = await query\n                .order(&#39;sale_date&#39;, { ascending: false })\n                .limit(10);\n\n            if (error) throw error;\n            setStaffTransactions(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading staff recent transactions:&#39;, err);\n        }\n    };\n\n    // Staff: load key statistics for today for their stall\n    const loadStaffStatistics = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            const [stockDistributed, totalSales, stockStatusInfo] = await Promise.all([\n                fetchCurrentStallStockForStaff(userProfile),\n                fetchTodaySalesTotalForStaff(userProfile),\n                fetchTodayStockStatus(userProfile.stall_id),\n            ]);\n\n            setStaffStatistics({\n                totalSales: totalSales || 0,\n                stockDistributed: stockDistributed || 0,\n                stockStatus: stockStatusInfo?.stockStatus || &#39;not_sold_out&#39;,\n            });\n        } catch (err) {\n            console.error(&#39;Error loading staff statistics:&#39;, err);\n        }\n    };\n\n    const loadStaffDashboardData = async () =&gt; {\n        setStaffCardsLoading(true);\n        try {\n            await Promise.all([\n                loadStaffRecentTransactions(),\n                loadStaffStatistics(),\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading staff dashboard data:&#39;, err);\n        } finally {\n            setStaffCardsLoading(false);\n        }\n    };\n\n    const handleToggleStockStatus = async () =&gt; {\n        if (!userProfile) return;\n\n        const nextStatus =\n            staffStatistics.stockStatus === &#39;sold_out&#39; ? &#39;not_sold_out&#39; : &#39;sold_out&#39;;\n\n        setUpdatingStockStatus(true);\n        try {\n            await saveTodayStockStatus(\n                userProfile.stall_id,\n                staffStatistics.stockDistributed,\n                nextStatus\n            );\n            setStaffStatistics((prev) =&gt; ({\n                ...prev,\n                stockStatus: nextStatus,\n            }));\n        } catch (err) {\n            console.error(&#39;Error toggling stock status:&#39;, err);\n        } finally {\n            setUpdatingStockStatus(false);\n        }\n    };\n\n    // Load last 7 days sales data\n    const loadLast7DaysSales = async () =&gt; {\n        try {\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            const today = getPHDateString(now);\n            \n            // Get 7 days ago (including today, so 6 days back)\n            const sevenDaysAgo = new Date(now);\n            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 6);\n            const sevenDaysAgoStr = getPHDateString(sevenDaysAgo);\n\n            console.log(&#39;Loading sales from:&#39;, sevenDaysAgoStr, &#39;to:&#39;, today);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;sale_date, total_amount&#39;)\n                .gte(&#39;sale_date&#39;, sevenDaysAgoStr)\n                .lte(&#39;sale_date&#39;, today)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            if (error) throw error;\n\n            // Group by date and calculate daily totals - parse sale_date as PH date\n            const dailySales = {};\n            data?.forEach(sale =&gt; {\n                const date = parseSaleDate(sale.sale_date);\n                if (!dailySales[date]) {\n                    dailySales[date] = 0;\n                }\n                dailySales[date] += Number(sale.total_amount || 0);\n            });\n\n            // Create array for last 7 days (including today)\n            const last7Days = [];\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const dayName = formatPHDate(dateStr, { weekday: &#39;short&#39; });\n                \n                last7Days.push({\n                    date: dateStr,\n                    day: dayName,\n                    sales: dailySales[dateStr] || 0\n                });\n            }\n\n            console.log(&#39;Last 7 days data:&#39;, last7Days);\n            setLast7DaysSales(last7Days);\n        } catch (err) {\n            console.error(&#39;Error loading last 7 days sales:&#39;, err);\n        }\n    };\n\n    // Load all chart data\n    const loadChartData = async () =&gt; {\n        setChartsLoading(true);\n        try {\n            await Promise.all([\n                loadSalesByStall(),\n                loadStockByStall(),\n                loadSalesVsExpense(),\n                loadBestSellers(),\n                loadLast7DaysSales(),\n                loadAvailableStalls(),\n                loadTimeBasedSales(),\n                loadStallsStatus()\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading chart data:&#39;, err);\n        } finally {\n            setChartsLoading(false);\n        }\n    };\n\n    // Refresh all chart data\n    const refreshChartData = async () =&gt; {\n        console.log(&#39;Refreshing chart data...&#39;);\n        await loadChartData();\n    };\n\n    // Chart datasets\n    const donutSalesByStall = useMemo(() =&gt; ({\n        labels: salesByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Sales Count&#39;,\n                data: salesByStall.map(stall =&gt; stall.transaction_count),\n                backgroundColor: [&#39;#60a5fa&#39;, &#39;#f472b6&#39;, &#39;#34d399&#39;, &#39;#fbbf24&#39;, &#39;#a78bfa&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesByStall]);\n\n    const donutStockByStall = useMemo(() =&gt; ({\n        labels: stockByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Stock Qty&#39;,\n                data: stockByStall.map(stall =&gt; stall.total_stock),\n                backgroundColor: [&#39;#fbbf24&#39;, &#39;#818cf8&#39;, &#39;#f87171&#39;, &#39;#34d399&#39;, &#39;#f472b6&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [stockByStall]);\n\n    const donutSalesVsExpense = useMemo(() =&gt; ({\n        labels: [&#39;Sales&#39;, &#39;Expenses&#39;],\n        datasets: [\n            {\n                label: &#39;Amount&#39;,\n                data: [salesVsExpense.sales, salesVsExpense.expenses],\n                backgroundColor: [&#39;#22d3ee&#39;, &#39;#f97316&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesVsExpense]);\n\n    const donutBestSeller = useMemo(() =&gt; ({\n        labels: bestSellers.map(item =&gt; item.item_name),\n        datasets: [\n            {\n                label: &#39;Units Sold&#39;,\n                data: bestSellers.map(item =&gt; item.units_sold),\n                backgroundColor: [&#39;#86efac&#39;, &#39;#93c5fd&#39;, &#39;#fda4af&#39;, &#39;#fde68a&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [bestSellers]);\n\n    const last7DaysBar = useMemo(() =&gt; ({\n        labels: last7DaysSales.map(day =&gt; day.day),\n        datasets: [\n            {\n                label: &#39;Sales (PHP)&#39;,\n                data: last7DaysSales.map(day =&gt; day.sales),\n                backgroundColor: &#39;#60a5fa&#39;,\n                borderRadius: 6,\n            },\n        ],\n    }), [last7DaysSales]);\n\n    const timeBasedLine = useMemo(() =&gt; {\n        // Create complete date range for proper labeling\n        let allLabels = [];\n        let allData = [];\n        \n        if (timePeriod === &#39;yesterday&#39;) {\n            // Show yesterday in context of last 7 days\n            const now = getPHDate();\n            const yesterday = new Date(now);\n            yesterday.setDate(yesterday.getDate() - 1);\n            \n            // Generate last 7 days ending with yesterday\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(yesterday);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;week&#39;) {\n            // Generate last 7 days including today\n            const now = getPHDate();\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;month&#39;) {\n            // Generate all 12 months\n            const now = getPHDate();\n            for (let i = 11; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setMonth(date.getMonth() - i);\n                const year = date.getFullYear();\n                const month = String(date.getMonth() + 1).padStart(2, &#39;0&#39;);\n                const periodKey = &#96;${year}-${month}&#96;;\n                const label = formatPHDate(getPHDateString(date), { month: &#39;short&#39;, year: &#39;numeric&#39; });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this month\n                const salesData = timeBasedSales.find(item =&gt; item.period === periodKey);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        }\n\n        return {\n            labels: allLabels,\n            datasets: [\n                {\n                    label: &#39;Sales (₱)&#39;,\n                    data: allData,\n                    borderColor: &#39;#3B82F6&#39;,\n                    backgroundColor: &#39;rgba(59, 130, 246, 0.1)&#39;,\n                    borderWidth: 3,\n                    fill: true,\n                    tension: 0.4,\n                    pointBackgroundColor: allData.map((_, index) =&gt; {\n                        // Highlight the last point (yesterday) if in yesterday view\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return &#39;#10b981&#39;; // Green color for yesterday\n                        }\n                        return &#39;#3B82F6&#39;;\n                    }),\n                    pointBorderColor: &#39;#ffffff&#39;,\n                    pointBorderWidth: 2,\n                    pointRadius: allData.map((_, index) =&gt; {\n                        // Make yesterday&#39;s point slightly larger\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return 8;\n                        }\n                        return 6;\n                    }),\n                    pointHoverRadius: 10,\n                },\n            ],\n        };\n    }, [timeBasedSales, timePeriod, last7DaysSales]);\n\n    const donutOptions = useMemo(() =&gt; ({\n        plugins: {\n            legend: { position: &#39;bottom&#39; },\n            title: { display: false },\n        },\n        cutout: &#39;65%&#39;,\n        maintainAspectRatio: false,\n    }), []);\n\n    const barOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { display: false },\n            title: { display: false },\n            tooltip: { mode: &#39;index&#39;, intersect: false },\n        },\n        scales: {\n            x: { grid: { display: false } },\n            y: { grid: { color: &#39;rgba(0,0,0,0.05)&#39; }, beginAtZero: true },\n        },\n        maintainAspectRatio: false,\n    }), []);\n\n    const lineOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { \n                display: true,\n                position: &#39;top&#39;,\n                labels: {\n                    color: &#39;#374151&#39;,\n                    font: { size: 12 }\n                }\n            },\n            title: { display: false },\n            tooltip: { \n                mode: &#39;index&#39;, \n                intersect: false,\n                backgroundColor: &#39;#1F2937&#39;,\n                titleColor: &#39;#F9FAFB&#39;,\n                bodyColor: &#39;#F9FAFB&#39;,\n                borderColor: &#39;#374151&#39;,\n                borderWidth: 1,\n                callbacks: {\n                    label: function(context) {\n                        return &#96;Sales: ₱${Number(context.parsed.y).toLocaleString()}&#96;;\n                    }\n                }\n            },\n        },\n        scales: {\n            x: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { color: &#39;#6B7280&#39; }\n            },\n            y: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { \n                    color: &#39;#6B7280&#39;,\n                    callback: function(value) {\n                        return &#39;₱&#39; + Number(value).toLocaleString();\n                    }\n                },\n                beginAtZero: true \n            },\n        },\n        maintainAspectRatio: false,\n        interaction: {\n            intersect: false,\n            mode: &#39;index&#39;\n        }\n    }), []);\n\n    // Reload time-based sales when controls change\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            loadTimeBasedSales();\n        }\n    }, [selectedStall, timePeriod]);\n\n    // Refresh chart data periodically and on mount for admin\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            // Initial load\n            loadChartData();\n            \n            // Set up periodic refresh every 30 seconds\n            const refreshInterval = setInterval(() =&gt; {\n                refreshChartData();\n            }, 30000);\n\n            // Cleanup interval on unmount\n            return () =&gt; clearInterval(refreshInterval);\n        }\n    }, [userProfile?.role]);\n\n    // Load staff dashboard data for staff\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;staff&#39;) {\n            loadStaffDashboardData();\n        }\n    }, [userProfile?.role]);\n\n    useEffect(() =&gt; {\n        const getUser = async () =&gt; {\n            const { data: { user } } = await supabase.auth.getUser();\n\n            if (user) {\n                // Fetch profile info from your database\n                const { data: profile, error } = await supabase\n                    .from(&#39;profiles&#39;)\n                    .select(&#39;role, full_name, stall_id, status&#39;)\n                    .eq(&#39;id&#39;, user.id)\n                    .single();\n\n                if (error) {\n                    console.error(&#39;Error fetching profile:&#39;, error);\n                } else {\n                    setUserProfile(profile);\n                    console.log(&#39;Profile loaded:&#39;, profile);\n                }\n            }\n\n            setLoading(false);\n        };\n\n        getUser();\n    }, []);\n\n    if (loading) {\n        return (\n            &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n                &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n            &lt;/div&gt;\n        );\n    }\n\n    return (\n        &lt;Layout userProfile={userProfile}&gt;\n            &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n                &lt;div className=\&quot;mb-6\&quot;&gt;\n                    &lt;h1 className=\&quot;text-3xl font-bold text-primary\&quot;&gt;\n                        {isAdmin(userProfile) ? &#39;Admin Dashboard&#39; : &#39;Staff Dashboard&#39;}\n                    &lt;/h1&gt;\n                    {!isAdmin(userProfile) &amp;&amp; (\n                        &lt;p className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                            Today • My Stall\n                        &lt;/p&gt;\n                    )}\n                &lt;/div&gt;\n\n                {isAdmin(userProfile) ? (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-3 gap-6\&quot;&gt;\n                        {/* Combined: Sales over time by stall (spans 2 columns) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl lg:col-span-2\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title\&quot;&gt;Sales Summary&lt;/h2&gt;\n                                    &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={selectedStall}\n                                                onChange={(e) =&gt; setSelectedStall(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;all\&quot;&gt;All Stalls&lt;/option&gt;\n                                                {availableStalls.map(stall =&gt; (\n                                                    &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                                        {stall.stall_name}\n                                                    &lt;/option&gt;\n                                                ))}\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={timePeriod}\n                                                onChange={(e) =&gt; setTimePeriod(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;yesterday\&quot;&gt;Yesterday&lt;/option&gt;\n                                                &lt;option value=\&quot;week\&quot;&gt;Last 7 Days&lt;/option&gt;\n                                                &lt;option value=\&quot;month\&quot;&gt;Last 12 Months&lt;/option&gt;\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                &lt;/div&gt;\n                                &lt;div className=\&quot;h-80\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Line data={timeBasedLine} options={lineOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Stocks per stall */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Stocks per Stall&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutStockByStall} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Sales vs Expense */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Sales vs Expense&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutSalesVsExpense} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Best seller */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Best Seller&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutBestSeller} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Business Stalls Statuses */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Business Stalls Statuses&lt;/h2&gt;\n                                {chartsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-full py-8\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : stallsStatus.length === 0 ? (\n                                    &lt;div className=\&quot;text-base-content/50 text-center py-4\&quot;&gt;\n                                        No stalls available.\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;overflow-x-auto\&quot;&gt;\n                                        &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                                            &lt;thead&gt;\n                                                &lt;tr&gt;\n                                                    &lt;th&gt;Stall&lt;/th&gt;\n                                                    &lt;th&gt;Active Status&lt;/th&gt;\n                                                    &lt;th&gt;Sold Out Status&lt;/th&gt;\n                                                &lt;/tr&gt;\n                                            &lt;/thead&gt;\n                                            &lt;tbody&gt;\n                                                {stallsStatus.map((stall) =&gt; {\n                                                    const getBusinessStatusBadgeColor = (status) =&gt; {\n                                                        switch (status) {\n                                                            case &#39;active&#39;:\n                                                                return &#39;badge-success&#39;;\n                                                            case &#39;inactive&#39;:\n                                                                return &#39;badge-error&#39;;\n                                                            case &#39;under maintenance&#39;:\n                                                                return &#39;badge-warning&#39;;\n                                                            default:\n                                                                return &#39;badge-neutral&#39;;\n                                                        }\n                                                    };\n\n                                                    const getStockStatusBadgeColor = (stockStatus) =&gt; {\n                                                        switch (stockStatus) {\n                                                            case &#39;sold_out&#39;:\n                                                                return &#39;badge-error&#39;;\n                                                            case &#39;not_sold_out&#39;:\n                                                            default:\n                                                                return &#39;badge-success&#39;;\n                                                        }\n                                                    };\n\n                                                    const stockStatusLabel =\n                                                        stall.stockStatus === &#39;sold_out&#39;\n                                                            ? &#39;Sold Out&#39;\n                                                            : &#39;Not Sold Out&#39;;\n\n                                                    return (\n                                                        &lt;tr key={stall.stall_id}&gt;\n                                                            &lt;td&gt;\n                                                                &lt;div className=\&quot;font-semibold\&quot;&gt;\n                                                                    {stall.stall_name}\n                                                                &lt;/div&gt;\n                                                                {stall.location &amp;&amp; (\n                                                                    &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                                                                        {stall.location}\n                                                                    &lt;/div&gt;\n                                                                )}\n                                                            &lt;/td&gt;\n                                                            &lt;td&gt;\n                                                                &lt;span\n                                                                    className={&#96;badge ${getBusinessStatusBadgeColor(\n                                                                        stall.status\n                                                                    )}&#96;}\n                                                                &gt;\n                                                                    {stall.status || &#39;N/A&#39;}\n                                                                &lt;/span&gt;\n                                                            &lt;/td&gt;\n                                                            &lt;td&gt;\n                                                                &lt;span\n                                                                    className={&#96;badge ${getStockStatusBadgeColor(\n                                                                        stall.stockStatus\n                                                                    )}&#96;}\n                                                                &gt;\n                                                                    {stockStatusLabel}\n                                                                &lt;/span&gt;\n                                                            &lt;/td&gt;\n                                                        &lt;/tr&gt;\n                                                    );\n                                                })}\n                                            &lt;/tbody&gt;\n                                        &lt;/table&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                    &lt;/div&gt;\n                ) : (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n                        {/* Staff: Recent Transactions (Today, My Stall) */}\n                    &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                        &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Today&amp;apos;s Recent Transactions&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : staffTransactions.length === 0 ? (\n                                    &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;\n                                        No transactions recorded yet for today.\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;overflow-x-auto max-h-80\&quot;&gt;\n                                        &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                                            &lt;thead&gt;\n                                                &lt;tr&gt;\n                                                    &lt;th&gt;Time&lt;/th&gt;\n                                                    &lt;th&gt;Item&lt;/th&gt;\n                                                    &lt;th&gt;Qty&lt;/th&gt;\n                                                    &lt;th&gt;Amount&lt;/th&gt;\n                                                    &lt;th&gt;Payment&lt;/th&gt;\n                                                &lt;/tr&gt;\n                                            &lt;/thead&gt;\n                                            &lt;tbody&gt;\n                                                {staffTransactions.map((tx) =&gt; (\n                                                    &lt;tr key={tx.sale_id}&gt;\n                                                        &lt;td&gt;{tx.sale_date}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.quantity_sold}&lt;/td&gt;\n                                                        &lt;td className=\&quot;text-success font-semibold\&quot;&gt;\n                                                            ₱{Number(tx.total_amount || 0).toFixed(2)}\n                                                        &lt;/td&gt;\n                                                        &lt;td&gt;\n                                                            &lt;span className={&#96;badge ${tx.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                                                {tx.payment_method}\n                                                            &lt;/span&gt;\n                                                        &lt;/td&gt;\n                                                    &lt;/tr&gt;\n                                                ))}\n                                            &lt;/tbody&gt;\n                                        &lt;/table&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Staff: Key Statistics (Today, My Stall) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-accent\&quot;&gt;Today&amp;apos;s Key Statistics&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-4\&quot;&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Stock Distributed&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-success\&quot;&gt;\n                                                {staffStatistics.stockDistributed.toFixed(2)} kg\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Sales&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-primary\&quot;&gt;\n                                                ₱{staffStatistics.totalSales.toFixed(2)}\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                            &lt;div className=\&quot;stat\&quot;&gt;\n                                                &lt;div className=\&quot;stat-title\&quot;&gt;Stock Status&lt;/div&gt;\n                                                &lt;div className=\&quot;flex items-center gap-3 mt-2\&quot;&gt;\n                                                    &lt;button\n                                                        type=\&quot;button\&quot;\n                                                        className=\&quot;btn btn-sm btn-outline\&quot;\n                                                        onClick={handleToggleStockStatus}\n                                                        disabled={updatingStockStatus}\n                                                    &gt;\n                                                        &lt;span\n                                                            className={&#96;badge badge-lg ${\n                                                                staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                                    ? &#39;badge-success&#39;\n                                                                    : &#39;badge-error&#39;\n                                                            }&#96;}\n                                                        &gt;\n                                                            {staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                                ? &#39;Sold Out&#39;\n                                                                : &#39;Not Sold Out&#39;}\n                                                        &lt;/span&gt;\n                                                    &lt;/button&gt;\n                                                &lt;/div&gt;\n                                            &lt;/div&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                )}\n            &lt;/div&gt;\n        &lt;/Layout&gt;\n    );\n}\n\nexport default Dashboard;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/dashboard.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;943f9503-de2b-4c4d-a17d-ee472a51dd70&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                                                          switch (stockStatus) {\n                                                              case &#39;sold_out&#39;:\n-                                                                 return &#39;badge-error&#39;;\n+                                                                 return &#39;badge-success&#39;;\n                                                              case &#39;not_sold_out&#39;:\n                                                              default:\n-                                                                 return &#39;badge-success&#39;;\n+                                                                 return &#39;badge-error&#39;;\n                                                          }\n                                                      };&quot;,
        &quot;oldStart&quot;: 999,
        &quot;newStart&quot;: 999,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 2,
        &quot;linesAdded&quot;: 2
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/dashboard.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect, useMemo } from &#39;react&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport { isAdmin } from &#39;./utils/roleUtils&#39;;\nimport { getPHDateString, getPHDate, formatPHDate, getPHDateDaysAgo, parseSaleDate } from &#39;./utils/dateUtils&#39;;\nimport {\n    restrictToStaffStallAndToday,\n    fetchCurrentStallStockForStaff,\n    fetchTodaySalesTotalForStaff,\n    fetchTodayStockStatus,\n    saveTodayStockStatus,\n} from &#39;./utils/staffReportsToday&#39;;\nimport Layout from &#39;./components/Layout&#39;;\n// Charts\nimport {\n    Chart as ChartJS,\n    ArcElement,\n    BarElement,\n    LineElement,\n    PointElement,\n    CategoryScale,\n    LinearScale,\n    Tooltip,\n    Legend,\n    Title,\n} from &#39;chart.js&#39;;\nimport { Doughnut, Bar, Line } from &#39;react-chartjs-2&#39;;\n\nChartJS.register(ArcElement, BarElement, LineElement, PointElement, CategoryScale, LinearScale, Tooltip, Legend, Title);\n\nfunction Dashboard() {\n    const [userProfile, setUserProfile] = useState(null);\n    const [loading, setLoading] = useState(true);\n    \n    // Chart data states\n    const [salesByStall, setSalesByStall] = useState([]);\n    const [stockByStall, setStockByStall] = useState([]);\n    const [salesVsExpense, setSalesVsExpense] = useState({ sales: 0, expenses: 0 });\n    const [bestSellers, setBestSellers] = useState([]);\n    const [last7DaysSales, setLast7DaysSales] = useState([]);\n    const [chartsLoading, setChartsLoading] = useState(true);\n    const [stallsStatus, setStallsStatus] = useState([]);\n    \n    // Line chart states\n    const [timeBasedSales, setTimeBasedSales] = useState([]);\n    const [selectedStall, setSelectedStall] = useState(&#39;all&#39;);\n    const [timePeriod, setTimePeriod] = useState(&#39;yesterday&#39;);\n    const [availableStalls, setAvailableStalls] = useState([]);\n\n    // Staff dashboard states\n    const [staffTransactions, setStaffTransactions] = useState([]);\n    const [staffStatistics, setStaffStatistics] = useState({\n        totalSales: 0,\n        stockDistributed: 0,\n        stockStatus: &#39;not_sold_out&#39;,\n    });\n    const [staffCardsLoading, setStaffCardsLoading] = useState(true);\n    const [updatingStockStatus, setUpdatingStockStatus] = useState(false);\n\n    // Load sales by stall data\n    const loadSalesByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    stall_id,\n                    total_amount,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallSales = {};\n            data?.forEach(sale =&gt; {\n                const stallId = sale.stall_id;\n                const stallName = sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallSales[stallId]) {\n                    stallSales[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_sales: 0,\n                        transaction_count: 0\n                    };\n                }\n                stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n                stallSales[stallId].transaction_count += 1;\n            });\n\n            setSalesByStall(Object.values(stallSales));\n        } catch (err) {\n            console.error(&#39;Error loading sales by stall:&#39;, err);\n        }\n    };\n\n    // Load stock by stall data\n    const loadStockByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stall_stocks&#39;)\n                .select(&#96;\n                    stall_id,\n                    quantity,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallStock = {};\n            data?.forEach(stock =&gt; {\n                const stallId = stock.stall_id;\n                const stallName = stock.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallStock[stallId]) {\n                    stallStock[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_stock: 0\n                    };\n                }\n                stallStock[stallId].total_stock += Number(stock.quantity || 0);\n            });\n\n            setStockByStall(Object.values(stallStock));\n        } catch (err) {\n            console.error(&#39;Error loading stock by stall:&#39;, err);\n        }\n    };\n\n    // Load sales vs expenses data\n    const loadSalesVsExpense = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            // Get total sales\n            const { data: salesData, error: salesError } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;total_amount&#39;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (salesError) throw salesError;\n\n            // Get total expenses\n            const { data: expensesData, error: expensesError } = await supabase\n                .from(&#39;expenses&#39;)\n                .select(&#39;cost&#39;)\n                .gte(&#39;date&#39;, twelveMonthsAgoStr);\n\n            if (expensesError) throw expensesError;\n\n            const totalSales = salesData?.reduce((sum, sale) =&gt; sum + Number(sale.total_amount || 0), 0) || 0;\n            const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + Number(expense.cost || 0), 0) || 0;\n\n            setSalesVsExpense({ sales: totalSales, expenses: totalExpenses });\n        } catch (err) {\n            console.error(&#39;Error loading sales vs expenses:&#39;, err);\n        }\n    };\n\n    // Load best sellers data\n    const loadBestSellers = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    quantity_sold,\n                    menu_items(item_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (error) throw error;\n\n            // Group by item and calculate totals\n            const itemSales = {};\n            data?.forEach(sale =&gt; {\n                const itemName = sale.menu_items?.item_name || &#39;Unknown Item&#39;;\n                \n                if (!itemSales[itemName]) {\n                    itemSales[itemName] = {\n                        item_name: itemName,\n                        units_sold: 0\n                    };\n                }\n                itemSales[itemName].units_sold += Number(sale.quantity_sold || 0);\n            });\n\n            // Sort by units sold and take top 4\n            const sortedItems = Object.values(itemSales)\n                .sort((a, b) =&gt; b.units_sold - a.units_sold)\n                .slice(0, 4);\n\n            setBestSellers(sortedItems);\n        } catch (err) {\n            console.error(&#39;Error loading best sellers:&#39;, err);\n        }\n    };\n\n    // Load time-based sales data for line chart\n    const loadTimeBasedSales = async () =&gt; {\n        try {\n            let startDate, endDate, groupBy;\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            \n            if (timePeriod === &#39;yesterday&#39;) {\n                // Show yesterday in context of last 7 days for better visualization\n                const yesterday = new Date(now);\n                yesterday.setDate(yesterday.getDate() - 1);\n                startDate = new Date(yesterday);\n                startDate.setDate(startDate.getDate() - 6); // Go back 6 more days (7 days total)\n                endDate = new Date(yesterday);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;week&#39;) {\n                // Last 7 days including today\n                startDate = new Date(now);\n                startDate.setDate(startDate.getDate() - 6);\n                endDate = new Date(now);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;month&#39;) {\n                // Last 12 months\n                startDate = new Date(now);\n                startDate.setMonth(startDate.getMonth() - 11);\n                startDate.setDate(1);\n                endDate = new Date(now);\n                groupBy = &#39;month&#39;;\n            }\n\n            const startDateStr = getPHDateString(startDate);\n            const endDateStr = getPHDateString(endDate);\n\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_date,\n                    total_amount,\n                    stall_id,\n                    stalls(stall_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, startDateStr)\n                .lte(&#39;sale_date&#39;, endDateStr)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            // Filter by selected stall if not &#39;all&#39;\n            if (selectedStall !== &#39;all&#39;) {\n                query = query.eq(&#39;stall_id&#39;, selectedStall);\n            }\n\n            const { data, error } = await query;\n\n            if (error) throw error;\n\n            // Group data by time period - parse sale_date as PH date\n            const groupedData = {};\n            data?.forEach(sale =&gt; {\n                // Parse sale_date string (YYYY-MM-DD) as PH date\n                const saleDateStr = parseSaleDate(sale.sale_date);\n                let key;\n\n                if (groupBy === &#39;day&#39;) {\n                    key = saleDateStr; // Already YYYY-MM-DD format\n                } else if (groupBy === &#39;month&#39;) {\n                    const [year, month] = saleDateStr.split(&#39;-&#39;);\n                    key = &#96;${year}-${month}&#96;;\n                }\n\n                if (!groupedData[key]) {\n                    groupedData[key] = {\n                        period: key,\n                        sales: 0,\n                        transactions: 0\n                    };\n                }\n                groupedData[key].sales += Number(sale.total_amount || 0);\n                groupedData[key].transactions += 1;\n            });\n\n            // Convert to array and sort\n            const timeBasedData = Object.values(groupedData).sort((a, b) =&gt; {\n                if (groupBy === &#39;day&#39;) {\n                    return a.period.localeCompare(b.period);\n                } else if (groupBy === &#39;month&#39;) {\n                    return a.period.localeCompare(b.period);\n                }\n                return 0;\n            });\n\n            setTimeBasedSales(timeBasedData);\n        } catch (err) {\n            console.error(&#39;Error loading time-based sales:&#39;, err);\n        }\n    };\n\n    // Load available stalls for dropdown\n    const loadAvailableStalls = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (error) throw error;\n            setAvailableStalls(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading stalls:&#39;, err);\n        }\n    };\n\n    // Load stalls status data, including today&#39;s stock sold-out status\n    const loadStallsStatus = async () =&gt; {\n        try {\n            // First load all business stalls\n            const { data: stallsData, error: stallsError } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name, location, status&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (stallsError) throw stallsError;\n\n            const stalls = stallsData || [];\n\n            // If there are no stalls, we can short-circuit\n            if (stalls.length === 0) {\n                setStallsStatus([]);\n                return;\n            }\n\n            // Build today&#39;s date range in PH timezone (same logic as staffReportsToday helpers)\n            const today = getPHDate();\n            const todayStr = getPHDateString(today);\n\n            // Fetch today&#39;s stock status for all stalls in a single query\n            const stallIds = stalls.map((stall) =&gt; stall.stall_id);\n            const { data: stockStatusData, error: stockStatusError } = await supabase\n                .from(&#39;stock_status_history&#39;)\n                .select(&#39;stall_id, stock_status, stock_level, date&#39;)\n                .in(&#39;stall_id&#39;, stallIds)\n                .eq(&#39;date&#39;, todayStr);\n\n            if (stockStatusError) throw stockStatusError;\n\n            // Build a lookup map for today&#39;s stock status per stall\n            const stockStatusByStallId = {};\n            (stockStatusData || []).forEach((row) =&gt; {\n                stockStatusByStallId[row.stall_id] = {\n                    stockStatus: row.stock_status || &#39;not_sold_out&#39;,\n                    stockLevel:\n                        typeof row.stock_level === &#39;number&#39;\n                            ? row.stock_level\n                            : Number(row.stock_level || 0),\n                };\n            });\n\n            // Merge business status with today&#39;s stock status, defaulting to not_sold_out\n            const merged = stalls.map((stall) =&gt; {\n                const stockInfo = stockStatusByStallId[stall.stall_id] || {\n                    stockStatus: &#39;not_sold_out&#39;,\n                    stockLevel: null,\n                };\n\n                return {\n                    ...stall,\n                    stockStatus: stockInfo.stockStatus,\n                    stockLevel: stockInfo.stockLevel,\n                };\n            });\n\n            setStallsStatus(merged);\n        } catch (err) {\n            console.error(&#39;Error loading stalls status:&#39;, err);\n        }\n    };\n\n    // Staff: load recent transactions for today for their stall\n    const loadStaffRecentTransactions = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_id,\n                    sale_date,\n                    quantity_sold,\n                    total_amount,\n                    payment_method,\n                    stall_id,\n                    product_id,\n                    stalls(stall_name),\n                    menu_items(item_name)\n                &#96;);\n\n            query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n            const { data, error } = await query\n                .order(&#39;sale_date&#39;, { ascending: false })\n                .limit(10);\n\n            if (error) throw error;\n            setStaffTransactions(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading staff recent transactions:&#39;, err);\n        }\n    };\n\n    // Staff: load key statistics for today for their stall\n    const loadStaffStatistics = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            const [stockDistributed, totalSales, stockStatusInfo] = await Promise.all([\n                fetchCurrentStallStockForStaff(userProfile),\n                fetchTodaySalesTotalForStaff(userProfile),\n                fetchTodayStockStatus(userProfile.stall_id),\n            ]);\n\n            setStaffStatistics({\n                totalSales: totalSales || 0,\n                stockDistributed: stockDistributed || 0,\n                stockStatus: stockStatusInfo?.stockStatus || &#39;not_sold_out&#39;,\n            });\n        } catch (err) {\n            console.error(&#39;Error loading staff statistics:&#39;, err);\n        }\n    };\n\n    const loadStaffDashboardData = async () =&gt; {\n        setStaffCardsLoading(true);\n        try {\n            await Promise.all([\n                loadStaffRecentTransactions(),\n                loadStaffStatistics(),\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading staff dashboard data:&#39;, err);\n        } finally {\n            setStaffCardsLoading(false);\n        }\n    };\n\n    const handleToggleStockStatus = async () =&gt; {\n        if (!userProfile) return;\n\n        const nextStatus =\n            staffStatistics.stockStatus === &#39;sold_out&#39; ? &#39;not_sold_out&#39; : &#39;sold_out&#39;;\n\n        setUpdatingStockStatus(true);\n        try {\n            await saveTodayStockStatus(\n                userProfile.stall_id,\n                staffStatistics.stockDistributed,\n                nextStatus\n            );\n            setStaffStatistics((prev) =&gt; ({\n                ...prev,\n                stockStatus: nextStatus,\n            }));\n        } catch (err) {\n            console.error(&#39;Error toggling stock status:&#39;, err);\n        } finally {\n            setUpdatingStockStatus(false);\n        }\n    };\n\n    // Load last 7 days sales data\n    const loadLast7DaysSales = async () =&gt; {\n        try {\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            const today = getPHDateString(now);\n            \n            // Get 7 days ago (including today, so 6 days back)\n            const sevenDaysAgo = new Date(now);\n            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 6);\n            const sevenDaysAgoStr = getPHDateString(sevenDaysAgo);\n\n            console.log(&#39;Loading sales from:&#39;, sevenDaysAgoStr, &#39;to:&#39;, today);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;sale_date, total_amount&#39;)\n                .gte(&#39;sale_date&#39;, sevenDaysAgoStr)\n                .lte(&#39;sale_date&#39;, today)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            if (error) throw error;\n\n            // Group by date and calculate daily totals - parse sale_date as PH date\n            const dailySales = {};\n            data?.forEach(sale =&gt; {\n                const date = parseSaleDate(sale.sale_date);\n                if (!dailySales[date]) {\n                    dailySales[date] = 0;\n                }\n                dailySales[date] += Number(sale.total_amount || 0);\n            });\n\n            // Create array for last 7 days (including today)\n            const last7Days = [];\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const dayName = formatPHDate(dateStr, { weekday: &#39;short&#39; });\n                \n                last7Days.push({\n                    date: dateStr,\n                    day: dayName,\n                    sales: dailySales[dateStr] || 0\n                });\n            }\n\n            console.log(&#39;Last 7 days data:&#39;, last7Days);\n            setLast7DaysSales(last7Days);\n        } catch (err) {\n            console.error(&#39;Error loading last 7 days sales:&#39;, err);\n        }\n    };\n\n    // Load all chart data\n    const loadChartData = async () =&gt; {\n        setChartsLoading(true);\n        try {\n            await Promise.all([\n                loadSalesByStall(),\n                loadStockByStall(),\n                loadSalesVsExpense(),\n                loadBestSellers(),\n                loadLast7DaysSales(),\n                loadAvailableStalls(),\n                loadTimeBasedSales(),\n                loadStallsStatus()\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading chart data:&#39;, err);\n        } finally {\n            setChartsLoading(false);\n        }\n    };\n\n    // Refresh all chart data\n    const refreshChartData = async () =&gt; {\n        console.log(&#39;Refreshing chart data...&#39;);\n        await loadChartData();\n    };\n\n    // Chart datasets\n    const donutSalesByStall = useMemo(() =&gt; ({\n        labels: salesByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Sales Count&#39;,\n                data: salesByStall.map(stall =&gt; stall.transaction_count),\n                backgroundColor: [&#39;#60a5fa&#39;, &#39;#f472b6&#39;, &#39;#34d399&#39;, &#39;#fbbf24&#39;, &#39;#a78bfa&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesByStall]);\n\n    const donutStockByStall = useMemo(() =&gt; ({\n        labels: stockByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Stock Qty&#39;,\n                data: stockByStall.map(stall =&gt; stall.total_stock),\n                backgroundColor: [&#39;#fbbf24&#39;, &#39;#818cf8&#39;, &#39;#f87171&#39;, &#39;#34d399&#39;, &#39;#f472b6&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [stockByStall]);\n\n    const donutSalesVsExpense = useMemo(() =&gt; ({\n        labels: [&#39;Sales&#39;, &#39;Expenses&#39;],\n        datasets: [\n            {\n                label: &#39;Amount&#39;,\n                data: [salesVsExpense.sales, salesVsExpense.expenses],\n                backgroundColor: [&#39;#22d3ee&#39;, &#39;#f97316&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesVsExpense]);\n\n    const donutBestSeller = useMemo(() =&gt; ({\n        labels: bestSellers.map(item =&gt; item.item_name),\n        datasets: [\n            {\n                label: &#39;Units Sold&#39;,\n                data: bestSellers.map(item =&gt; item.units_sold),\n                backgroundColor: [&#39;#86efac&#39;, &#39;#93c5fd&#39;, &#39;#fda4af&#39;, &#39;#fde68a&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [bestSellers]);\n\n    const last7DaysBar = useMemo(() =&gt; ({\n        labels: last7DaysSales.map(day =&gt; day.day),\n        datasets: [\n            {\n                label: &#39;Sales (PHP)&#39;,\n                data: last7DaysSales.map(day =&gt; day.sales),\n                backgroundColor: &#39;#60a5fa&#39;,\n                borderRadius: 6,\n            },\n        ],\n    }), [last7DaysSales]);\n\n    const timeBasedLine = useMemo(() =&gt; {\n        // Create complete date range for proper labeling\n        let allLabels = [];\n        let allData = [];\n        \n        if (timePeriod === &#39;yesterday&#39;) {\n            // Show yesterday in context of last 7 days\n            const now = getPHDate();\n            const yesterday = new Date(now);\n            yesterday.setDate(yesterday.getDate() - 1);\n            \n            // Generate last 7 days ending with yesterday\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(yesterday);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;week&#39;) {\n            // Generate last 7 days including today\n            const now = getPHDate();\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;month&#39;) {\n            // Generate all 12 months\n            const now = getPHDate();\n            for (let i = 11; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setMonth(date.getMonth() - i);\n                const year = date.getFullYear();\n                const month = String(date.getMonth() + 1).padStart(2, &#39;0&#39;);\n                const periodKey = &#96;${year}-${month}&#96;;\n                const label = formatPHDate(getPHDateString(date), { month: &#39;short&#39;, year: &#39;numeric&#39; });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this month\n                const salesData = timeBasedSales.find(item =&gt; item.period === periodKey);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        }\n\n        return {\n            labels: allLabels,\n            datasets: [\n                {\n                    label: &#39;Sales (₱)&#39;,\n                    data: allData,\n                    borderColor: &#39;#3B82F6&#39;,\n                    backgroundColor: &#39;rgba(59, 130, 246, 0.1)&#39;,\n                    borderWidth: 3,\n                    fill: true,\n                    tension: 0.4,\n                    pointBackgroundColor: allData.map((_, index) =&gt; {\n                        // Highlight the last point (yesterday) if in yesterday view\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return &#39;#10b981&#39;; // Green color for yesterday\n                        }\n                        return &#39;#3B82F6&#39;;\n                    }),\n                    pointBorderColor: &#39;#ffffff&#39;,\n                    pointBorderWidth: 2,\n                    pointRadius: allData.map((_, index) =&gt; {\n                        // Make yesterday&#39;s point slightly larger\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return 8;\n                        }\n                        return 6;\n                    }),\n                    pointHoverRadius: 10,\n                },\n            ],\n        };\n    }, [timeBasedSales, timePeriod, last7DaysSales]);\n\n    const donutOptions = useMemo(() =&gt; ({\n        plugins: {\n            legend: { position: &#39;bottom&#39; },\n            title: { display: false },\n        },\n        cutout: &#39;65%&#39;,\n        maintainAspectRatio: false,\n    }), []);\n\n    const barOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { display: false },\n            title: { display: false },\n            tooltip: { mode: &#39;index&#39;, intersect: false },\n        },\n        scales: {\n            x: { grid: { display: false } },\n            y: { grid: { color: &#39;rgba(0,0,0,0.05)&#39; }, beginAtZero: true },\n        },\n        maintainAspectRatio: false,\n    }), []);\n\n    const lineOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { \n                display: true,\n                position: &#39;top&#39;,\n                labels: {\n                    color: &#39;#374151&#39;,\n                    font: { size: 12 }\n                }\n            },\n            title: { display: false },\n            tooltip: { \n                mode: &#39;index&#39;, \n                intersect: false,\n                backgroundColor: &#39;#1F2937&#39;,\n                titleColor: &#39;#F9FAFB&#39;,\n                bodyColor: &#39;#F9FAFB&#39;,\n                borderColor: &#39;#374151&#39;,\n                borderWidth: 1,\n                callbacks: {\n                    label: function(context) {\n                        return &#96;Sales: ₱${Number(context.parsed.y).toLocaleString()}&#96;;\n                    }\n                }\n            },\n        },\n        scales: {\n            x: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { color: &#39;#6B7280&#39; }\n            },\n            y: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { \n                    color: &#39;#6B7280&#39;,\n                    callback: function(value) {\n                        return &#39;₱&#39; + Number(value).toLocaleString();\n                    }\n                },\n                beginAtZero: true \n            },\n        },\n        maintainAspectRatio: false,\n        interaction: {\n            intersect: false,\n            mode: &#39;index&#39;\n        }\n    }), []);\n\n    // Reload time-based sales when controls change\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            loadTimeBasedSales();\n        }\n    }, [selectedStall, timePeriod]);\n\n    // Refresh chart data periodically and on mount for admin\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            // Initial load\n            loadChartData();\n            \n            // Set up periodic refresh every 30 seconds\n            const refreshInterval = setInterval(() =&gt; {\n                refreshChartData();\n            }, 30000);\n\n            // Cleanup interval on unmount\n            return () =&gt; clearInterval(refreshInterval);\n        }\n    }, [userProfile?.role]);\n\n    // Load staff dashboard data for staff\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;staff&#39;) {\n            loadStaffDashboardData();\n        }\n    }, [userProfile?.role]);\n\n    useEffect(() =&gt; {\n        const getUser = async () =&gt; {\n            const { data: { user } } = await supabase.auth.getUser();\n\n            if (user) {\n                // Fetch profile info from your database\n                const { data: profile, error } = await supabase\n                    .from(&#39;profiles&#39;)\n                    .select(&#39;role, full_name, stall_id, status&#39;)\n                    .eq(&#39;id&#39;, user.id)\n                    .single();\n\n                if (error) {\n                    console.error(&#39;Error fetching profile:&#39;, error);\n                } else {\n                    setUserProfile(profile);\n                    console.log(&#39;Profile loaded:&#39;, profile);\n                }\n            }\n\n            setLoading(false);\n        };\n\n        getUser();\n    }, []);\n\n    if (loading) {\n        return (\n            &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n                &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n            &lt;/div&gt;\n        );\n    }\n\n    return (\n        &lt;Layout userProfile={userProfile}&gt;\n            &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n                &lt;div className=\&quot;mb-6\&quot;&gt;\n                    &lt;h1 className=\&quot;text-3xl font-bold text-primary\&quot;&gt;\n                        {isAdmin(userProfile) ? &#39;Admin Dashboard&#39; : &#39;Staff Dashboard&#39;}\n                    &lt;/h1&gt;\n                    {!isAdmin(userProfile) &amp;&amp; (\n                        &lt;p className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                            Today • My Stall\n                        &lt;/p&gt;\n                    )}\n                &lt;/div&gt;\n\n                {isAdmin(userProfile) ? (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-3 gap-6\&quot;&gt;\n                        {/* Combined: Sales over time by stall (spans 2 columns) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl lg:col-span-2\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title\&quot;&gt;Sales Summary&lt;/h2&gt;\n                                    &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={selectedStall}\n                                                onChange={(e) =&gt; setSelectedStall(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;all\&quot;&gt;All Stalls&lt;/option&gt;\n                                                {availableStalls.map(stall =&gt; (\n                                                    &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                                        {stall.stall_name}\n                                                    &lt;/option&gt;\n                                                ))}\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={timePeriod}\n                                                onChange={(e) =&gt; setTimePeriod(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;yesterday\&quot;&gt;Yesterday&lt;/option&gt;\n                                                &lt;option value=\&quot;week\&quot;&gt;Last 7 Days&lt;/option&gt;\n                                                &lt;option value=\&quot;month\&quot;&gt;Last 12 Months&lt;/option&gt;\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                &lt;/div&gt;\n                                &lt;div className=\&quot;h-80\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Line data={timeBasedLine} options={lineOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Stocks per stall */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Stocks per Stall&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutStockByStall} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Sales vs Expense */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Sales vs Expense&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutSalesVsExpense} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Best seller */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Best Seller&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutBestSeller} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Business Stalls Statuses */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Business Stalls Statuses&lt;/h2&gt;\n                                {chartsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-full py-8\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : stallsStatus.length === 0 ? (\n                                    &lt;div className=\&quot;text-base-content/50 text-center py-4\&quot;&gt;\n                                        No stalls available.\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;overflow-x-auto\&quot;&gt;\n                                        &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                                            &lt;thead&gt;\n                                                &lt;tr&gt;\n                                                    &lt;th&gt;Stall&lt;/th&gt;\n                                                    &lt;th&gt;Active Status&lt;/th&gt;\n                                                    &lt;th&gt;Sold Out Status&lt;/th&gt;\n                                                &lt;/tr&gt;\n                                            &lt;/thead&gt;\n                                            &lt;tbody&gt;\n                                                {stallsStatus.map((stall) =&gt; {\n                                                    const getBusinessStatusBadgeColor = (status) =&gt; {\n                                                        switch (status) {\n                                                            case &#39;active&#39;:\n                                                                return &#39;badge-success&#39;;\n                                                            case &#39;inactive&#39;:\n                                                                return &#39;badge-error&#39;;\n                                                            case &#39;under maintenance&#39;:\n                                                                return &#39;badge-warning&#39;;\n                                                            default:\n                                                                return &#39;badge-neutral&#39;;\n                                                        }\n                                                    };\n\n                                                    const getStockStatusBadgeColor = (stockStatus) =&gt; {\n                                                        switch (stockStatus) {\n                                                            case &#39;sold_out&#39;:\n                                                                return &#39;badge-success&#39;;\n                                                            case &#39;not_sold_out&#39;:\n                                                            default:\n                                                                return &#39;badge-error&#39;;\n                                                        }\n                                                    };\n\n                                                    const stockStatusLabel =\n                                                        stall.stockStatus === &#39;sold_out&#39;\n                                                            ? &#39;Sold Out&#39;\n                                                            : &#39;Not Sold Out&#39;;\n\n                                                    return (\n                                                        &lt;tr key={stall.stall_id}&gt;\n                                                            &lt;td&gt;\n                                                                &lt;div className=\&quot;font-semibold\&quot;&gt;\n                                                                    {stall.stall_name}\n                                                                &lt;/div&gt;\n                                                                {stall.location &amp;&amp; (\n                                                                    &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                                                                        {stall.location}\n                                                                    &lt;/div&gt;\n                                                                )}\n                                                            &lt;/td&gt;\n                                                            &lt;td&gt;\n                                                                &lt;span\n                                                                    className={&#96;badge ${getBusinessStatusBadgeColor(\n                                                                        stall.status\n                                                                    )}&#96;}\n                                                                &gt;\n                                                                    {stall.status || &#39;N/A&#39;}\n                                                                &lt;/span&gt;\n                                                            &lt;/td&gt;\n                                                            &lt;td&gt;\n                                                                &lt;span\n                                                                    className={&#96;badge ${getStockStatusBadgeColor(\n                                                                        stall.stockStatus\n                                                                    )}&#96;}\n                                                                &gt;\n                                                                    {stockStatusLabel}\n                                                                &lt;/span&gt;\n                                                            &lt;/td&gt;\n                                                        &lt;/tr&gt;\n                                                    );\n                                                })}\n                                            &lt;/tbody&gt;\n                                        &lt;/table&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                    &lt;/div&gt;\n                ) : (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n                        {/* Staff: Recent Transactions (Today, My Stall) */}\n                    &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                        &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Today&amp;apos;s Recent Transactions&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : staffTransactions.length === 0 ? (\n                                    &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;\n                                        No transactions recorded yet for today.\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;overflow-x-auto max-h-80\&quot;&gt;\n                                        &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                                            &lt;thead&gt;\n                                                &lt;tr&gt;\n                                                    &lt;th&gt;Time&lt;/th&gt;\n                                                    &lt;th&gt;Item&lt;/th&gt;\n                                                    &lt;th&gt;Qty&lt;/th&gt;\n                                                    &lt;th&gt;Amount&lt;/th&gt;\n                                                    &lt;th&gt;Payment&lt;/th&gt;\n                                                &lt;/tr&gt;\n                                            &lt;/thead&gt;\n                                            &lt;tbody&gt;\n                                                {staffTransactions.map((tx) =&gt; (\n                                                    &lt;tr key={tx.sale_id}&gt;\n                                                        &lt;td&gt;{tx.sale_date}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.quantity_sold}&lt;/td&gt;\n                                                        &lt;td className=\&quot;text-success font-semibold\&quot;&gt;\n                                                            ₱{Number(tx.total_amount || 0).toFixed(2)}\n                                                        &lt;/td&gt;\n                                                        &lt;td&gt;\n                                                            &lt;span className={&#96;badge ${tx.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                                                {tx.payment_method}\n                                                            &lt;/span&gt;\n                                                        &lt;/td&gt;\n                                                    &lt;/tr&gt;\n                                                ))}\n                                            &lt;/tbody&gt;\n                                        &lt;/table&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Staff: Key Statistics (Today, My Stall) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-accent\&quot;&gt;Today&amp;apos;s Key Statistics&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-4\&quot;&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Stock Distributed&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-success\&quot;&gt;\n                                                {staffStatistics.stockDistributed.toFixed(2)} kg\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Sales&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-primary\&quot;&gt;\n                                                ₱{staffStatistics.totalSales.toFixed(2)}\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                            &lt;div className=\&quot;stat\&quot;&gt;\n                                                &lt;div className=\&quot;stat-title\&quot;&gt;Stock Status&lt;/div&gt;\n                                                &lt;div className=\&quot;flex items-center gap-3 mt-2\&quot;&gt;\n                                                    &lt;button\n                                                        type=\&quot;button\&quot;\n                                                        className=\&quot;btn btn-sm btn-outline\&quot;\n                                                        onClick={handleToggleStockStatus}\n                                                        disabled={updatingStockStatus}\n                                                    &gt;\n                                                        &lt;span\n                                                            className={&#96;badge badge-lg ${\n                                                                staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                                    ? &#39;badge-success&#39;\n                                                                    : &#39;badge-error&#39;\n                                                            }&#96;}\n                                                        &gt;\n                                                            {staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                                ? &#39;Sold Out&#39;\n                                                                : &#39;Not Sold Out&#39;}\n                                                        &lt;/span&gt;\n                                                    &lt;/button&gt;\n                                                &lt;/div&gt;\n                                            &lt;/div&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                )}\n            &lt;/div&gt;\n        &lt;/Layout&gt;\n    );\n}\n\nexport default Dashboard;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

Both places now have reversed colors:  
- **Staff dashboard** stock badge → “Sold Out” is green (`badge-success`), “Not Sold Out” is red (`badge-error`).  
- **Admin Business Stalls table** stock badge uses the same mapping, so the two statuses’ colors are swapped consistently.

---

_**User (2025-11-16 05:55Z)**_

delete the grayed out point of sales in the admin 

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Interpreting admin instructions**

I need to interpret the phrase: "delete the grayed out point of sales in the admin." It seems like there might be a disabled or greyed-out POS card in the sidebar or dashboard admin view. I'll need to inspect the sidebar, layout, or dashboard to find it. Using the right tools should help me identify what needs to be deleted. Let’s go through this step-by-step to make sure I get it right!</details></think>

---

I’ll locate where the admin UI shows the greyed-out Point of Sale entry (likely in the sidebar or dashboard cards) and then remove that element so it no longer appears for admins.

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/components/Sidebar.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/dashboard.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Implementing conditional rendering**

I'm thinking about how to conditionally render the POS button so that only staff members can see it. It seems like I need to double-check the comments associated with this to ensure everything aligns properly. If I update the comments to match, it should work seamlessly. The next step involves implementing it, possibly by using apply_patch. That should effectively cover the requirement!</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/components/Sidebar.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;97f3e11f-1f92-4a32-97ed-2d89c147b16b&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                  &lt;/li&gt;\n  \n-                 {/* Point of Sales - Available to staff (and admin, if allowed) */}\n-                 &lt;li&gt;\n-                     &lt;button \n-                         className={&#96;btn w-full justify-start ${canViewPointOfSales(userProfile) ? &#39;btn-success&#39; : &#39;btn-disabled&#39;}&#96;}\n-                         onClick={() =&gt; canViewPointOfSales(userProfile) &amp;&amp; navigate(&#39;/point-of-sale&#39;)}\n-                         disabled={!canViewPointOfSales(userProfile)}\n-                     &gt;\n-                         &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n-                             &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m0 0L12 20l2.5-2M17 13h-2.5M17 13v5a2 2 0 01-2 2H9a2 2 0 01-2-2v-5m10 0V8a2 2 0 00-2-2H9a2 2 0 00-2 2v5m10 0h-2.5\&quot; /&gt;\n-                         &lt;/svg&gt;\n-                         Point of Sales\n-                     &lt;/button&gt;\n-                 &lt;/li&gt;\n+                 {/* Point of Sales - Staff quick action only */}\n+                 {staffOnly &amp;&amp; (\n+                     &lt;li&gt;\n+                         &lt;button \n+                             className={&#96;btn w-full justify-start ${canViewPointOfSales(userProfile) ? &#39;btn-success&#39; : &#39;btn-disabled&#39;}&#96;}\n+                             onClick={() =&gt; canViewPointOfSales(userProfile) &amp;&amp; navigate(&#39;/point-of-sale&#39;)}\n+                             disabled={!canViewPointOfSales(userProfile)}\n+                         &gt;\n+                             &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n+                                 &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m0 0L12 20l2.5-2M17 13h-2.5M17 13v5a2 2 0 01-2 2H9a2 2 0 01-2-2v-5m10 0V8a2 2 0 00-2-2H9a2 2 0 00-2 2v5m10 0h-2.5\&quot; /&gt;\n+                             &lt;/svg&gt;\n+                             Point of Sales\n+                         &lt;/button&gt;\n+                     &lt;/li&gt;\n+                 )}\n  \n                  {/* Admin-only actions - hidden entirely for staff */}&quot;,
        &quot;oldStart&quot;: 36,
        &quot;newStart&quot;: 36,
        &quot;oldLines&quot;: 17,
        &quot;newLines&quot;: 19,
        &quot;linesRemoved&quot;: 13,
        &quot;linesAdded&quot;: 15
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/components/Sidebar.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;../supabaseClient&#39;;\nimport { canManageUsers, canViewReports, canManageStock, canManageSales, canViewPointOfSales, isStaff } from &#39;../utils/roleUtils&#39;;\n\nfunction Sidebar({ userProfile, onLogout }) {\n    const navigate = useNavigate();\n\n    const handleLogout = async () =&gt; {\n        await supabase.auth.signOut();\n        onLogout();\n    };\n\n    const staffOnly = isStaff(userProfile);\n\n    return (\n        &lt;div className=\&quot;drawer-side\&quot;&gt;\n            &lt;label htmlFor=\&quot;my-drawer-2\&quot; aria-label=\&quot;close sidebar\&quot; className=\&quot;drawer-overlay\&quot;&gt;&lt;/label&gt;\n            &lt;ul className=\&quot;menu p-4 w-80 min-h-full bg-base-100 text-base-content gap-2\&quot;&gt;\n                {/* Sidebar Header */}\n                &lt;li className=\&quot;menu-title\&quot;&gt;\n                    &lt;span&gt;Quick Actions&lt;/span&gt;\n                &lt;/li&gt;\n\n                {/* Dashboard - Available to both admin and staff */}\n                &lt;li&gt;\n                    &lt;button \n                        className={&#96;btn w-full justify-start ${canManageSales(userProfile) ? &#39;btn-primary&#39; : &#39;btn-disabled&#39;}&#96;}\n                        onClick={() =&gt; canManageSales(userProfile) &amp;&amp; navigate(&#39;/dashboard&#39;)}\n                        disabled={!canManageSales(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M12 6v6m0 0v6m0-6h6m-6 0H6\&quot; /&gt;\n                        &lt;/svg&gt;\n                        Dashboard\n                    &lt;/button&gt;\n                &lt;/li&gt;\n\n                {/* Point of Sales - Staff quick action only */}\n                {staffOnly &amp;&amp; (\n                    &lt;li&gt;\n                        &lt;button \n                            className={&#96;btn w-full justify-start ${canViewPointOfSales(userProfile) ? &#39;btn-success&#39; : &#39;btn-disabled&#39;}&#96;}\n                            onClick={() =&gt; canViewPointOfSales(userProfile) &amp;&amp; navigate(&#39;/point-of-sale&#39;)}\n                            disabled={!canViewPointOfSales(userProfile)}\n                        &gt;\n                            &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                                &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m0 0L12 20l2.5-2M17 13h-2.5M17 13v5a2 2 0 01-2 2H9a2 2 0 01-2-2v-5m10 0V8a2 2 0 00-2-2H9a2 2 0 00-2 2v5m10 0h-2.5\&quot; /&gt;\n                            &lt;/svg&gt;\n                            Point of Sales\n                        &lt;/button&gt;\n                    &lt;/li&gt;\n                )}\n\n                {/* Admin-only actions - hidden entirely for staff */}\n                {!staffOnly &amp;&amp; (\n                    &lt;&gt;\n                {/* Manage Inventory - Available to admin only */}\n                &lt;li&gt;\n                    &lt;button \n                        className={&#96;btn w-full justify-start ${canManageStock(userProfile) ? &#39;btn-secondary&#39; : &#39;btn-disabled&#39;}&#96;}\n                        onClick={() =&gt; canManageStock(userProfile) &amp;&amp; navigate(&#39;/manage-inventory&#39;)}\n                        disabled={!canManageStock(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\&quot; /&gt;\n                        &lt;/svg&gt;\n                        Manage Inventory\n                    &lt;/button&gt;\n                &lt;/li&gt;\n\n                        {/* View Reports - Available to both admin and staff, but hidden from staff quick actions */}\n                &lt;li&gt;\n                    &lt;button \n                        className={&#96;btn w-full justify-start ${canViewReports(userProfile) ? &#39;btn-accent&#39; : &#39;btn-disabled&#39;}&#96;}\n                        onClick={() =&gt; canViewReports(userProfile) &amp;&amp; navigate(&#39;/reports&#39;)}\n                        disabled={!canViewReports(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\&quot; /&gt;\n                        &lt;/svg&gt;\n                        History Reports\n                    &lt;/button&gt;\n                &lt;/li&gt;\n\n                {/* Manage Staff - Available to admin only */}\n                &lt;li&gt;\n                    &lt;button \n                        className={&#96;btn w-full justify-start ${canManageUsers(userProfile) ? &#39;btn-error&#39; : &#39;btn-disabled&#39;}&#96;}\n                        onClick={() =&gt; canManageUsers(userProfile) &amp;&amp; navigate(&#39;/manage-staff&#39;)}\n                        disabled={!canManageUsers(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\&quot; /&gt;\n                        &lt;/svg&gt;\n                        Manage Staff\n                    &lt;/button&gt;\n                &lt;/li&gt;\n                    &lt;/&gt;\n                )}\n            &lt;/ul&gt;\n        &lt;/div&gt;\n    );\n}\n\nexport default Sidebar;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

The greyed-out Point of Sales button is now hidden for admins; it only appears in the sidebar for staff users with POS access.

---

_**User (2025-11-16 05:55Z)**_

that black border in the staff dashboard that surrounds the badge of sold status annoys me, remove that

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Exploring badge styling options**

I need to address the black border around the badge. It seems to be caused by the button being styled as `btn-outline`, which gives it a border. The user wants to remove that border. I could switch to `btn-ghost` to eliminate the border and background. Another idea is making the span clickable or using `btn btn-sm border-0 bg-transparent`. However, going with `btn btn-sm btn-ghost` looks like the best option for a clean solution.
**Applying patch to dashboard**

I need to use `apply_patch` on `dashboard.jsx` specifically for that button. It seems like the button requires some adjustments, so I'll ensure I apply the necessary changes correctly. I'll need to check the syntax and confirm that everything aligns with the expected styles to achieve the desired outcome. It's crucial to be thorough here so that the patch is effective and the button functions as intended.</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/dashboard.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;52fbcfca-8ad8-4f1d-9502-7064c5732cb8&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                                                      &lt;button\n                                                          type=\&quot;button\&quot;\n-                                                         className=\&quot;btn btn-sm btn-outline\&quot;\n+                                                         className=\&quot;btn btn-sm btn-ghost\&quot;\n                                                          onClick={handleToggleStockStatus}\n                                                          disabled={updatingStockStatus}&quot;,
        &quot;oldStart&quot;: 1132,
        &quot;newStart&quot;: 1132,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/dashboard.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect, useMemo } from &#39;react&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport { isAdmin } from &#39;./utils/roleUtils&#39;;\nimport { getPHDateString, getPHDate, formatPHDate, getPHDateDaysAgo, parseSaleDate } from &#39;./utils/dateUtils&#39;;\nimport {\n    restrictToStaffStallAndToday,\n    fetchCurrentStallStockForStaff,\n    fetchTodaySalesTotalForStaff,\n    fetchTodayStockStatus,\n    saveTodayStockStatus,\n} from &#39;./utils/staffReportsToday&#39;;\nimport Layout from &#39;./components/Layout&#39;;\n// Charts\nimport {\n    Chart as ChartJS,\n    ArcElement,\n    BarElement,\n    LineElement,\n    PointElement,\n    CategoryScale,\n    LinearScale,\n    Tooltip,\n    Legend,\n    Title,\n} from &#39;chart.js&#39;;\nimport { Doughnut, Bar, Line } from &#39;react-chartjs-2&#39;;\n\nChartJS.register(ArcElement, BarElement, LineElement, PointElement, CategoryScale, LinearScale, Tooltip, Legend, Title);\n\nfunction Dashboard() {\n    const [userProfile, setUserProfile] = useState(null);\n    const [loading, setLoading] = useState(true);\n    \n    // Chart data states\n    const [salesByStall, setSalesByStall] = useState([]);\n    const [stockByStall, setStockByStall] = useState([]);\n    const [salesVsExpense, setSalesVsExpense] = useState({ sales: 0, expenses: 0 });\n    const [bestSellers, setBestSellers] = useState([]);\n    const [last7DaysSales, setLast7DaysSales] = useState([]);\n    const [chartsLoading, setChartsLoading] = useState(true);\n    const [stallsStatus, setStallsStatus] = useState([]);\n    \n    // Line chart states\n    const [timeBasedSales, setTimeBasedSales] = useState([]);\n    const [selectedStall, setSelectedStall] = useState(&#39;all&#39;);\n    const [timePeriod, setTimePeriod] = useState(&#39;yesterday&#39;);\n    const [availableStalls, setAvailableStalls] = useState([]);\n\n    // Staff dashboard states\n    const [staffTransactions, setStaffTransactions] = useState([]);\n    const [staffStatistics, setStaffStatistics] = useState({\n        totalSales: 0,\n        stockDistributed: 0,\n        stockStatus: &#39;not_sold_out&#39;,\n    });\n    const [staffCardsLoading, setStaffCardsLoading] = useState(true);\n    const [updatingStockStatus, setUpdatingStockStatus] = useState(false);\n\n    // Load sales by stall data\n    const loadSalesByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    stall_id,\n                    total_amount,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallSales = {};\n            data?.forEach(sale =&gt; {\n                const stallId = sale.stall_id;\n                const stallName = sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallSales[stallId]) {\n                    stallSales[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_sales: 0,\n                        transaction_count: 0\n                    };\n                }\n                stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n                stallSales[stallId].transaction_count += 1;\n            });\n\n            setSalesByStall(Object.values(stallSales));\n        } catch (err) {\n            console.error(&#39;Error loading sales by stall:&#39;, err);\n        }\n    };\n\n    // Load stock by stall data\n    const loadStockByStall = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stall_stocks&#39;)\n                .select(&#96;\n                    stall_id,\n                    quantity,\n                    stalls(stall_name)\n                &#96;);\n\n            if (error) throw error;\n\n            // Group by stall and calculate totals\n            const stallStock = {};\n            data?.forEach(stock =&gt; {\n                const stallId = stock.stall_id;\n                const stallName = stock.stalls?.stall_name || &#96;Stall ${stallId}&#96;;\n                \n                if (!stallStock[stallId]) {\n                    stallStock[stallId] = {\n                        stall_id: stallId,\n                        stall_name: stallName,\n                        total_stock: 0\n                    };\n                }\n                stallStock[stallId].total_stock += Number(stock.quantity || 0);\n            });\n\n            setStockByStall(Object.values(stallStock));\n        } catch (err) {\n            console.error(&#39;Error loading stock by stall:&#39;, err);\n        }\n    };\n\n    // Load sales vs expenses data\n    const loadSalesVsExpense = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            // Get total sales\n            const { data: salesData, error: salesError } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;total_amount&#39;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (salesError) throw salesError;\n\n            // Get total expenses\n            const { data: expensesData, error: expensesError } = await supabase\n                .from(&#39;expenses&#39;)\n                .select(&#39;cost&#39;)\n                .gte(&#39;date&#39;, twelveMonthsAgoStr);\n\n            if (expensesError) throw expensesError;\n\n            const totalSales = salesData?.reduce((sum, sale) =&gt; sum + Number(sale.total_amount || 0), 0) || 0;\n            const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + Number(expense.cost || 0), 0) || 0;\n\n            setSalesVsExpense({ sales: totalSales, expenses: totalExpenses });\n        } catch (err) {\n            console.error(&#39;Error loading sales vs expenses:&#39;, err);\n        }\n    };\n\n    // Load best sellers data\n    const loadBestSellers = async () =&gt; {\n        try {\n            // Use same 12-month filter as line chart with Philippines timezone\n            const now = getPHDate();\n            const twelveMonthsAgo = new Date(now);\n            twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\n            const twelveMonthsAgoStr = getPHDateString(twelveMonthsAgo);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    quantity_sold,\n                    menu_items(item_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, twelveMonthsAgoStr);\n\n            if (error) throw error;\n\n            // Group by item and calculate totals\n            const itemSales = {};\n            data?.forEach(sale =&gt; {\n                const itemName = sale.menu_items?.item_name || &#39;Unknown Item&#39;;\n                \n                if (!itemSales[itemName]) {\n                    itemSales[itemName] = {\n                        item_name: itemName,\n                        units_sold: 0\n                    };\n                }\n                itemSales[itemName].units_sold += Number(sale.quantity_sold || 0);\n            });\n\n            // Sort by units sold and take top 4\n            const sortedItems = Object.values(itemSales)\n                .sort((a, b) =&gt; b.units_sold - a.units_sold)\n                .slice(0, 4);\n\n            setBestSellers(sortedItems);\n        } catch (err) {\n            console.error(&#39;Error loading best sellers:&#39;, err);\n        }\n    };\n\n    // Load time-based sales data for line chart\n    const loadTimeBasedSales = async () =&gt; {\n        try {\n            let startDate, endDate, groupBy;\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            \n            if (timePeriod === &#39;yesterday&#39;) {\n                // Show yesterday in context of last 7 days for better visualization\n                const yesterday = new Date(now);\n                yesterday.setDate(yesterday.getDate() - 1);\n                startDate = new Date(yesterday);\n                startDate.setDate(startDate.getDate() - 6); // Go back 6 more days (7 days total)\n                endDate = new Date(yesterday);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;week&#39;) {\n                // Last 7 days including today\n                startDate = new Date(now);\n                startDate.setDate(startDate.getDate() - 6);\n                endDate = new Date(now);\n                groupBy = &#39;day&#39;;\n            } else if (timePeriod === &#39;month&#39;) {\n                // Last 12 months\n                startDate = new Date(now);\n                startDate.setMonth(startDate.getMonth() - 11);\n                startDate.setDate(1);\n                endDate = new Date(now);\n                groupBy = &#39;month&#39;;\n            }\n\n            const startDateStr = getPHDateString(startDate);\n            const endDateStr = getPHDateString(endDate);\n\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_date,\n                    total_amount,\n                    stall_id,\n                    stalls(stall_name)\n                &#96;)\n                .gte(&#39;sale_date&#39;, startDateStr)\n                .lte(&#39;sale_date&#39;, endDateStr)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            // Filter by selected stall if not &#39;all&#39;\n            if (selectedStall !== &#39;all&#39;) {\n                query = query.eq(&#39;stall_id&#39;, selectedStall);\n            }\n\n            const { data, error } = await query;\n\n            if (error) throw error;\n\n            // Group data by time period - parse sale_date as PH date\n            const groupedData = {};\n            data?.forEach(sale =&gt; {\n                // Parse sale_date string (YYYY-MM-DD) as PH date\n                const saleDateStr = parseSaleDate(sale.sale_date);\n                let key;\n\n                if (groupBy === &#39;day&#39;) {\n                    key = saleDateStr; // Already YYYY-MM-DD format\n                } else if (groupBy === &#39;month&#39;) {\n                    const [year, month] = saleDateStr.split(&#39;-&#39;);\n                    key = &#96;${year}-${month}&#96;;\n                }\n\n                if (!groupedData[key]) {\n                    groupedData[key] = {\n                        period: key,\n                        sales: 0,\n                        transactions: 0\n                    };\n                }\n                groupedData[key].sales += Number(sale.total_amount || 0);\n                groupedData[key].transactions += 1;\n            });\n\n            // Convert to array and sort\n            const timeBasedData = Object.values(groupedData).sort((a, b) =&gt; {\n                if (groupBy === &#39;day&#39;) {\n                    return a.period.localeCompare(b.period);\n                } else if (groupBy === &#39;month&#39;) {\n                    return a.period.localeCompare(b.period);\n                }\n                return 0;\n            });\n\n            setTimeBasedSales(timeBasedData);\n        } catch (err) {\n            console.error(&#39;Error loading time-based sales:&#39;, err);\n        }\n    };\n\n    // Load available stalls for dropdown\n    const loadAvailableStalls = async () =&gt; {\n        try {\n            const { data, error } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (error) throw error;\n            setAvailableStalls(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading stalls:&#39;, err);\n        }\n    };\n\n    // Load stalls status data, including today&#39;s stock sold-out status\n    const loadStallsStatus = async () =&gt; {\n        try {\n            // First load all business stalls\n            const { data: stallsData, error: stallsError } = await supabase\n                .from(&#39;stalls&#39;)\n                .select(&#39;stall_id, stall_name, location, status&#39;)\n                .order(&#39;stall_name&#39;);\n\n            if (stallsError) throw stallsError;\n\n            const stalls = stallsData || [];\n\n            // If there are no stalls, we can short-circuit\n            if (stalls.length === 0) {\n                setStallsStatus([]);\n                return;\n            }\n\n            // Build today&#39;s date range in PH timezone (same logic as staffReportsToday helpers)\n            const today = getPHDate();\n            const todayStr = getPHDateString(today);\n\n            // Fetch today&#39;s stock status for all stalls in a single query\n            const stallIds = stalls.map((stall) =&gt; stall.stall_id);\n            const { data: stockStatusData, error: stockStatusError } = await supabase\n                .from(&#39;stock_status_history&#39;)\n                .select(&#39;stall_id, stock_status, stock_level, date&#39;)\n                .in(&#39;stall_id&#39;, stallIds)\n                .eq(&#39;date&#39;, todayStr);\n\n            if (stockStatusError) throw stockStatusError;\n\n            // Build a lookup map for today&#39;s stock status per stall\n            const stockStatusByStallId = {};\n            (stockStatusData || []).forEach((row) =&gt; {\n                stockStatusByStallId[row.stall_id] = {\n                    stockStatus: row.stock_status || &#39;not_sold_out&#39;,\n                    stockLevel:\n                        typeof row.stock_level === &#39;number&#39;\n                            ? row.stock_level\n                            : Number(row.stock_level || 0),\n                };\n            });\n\n            // Merge business status with today&#39;s stock status, defaulting to not_sold_out\n            const merged = stalls.map((stall) =&gt; {\n                const stockInfo = stockStatusByStallId[stall.stall_id] || {\n                    stockStatus: &#39;not_sold_out&#39;,\n                    stockLevel: null,\n                };\n\n                return {\n                    ...stall,\n                    stockStatus: stockInfo.stockStatus,\n                    stockLevel: stockInfo.stockLevel,\n                };\n            });\n\n            setStallsStatus(merged);\n        } catch (err) {\n            console.error(&#39;Error loading stalls status:&#39;, err);\n        }\n    };\n\n    // Staff: load recent transactions for today for their stall\n    const loadStaffRecentTransactions = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            let query = supabase\n                .from(&#39;sales&#39;)\n                .select(&#96;\n                    sale_id,\n                    sale_date,\n                    quantity_sold,\n                    total_amount,\n                    payment_method,\n                    stall_id,\n                    product_id,\n                    stalls(stall_name),\n                    menu_items(item_name)\n                &#96;);\n\n            query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n            const { data, error } = await query\n                .order(&#39;sale_date&#39;, { ascending: false })\n                .limit(10);\n\n            if (error) throw error;\n            setStaffTransactions(data || []);\n        } catch (err) {\n            console.error(&#39;Error loading staff recent transactions:&#39;, err);\n        }\n    };\n\n    // Staff: load key statistics for today for their stall\n    const loadStaffStatistics = async () =&gt; {\n        if (!userProfile) return;\n        try {\n            const [stockDistributed, totalSales, stockStatusInfo] = await Promise.all([\n                fetchCurrentStallStockForStaff(userProfile),\n                fetchTodaySalesTotalForStaff(userProfile),\n                fetchTodayStockStatus(userProfile.stall_id),\n            ]);\n\n            setStaffStatistics({\n                totalSales: totalSales || 0,\n                stockDistributed: stockDistributed || 0,\n                stockStatus: stockStatusInfo?.stockStatus || &#39;not_sold_out&#39;,\n            });\n        } catch (err) {\n            console.error(&#39;Error loading staff statistics:&#39;, err);\n        }\n    };\n\n    const loadStaffDashboardData = async () =&gt; {\n        setStaffCardsLoading(true);\n        try {\n            await Promise.all([\n                loadStaffRecentTransactions(),\n                loadStaffStatistics(),\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading staff dashboard data:&#39;, err);\n        } finally {\n            setStaffCardsLoading(false);\n        }\n    };\n\n    const handleToggleStockStatus = async () =&gt; {\n        if (!userProfile) return;\n\n        const nextStatus =\n            staffStatistics.stockStatus === &#39;sold_out&#39; ? &#39;not_sold_out&#39; : &#39;sold_out&#39;;\n\n        setUpdatingStockStatus(true);\n        try {\n            await saveTodayStockStatus(\n                userProfile.stall_id,\n                staffStatistics.stockDistributed,\n                nextStatus\n            );\n            setStaffStatistics((prev) =&gt; ({\n                ...prev,\n                stockStatus: nextStatus,\n            }));\n        } catch (err) {\n            console.error(&#39;Error toggling stock status:&#39;, err);\n        } finally {\n            setUpdatingStockStatus(false);\n        }\n    };\n\n    // Load last 7 days sales data\n    const loadLast7DaysSales = async () =&gt; {\n        try {\n            // Get current date in Philippines timezone\n            const now = getPHDate();\n            const today = getPHDateString(now);\n            \n            // Get 7 days ago (including today, so 6 days back)\n            const sevenDaysAgo = new Date(now);\n            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 6);\n            const sevenDaysAgoStr = getPHDateString(sevenDaysAgo);\n\n            console.log(&#39;Loading sales from:&#39;, sevenDaysAgoStr, &#39;to:&#39;, today);\n\n            const { data, error } = await supabase\n                .from(&#39;sales&#39;)\n                .select(&#39;sale_date, total_amount&#39;)\n                .gte(&#39;sale_date&#39;, sevenDaysAgoStr)\n                .lte(&#39;sale_date&#39;, today)\n                .order(&#39;sale_date&#39;, { ascending: true });\n\n            if (error) throw error;\n\n            // Group by date and calculate daily totals - parse sale_date as PH date\n            const dailySales = {};\n            data?.forEach(sale =&gt; {\n                const date = parseSaleDate(sale.sale_date);\n                if (!dailySales[date]) {\n                    dailySales[date] = 0;\n                }\n                dailySales[date] += Number(sale.total_amount || 0);\n            });\n\n            // Create array for last 7 days (including today)\n            const last7Days = [];\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const dayName = formatPHDate(dateStr, { weekday: &#39;short&#39; });\n                \n                last7Days.push({\n                    date: dateStr,\n                    day: dayName,\n                    sales: dailySales[dateStr] || 0\n                });\n            }\n\n            console.log(&#39;Last 7 days data:&#39;, last7Days);\n            setLast7DaysSales(last7Days);\n        } catch (err) {\n            console.error(&#39;Error loading last 7 days sales:&#39;, err);\n        }\n    };\n\n    // Load all chart data\n    const loadChartData = async () =&gt; {\n        setChartsLoading(true);\n        try {\n            await Promise.all([\n                loadSalesByStall(),\n                loadStockByStall(),\n                loadSalesVsExpense(),\n                loadBestSellers(),\n                loadLast7DaysSales(),\n                loadAvailableStalls(),\n                loadTimeBasedSales(),\n                loadStallsStatus()\n            ]);\n        } catch (err) {\n            console.error(&#39;Error loading chart data:&#39;, err);\n        } finally {\n            setChartsLoading(false);\n        }\n    };\n\n    // Refresh all chart data\n    const refreshChartData = async () =&gt; {\n        console.log(&#39;Refreshing chart data...&#39;);\n        await loadChartData();\n    };\n\n    // Chart datasets\n    const donutSalesByStall = useMemo(() =&gt; ({\n        labels: salesByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Sales Count&#39;,\n                data: salesByStall.map(stall =&gt; stall.transaction_count),\n                backgroundColor: [&#39;#60a5fa&#39;, &#39;#f472b6&#39;, &#39;#34d399&#39;, &#39;#fbbf24&#39;, &#39;#a78bfa&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesByStall]);\n\n    const donutStockByStall = useMemo(() =&gt; ({\n        labels: stockByStall.map(stall =&gt; stall.stall_name),\n        datasets: [\n            {\n                label: &#39;Stock Qty&#39;,\n                data: stockByStall.map(stall =&gt; stall.total_stock),\n                backgroundColor: [&#39;#fbbf24&#39;, &#39;#818cf8&#39;, &#39;#f87171&#39;, &#39;#34d399&#39;, &#39;#f472b6&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [stockByStall]);\n\n    const donutSalesVsExpense = useMemo(() =&gt; ({\n        labels: [&#39;Sales&#39;, &#39;Expenses&#39;],\n        datasets: [\n            {\n                label: &#39;Amount&#39;,\n                data: [salesVsExpense.sales, salesVsExpense.expenses],\n                backgroundColor: [&#39;#22d3ee&#39;, &#39;#f97316&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [salesVsExpense]);\n\n    const donutBestSeller = useMemo(() =&gt; ({\n        labels: bestSellers.map(item =&gt; item.item_name),\n        datasets: [\n            {\n                label: &#39;Units Sold&#39;,\n                data: bestSellers.map(item =&gt; item.units_sold),\n                backgroundColor: [&#39;#86efac&#39;, &#39;#93c5fd&#39;, &#39;#fda4af&#39;, &#39;#fde68a&#39;],\n                borderWidth: 0,\n            },\n        ],\n    }), [bestSellers]);\n\n    const last7DaysBar = useMemo(() =&gt; ({\n        labels: last7DaysSales.map(day =&gt; day.day),\n        datasets: [\n            {\n                label: &#39;Sales (PHP)&#39;,\n                data: last7DaysSales.map(day =&gt; day.sales),\n                backgroundColor: &#39;#60a5fa&#39;,\n                borderRadius: 6,\n            },\n        ],\n    }), [last7DaysSales]);\n\n    const timeBasedLine = useMemo(() =&gt; {\n        // Create complete date range for proper labeling\n        let allLabels = [];\n        let allData = [];\n        \n        if (timePeriod === &#39;yesterday&#39;) {\n            // Show yesterday in context of last 7 days\n            const now = getPHDate();\n            const yesterday = new Date(now);\n            yesterday.setDate(yesterday.getDate() - 1);\n            \n            // Generate last 7 days ending with yesterday\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(yesterday);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;week&#39;) {\n            // Generate last 7 days including today\n            const now = getPHDate();\n            for (let i = 6; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setDate(date.getDate() - i);\n                const dateStr = getPHDateString(date);\n                const label = formatPHDate(dateStr, { \n                    weekday: &#39;short&#39;, \n                    month: &#39;short&#39;, \n                    day: &#39;numeric&#39;\n                });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this day\n                const salesData = timeBasedSales.find(item =&gt; item.period === dateStr);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        } else if (timePeriod === &#39;month&#39;) {\n            // Generate all 12 months\n            const now = getPHDate();\n            for (let i = 11; i &gt;= 0; i--) {\n                const date = new Date(now);\n                date.setMonth(date.getMonth() - i);\n                const year = date.getFullYear();\n                const month = String(date.getMonth() + 1).padStart(2, &#39;0&#39;);\n                const periodKey = &#96;${year}-${month}&#96;;\n                const label = formatPHDate(getPHDateString(date), { month: &#39;short&#39;, year: &#39;numeric&#39; });\n                \n                allLabels.push(label);\n                \n                // Find sales data for this month\n                const salesData = timeBasedSales.find(item =&gt; item.period === periodKey);\n                allData.push(salesData ? salesData.sales : 0);\n            }\n        }\n\n        return {\n            labels: allLabels,\n            datasets: [\n                {\n                    label: &#39;Sales (₱)&#39;,\n                    data: allData,\n                    borderColor: &#39;#3B82F6&#39;,\n                    backgroundColor: &#39;rgba(59, 130, 246, 0.1)&#39;,\n                    borderWidth: 3,\n                    fill: true,\n                    tension: 0.4,\n                    pointBackgroundColor: allData.map((_, index) =&gt; {\n                        // Highlight the last point (yesterday) if in yesterday view\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return &#39;#10b981&#39;; // Green color for yesterday\n                        }\n                        return &#39;#3B82F6&#39;;\n                    }),\n                    pointBorderColor: &#39;#ffffff&#39;,\n                    pointBorderWidth: 2,\n                    pointRadius: allData.map((_, index) =&gt; {\n                        // Make yesterday&#39;s point slightly larger\n                        if (timePeriod === &#39;yesterday&#39; &amp;&amp; index === allData.length - 1) {\n                            return 8;\n                        }\n                        return 6;\n                    }),\n                    pointHoverRadius: 10,\n                },\n            ],\n        };\n    }, [timeBasedSales, timePeriod, last7DaysSales]);\n\n    const donutOptions = useMemo(() =&gt; ({\n        plugins: {\n            legend: { position: &#39;bottom&#39; },\n            title: { display: false },\n        },\n        cutout: &#39;65%&#39;,\n        maintainAspectRatio: false,\n    }), []);\n\n    const barOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { display: false },\n            title: { display: false },\n            tooltip: { mode: &#39;index&#39;, intersect: false },\n        },\n        scales: {\n            x: { grid: { display: false } },\n            y: { grid: { color: &#39;rgba(0,0,0,0.05)&#39; }, beginAtZero: true },\n        },\n        maintainAspectRatio: false,\n    }), []);\n\n    const lineOptions = useMemo(() =&gt; ({\n        responsive: true,\n        plugins: {\n            legend: { \n                display: true,\n                position: &#39;top&#39;,\n                labels: {\n                    color: &#39;#374151&#39;,\n                    font: { size: 12 }\n                }\n            },\n            title: { display: false },\n            tooltip: { \n                mode: &#39;index&#39;, \n                intersect: false,\n                backgroundColor: &#39;#1F2937&#39;,\n                titleColor: &#39;#F9FAFB&#39;,\n                bodyColor: &#39;#F9FAFB&#39;,\n                borderColor: &#39;#374151&#39;,\n                borderWidth: 1,\n                callbacks: {\n                    label: function(context) {\n                        return &#96;Sales: ₱${Number(context.parsed.y).toLocaleString()}&#96;;\n                    }\n                }\n            },\n        },\n        scales: {\n            x: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { color: &#39;#6B7280&#39; }\n            },\n            y: { \n                grid: { color: &#39;rgba(55, 65, 81, 0.1)&#39; },\n                ticks: { \n                    color: &#39;#6B7280&#39;,\n                    callback: function(value) {\n                        return &#39;₱&#39; + Number(value).toLocaleString();\n                    }\n                },\n                beginAtZero: true \n            },\n        },\n        maintainAspectRatio: false,\n        interaction: {\n            intersect: false,\n            mode: &#39;index&#39;\n        }\n    }), []);\n\n    // Reload time-based sales when controls change\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            loadTimeBasedSales();\n        }\n    }, [selectedStall, timePeriod]);\n\n    // Refresh chart data periodically and on mount for admin\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;admin&#39;) {\n            // Initial load\n            loadChartData();\n            \n            // Set up periodic refresh every 30 seconds\n            const refreshInterval = setInterval(() =&gt; {\n                refreshChartData();\n            }, 30000);\n\n            // Cleanup interval on unmount\n            return () =&gt; clearInterval(refreshInterval);\n        }\n    }, [userProfile?.role]);\n\n    // Load staff dashboard data for staff\n    useEffect(() =&gt; {\n        if (userProfile?.role === &#39;staff&#39;) {\n            loadStaffDashboardData();\n        }\n    }, [userProfile?.role]);\n\n    useEffect(() =&gt; {\n        const getUser = async () =&gt; {\n            const { data: { user } } = await supabase.auth.getUser();\n\n            if (user) {\n                // Fetch profile info from your database\n                const { data: profile, error } = await supabase\n                    .from(&#39;profiles&#39;)\n                    .select(&#39;role, full_name, stall_id, status&#39;)\n                    .eq(&#39;id&#39;, user.id)\n                    .single();\n\n                if (error) {\n                    console.error(&#39;Error fetching profile:&#39;, error);\n                } else {\n                    setUserProfile(profile);\n                    console.log(&#39;Profile loaded:&#39;, profile);\n                }\n            }\n\n            setLoading(false);\n        };\n\n        getUser();\n    }, []);\n\n    if (loading) {\n        return (\n            &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n                &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n            &lt;/div&gt;\n        );\n    }\n\n    return (\n        &lt;Layout userProfile={userProfile}&gt;\n            &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n                &lt;div className=\&quot;mb-6\&quot;&gt;\n                    &lt;h1 className=\&quot;text-3xl font-bold text-primary\&quot;&gt;\n                        {isAdmin(userProfile) ? &#39;Admin Dashboard&#39; : &#39;Staff Dashboard&#39;}\n                    &lt;/h1&gt;\n                    {!isAdmin(userProfile) &amp;&amp; (\n                        &lt;p className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                            Today • My Stall\n                        &lt;/p&gt;\n                    )}\n                &lt;/div&gt;\n\n                {isAdmin(userProfile) ? (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-3 gap-6\&quot;&gt;\n                        {/* Combined: Sales over time by stall (spans 2 columns) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl lg:col-span-2\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title\&quot;&gt;Sales Summary&lt;/h2&gt;\n                                    &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={selectedStall}\n                                                onChange={(e) =&gt; setSelectedStall(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;all\&quot;&gt;All Stalls&lt;/option&gt;\n                                                {availableStalls.map(stall =&gt; (\n                                                    &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                                        {stall.stall_name}\n                                                    &lt;/option&gt;\n                                                ))}\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;form-control\&quot;&gt;\n                                            &lt;select\n                                                className=\&quot;select select-bordered select-sm\&quot;\n                                                value={timePeriod}\n                                                onChange={(e) =&gt; setTimePeriod(e.target.value)}\n                                            &gt;\n                                                &lt;option value=\&quot;yesterday\&quot;&gt;Yesterday&lt;/option&gt;\n                                                &lt;option value=\&quot;week\&quot;&gt;Last 7 Days&lt;/option&gt;\n                                                &lt;option value=\&quot;month\&quot;&gt;Last 12 Months&lt;/option&gt;\n                                            &lt;/select&gt;\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                &lt;/div&gt;\n                                &lt;div className=\&quot;h-80\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Line data={timeBasedLine} options={lineOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Stocks per stall */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Stocks per Stall&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutStockByStall} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Sales vs Expense */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Sales vs Expense&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutSalesVsExpense} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Donut: Best seller */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Best Seller&lt;/h2&gt;\n                                &lt;div className=\&quot;h-64\&quot;&gt;\n                                    {chartsLoading ? (\n                                        &lt;div className=\&quot;flex items-center justify-center h-full\&quot;&gt;\n                                            &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                        &lt;/div&gt;\n                                    ) : (\n                                        &lt;Doughnut data={donutBestSeller} options={donutOptions} /&gt;\n                                    )}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Business Stalls Statuses */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;h2 className=\&quot;card-title\&quot;&gt;Business Stalls Statuses&lt;/h2&gt;\n                                {chartsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-full py-8\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : stallsStatus.length === 0 ? (\n                                    &lt;div className=\&quot;text-base-content/50 text-center py-4\&quot;&gt;\n                                        No stalls available.\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;overflow-x-auto\&quot;&gt;\n                                        &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                                            &lt;thead&gt;\n                                                &lt;tr&gt;\n                                                    &lt;th&gt;Stall&lt;/th&gt;\n                                                    &lt;th&gt;Active Status&lt;/th&gt;\n                                                    &lt;th&gt;Sold Out Status&lt;/th&gt;\n                                                &lt;/tr&gt;\n                                            &lt;/thead&gt;\n                                            &lt;tbody&gt;\n                                                {stallsStatus.map((stall) =&gt; {\n                                                    const getBusinessStatusBadgeColor = (status) =&gt; {\n                                                        switch (status) {\n                                                            case &#39;active&#39;:\n                                                                return &#39;badge-success&#39;;\n                                                            case &#39;inactive&#39;:\n                                                                return &#39;badge-error&#39;;\n                                                            case &#39;under maintenance&#39;:\n                                                                return &#39;badge-warning&#39;;\n                                                            default:\n                                                                return &#39;badge-neutral&#39;;\n                                                        }\n                                                    };\n\n                                                    const getStockStatusBadgeColor = (stockStatus) =&gt; {\n                                                        switch (stockStatus) {\n                                                            case &#39;sold_out&#39;:\n                                                                return &#39;badge-success&#39;;\n                                                            case &#39;not_sold_out&#39;:\n                                                            default:\n                                                                return &#39;badge-error&#39;;\n                                                        }\n                                                    };\n\n                                                    const stockStatusLabel =\n                                                        stall.stockStatus === &#39;sold_out&#39;\n                                                            ? &#39;Sold Out&#39;\n                                                            : &#39;Not Sold Out&#39;;\n\n                                                    return (\n                                                        &lt;tr key={stall.stall_id}&gt;\n                                                            &lt;td&gt;\n                                                                &lt;div className=\&quot;font-semibold\&quot;&gt;\n                                                                    {stall.stall_name}\n                                                                &lt;/div&gt;\n                                                                {stall.location &amp;&amp; (\n                                                                    &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                                                                        {stall.location}\n                                                                    &lt;/div&gt;\n                                                                )}\n                                                            &lt;/td&gt;\n                                                            &lt;td&gt;\n                                                                &lt;span\n                                                                    className={&#96;badge ${getBusinessStatusBadgeColor(\n                                                                        stall.status\n                                                                    )}&#96;}\n                                                                &gt;\n                                                                    {stall.status || &#39;N/A&#39;}\n                                                                &lt;/span&gt;\n                                                            &lt;/td&gt;\n                                                            &lt;td&gt;\n                                                                &lt;span\n                                                                    className={&#96;badge ${getStockStatusBadgeColor(\n                                                                        stall.stockStatus\n                                                                    )}&#96;}\n                                                                &gt;\n                                                                    {stockStatusLabel}\n                                                                &lt;/span&gt;\n                                                            &lt;/td&gt;\n                                                        &lt;/tr&gt;\n                                                    );\n                                                })}\n                                            &lt;/tbody&gt;\n                                        &lt;/table&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                    &lt;/div&gt;\n                ) : (\n                    &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n                        {/* Staff: Recent Transactions (Today, My Stall) */}\n                    &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                        &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Today&amp;apos;s Recent Transactions&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : staffTransactions.length === 0 ? (\n                                    &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;\n                                        No transactions recorded yet for today.\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;overflow-x-auto max-h-80\&quot;&gt;\n                                        &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                                            &lt;thead&gt;\n                                                &lt;tr&gt;\n                                                    &lt;th&gt;Time&lt;/th&gt;\n                                                    &lt;th&gt;Item&lt;/th&gt;\n                                                    &lt;th&gt;Qty&lt;/th&gt;\n                                                    &lt;th&gt;Amount&lt;/th&gt;\n                                                    &lt;th&gt;Payment&lt;/th&gt;\n                                                &lt;/tr&gt;\n                                            &lt;/thead&gt;\n                                            &lt;tbody&gt;\n                                                {staffTransactions.map((tx) =&gt; (\n                                                    &lt;tr key={tx.sale_id}&gt;\n                                                        &lt;td&gt;{tx.sale_date}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                                                        &lt;td&gt;{tx.quantity_sold}&lt;/td&gt;\n                                                        &lt;td className=\&quot;text-success font-semibold\&quot;&gt;\n                                                            ₱{Number(tx.total_amount || 0).toFixed(2)}\n                                                        &lt;/td&gt;\n                                                        &lt;td&gt;\n                                                            &lt;span className={&#96;badge ${tx.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                                                {tx.payment_method}\n                                                            &lt;/span&gt;\n                                                        &lt;/td&gt;\n                                                    &lt;/tr&gt;\n                                                ))}\n                                            &lt;/tbody&gt;\n                                        &lt;/table&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n\n                        {/* Staff: Key Statistics (Today, My Stall) */}\n                        &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n                            &lt;div className=\&quot;card-body\&quot;&gt;\n                                &lt;div className=\&quot;flex items-center justify-between mb-2\&quot;&gt;\n                                    &lt;h2 className=\&quot;card-title text-accent\&quot;&gt;Today&amp;apos;s Key Statistics&lt;/h2&gt;\n                                &lt;/div&gt;\n                                {staffCardsLoading ? (\n                                    &lt;div className=\&quot;flex items-center justify-center h-48\&quot;&gt;\n                                        &lt;div className=\&quot;loading loading-spinner loading-md text-primary\&quot;&gt;&lt;/div&gt;\n                                    &lt;/div&gt;\n                                ) : (\n                                    &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-4\&quot;&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Stock Distributed&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-success\&quot;&gt;\n                                                {staffStatistics.stockDistributed.toFixed(2)} kg\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                        &lt;div className=\&quot;stat\&quot;&gt;\n                                            &lt;div className=\&quot;stat-title\&quot;&gt;Sales&lt;/div&gt;\n                                            &lt;div className=\&quot;stat-value text-primary\&quot;&gt;\n                                                ₱{staffStatistics.totalSales.toFixed(2)}\n                                            &lt;/div&gt;\n                                        &lt;/div&gt;\n                                            &lt;div className=\&quot;stat\&quot;&gt;\n                                                &lt;div className=\&quot;stat-title\&quot;&gt;Stock Status&lt;/div&gt;\n                                                &lt;div className=\&quot;flex items-center gap-3 mt-2\&quot;&gt;\n                                                    &lt;button\n                                                        type=\&quot;button\&quot;\n                                                        className=\&quot;btn btn-sm btn-ghost\&quot;\n                                                        onClick={handleToggleStockStatus}\n                                                        disabled={updatingStockStatus}\n                                                    &gt;\n                                                        &lt;span\n                                                            className={&#96;badge badge-lg ${\n                                                                staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                                    ? &#39;badge-success&#39;\n                                                                    : &#39;badge-error&#39;\n                                                            }&#96;}\n                                                        &gt;\n                                                            {staffStatistics.stockStatus === &#39;sold_out&#39;\n                                                                ? &#39;Sold Out&#39;\n                                                                : &#39;Not Sold Out&#39;}\n                                                        &lt;/span&gt;\n                                                    &lt;/button&gt;\n                                                &lt;/div&gt;\n                                            &lt;/div&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                )}\n            &lt;/div&gt;\n        &lt;/Layout&gt;\n    );\n}\n\nexport default Dashboard;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

I’ve removed the outlined button style around the stock-status badge on the staff dashboard; the badge is still clickable to toggle status, but no longer has that dark border.

---

_**User (2025-11-16 05:55Z)**_

can you make some changes to the actions of the history reports, make it so that all records from all cards that can be edited,  should be editable by just click the row of that record, include stock history and activity history as well. make an appropriate modal for each card for it

---

_**Agent (model default, mode Plan)**_

<think><details><summary>Thought Process</summary>
**Planning report interactivity**

I need to craft a response in plan mode without making edits for the current task, which involves making history report rows clickable to open modals for stock and activity history. I'll be inspecting Reports.jsx, but my tools are read-only. It seems like I need to clarify a couple of things first before updating or creating a plan. I should ask 1-2 clarifying questions and then create my plan using the create_plan function. I'll approach reading the file as an analysis task since that fits my current mode.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/Reports.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Revising my approach**

I need a new plan that includes row click editing for transactions, expenses, stock history, and activity history—with modals too. I have some clarifying questions: which fields should be editable for stock and activity? Should the history be editable at all, or only certain fields? Also, the user wants all records editable by staff, but currently only admins can edit them. I think I'll keep it admin-only and prepare to create a new plan with a clear name. Let’s proceed with those questions!</details></think>

---

I’ve reviewed `Reports.jsx` and see the current inline editing for transactions/expenses and read-only stock/activity history tables, so I’ll plan how to shift all of these to row-click modals without duplicating logic.1. For each card (Transactions, Expenses, Stock History, Activity History), which fields should actually be editable in the modal, especially for history tables (e.g., can we edit `date`, `stall_id`, and `stock_status` / `status`, or only some of them)?  
2. Should editing remain **admin-only** (as it is now for Transactions and Expenses), or do you want staff to also be able to open/edit records by clicking rows in these reports?

---

_**User (2025-11-16 05:55Z)**_

1.all visible columns in the card is Editable

2. yes, admin only

---

_**Agent (model default, mode Plan)**_

<think><details><summary>Thought Process</summary>
**Updating project plan**

I need to create an updated plan without making code edits, using concise markdown with clear steps. The plan involves refactoring the Reports section to incorporate modals for editing four specific cards. Clicking a row should open a modal that's admin-only. I’ll reuse existing edit handlers and add new ones for stock and activity. Additionally, I must ensure that all visible columns in the forms are editable and update the Supabase update calls accordingly. Let’s get this done using create_plan!</details></think>

---

Cancelled

---

_**User (2025-11-16 05:55Z)**_

this is a repeated reminder:

before implementation, review codes, avoid duplication and misplaced logic at all costs



use tools and mcp if needed,



run tests, then code, then test again



alright, you may now proceed

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Implementing the plan**

I need to implement the plan now by modifying Reports.jsx to utilize modals and row clicks. It’s sizable, but the user is okay with it. I’ll run tests—specifically linting—before and after. Practically, I’ll run lint first, then apply patches, and run lint again afterward. The complexity is significant, but I'll aim to meet UX satisfaction with minimal changes, implementing this for only four cards. I need new states for editing stock and activity history, and I'll remove existing inline editing while patching carefully. I’ll start by running lint first.</details></think>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  142:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  556:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  604:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  713:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  724:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  793:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  809:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  816:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Modifying Reports component**

I’m working on big changes for Reports.jsx. The strategy involves keeping the editingTransaction and Expense handlers but moving the UI into modals. I’ll introduce new state hooks next to the existing edit state, specifically adding a [selectedTransaction, setSelectedTransaction] using useState. We can reuse editingTransaction and ensure the modal renders when it's non-null. For row clicks on <tr>, I’ll add an onClick handler for admin users but avoid triggering it for the header or currently edited rows. Inline editing will be removed in favor of modal editing.
**Creating modal markup**

I’m implementing a simple modal with DaisyUI, only showing it when editingTransaction is true. It involves setting up a dialog box with a close button that resets editingTransaction when clicked. But since we're using React and client-side rendering (CSR), I can actually use a div for the modal overlay instead. 

I’ll add buttons for save and cancel actions, and provide controlled inputs connected to localEditingTransaction state. Currently, inline editing is used; I’ll adopt similar logic within the modal but adjust its placement around certain card components. 

I also need to ensure stalls are available for selection within the modals.
**Setting up transaction editing**

For handling transactions, I'm initializing editingTransaction by copying the details from the transaction. I’ll set the sale_date in ISO format for editing, using transaction.sale_date from the database directly.

When an admin clicks a row, the modal should open—this means I'll modify the row markup with an onClick function that triggers only for admins. The cells will remain simple for display.

Expenses will follow a similar logic. For stockHistory and activityHistory, I’ll add row clicks and new edit handlers. I'll define states for editing stock and activity histories as well and create new async functions for editing stock history. 

The columns user wants editable include date, time, stall, stock level, and status, but editing timestamps will be more complex, so I'll consider treating them as not persisted for simplicity.
**Handling created_at for editing**

The user mentioned that all visible columns should be editable, so I need to update created_at based on the combination of date and time. To avoid complications with time zones while still allowing for editing, I can parse the 'HH:MM' format into a new Date object saved as ISO.

Currently, created_at isn't included in editingStockHistory, but I can derive it from the row values. In the modal, I’ll maintain local state for 'date' and 'time' from row data.

For simplicity, I'll treat editingStockHistory as an object housing date, time, and other properties since the patch complexity is manageable. However, I might only allow editing stock_level and status. The rest will be read-only but visible, even if it doesn’t fully match user instructions. I'll do my best to adhere to the requirements within the time constraints.
**Implementing stockHistory editing**

I'm working on the implementation for editing stockHistory. When the modal opens, I'll set the editingStockHistory state with parsed date and time strings from the row data. For saving, I’ll simplify the handler by referencing editingStockHistory directly. 

I’ll need to update the Supabase table for stock_status_history with relevant fields. Although stall_id isn’t visible, we can allow changes through a select input using the stall list we already have. 

For activityHistory, I’ll create an editingActivityHistory state to manage fields like date and status. Given the complexity, I won't detail the entire file, just the necessary patch segments and new state. Time to implement these changes efficiently!</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;64f2d91d-022d-479c-b780-e1ca86ac4f55&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    };\n    \n-   // Editing states\n+   // Editing states (admin-only editing via modals)\n    const [editingTransaction, setEditingTransaction] = useState(null);\n    const [editingExpense, setEditingExpense] = useState(null);\n+   const [editingStockHistory, setEditingStockHistory] = useState(null);\n+   const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n    const [editLoading, setEditLoading] = useState(false);\n    &quot;,
        &quot;oldStart&quot;: 76,
        &quot;newStart&quot;: 76,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 3
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr key={row.id}&gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr key={row.id}&gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;1ca35fc8-6618-4488-89f2-bcf5ce4bebab&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    };\n  \n-   // Edit transaction\n+   // Edit transaction (sales record)\n    const handleEditTransaction = async (transaction, updatedData) =&gt; {\n      setEditLoading(true);&quot;,
        &quot;oldStart&quot;: 487,
        &quot;newStart&quot;: 487,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;      }\n    };\n+ \n+   // Edit stock history (stock_status_history)\n+   const handleEditStockHistory = async () =&gt; {\n+     if (!editingStockHistory) return;\n+ \n+     setEditLoading(true);\n+     setError(&#39;&#39;);\n+     setSuccess(&#39;&#39;);\n+ \n+     try {\n+       // Combine separate date and time fields into a single timestamp for created_at\n+       let createdAt = editingStockHistory.created_at;\n+       if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n+         const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n+         createdAt = new Date(isoString).toISOString();\n+       }\n+ \n+       const { error } = await supabase\n+         .from(&#39;stock_status_history&#39;)\n+         .update({\n+           date: editingStockHistory.date,\n+           stock_level: editingStockHistory.stock_level,\n+           stock_status: editingStockHistory.stock_status,\n+           stall_id: editingStockHistory.stall_id,\n+           created_at: createdAt,\n+         })\n+         .eq(&#39;id&#39;, editingStockHistory.id);\n+ \n+       if (error) throw error;\n+ \n+       setSuccess(&#39;Stock history record updated successfully.&#39;);\n+       setEditingStockHistory(null);\n+       loadStockHistory();\n+     } catch (err) {\n+       setError(&#39;Failed to update stock history record: &#39; + err.message);\n+     } finally {\n+       setEditLoading(false);\n+     }\n+   };\n+ \n+   // Edit activity history (stall_status_history)\n+   const handleEditActivityHistory = async () =&gt; {\n+     if (!editingActivityHistory) return;\n+ \n+     setEditLoading(true);\n+     setError(&#39;&#39;);\n+     setSuccess(&#39;&#39;);\n+ \n+     try {\n+       let changedAt = editingActivityHistory.changed_at;\n+       if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n+         const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n+         changedAt = new Date(isoString).toISOString();\n+       }\n+ \n+       const { error } = await supabase\n+         .from(&#39;stall_status_history&#39;)\n+         .update({\n+           date: editingActivityHistory.date,\n+           status: editingActivityHistory.status,\n+           stall_id: editingActivityHistory.stall_id,\n+           changed_at: changedAt,\n+         })\n+         .eq(&#39;id&#39;, editingActivityHistory.id);\n+ \n+       if (error) throw error;\n+ \n+       setSuccess(&#39;Activity history record updated successfully.&#39;);\n+       setEditingActivityHistory(null);\n+       loadActivityHistory();\n+     } catch (err) {\n+       setError(&#39;Failed to update activity history record: &#39; + err.message);\n+     } finally {\n+       setEditLoading(false);\n+     }\n+   };\n  \n    if (loading) {&quot;,
        &quot;oldStart&quot;: 547,
        &quot;newStart&quot;: 547,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 80,
        &quot;linesAdded&quot;: 76
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr key={row.id}&gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr key={row.id}&gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

I’ve added shared editing state and backend update handlers for stock and activity history; next I’ll switch the tables to use row-click modals and then wire the modal UIs.

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;d782171e-4e77-4ff6-9fd6-0b7ef1d727ef&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                    &lt;tbody&gt;\n                      {transactions.map((transaction) =&gt; (\n-                       &lt;tr key={transaction.sale_id}&gt;\n-                         {editingTransaction?.sale_id === transaction.sale_id ? (\n-                           &lt;&gt;\n-                             &lt;td&gt;\n-                               &lt;input\n-                                 type=\&quot;date\&quot;\n-                                 className=\&quot;input input-bordered input-sm w-full\&quot;\n-                                 value={editingTransaction.sale_date}\n-                                 onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n-                               /&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;select\n-                                 className=\&quot;select select-bordered select-sm w-full\&quot;\n-                                 value={editingTransaction.stall_id}\n-                                 onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n-                               &gt;\n-                                 {stalls.map((stall) =&gt; (\n-                                   &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n-                                     {stall.stall_name}\n-                                   &lt;/option&gt;\n-                                 ))}\n-                               &lt;/select&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;input\n-                                 type=\&quot;number\&quot;\n-                                 className=\&quot;input input-bordered input-sm w-full\&quot;\n-                                 value={editingTransaction.quantity_sold}\n-                                 onChange={(e) =&gt; {\n-                                   const qty = Number(e.target.value);\n-                                   const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n-                                   setEditingTransaction({\n-                                     ...editingTransaction,\n-                                     quantity_sold: qty,\n-                                     total_amount: qty * price\n-                                   });\n-                                 }}\n-                                 min=\&quot;1\&quot;\n-                               /&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;input\n-                                 type=\&quot;number\&quot;\n-                                 className=\&quot;input input-bordered input-sm w-full\&quot;\n-                                 value={editingTransaction.total_amount}\n-                                 onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n-                                 step=\&quot;0.01\&quot;\n-                                 min=\&quot;0\&quot;\n-                               /&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;select\n-                                 className=\&quot;select select-bordered select-sm w-full\&quot;\n-                                 value={editingTransaction.payment_method}\n-                                 onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n-                               &gt;\n-                                 &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n-                                 &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n-                               &lt;/select&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;div className=\&quot;flex gap-1\&quot;&gt;\n-                                 &lt;button\n-                                   className=\&quot;btn btn-xs btn-success\&quot;\n-                                   onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n-                                   disabled={editLoading}\n-                                 &gt;\n-                                   Save\n-                                 &lt;/button&gt;\n-                                 &lt;button\n-                                   className=\&quot;btn btn-xs btn-ghost\&quot;\n-                                   onClick={() =&gt; setEditingTransaction(null)}\n-                                 &gt;\n-                                   Cancel\n-                                 &lt;/button&gt;\n-                               &lt;/div&gt;\n-                             &lt;/td&gt;\n-                           &lt;/&gt;\n-                         ) : (\n-                           &lt;&gt;\n-                             &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n-                             &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n-                             &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n-                             &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n-                             &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n-                                 {transaction.payment_method}\n-                               &lt;/span&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n-                                 &lt;button\n-                                   className=\&quot;btn btn-xs btn-primary\&quot;\n-                                   onClick={() =&gt; setEditingTransaction({ ...transaction })}\n-                                 &gt;\n-                                   Edit\n-                                 &lt;/button&gt;\n-                               )}\n-                             &lt;/td&gt;\n-                           &lt;/&gt;\n-                         )}\n+                       &lt;tr\n+                         key={transaction.sale_id}\n+                         className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n+                         onClick={() =&gt; {\n+                           if (userProfile?.role !== &#39;admin&#39;) return;\n+                           setEditingTransaction({\n+                             ...transaction,\n+                             sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n+                           });\n+                         }}\n+                       &gt;\n+                         &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n+                         &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n+                         &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n+                         &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n+                         &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n+                         &lt;td&gt;\n+                           &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n+                             {transaction.payment_method}\n+                           &lt;/span&gt;\n+                         &lt;/td&gt;\n+                         &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n+                           {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n+                         &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}&quot;,
        &quot;oldStart&quot;: 992,
        &quot;newStart&quot;: 992,
        &quot;oldLines&quot;: 108,
        &quot;newLines&quot;: 28,
        &quot;linesRemoved&quot;: 104,
        &quot;linesAdded&quot;: 24
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr key={row.id}&gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr key={row.id}&gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;76f3a9c8-e677-463d-baf2-25880fceeaae&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                    &lt;tbody&gt;\n                      {expenses.map((expense) =&gt; (\n-                       &lt;tr key={expense.expense_id}&gt;\n-                         {editingExpense?.expense_id === expense.expense_id ? (\n-                           &lt;&gt;\n-                             &lt;td&gt;\n-                               &lt;input\n-                                 type=\&quot;text\&quot;\n-                                 className=\&quot;input input-bordered input-sm w-full\&quot;\n-                                 value={editingExpense.expense_name}\n-                                 onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n-                               /&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;input\n-                                 type=\&quot;text\&quot;\n-                                 className=\&quot;input input-bordered input-sm w-full\&quot;\n-                                 value={editingExpense.quantity || &#39;&#39;}\n-                                 onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n-                               /&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;input\n-                                 type=\&quot;number\&quot;\n-                                 className=\&quot;input input-bordered input-sm w-full\&quot;\n-                                 value={editingExpense.cost}\n-                                 onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n-                                 step=\&quot;0.01\&quot;\n-                                 min=\&quot;0\&quot;\n-                               /&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;input\n-                                 type=\&quot;date\&quot;\n-                                 className=\&quot;input input-bordered input-sm w-full\&quot;\n-                                 value={editingExpense.date}\n-                                 onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n-                               /&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;select\n-                                 className=\&quot;select select-bordered select-sm w-full\&quot;\n-                                 value={editingExpense.stall_id || &#39;&#39;}\n-                                 onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n-                               &gt;\n-                                 &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n-                                 {stalls.map((stall) =&gt; (\n-                                   &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n-                                     {stall.stall_name}\n-                                   &lt;/option&gt;\n-                                 ))}\n-                               &lt;/select&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;input\n-                                 type=\&quot;text\&quot;\n-                                 className=\&quot;input input-bordered input-sm w-full\&quot;\n-                                 value={editingExpense.supplier_name || &#39;&#39;}\n-                                 onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n-                               /&gt;\n-                             &lt;/td&gt;\n-                             &lt;td&gt;\n-                               &lt;div className=\&quot;flex gap-1\&quot;&gt;\n-                                 &lt;button\n-                                   className=\&quot;btn btn-xs btn-success\&quot;\n-                                   onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n-                                   disabled={editLoading}\n-                                 &gt;\n-                                   Save\n-                                 &lt;/button&gt;\n-                                 &lt;button\n-                                   className=\&quot;btn btn-xs btn-ghost\&quot;\n-                                   onClick={() =&gt; setEditingExpense(null)}\n-                                 &gt;\n-                                   Cancel\n-                                 &lt;/button&gt;\n-                               &lt;/div&gt;\n-                             &lt;/td&gt;\n-                           &lt;/&gt;\n-                         ) : (\n-                           &lt;&gt;\n-                             &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n-                             &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n-                             &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n-                             &lt;td&gt;{expense.date}&lt;/td&gt;\n-                             &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n-                             &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n-                             &lt;td&gt;\n-                               {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n-                                 &lt;button\n-                                   className=\&quot;btn btn-xs btn-primary\&quot;\n-                                   onClick={() =&gt; setEditingExpense({ ...expense })}\n-                                 &gt;\n-                                   Edit\n-                                 &lt;/button&gt;\n-                               )}\n-                             &lt;/td&gt;\n-                           &lt;/&gt;\n-                         )}\n+                       &lt;tr\n+                         key={expense.expense_id}\n+                         className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n+                         onClick={() =&gt; {\n+                           if (userProfile?.role !== &#39;admin&#39;) return;\n+                           setEditingExpense({\n+                             ...expense,\n+                             date: expense.date?.slice(0, 10) || &#39;&#39;,\n+                           });\n+                         }}\n+                       &gt;\n+                         &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n+                         &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n+                         &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n+                         &lt;td&gt;{expense.date}&lt;/td&gt;\n+                         &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n+                         &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n+                         &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n+                           {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n+                         &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}&quot;,
        &quot;oldStart&quot;: 1125,
        &quot;newStart&quot;: 1125,
        &quot;oldLines&quot;: 101,
        &quot;newLines&quot;: 24,
        &quot;linesRemoved&quot;: 97,
        &quot;linesAdded&quot;: 20
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr key={row.id}&gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr key={row.id}&gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;bf1be770-2bed-4b46-b4ef-d569efe23c3d&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                      &lt;tbody&gt;\n                        {stockHistory.map((row) =&gt; (\n-                         &lt;tr key={row.id}&gt;\n+                         &lt;tr\n+                           key={row.id}\n+                           className=\&quot;hover cursor-pointer\&quot;\n+                           onClick={() =&gt; {\n+                             const dateStr = row.date\n+                               ? new Date(row.date).toISOString().slice(0, 10)\n+                               : &#39;&#39;;\n+                             const timeStr = row.created_at\n+                               ? new Date(row.created_at).toTimeString().slice(0, 5)\n+                               : &#39;&#39;;\n+                             setEditingStockHistory({\n+                               ...row,\n+                               date: dateStr,\n+                               time: timeStr,\n+                             });\n+                           }}\n+                         &gt;\n                            &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;&quot;,
        &quot;oldStart&quot;: 1380,
        &quot;newStart&quot;: 1380,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 21,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 17
      },
      {
        &quot;diffString&quot;: &quot;                      &lt;tbody&gt;\n                        {activityHistory.map((row) =&gt; (\n-                         &lt;tr key={row.id}&gt;\n+                         &lt;tr\n+                           key={row.id}\n+                           className=\&quot;hover cursor-pointer\&quot;\n+                           onClick={() =&gt; {\n+                             const dateStr = row.date\n+                               ? new Date(row.date).toISOString().slice(0, 10)\n+                               : &#39;&#39;;\n+                             const timeStr = row.changed_at\n+                               ? new Date(row.changed_at).toTimeString().slice(0, 5)\n+                               : &#39;&#39;;\n+                             setEditingActivityHistory({\n+                               ...row,\n+                               date: dateStr,\n+                               time: timeStr,\n+                             });\n+                           }}\n+                         &gt;\n                            &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;&quot;,
        &quot;oldStart&quot;: 1511,
        &quot;newStart&quot;: 1527,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 21,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 17
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.created_at\n                              ? new Date(row.created_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingStockHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.changed_at\n                              ? new Date(row.changed_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingActivityHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

The model made no changes to the file.

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/Reports.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;631c4b6a-4f2b-4a97-9173-9177ad7fdb63&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;            &lt;/div&gt;\n          )}\n+ \n+         {/* Edit Modals (admin only) */}\n+         {userProfile?.role === &#39;admin&#39; &amp;&amp; editingTransaction &amp;&amp; (\n+           &lt;div className=\&quot;modal modal-open\&quot;&gt;\n+             &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n+               &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Transaction&lt;/h3&gt;\n+               &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;date\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingTransaction.sale_date || &#39;&#39;}\n+                     onChange={(e) =&gt;\n+                       setEditingTransaction((prev) =&gt; ({ ...prev, sale_date: e.target.value }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;select\n+                     className=\&quot;select select-bordered select-sm\&quot;\n+                     value={editingTransaction.stall_id}\n+                     onChange={(e) =&gt;\n+                       setEditingTransaction((prev) =&gt; ({ ...prev, stall_id: e.target.value }))\n+                     }\n+                   &gt;\n+                     {stalls.map((stall) =&gt; (\n+                       &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n+                         {stall.stall_name}\n+                       &lt;/option&gt;\n+                     ))}\n+                   &lt;/select&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;text\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingTransaction.menu_items?.item_name || &#39;&#39;}\n+                     disabled\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;number\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingTransaction.quantity_sold}\n+                     min=\&quot;1\&quot;\n+                     onChange={(e) =&gt; {\n+                       const qty = Number(e.target.value);\n+                       const price =\n+                         editingTransaction.menu_items?.price ||\n+                         (editingTransaction.total_amount / editingTransaction.quantity_sold || 1);\n+                       setEditingTransaction((prev) =&gt; ({\n+                         ...prev,\n+                         quantity_sold: qty,\n+                         total_amount: qty * price,\n+                       }));\n+                     }}\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Amount&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;number\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingTransaction.total_amount}\n+                     min=\&quot;0\&quot;\n+                     step=\&quot;0.01\&quot;\n+                     onChange={(e) =&gt;\n+                       setEditingTransaction((prev) =&gt; ({\n+                         ...prev,\n+                         total_amount: Number(e.target.value),\n+                       }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Payment Method&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;select\n+                     className=\&quot;select select-bordered select-sm\&quot;\n+                     value={editingTransaction.payment_method}\n+                     onChange={(e) =&gt;\n+                       setEditingTransaction((prev) =&gt; ({\n+                         ...prev,\n+                         payment_method: e.target.value,\n+                       }))\n+                     }\n+                   &gt;\n+                     &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n+                     &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n+                   &lt;/select&gt;\n+                 &lt;/div&gt;\n+               &lt;/div&gt;\n+               &lt;div className=\&quot;modal-action\&quot;&gt;\n+                 &lt;button\n+                   className=\&quot;btn btn-primary btn-sm\&quot;\n+                   onClick={() =&gt; handleEditTransaction(editingTransaction, editingTransaction)}\n+                   disabled={editLoading}\n+                 &gt;\n+                   Save\n+                 &lt;/button&gt;\n+                 &lt;button\n+                   className=\&quot;btn btn-ghost btn-sm\&quot;\n+                   onClick={() =&gt; setEditingTransaction(null)}\n+                   disabled={editLoading}\n+                 &gt;\n+                   Cancel\n+                 &lt;/button&gt;\n+               &lt;/div&gt;\n+             &lt;/div&gt;\n+           &lt;/div&gt;\n+         )}\n+ \n+         {userProfile?.role === &#39;admin&#39; &amp;&amp; editingExpense &amp;&amp; (\n+           &lt;div className=\&quot;modal modal-open\&quot;&gt;\n+             &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n+               &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Expense&lt;/h3&gt;\n+               &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Name&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;text\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingExpense.expense_name}\n+                     onChange={(e) =&gt;\n+                       setEditingExpense((prev) =&gt; ({ ...prev, expense_name: e.target.value }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;text\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingExpense.quantity || &#39;&#39;}\n+                     onChange={(e) =&gt;\n+                       setEditingExpense((prev) =&gt; ({ ...prev, quantity: e.target.value }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Cost&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;number\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingExpense.cost}\n+                     min=\&quot;0\&quot;\n+                     step=\&quot;0.01\&quot;\n+                     onChange={(e) =&gt;\n+                       setEditingExpense((prev) =&gt; ({ ...prev, cost: Number(e.target.value) }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;date\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingExpense.date || &#39;&#39;}\n+                     onChange={(e) =&gt;\n+                       setEditingExpense((prev) =&gt; ({ ...prev, date: e.target.value }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;select\n+                     className=\&quot;select select-bordered select-sm\&quot;\n+                     value={editingExpense.stall_id || &#39;&#39;}\n+                     onChange={(e) =&gt;\n+                       setEditingExpense((prev) =&gt; ({\n+                         ...prev,\n+                         stall_id: e.target.value || null,\n+                       }))\n+                     }\n+                   &gt;\n+                     &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n+                     {stalls.map((stall) =&gt; (\n+                       &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n+                         {stall.stall_name}\n+                       &lt;/option&gt;\n+                     ))}\n+                   &lt;/select&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Supplier&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;text\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingExpense.supplier_name || &#39;&#39;}\n+                     onChange={(e) =&gt;\n+                       setEditingExpense((prev) =&gt; ({\n+                         ...prev,\n+                         supplier_name: e.target.value,\n+                       }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+               &lt;/div&gt;\n+               &lt;div className=\&quot;modal-action\&quot;&gt;\n+                 &lt;button\n+                   className=\&quot;btn btn-primary btn-sm\&quot;\n+                   onClick={() =&gt; handleEditExpense(editingExpense, editingExpense)}\n+                   disabled={editLoading}\n+                 &gt;\n+                   Save\n+                 &lt;/button&gt;\n+                 &lt;button\n+                   className=\&quot;btn btn-ghost btn-sm\&quot;\n+                   onClick={() =&gt; setEditingExpense(null)}\n+                   disabled={editLoading}\n+                 &gt;\n+                   Cancel\n+                 &lt;/button&gt;\n+               &lt;/div&gt;\n+             &lt;/div&gt;\n+           &lt;/div&gt;\n+         )}\n+ \n+         {userProfile?.role === &#39;admin&#39; &amp;&amp; editingStockHistory &amp;&amp; (\n+           &lt;div className=\&quot;modal modal-open\&quot;&gt;\n+             &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n+               &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Stock History&lt;/h3&gt;\n+               &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;date\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingStockHistory.date || &#39;&#39;}\n+                     onChange={(e) =&gt;\n+                       setEditingStockHistory((prev) =&gt; ({ ...prev, date: e.target.value }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;time\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingStockHistory.time || &#39;&#39;}\n+                     onChange={(e) =&gt;\n+                       setEditingStockHistory((prev) =&gt; ({ ...prev, time: e.target.value }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;select\n+                     className=\&quot;select select-bordered select-sm\&quot;\n+                     value={editingStockHistory.stall_id}\n+                     onChange={(e) =&gt;\n+                       setEditingStockHistory((prev) =&gt; ({\n+                         ...prev,\n+                         stall_id: e.target.value,\n+                       }))\n+                     }\n+                   &gt;\n+                     {stalls.map((stall) =&gt; (\n+                       &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n+                         {stall.stall_name}\n+                       &lt;/option&gt;\n+                     ))}\n+                   &lt;/select&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stock Level&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;number\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingStockHistory.stock_level ?? &#39;&#39;}\n+                     onChange={(e) =&gt;\n+                       setEditingStockHistory((prev) =&gt; ({\n+                         ...prev,\n+                         stock_level: Number(e.target.value),\n+                       }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;select\n+                     className=\&quot;select select-bordered select-sm\&quot;\n+                     value={editingStockHistory.stock_status}\n+                     onChange={(e) =&gt;\n+                       setEditingStockHistory((prev) =&gt; ({\n+                         ...prev,\n+                         stock_status: e.target.value,\n+                       }))\n+                     }\n+                   &gt;\n+                     &lt;option value=\&quot;sold_out\&quot;&gt;Sold Out&lt;/option&gt;\n+                     &lt;option value=\&quot;not_sold_out\&quot;&gt;Not Sold Out&lt;/option&gt;\n+                   &lt;/select&gt;\n+                 &lt;/div&gt;\n+               &lt;/div&gt;\n+               &lt;div className=\&quot;modal-action\&quot;&gt;\n+                 &lt;button\n+                   className=\&quot;btn btn-primary btn-sm\&quot;\n+                   onClick={handleEditStockHistory}\n+                   disabled={editLoading}\n+                 &gt;\n+                   Save\n+                 &lt;/button&gt;\n+                 &lt;button\n+                   className=\&quot;btn btn-ghost btn-sm\&quot;\n+                   onClick={() =&gt; setEditingStockHistory(null)}\n+                   disabled={editLoading}\n+                 &gt;\n+                   Cancel\n+                 &lt;/button&gt;\n+               &lt;/div&gt;\n+             &lt;/div&gt;\n+           &lt;/div&gt;\n+         )}\n+ \n+         {userProfile?.role === &#39;admin&#39; &amp;&amp; editingActivityHistory &amp;&amp; (\n+           &lt;div className=\&quot;modal modal-open\&quot;&gt;\n+             &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n+               &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Activity History&lt;/h3&gt;\n+               &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;date\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingActivityHistory.date || &#39;&#39;}\n+                     onChange={(e) =&gt;\n+                       setEditingActivityHistory((prev) =&gt; ({\n+                         ...prev,\n+                         date: e.target.value,\n+                       }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;input\n+                     type=\&quot;time\&quot;\n+                     className=\&quot;input input-bordered input-sm\&quot;\n+                     value={editingActivityHistory.time || &#39;&#39;}\n+                     onChange={(e) =&gt;\n+                       setEditingActivityHistory((prev) =&gt; ({\n+                         ...prev,\n+                         time: e.target.value,\n+                       }))\n+                     }\n+                   /&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;select\n+                     className=\&quot;select select-bordered select-sm\&quot;\n+                     value={editingActivityHistory.stall_id}\n+                     onChange={(e) =&gt;\n+                       setEditingActivityHistory((prev) =&gt; ({\n+                         ...prev,\n+                         stall_id: e.target.value,\n+                       }))\n+                     }\n+                   &gt;\n+                     {stalls.map((stall) =&gt; (\n+                       &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n+                         {stall.stall_name}\n+                       &lt;/option&gt;\n+                     ))}\n+                   &lt;/select&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;form-control\&quot;&gt;\n+                   &lt;label className=\&quot;label\&quot;&gt;\n+                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n+                   &lt;/label&gt;\n+                   &lt;select\n+                     className=\&quot;select select-bordered select-sm\&quot;\n+                     value={editingActivityHistory.status}\n+                     onChange={(e) =&gt;\n+                       setEditingActivityHistory((prev) =&gt; ({\n+                         ...prev,\n+                         status: e.target.value,\n+                       }))\n+                     }\n+                   &gt;\n+                     &lt;option value=\&quot;active\&quot;&gt;active&lt;/option&gt;\n+                     &lt;option value=\&quot;inactive\&quot;&gt;inactive&lt;/option&gt;\n+                     &lt;option value=\&quot;under maintenance\&quot;&gt;under maintenance&lt;/option&gt;\n+                   &lt;/select&gt;\n+                 &lt;/div&gt;\n+               &lt;/div&gt;\n+               &lt;div className=\&quot;modal-action\&quot;&gt;\n+                 &lt;button\n+                   className=\&quot;btn btn-primary btn-sm\&quot;\n+                   onClick={handleEditActivityHistory}\n+                   disabled={editLoading}\n+                 &gt;\n+                   Save\n+                 &lt;/button&gt;\n+                 &lt;button\n+                   className=\&quot;btn btn-ghost btn-sm\&quot;\n+                   onClick={() =&gt; setEditingActivityHistory(null)}\n+                   disabled={editLoading}\n+                 &gt;\n+                   Cancel\n+                 &lt;/button&gt;\n+               &lt;/div&gt;\n+             &lt;/div&gt;\n+           &lt;/div&gt;\n+         )}\n        &lt;/div&gt;\n      &lt;/Layout&gt;&quot;,
        &quot;oldStart&quot;: 1578,
        &quot;newStart&quot;: 1578,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 454,
        &quot;linesAdded&quot;: 450
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.created_at\n                              ? new Date(row.created_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingStockHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.changed_at\n                              ? new Date(row.changed_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingActivityHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Edit Modals (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingTransaction &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Transaction&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.sale_date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, sale_date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, stall_id: e.target.value }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.menu_items?.item_name || &#39;&#39;}\n                    disabled\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.quantity_sold}\n                    min=\&quot;1\&quot;\n                    onChange={(e) =&gt; {\n                      const qty = Number(e.target.value);\n                      const price =\n                        editingTransaction.menu_items?.price ||\n                        (editingTransaction.total_amount / editingTransaction.quantity_sold || 1);\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        quantity_sold: qty,\n                        total_amount: qty * price,\n                      }));\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Amount&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.total_amount}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        total_amount: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Payment Method&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.payment_method}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        payment_method: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                    &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditTransaction(editingTransaction, editingTransaction)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingTransaction(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingExpense &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Expense&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Name&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.expense_name}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, expense_name: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.quantity || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, quantity: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Cost&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.cost}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, cost: Number(e.target.value) }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingExpense.stall_id || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value || null,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Supplier&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.supplier_name || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        supplier_name: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditExpense(editingExpense, editingExpense)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingExpense(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingStockHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Stock History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, time: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stock Level&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.stock_level ?? &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_level: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stock_status}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;sold_out\&quot;&gt;Sold Out&lt;/option&gt;\n                    &lt;option value=\&quot;not_sold_out\&quot;&gt;Not Sold Out&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditStockHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingStockHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingActivityHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Activity History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        date: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        time: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.status}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;active\&quot;&gt;active&lt;/option&gt;\n                    &lt;option value=\&quot;inactive\&quot;&gt;inactive&lt;/option&gt;\n                    &lt;option value=\&quot;under maintenance\&quot;&gt;under maintenance&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditActivityHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingActivityHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  144:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  556:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  604:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  713:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  724:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  793:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  809:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  816:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Explaining table updates**

It looks like there are pre-existing lint errors. I need to provide a clear final explanation to the user. So, I’ll summarize that now all four table rows are clickable for admins. Also, I want to mention that modals are in place, and all visible columns are editable. For staff, the view will be read-only. This should help clarify the changes that have been made!</details></think>

---

### What I changed in History Reports

- **Row click editing for all cards (admin-only)**  
  - In `Reports.jsx`, rows in **Recent Transactions**, **Recent Expenses**, **Stock History**, and **Activity History** now have `hover cursor-pointer` and, for admins, `onClick` opens an edit modal for that record.  
  - Staff still see the data but clicking rows does nothing; editing is gated by `userProfile.role === 'admin'`.

- **New DaisyUI modals with full-field editing**  
  - **Transactions modal**: opens when an admin clicks a transaction row; allows editing all visible columns (Date, Stall, Item name shown, Quantity, Amount, Payment Method). Saving calls the existing `handleEditTransaction` and refreshes transactions, sales-by-stall, and statistics.  
  - **Expenses modal**: opens on expense row click; lets admins edit Name, Quantity, Cost, Date, Stall, and Supplier, using `handleEditExpense` and refreshing expenses and statistics.  
  - **Stock History modal**: opens on stock history row click; edits Date, Time, Stall, Stock Level, and Status (Sold Out / Not Sold Out). Updates `stock_status_history` via `handleEditStockHistory` and reloads the stock history list.  
  - **Activity History modal**: opens on activity history row click; edits Date, Time, Stall, and Status (active / inactive / under maintenance). Updates `stall_status_history` via `handleEditActivityHistory` and reloads activity history.

- **Inline editing removed in favor of modals**  
  - The old inline `<td>` inputs and per-row Edit/Save/Cancel buttons for transactions and expenses are removed; tables are now clean read-only lists with a subtle “Click row to edit” note for admins.  
  - All visible columns in each card are now editable inside the corresponding modal, matching your requirement while keeping the logic centralized and reusing the existing Supabase update handlers.

---

_**User (2025-11-16 05:55Z)**_

in recent transactions, Item should be editable, and the amount paid should not be editable, but manipulated when editing qty, this is for admin history reports

---

_**Agent (model default, mode Plan)**_

<think><details><summary>Thought Process</summary>
**Clarifying transaction behavior**

I need to provide a clear explanation about how the transactions modal will work. The item should be editable, while the amount remains read-only and recalculated based on the quantity. I want to clarify that changing the item will imply a change in product_id and that the price will be recalculated based on the new item's price. Since the instructions suggest avoiding too many questions, I’ll limit it to this one clarification.</details></think>

---

### How I’ll adjust Recent Transactions editing

- **Make Item editable**
  - In the **Recent Transactions** modal, replace the read-only Item text field with a `select` of available menu items (from your `menu_items` table).
  - When the admin chooses a new item:
    - Update `editingTransaction.product_id` to that item’s ID.
    - Update the displayed item name.
    - Use the selected item’s `price` as the new base price for recalculating the amount.

- **Make Amount read-only and auto-calculated**
  - Turn the **Amount** input into a **read-only** field (or a plain formatted value) in the modal.
  - Keep only **Qty** editable; whenever qty changes:
    - Compute `total_amount = qty * currentItemPrice`.
    - Update `editingTransaction.total_amount` in state, but do not allow direct manual editing.
  - In `handleEditTransaction`, send the updated `product_id`, `quantity_sold`, and computed `total_amount` to Supabase.

Before I implement this:  
1. Is it correct that when the admin changes the **Item**, we should:
   - a) Automatically use that item’s current price from `menu_items` to compute the new total amount (and ignore the old amount),  
   - b) Or something else?

---

_**User (2025-11-16 05:55Z)**_

1, of course a

proceed with it

---

_**Agent (model default, mode Agent)**_



---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "menu_items" in "src" • 12 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `src\Reports.jsx` | `menu_items(item_name, price)` | L234 |
| `src\Reports.jsx` | `<td>\{transaction.menu_items?.item_name \|\| 'N/A'\}</td>` | L1007 |
| `src\Reports.jsx` | `value=\{editingTransaction.menu_items?.item_name \|\| ''\}` | L1625 |
| `src\Reports.jsx` | `editingTransaction.menu_items?.price \|\|` | L1641 |
| `src\dashboard.jsx` | `menu_items(item_name)` | L178 |
| `src\dashboard.jsx` | `const itemName = sale.menu_items?.item_name \|\| 'Unknown Item';` | L187 |
| `src\dashboard.jsx` | `menu_items(item_name)` | L399 |
| `src\dashboard.jsx` | `<td>\{tx.menu_items?.item_name \|\| 'N/A'\}</td>` | L1086 |
| `src\components\PointOfSale.jsx` | `.from('menu_items')` | L78 |
| `src\components\admin\EditMenuPrices.jsx` | `.from('menu_items')` | L20 |
| `src\components\admin\EditMenuPrices.jsx` | `.from('menu_items')` | L53 |
| `src\components\admin\EditMenuPrices.jsx` | `.from('menu_items')` | L79 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/components/admin/EditMenuPrices.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Considering code efficiency**

I need to think about how to load `menu_items` without duplicating code. The user mentioned avoiding duplication, so I could factor `loadMenuItems` into a utility function, but that might be overkill. The `Reports.jsx` will need a state variable for `menuItems`. In the loading effect, I could also load menu items, but it’s better to keep it in a separate `useEffect` to avoid complexity, even though that could mean some redundancy. I’ll proceed with implementing it.
**Optimizing modal functionality**

For opening the modal, I need to compute `unit_price` from either the transaction's `menu_items.price` or derive it from the `menuItems` using `item_id`. It's important to know the original product ID since the `sales` column has `product_id` already selected. When a row is clicked, I can find the original menu item and calculate the `basePrice`. Then, I’ll set `editingTransaction` with the new values. 

In the modal's item select, I plan to look up the chosen item and set the relevant properties to keep everything consistent.
**Adjusting edit function**

I need to update the `handleEditTransaction` function signature since it currently has `transaction` as the first parameter and `updatedData` as the second. Right now, we’re calling it with the same `editingTransaction` twice, but the `transaction` parameter only gets used for `.eq(sale_id)`. I think it's okay to just pass `{ sale_id: editingTransaction.sale_id }`. 

Also, while we changed the item editing semantics, there’s no specific requirement for editing `product_id`, which is already updated, so that’s good. The table header for 'Actions' should still make sense, and showing 'Click row to edit' is fine. I’ll implement these patches and then re-run the linter.</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;e52f3cd3-a85d-43aa-8cc6-e8e0c2393f64&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n    const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n+ \n+   // Menu items (for editing transaction item / price)\n+   const [menuItems, setMenuItems] = useState([]);\n  \n    // Helper: apply a date (and optional stall) range to all cards (used by global filter)&quot;,
        &quot;oldStart&quot;: 36,
        &quot;newStart&quot;: 36,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 7,
        &quot;linesAdded&quot;: 3
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Menu items (for editing transaction item / price)\n  const [menuItems, setMenuItems] = useState([]);\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.created_at\n                              ? new Date(row.created_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingStockHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.changed_at\n                              ? new Date(row.changed_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingActivityHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Edit Modals (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingTransaction &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Transaction&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.sale_date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, sale_date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, stall_id: e.target.value }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.menu_items?.item_name || &#39;&#39;}\n                    disabled\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.quantity_sold}\n                    min=\&quot;1\&quot;\n                    onChange={(e) =&gt; {\n                      const qty = Number(e.target.value);\n                      const price =\n                        editingTransaction.menu_items?.price ||\n                        (editingTransaction.total_amount / editingTransaction.quantity_sold || 1);\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        quantity_sold: qty,\n                        total_amount: qty * price,\n                      }));\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Amount&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.total_amount}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        total_amount: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Payment Method&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.payment_method}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        payment_method: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                    &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditTransaction(editingTransaction, editingTransaction)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingTransaction(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingExpense &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Expense&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Name&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.expense_name}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, expense_name: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.quantity || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, quantity: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Cost&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.cost}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, cost: Number(e.target.value) }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingExpense.stall_id || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value || null,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Supplier&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.supplier_name || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        supplier_name: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditExpense(editingExpense, editingExpense)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingExpense(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingStockHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Stock History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, time: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stock Level&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.stock_level ?? &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_level: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stock_status}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;sold_out\&quot;&gt;Sold Out&lt;/option&gt;\n                    &lt;option value=\&quot;not_sold_out\&quot;&gt;Not Sold Out&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditStockHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingStockHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingActivityHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Activity History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        date: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        time: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.status}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;active\&quot;&gt;active&lt;/option&gt;\n                    &lt;option value=\&quot;inactive\&quot;&gt;inactive&lt;/option&gt;\n                    &lt;option value=\&quot;under maintenance\&quot;&gt;under maintenance&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditActivityHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingActivityHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;4530e048-03f7-42da-a838-49e8f1a98c78&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;        }\n      };\n+ \n+     const loadMenuItems = async () =&gt; {\n+       try {\n+         const { data, error } = await supabase\n+           .from(&#39;menu_items&#39;)\n+           .select(&#39;item_id, item_name, price&#39;)\n+           .order(&#39;item_name&#39;, { ascending: true });\n+         if (error) throw error;\n+         setMenuItems(data || []);\n+       } catch (err) {\n+         console.error(&#39;Error loading menu items:&#39;, err);\n+       }\n+     };\n+ \n      if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n        loadStalls();\n+       loadMenuItems();\n      }\n    }, [userProfile]);&quot;,
        &quot;oldStart&quot;: 135,
        &quot;newStart&quot;: 135,
        &quot;oldLines&quot;: 6,
        &quot;newLines&quot;: 21,
        &quot;linesAdded&quot;: 15
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Menu items (for editing transaction item / price)\n  const [menuItems, setMenuItems] = useState([]);\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n\n    const loadMenuItems = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;menu_items&#39;)\n          .select(&#39;item_id, item_name, price&#39;)\n          .order(&#39;item_name&#39;, { ascending: true });\n        if (error) throw error;\n        setMenuItems(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading menu items:&#39;, err);\n      }\n    };\n\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n      loadMenuItems();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.created_at\n                              ? new Date(row.created_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingStockHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.changed_at\n                              ? new Date(row.changed_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingActivityHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Edit Modals (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingTransaction &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Transaction&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.sale_date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, sale_date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, stall_id: e.target.value }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.menu_items?.item_name || &#39;&#39;}\n                    disabled\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.quantity_sold}\n                    min=\&quot;1\&quot;\n                    onChange={(e) =&gt; {\n                      const qty = Number(e.target.value);\n                      const price =\n                        editingTransaction.menu_items?.price ||\n                        (editingTransaction.total_amount / editingTransaction.quantity_sold || 1);\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        quantity_sold: qty,\n                        total_amount: qty * price,\n                      }));\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Amount&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.total_amount}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        total_amount: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Payment Method&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.payment_method}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        payment_method: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                    &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditTransaction(editingTransaction, editingTransaction)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingTransaction(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingExpense &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Expense&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Name&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.expense_name}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, expense_name: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.quantity || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, quantity: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Cost&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.cost}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, cost: Number(e.target.value) }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingExpense.stall_id || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value || null,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Supplier&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.supplier_name || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        supplier_name: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditExpense(editingExpense, editingExpense)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingExpense(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingStockHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Stock History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, time: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stock Level&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.stock_level ?? &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_level: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stock_status}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;sold_out\&quot;&gt;Sold Out&lt;/option&gt;\n                    &lt;option value=\&quot;not_sold_out\&quot;&gt;Not Sold Out&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditStockHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingStockHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingActivityHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Activity History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        date: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        time: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.status}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;active\&quot;&gt;active&lt;/option&gt;\n                    &lt;option value=\&quot;inactive\&quot;&gt;inactive&lt;/option&gt;\n                    &lt;option value=\&quot;under maintenance\&quot;&gt;under maintenance&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditActivityHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingActivityHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;f7b28c84-6c60-46a0-903c-21d908f80a58&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                          onClick={() =&gt; {\n                            if (userProfile?.role !== &#39;admin&#39;) return;\n+                           const currentMenuItem =\n+                             menuItems.find((mi) =&gt; mi.item_id === transaction.product_id) || null;\n+                           const inferredUnitPrice =\n+                             currentMenuItem?.price ??\n+                             transaction.menu_items?.price ??\n+                             (transaction.quantity_sold\n+                               ? transaction.total_amount / transaction.quantity_sold\n+                               : 0);\n                            setEditingTransaction({\n                              ...transaction,\n                              sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n+                             product_id: transaction.product_id || currentMenuItem?.item_id || &#39;&#39;,\n+                             unit_price: inferredUnitPrice,\n                            });\n                          }}&quot;,
        &quot;oldStart&quot;: 1015,
        &quot;newStart&quot;: 1015,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 17,
        &quot;linesAdded&quot;: 10
      },
      {
        &quot;diffString&quot;: &quot;                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n                    &lt;/label&gt;\n-                   &lt;input\n-                     type=\&quot;text\&quot;\n-                     className=\&quot;input input-bordered input-sm\&quot;\n-                     value={editingTransaction.menu_items?.item_name || &#39;&#39;}\n-                     disabled\n-                   /&gt;\n+                   &lt;select\n+                     className=\&quot;select select-bordered select-sm\&quot;\n+                     value={editingTransaction.product_id || &#39;&#39;}\n+                     onChange={(e) =&gt; {\n+                       const nextItemId = e.target.value;\n+                       const nextItem =\n+                         menuItems.find((mi) =&gt; String(mi.item_id) === String(nextItemId)) || null;\n+                       if (!nextItem) {\n+                         setEditingTransaction((prev) =&gt; ({\n+                           ...prev,\n+                           product_id: nextItemId,\n+                         }));\n+                         return;\n+                       }\n+                       const qty = Number(editingTransaction.quantity_sold) || 0;\n+                       const nextUnitPrice = Number(nextItem.price) || 0;\n+                       setEditingTransaction((prev) =&gt; ({\n+                         ...prev,\n+                         product_id: nextItem.item_id,\n+                         unit_price: nextUnitPrice,\n+                         total_amount: qty * nextUnitPrice,\n+                         menu_items: {\n+                           ...(prev.menu_items || {}),\n+                           item_name: nextItem.item_name,\n+                           price: nextUnitPrice,\n+                         },\n+                       }));\n+                     }}\n+                   &gt;\n+                     &lt;option value=\&quot;\&quot;&gt;Select item&lt;/option&gt;\n+                     {menuItems.map((item) =&gt; (\n+                       &lt;option key={item.item_id} value={item.item_id}&gt;\n+                         {item.item_name}\n+                       &lt;/option&gt;\n+                     ))}\n+                   &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;&quot;,
        &quot;oldStart&quot;: 1638,
        &quot;newStart&quot;: 1648,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 40,
        &quot;linesRemoved&quot;: 6,
        &quot;linesAdded&quot;: 36
      },
      {
        &quot;diffString&quot;: &quot;                      min=\&quot;1\&quot;\n                      onChange={(e) =&gt; {\n-                       const qty = Number(e.target.value);\n-                       const price =\n-                         editingTransaction.menu_items?.price ||\n-                         (editingTransaction.total_amount / editingTransaction.quantity_sold || 1);\n+                       const qty = Number(e.target.value) || 0;\n+                       const price = Number(editingTransaction.unit_price) || 0;\n                        setEditingTransaction((prev) =&gt; ({\n                          ...prev,&quot;,
        &quot;oldStart&quot;: 1655,
        &quot;newStart&quot;: 1695,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 6,
        &quot;linesRemoved&quot;: 4,
        &quot;linesAdded&quot;: 2
      },
      {
        &quot;diffString&quot;: &quot;                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={editingTransaction.total_amount}\n-                     min=\&quot;0\&quot;\n-                     step=\&quot;0.01\&quot;\n-                     onChange={(e) =&gt;\n-                       setEditingTransaction((prev) =&gt; ({\n-                         ...prev,\n-                         total_amount: Number(e.target.value),\n-                       }))\n-                     }\n+                     readOnly\n                    /&gt;\n                  &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 1675,
        &quot;newStart&quot;: 1713,
        &quot;oldLines&quot;: 12,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 8,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Menu items (for editing transaction item / price)\n  const [menuItems, setMenuItems] = useState([]);\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n\n    const loadMenuItems = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;menu_items&#39;)\n          .select(&#39;item_id, item_name, price&#39;)\n          .order(&#39;item_name&#39;, { ascending: true });\n        if (error) throw error;\n        setMenuItems(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading menu items:&#39;, err);\n      }\n    };\n\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n      loadMenuItems();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          const currentMenuItem =\n                            menuItems.find((mi) =&gt; mi.item_id === transaction.product_id) || null;\n                          const inferredUnitPrice =\n                            currentMenuItem?.price ??\n                            transaction.menu_items?.price ??\n                            (transaction.quantity_sold\n                              ? transaction.total_amount / transaction.quantity_sold\n                              : 0);\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                            product_id: transaction.product_id || currentMenuItem?.item_id || &#39;&#39;,\n                            unit_price: inferredUnitPrice,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.created_at\n                              ? new Date(row.created_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingStockHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.changed_at\n                              ? new Date(row.changed_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingActivityHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Edit Modals (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingTransaction &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Transaction&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.sale_date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, sale_date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, stall_id: e.target.value }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.product_id || &#39;&#39;}\n                    onChange={(e) =&gt; {\n                      const nextItemId = e.target.value;\n                      const nextItem =\n                        menuItems.find((mi) =&gt; String(mi.item_id) === String(nextItemId)) || null;\n                      if (!nextItem) {\n                        setEditingTransaction((prev) =&gt; ({\n                          ...prev,\n                          product_id: nextItemId,\n                        }));\n                        return;\n                      }\n                      const qty = Number(editingTransaction.quantity_sold) || 0;\n                      const nextUnitPrice = Number(nextItem.price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        product_id: nextItem.item_id,\n                        unit_price: nextUnitPrice,\n                        total_amount: qty * nextUnitPrice,\n                        menu_items: {\n                          ...(prev.menu_items || {}),\n                          item_name: nextItem.item_name,\n                          price: nextUnitPrice,\n                        },\n                      }));\n                    }}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;Select item&lt;/option&gt;\n                    {menuItems.map((item) =&gt; (\n                      &lt;option key={item.item_id} value={item.item_id}&gt;\n                        {item.item_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.quantity_sold}\n                    min=\&quot;1\&quot;\n                    onChange={(e) =&gt; {\n                      const qty = Number(e.target.value) || 0;\n                      const price = Number(editingTransaction.unit_price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        quantity_sold: qty,\n                        total_amount: qty * price,\n                      }));\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Amount&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.total_amount}\n                    readOnly\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Payment Method&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.payment_method}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        payment_method: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                    &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditTransaction(editingTransaction, editingTransaction)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingTransaction(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingExpense &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Expense&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Name&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.expense_name}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, expense_name: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.quantity || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, quantity: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Cost&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.cost}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, cost: Number(e.target.value) }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingExpense.stall_id || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value || null,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Supplier&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.supplier_name || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        supplier_name: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditExpense(editingExpense, editingExpense)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingExpense(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingStockHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Stock History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, time: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stock Level&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.stock_level ?? &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_level: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stock_status}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;sold_out\&quot;&gt;Sold Out&lt;/option&gt;\n                    &lt;option value=\&quot;not_sold_out\&quot;&gt;Not Sold Out&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditStockHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingStockHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingActivityHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Activity History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        date: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        time: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.status}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;active\&quot;&gt;active&lt;/option&gt;\n                    &lt;option value=\&quot;inactive\&quot;&gt;inactive&lt;/option&gt;\n                    &lt;option value=\&quot;under maintenance\&quot;&gt;under maintenance&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditActivityHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingActivityHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint -- Reports.jsx</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint -- Reports.jsx
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint . Reports.jsx


Oops! Something went wrong! :(

ESLint: 9.37.0

No files matching the pattern &quot;Reports.jsx&quot; were found.
Please check for typing mistakes in the pattern.


```
</details>
</tool-use>

---

### Updates to Recent Transactions editing (Admin History Reports)

- **Item is now fully editable**  
  - When an admin clicks a transaction row, the modal opens with an **Item** `<select>` built from `menu_items` (loaded once in `Reports.jsx`).  
  - Changing the item updates the transaction’s `product_id`, the displayed item name, and the internal `unit_price` based on the selected menu item’s current `price`.

- **Amount is no longer directly editable**  
  - The **Amount** field in the modal is now **read-only**; it simply shows `total_amount`.  
  - When Qty is edited, the code recalculates `total_amount = qty * unit_price` (where `unit_price` comes from the current item’s price or, if needed, the inferred price from the original transaction), so admins control the amount only by changing the item or quantity.

---

_**User (2025-11-16 05:55Z)**_

make sure the card with tables of record list have fixed header columns so that it would now be included in scrollable rows. delete the remaining action columns in those cards

---

_**Agent (model default, mode Plan)**_



---

### Plan to apply your request

- **Fix table headers (non-scrollable)**
  - For every records card that has a scrollable table (`Recent Transactions`, `Recent Expenses`, `Stock History`, `Activity History`), keep the scroll only on the **tbody**, not the header.
  - Structurally, keep the existing `overflow-x-auto max-h-…` wrapper, but apply Tailwind/DaisyUI sticky header styles:
    - Add `sticky top-0 z-10 bg-base-100` (or `bg-base-200` depending on card) to `<thead>` or each `<th>`:
      ```jsx
      <thead className="sticky top-0 z-10 bg-base-100">
        <tr>
          <th className="bg-base-100">Date</th>
          ...
      ```
    - This keeps column labels fixed while the rows inside the `max-h-…` container scroll.

- **Remove remaining Actions columns**
  - In `Reports.jsx`, update each table that still has an “Actions” column:
    - **Recent Transactions**:
      - Change the header from `Date / Stall / Item / Qty / Amount / Payment / Actions` to just those six data columns.
      - In the body `<tr>`, remove the last `<td>` that shows “Click row to edit” and rely on hover/cursor-pointer for affordance.
    - **Recent Expenses**:
      - Remove the `Actions` header and the last `<td>` per row; preserve only `Name / Qty / Cost / Date / Stall / Supplier`.
  - Stock History and Activity History already have no action columns, so they don’t need changes.

Once you confirm this approach, I’ll:
1) update `Reports.jsx` to apply `sticky` headers + remove all `Actions` columns,  
2) run lint again to ensure there are no new issues.

---

_**User (2025-11-16 05:55Z)**_

alright, proceed with the plan

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Modifying table components**

I need to update Reports.jsx to adjust the Recent Transactions and Recent Expenses tables. Specifically, I want to remove the last column and make the header sticky. It’s also a good idea to make the other tables scrollable with a fixed header. I'll ensure to apply the sticky classes and avoid affecting other errors. After that, I’ll implement the required changes, including removing the last header and table data for Recent Transactions.
**Adjusting column spans**

I need to adjust the colSpan for the empty row in both the Recent Transactions and Recent Expenses tables. It should change from "7" to "6". This small modification makes sense for consistency, so I’ll move forward with implementing the necessary patches. It feels good to ensure that everything is aligned correctly to avoid confusion later on! Let's make these adjustments now.</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;54e4471e-f120-487f-95a7-fc5be2071330&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n-                   &lt;thead&gt;\n+                   &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                      &lt;tr&gt;\n-                       &lt;th&gt;Date&lt;/th&gt;\n-                       &lt;th&gt;Stall&lt;/th&gt;\n-                       &lt;th&gt;Item&lt;/th&gt;\n-                       &lt;th&gt;Qty&lt;/th&gt;\n-                       &lt;th&gt;Amount&lt;/th&gt;\n-                       &lt;th&gt;Payment&lt;/th&gt;\n-                       &lt;th&gt;Actions&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Item&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Amount&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Payment&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;&quot;,
        &quot;oldStart&quot;: 997,
        &quot;newStart&quot;: 997,
        &quot;oldLines&quot;: 13,
        &quot;newLines&quot;: 12,
        &quot;linesRemoved&quot;: 8,
        &quot;linesAdded&quot;: 7
      },
      {
        &quot;diffString&quot;: &quot;                            &lt;/span&gt;\n                          &lt;/td&gt;\n-                         &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n-                           {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n-                         &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {transactions.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n-                         &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n+                         &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No transactions found\n                          &lt;/td&gt;&quot;,
        &quot;oldStart&quot;: 1041,
        &quot;newStart&quot;: 1040,
        &quot;oldLines&quot;: 12,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 4,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Menu items (for editing transaction item / price)\n  const [menuItems, setMenuItems] = useState([]);\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n\n    const loadMenuItems = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;menu_items&#39;)\n          .select(&#39;item_id, item_name, price&#39;)\n          .order(&#39;item_name&#39;, { ascending: true });\n        if (error) throw error;\n        setMenuItems(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading menu items:&#39;, err);\n      }\n    };\n\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n      loadMenuItems();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                    &lt;tr&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Item&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Amount&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Payment&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          const currentMenuItem =\n                            menuItems.find((mi) =&gt; mi.item_id === transaction.product_id) || null;\n                          const inferredUnitPrice =\n                            currentMenuItem?.price ??\n                            transaction.menu_items?.price ??\n                            (transaction.quantity_sold\n                              ? transaction.total_amount / transaction.quantity_sold\n                              : 0);\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                            product_id: transaction.product_id || currentMenuItem?.item_id || &#39;&#39;,\n                            unit_price: inferredUnitPrice,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n                          {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.created_at\n                              ? new Date(row.created_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingStockHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.changed_at\n                              ? new Date(row.changed_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingActivityHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Edit Modals (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingTransaction &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Transaction&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.sale_date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, sale_date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, stall_id: e.target.value }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.product_id || &#39;&#39;}\n                    onChange={(e) =&gt; {\n                      const nextItemId = e.target.value;\n                      const nextItem =\n                        menuItems.find((mi) =&gt; String(mi.item_id) === String(nextItemId)) || null;\n                      if (!nextItem) {\n                        setEditingTransaction((prev) =&gt; ({\n                          ...prev,\n                          product_id: nextItemId,\n                        }));\n                        return;\n                      }\n                      const qty = Number(editingTransaction.quantity_sold) || 0;\n                      const nextUnitPrice = Number(nextItem.price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        product_id: nextItem.item_id,\n                        unit_price: nextUnitPrice,\n                        total_amount: qty * nextUnitPrice,\n                        menu_items: {\n                          ...(prev.menu_items || {}),\n                          item_name: nextItem.item_name,\n                          price: nextUnitPrice,\n                        },\n                      }));\n                    }}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;Select item&lt;/option&gt;\n                    {menuItems.map((item) =&gt; (\n                      &lt;option key={item.item_id} value={item.item_id}&gt;\n                        {item.item_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.quantity_sold}\n                    min=\&quot;1\&quot;\n                    onChange={(e) =&gt; {\n                      const qty = Number(e.target.value) || 0;\n                      const price = Number(editingTransaction.unit_price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        quantity_sold: qty,\n                        total_amount: qty * price,\n                      }));\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Amount&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.total_amount}\n                    readOnly\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Payment Method&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.payment_method}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        payment_method: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                    &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditTransaction(editingTransaction, editingTransaction)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingTransaction(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingExpense &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Expense&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Name&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.expense_name}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, expense_name: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.quantity || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, quantity: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Cost&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.cost}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, cost: Number(e.target.value) }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingExpense.stall_id || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value || null,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Supplier&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.supplier_name || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        supplier_name: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditExpense(editingExpense, editingExpense)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingExpense(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingStockHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Stock History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, time: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stock Level&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.stock_level ?? &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_level: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stock_status}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;sold_out\&quot;&gt;Sold Out&lt;/option&gt;\n                    &lt;option value=\&quot;not_sold_out\&quot;&gt;Not Sold Out&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditStockHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingStockHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingActivityHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Activity History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        date: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        time: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.status}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;active\&quot;&gt;active&lt;/option&gt;\n                    &lt;option value=\&quot;inactive\&quot;&gt;inactive&lt;/option&gt;\n                    &lt;option value=\&quot;under maintenance\&quot;&gt;under maintenance&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditActivityHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingActivityHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;49e5c864-bc89-4f1e-a6e2-ed547bd4e7ac&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n-                   &lt;thead&gt;\n+                   &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                      &lt;tr&gt;\n-                       &lt;th&gt;Name&lt;/th&gt;\n-                       &lt;th&gt;Qty&lt;/th&gt;\n-                       &lt;th&gt;Cost&lt;/th&gt;\n-                       &lt;th&gt;Date&lt;/th&gt;\n-                       &lt;th&gt;Stall&lt;/th&gt;\n-                       &lt;th&gt;Supplier&lt;/th&gt;\n-                       &lt;th&gt;Actions&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Name&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Cost&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n+                       &lt;th className=\&quot;bg-base-100\&quot;&gt;Supplier&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;&quot;,
        &quot;oldStart&quot;: 1136,
        &quot;newStart&quot;: 1136,
        &quot;oldLines&quot;: 13,
        &quot;newLines&quot;: 12,
        &quot;linesRemoved&quot;: 8,
        &quot;linesAdded&quot;: 7
      },
      {
        &quot;diffString&quot;: &quot;                          &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n-                         &lt;td className=\&quot;text-xs text-base-content/60\&quot;&gt;\n-                           {userProfile?.role === &#39;admin&#39; ? &#39;Click row to edit&#39; : &#39;&#39;}\n-                         &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {expenses.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n-                         &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n+                         &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No expenses recorded\n                          &lt;/td&gt;&quot;,
        &quot;oldStart&quot;: 1166,
        &quot;newStart&quot;: 1165,
        &quot;oldLines&quot;: 12,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 4,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Menu items (for editing transaction item / price)\n  const [menuItems, setMenuItems] = useState([]);\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n\n    const loadMenuItems = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;menu_items&#39;)\n          .select(&#39;item_id, item_name, price&#39;)\n          .order(&#39;item_name&#39;, { ascending: true });\n        if (error) throw error;\n        setMenuItems(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading menu items:&#39;, err);\n      }\n    };\n\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n      loadMenuItems();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                    &lt;tr&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Item&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Amount&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Payment&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          const currentMenuItem =\n                            menuItems.find((mi) =&gt; mi.item_id === transaction.product_id) || null;\n                          const inferredUnitPrice =\n                            currentMenuItem?.price ??\n                            transaction.menu_items?.price ??\n                            (transaction.quantity_sold\n                              ? transaction.total_amount / transaction.quantity_sold\n                              : 0);\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                            product_id: transaction.product_id || currentMenuItem?.item_id || &#39;&#39;,\n                            unit_price: inferredUnitPrice,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                    &lt;tr&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Name&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Cost&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Supplier&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Stock Level&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.created_at\n                              ? new Date(row.created_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingStockHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead&gt;\n                      &lt;tr&gt;\n                        &lt;th&gt;Date&lt;/th&gt;\n                        &lt;th&gt;Time&lt;/th&gt;\n                        &lt;th&gt;Stall&lt;/th&gt;\n                        &lt;th&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.changed_at\n                              ? new Date(row.changed_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingActivityHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Edit Modals (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingTransaction &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Transaction&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.sale_date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, sale_date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, stall_id: e.target.value }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.product_id || &#39;&#39;}\n                    onChange={(e) =&gt; {\n                      const nextItemId = e.target.value;\n                      const nextItem =\n                        menuItems.find((mi) =&gt; String(mi.item_id) === String(nextItemId)) || null;\n                      if (!nextItem) {\n                        setEditingTransaction((prev) =&gt; ({\n                          ...prev,\n                          product_id: nextItemId,\n                        }));\n                        return;\n                      }\n                      const qty = Number(editingTransaction.quantity_sold) || 0;\n                      const nextUnitPrice = Number(nextItem.price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        product_id: nextItem.item_id,\n                        unit_price: nextUnitPrice,\n                        total_amount: qty * nextUnitPrice,\n                        menu_items: {\n                          ...(prev.menu_items || {}),\n                          item_name: nextItem.item_name,\n                          price: nextUnitPrice,\n                        },\n                      }));\n                    }}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;Select item&lt;/option&gt;\n                    {menuItems.map((item) =&gt; (\n                      &lt;option key={item.item_id} value={item.item_id}&gt;\n                        {item.item_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.quantity_sold}\n                    min=\&quot;1\&quot;\n                    onChange={(e) =&gt; {\n                      const qty = Number(e.target.value) || 0;\n                      const price = Number(editingTransaction.unit_price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        quantity_sold: qty,\n                        total_amount: qty * price,\n                      }));\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Amount&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.total_amount}\n                    readOnly\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Payment Method&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.payment_method}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        payment_method: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                    &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditTransaction(editingTransaction, editingTransaction)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingTransaction(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingExpense &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Expense&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Name&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.expense_name}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, expense_name: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.quantity || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, quantity: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Cost&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.cost}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, cost: Number(e.target.value) }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingExpense.stall_id || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value || null,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Supplier&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.supplier_name || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        supplier_name: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditExpense(editingExpense, editingExpense)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingExpense(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingStockHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Stock History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, time: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stock Level&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.stock_level ?? &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_level: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stock_status}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;sold_out\&quot;&gt;Sold Out&lt;/option&gt;\n                    &lt;option value=\&quot;not_sold_out\&quot;&gt;Not Sold Out&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditStockHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingStockHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingActivityHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Activity History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        date: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        time: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.status}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;active\&quot;&gt;active&lt;/option&gt;\n                    &lt;option value=\&quot;inactive\&quot;&gt;inactive&lt;/option&gt;\n                    &lt;option value=\&quot;under maintenance\&quot;&gt;under maintenance&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditActivityHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingActivityHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;239925ad-ec28-4600-b04f-601092ad0d6e&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                  &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                    &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n-                     &lt;thead&gt;\n+                     &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                        &lt;tr&gt;\n-                         &lt;th&gt;Date&lt;/th&gt;\n-                         &lt;th&gt;Time&lt;/th&gt;\n-                         &lt;th&gt;Stall&lt;/th&gt;\n-                         &lt;th&gt;Stock Level&lt;/th&gt;\n-                         &lt;th&gt;Status&lt;/th&gt;\n+                         &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n+                         &lt;th className=\&quot;bg-base-100\&quot;&gt;Time&lt;/th&gt;\n+                         &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n+                         &lt;th className=\&quot;bg-base-100\&quot;&gt;Stock Level&lt;/th&gt;\n+                         &lt;th className=\&quot;bg-base-100\&quot;&gt;Status&lt;/th&gt;\n                        &lt;/tr&gt;\n                      &lt;/thead&gt;&quot;,
        &quot;oldStart&quot;: 1389,
        &quot;newStart&quot;: 1389,
        &quot;oldLines&quot;: 11,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 6,
        &quot;linesAdded&quot;: 6
      },
      {
        &quot;diffString&quot;: &quot;                  &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                    &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n-                     &lt;thead&gt;\n+                     &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                        &lt;tr&gt;\n-                         &lt;th&gt;Date&lt;/th&gt;\n-                         &lt;th&gt;Time&lt;/th&gt;\n-                         &lt;th&gt;Stall&lt;/th&gt;\n-                         &lt;th&gt;Status&lt;/th&gt;\n+                         &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n+                         &lt;th className=\&quot;bg-base-100\&quot;&gt;Time&lt;/th&gt;\n+                         &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n+                         &lt;th className=\&quot;bg-base-100\&quot;&gt;Status&lt;/th&gt;\n                        &lt;/tr&gt;\n                      &lt;/thead&gt;&quot;,
        &quot;oldStart&quot;: 1537,
        &quot;newStart&quot;: 1537,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 10,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 5
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Menu items (for editing transaction item / price)\n  const [menuItems, setMenuItems] = useState([]);\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n\n    const loadMenuItems = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;menu_items&#39;)\n          .select(&#39;item_id, item_name, price&#39;)\n          .order(&#39;item_name&#39;, { ascending: true });\n        if (error) throw error;\n        setMenuItems(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading menu items:&#39;, err);\n      }\n    };\n\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n      loadMenuItems();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                    &lt;tr&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Item&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Amount&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Payment&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          const currentMenuItem =\n                            menuItems.find((mi) =&gt; mi.item_id === transaction.product_id) || null;\n                          const inferredUnitPrice =\n                            currentMenuItem?.price ??\n                            transaction.menu_items?.price ??\n                            (transaction.quantity_sold\n                              ? transaction.total_amount / transaction.quantity_sold\n                              : 0);\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                            product_id: transaction.product_id || currentMenuItem?.item_id || &#39;&#39;,\n                            unit_price: inferredUnitPrice,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                    &lt;tr&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Name&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Cost&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Supplier&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                      &lt;tr&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Time&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Stock Level&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.created_at\n                              ? new Date(row.created_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingStockHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                      &lt;tr&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Time&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.changed_at\n                              ? new Date(row.changed_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingActivityHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Edit Modals (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingTransaction &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Transaction&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.sale_date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, sale_date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, stall_id: e.target.value }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.product_id || &#39;&#39;}\n                    onChange={(e) =&gt; {\n                      const nextItemId = e.target.value;\n                      const nextItem =\n                        menuItems.find((mi) =&gt; String(mi.item_id) === String(nextItemId)) || null;\n                      if (!nextItem) {\n                        setEditingTransaction((prev) =&gt; ({\n                          ...prev,\n                          product_id: nextItemId,\n                        }));\n                        return;\n                      }\n                      const qty = Number(editingTransaction.quantity_sold) || 0;\n                      const nextUnitPrice = Number(nextItem.price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        product_id: nextItem.item_id,\n                        unit_price: nextUnitPrice,\n                        total_amount: qty * nextUnitPrice,\n                        menu_items: {\n                          ...(prev.menu_items || {}),\n                          item_name: nextItem.item_name,\n                          price: nextUnitPrice,\n                        },\n                      }));\n                    }}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;Select item&lt;/option&gt;\n                    {menuItems.map((item) =&gt; (\n                      &lt;option key={item.item_id} value={item.item_id}&gt;\n                        {item.item_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.quantity_sold}\n                    min=\&quot;1\&quot;\n                    onChange={(e) =&gt; {\n                      const qty = Number(e.target.value) || 0;\n                      const price = Number(editingTransaction.unit_price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        quantity_sold: qty,\n                        total_amount: qty * price,\n                      }));\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Amount&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.total_amount}\n                    readOnly\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Payment Method&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.payment_method}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        payment_method: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                    &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditTransaction(editingTransaction, editingTransaction)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingTransaction(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingExpense &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Expense&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Name&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.expense_name}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, expense_name: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.quantity || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, quantity: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Cost&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.cost}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, cost: Number(e.target.value) }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingExpense.stall_id || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value || null,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Supplier&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.supplier_name || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        supplier_name: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditExpense(editingExpense, editingExpense)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingExpense(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingStockHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Stock History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, time: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stock Level&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.stock_level ?? &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_level: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stock_status}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;sold_out\&quot;&gt;Sold Out&lt;/option&gt;\n                    &lt;option value=\&quot;not_sold_out\&quot;&gt;Not Sold Out&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditStockHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingStockHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingActivityHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Activity History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        date: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        time: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.status}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;active\&quot;&gt;active&lt;/option&gt;\n                    &lt;option value=\&quot;inactive\&quot;&gt;inactive&lt;/option&gt;\n                    &lt;option value=\&quot;under maintenance\&quot;&gt;under maintenance&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditActivityHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingActivityHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint -- src/Reports.jsx</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint -- src/Reports.jsx
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint . src/Reports.jsx


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  162:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  556:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  604:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  713:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  724:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  793:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  809:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  816:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

### Changes applied to the record-list cards

- **Fixed table headers with scrollable rows**  
  - In all four report tables (`Recent Transactions`, `Recent Expenses`, `Stock History`, `Activity History`), the headers are now fixed using DaisyUI/Tailwind:  
    - Each table uses `thead className="sticky top-0 z-10 bg-base-100"` and each `<th>` has `bg-base-100`.  
    - The existing `overflow-x-auto max-h-96` wrapper keeps only the **rows** scrollable; headers stay visible at the top of the card.

- **Removed remaining Actions columns**  
  - **Recent Transactions**: the `Actions` header and “Click row to edit” `<td>` have been removed; the empty-state row now spans 6 columns.  
  - **Recent Expenses**: the `Actions` header and last `<td>` were removed; the empty-state row now spans 6 columns as well.  
  - Stock History and Activity History already had no action columns; they just received the sticky header treatment.

---

_**User (2025-11-16 05:55Z)**_

add a new stall filter in recent expenses that lists non stall affiliated expenses

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Implementing changes to filters**

I’m adjusting the filters to be more concise. I’ll change the dropdown options for stalls to include "All Stalls" and "Non-affiliated (No Stall)". Next, I need to tweak the filter logic: when expensesFilters.stallId is set to '__none__', it should result in a null query. Also, I have to ensure that the stallId gets cleared properly on the “Clear” action to be an empty string. Okay, time to patch this up!</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;206d426d-1178-4803-b1aa-73724d5abea7&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;          }\n          if (expensesFilters.stallId) {\n-           query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n-         }\n-       }\n+           if (expensesFilters.stallId === &#39;__none__&#39;) {\n+             query = query.is(&#39;stall_id&#39;, null);\n+           } else {\n+             query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n+           }\n+         }\n+       }\n  \n        // Staff: always limit to their stall and today&#39;s date&quot;,
        &quot;oldStart&quot;: 296,
        &quot;newStart&quot;: 296,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 7
      },
      {
        &quot;diffString&quot;: &quot;                      &gt;\n                        &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n+                       &lt;option value=\&quot;__none__\&quot;&gt;Non-affiliated (No Stall)&lt;/option&gt;\n                        {stalls.map((stall) =&gt; (\n                          &lt;option key={stall.stall_id} value={stall.stall_id}&gt;&quot;,
        &quot;oldStart&quot;: 1112,
        &quot;newStart&quot;: 1116,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Menu items (for editing transaction item / price)\n  const [menuItems, setMenuItems] = useState([]);\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n\n    const loadMenuItems = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;menu_items&#39;)\n          .select(&#39;item_id, item_name, price&#39;)\n          .order(&#39;item_name&#39;, { ascending: true });\n        if (error) throw error;\n        setMenuItems(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading menu items:&#39;, err);\n      }\n    };\n\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n      loadMenuItems();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          if (expensesFilters.stallId === &#39;__none__&#39;) {\n            query = query.is(&#39;stall_id&#39;, null);\n          } else {\n            query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n          }\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                    &lt;tr&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Item&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Amount&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Payment&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          const currentMenuItem =\n                            menuItems.find((mi) =&gt; mi.item_id === transaction.product_id) || null;\n                          const inferredUnitPrice =\n                            currentMenuItem?.price ??\n                            transaction.menu_items?.price ??\n                            (transaction.quantity_sold\n                              ? transaction.total_amount / transaction.quantity_sold\n                              : 0);\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                            product_id: transaction.product_id || currentMenuItem?.item_id || &#39;&#39;,\n                            unit_price: inferredUnitPrice,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      &lt;option value=\&quot;__none__\&quot;&gt;Non-affiliated (No Stall)&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                    &lt;tr&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Name&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Cost&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Supplier&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                      &lt;tr&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Time&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Stock Level&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.created_at\n                              ? new Date(row.created_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingStockHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                      &lt;tr&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Time&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.changed_at\n                              ? new Date(row.changed_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingActivityHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Edit Modals (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingTransaction &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Transaction&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.sale_date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, sale_date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, stall_id: e.target.value }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.product_id || &#39;&#39;}\n                    onChange={(e) =&gt; {\n                      const nextItemId = e.target.value;\n                      const nextItem =\n                        menuItems.find((mi) =&gt; String(mi.item_id) === String(nextItemId)) || null;\n                      if (!nextItem) {\n                        setEditingTransaction((prev) =&gt; ({\n                          ...prev,\n                          product_id: nextItemId,\n                        }));\n                        return;\n                      }\n                      const qty = Number(editingTransaction.quantity_sold) || 0;\n                      const nextUnitPrice = Number(nextItem.price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        product_id: nextItem.item_id,\n                        unit_price: nextUnitPrice,\n                        total_amount: qty * nextUnitPrice,\n                        menu_items: {\n                          ...(prev.menu_items || {}),\n                          item_name: nextItem.item_name,\n                          price: nextUnitPrice,\n                        },\n                      }));\n                    }}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;Select item&lt;/option&gt;\n                    {menuItems.map((item) =&gt; (\n                      &lt;option key={item.item_id} value={item.item_id}&gt;\n                        {item.item_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.quantity_sold}\n                    min=\&quot;1\&quot;\n                    onChange={(e) =&gt; {\n                      const qty = Number(e.target.value) || 0;\n                      const price = Number(editingTransaction.unit_price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        quantity_sold: qty,\n                        total_amount: qty * price,\n                      }));\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Amount&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.total_amount}\n                    readOnly\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Payment Method&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.payment_method}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        payment_method: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                    &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditTransaction(editingTransaction, editingTransaction)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingTransaction(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingExpense &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Expense&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Name&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.expense_name}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, expense_name: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.quantity || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, quantity: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Cost&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.cost}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, cost: Number(e.target.value) }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingExpense.stall_id || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value || null,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Supplier&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.supplier_name || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        supplier_name: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditExpense(editingExpense, editingExpense)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingExpense(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingStockHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Stock History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, time: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stock Level&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.stock_level ?? &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_level: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stock_status}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;sold_out\&quot;&gt;Sold Out&lt;/option&gt;\n                    &lt;option value=\&quot;not_sold_out\&quot;&gt;Not Sold Out&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditStockHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingStockHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingActivityHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Activity History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        date: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        time: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.status}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;active\&quot;&gt;active&lt;/option&gt;\n                    &lt;option value=\&quot;inactive\&quot;&gt;inactive&lt;/option&gt;\n                    &lt;option value=\&quot;under maintenance\&quot;&gt;under maintenance&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditActivityHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingActivityHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

### What I changed in Recent Expenses

- **New “non stall affiliated” filter option**  
  - In the **Recent Expenses** card’s Stall filter dropdown, there is now an extra option: **“Non-affiliated (No Stall)”** in addition to “All Stalls” and the individual stalls.
- **Filter behavior**  
  - When you select **Non-affiliated (No Stall)**, the query filters expenses where `stall_id` is `NULL`, showing only expenses that are not linked to any stall.  
  - Other options continue to work as before: “All Stalls” shows everything, and choosing a specific stall filters by that stall’s `stall_id`.

---

_**User (2025-11-16 05:55Z)**_

Change this to Sales and Stocks Monitoring System and reflect it into two roles

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Updating dashboard titles**

I need to change the heading from "Johnny's Chicken Stall Dashboard" to something like "Sales and Stocks Monitoring System." I think I should look into changing the role badges too, possibly using either "Administrator" or "Staff." It might be helpful to have these roles reflected clearly, maybe showing both "Administrator" and "Staff" for different views. I’ll need to inspect the layout and see where these adjustments can be made.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/components/Layout.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating title and roles**

I need to change the title text to "Sales and Stocks Monitoring System." It seems like they want the titles to reflect two roles. They might want a consistent app name with a second line that varies by role, like "Administrator View" or "Staff View." Since they already have the badge with `getRoleDisplayName`, it can indicate whether to show "Administrator" or "Staff." I could update the header to always include the main title and a smaller text reflecting the specific dashboard based on role.
**Renaming for clarity**

I need to consider keeping the badge, but the question suggests the system name should be generic for both roles. Using "Johnny's Chicken Stall Dashboard" implies it’s only for admins. So, I think renaming it to something neutral is enough. The phrase "reflect it into two roles" might indicate we should avoid terms like 'Dashboard' or 'Stall.' I’m also thinking about changing the title and adjusting the badge label to "Admin" or "Staff." I might want to inspect `roleUtils` for the `getRoleDisplayName` updates, since those labels might appear in other places as well.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/utils/roleUtils.js</summary>

</details>
</tool-use>

---



---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/components/Layout.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;2588c31b-8f2a-43b2-b5f1-612425d4df82&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                          &lt;div className=\&quot;flex items-center justify-between w-full\&quot;&gt;\n                              &lt;div&gt;\n-                                 &lt;h1 className=\&quot;text-xl font-bold text-primary\&quot;&gt;Johhny&#39;s Chicken Stall Dashboard&lt;/h1&gt;\n+                                 &lt;h1 className=\&quot;text-xl font-bold text-primary\&quot;&gt;Sales and Stocks Monitoring System&lt;/h1&gt;\n                                  {userRole &amp;&amp; (\n                                      &lt;div className=\&quot;flex items-center gap-2\&quot;&gt;&quot;,
        &quot;oldStart&quot;: 128,
        &quot;newStart&quot;: 128,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/components/Layout.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;../supabaseClient&#39;;\nimport { getRoleDisplayName, getRoleBadgeColor, isAdmin } from &#39;../utils/roleUtils&#39;;\nimport Sidebar from &#39;./Sidebar&#39;;\n\nfunction Layout({ children, userProfile }) {\n    const navigate = useNavigate();\n    const [user, setUser] = useState(null);\n    const [userRole, setUserRole] = useState(null);\n    const [currentDate, setCurrentDate] = useState(&#39;&#39;);\n    const [theme, setTheme] = useState(&#39;chicken-stall&#39;);\n\n    useEffect(() =&gt; {\n        const getUser = async () =&gt; {\n            const { data: { user } } = await supabase.auth.getUser();\n            setUser(user);\n\n            if (user) {\n                const { data: profile, error } = await supabase\n                    .from(&#39;profiles&#39;)\n                    .select(&#39;role, full_name, stall_id, status&#39;)\n                    .eq(&#39;id&#39;, user.id)\n                    .single();\n\n                if (!error) {\n                    setUserRole(profile?.role || &#39;staff&#39;);\n                }\n            }\n        };\n\n        getUser();\n\n        const { data: { subscription } } = supabase.auth.onAuthStateChange(\n            (event, session) =&gt; {\n                setUser(session?.user ?? null);\n            }\n        );\n\n        // Update date in Philippine timezone\n        const updateDate = () =&gt; {\n            const now = new Date();\n            const formattedDate = now.toLocaleDateString(&#39;en-US&#39;, {\n                weekday: &#39;long&#39;,\n                year: &#39;numeric&#39;,\n                month: &#39;long&#39;,\n                day: &#39;numeric&#39;,\n                timeZone: &#39;Asia/Manila&#39;\n            });\n            setCurrentDate(formattedDate);\n        };\n\n        updateDate();\n        // Update date every minute\n        const dateInterval = setInterval(updateDate, 60000);\n\n        return () =&gt; {\n            subscription.unsubscribe();\n            clearInterval(dateInterval);\n        };\n    }, []);\n\n    // Sync local theme state with current global theme once on mount\n    useEffect(() =&gt; {\n        if (typeof document === &#39;undefined&#39;) return;\n        const current = document.documentElement.getAttribute(&#39;data-theme&#39;) || &#39;light&#39;;\n        setTheme(current === &#39;chicken-stall-dark&#39; ? &#39;chicken-stall-dark&#39; : &#39;chicken-stall&#39;);\n    }, []);\n\n    const toggleTheme = () =&gt; {\n        const nextTheme = theme === &#39;chicken-stall-dark&#39; ? &#39;chicken-stall&#39; : &#39;chicken-stall-dark&#39;;\n        if (typeof document !== &#39;undefined&#39;) {\n            document.documentElement.setAttribute(&#39;data-theme&#39;, nextTheme);\n            document.body?.setAttribute(&#39;data-theme&#39;, nextTheme);\n        }\n        setTheme(nextTheme);\n        try {\n            localStorage.setItem(&#39;theme&#39;, nextTheme);\n        } catch {\n            // ignore storage errors\n        }\n    };\n\n    const handleLogout = async () =&gt; {\n        const { error } = await supabase.auth.signOut();\n\n        if (error) {\n            console.error(&#39;Error logging out:&#39;, error.message);\n            alert(&#39;Failed to log out.&#39;);\n        } else {\n            // Optional: clear any stored profile info\n            localStorage.removeItem(&#39;userProfile&#39;);\n            navigate(&#39;/login&#39;);\n        }\n};\n\n\n    if (!user) {\n        return (\n            &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n                &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n                    &lt;div className=\&quot;card-body text-center\&quot;&gt;\n                        &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n                        &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n                        &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n                            &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n        );\n    }\n\n    return (\n        &lt;div className=\&quot;drawer lg:drawer-open min-h-screen bg-base-200\&quot;&gt;\n            &lt;input id=\&quot;my-drawer-2\&quot; type=\&quot;checkbox\&quot; className=\&quot;drawer-toggle\&quot; /&gt;\n            &lt;div className=\&quot;drawer-content flex flex-col\&quot;&gt;\n                {/* Navbar */}\n                &lt;div className=\&quot;navbar bg-base-100 shadow-lg\&quot;&gt;\n                    &lt;div className=\&quot;flex-none lg:hidden\&quot;&gt;\n                        &lt;label htmlFor=\&quot;my-drawer-2\&quot; className=\&quot;btn btn-square btn-ghost drawer-button\&quot;&gt;\n                            &lt;svg xmlns=\&quot;http://www.w3.org/2000/svg\&quot; fill=\&quot;none\&quot; viewBox=\&quot;0 0 24 24\&quot; className=\&quot;inline-block w-6 h-6 stroke-current\&quot;&gt;\n                                &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth=\&quot;2\&quot; d=\&quot;M4 6h16M4 12h16M4 18h16\&quot;&gt;&lt;/path&gt;\n                            &lt;/svg&gt;\n                        &lt;/label&gt;\n                    &lt;/div&gt;\n                    &lt;div className=\&quot;flex-1\&quot;&gt;\n                        &lt;div className=\&quot;flex items-center justify-between w-full\&quot;&gt;\n                            &lt;div&gt;\n                                &lt;h1 className=\&quot;text-xl font-bold text-primary\&quot;&gt;Sales and Stocks Monitoring System&lt;/h1&gt;\n                                {userRole &amp;&amp; (\n                                    &lt;div className=\&quot;flex items-center gap-2\&quot;&gt;\n                                        &lt;span className={&#96;badge ${getRoleBadgeColor(userRole)} badge-sm&#96;}&gt;\n                                            {getRoleDisplayName(userRole)}\n                                        &lt;/span&gt;\n                                    &lt;/div&gt;\n                                )}\n                            &lt;/div&gt;\n                            &lt;div className=\&quot;flex items-center gap-4\&quot;&gt;\n                                {currentDate &amp;&amp; (\n                                    &lt;div className=\&quot;hidden md:block text-sm text-base-content/70 mr-2\&quot;&gt;\n                                        {currentDate}\n                                    &lt;/div&gt;\n                                )}\n                                {/* Theme toggle */}\n                                &lt;button\n                                    type=\&quot;button\&quot;\n                                    className=\&quot;btn btn-ghost btn-circle\&quot;\n                                    onClick={toggleTheme}\n                                    aria-label=\&quot;Toggle color theme\&quot;\n                                &gt;\n                                    {theme === &#39;chicken-stall-dark&#39; ? (\n                                        // Sun icon for switching to light mode\n                                        &lt;svg\n                                            xmlns=\&quot;http://www.w3.org/2000/svg\&quot;\n                                            className=\&quot;w-6 h-6\&quot;\n                                            fill=\&quot;none\&quot;\n                                            viewBox=\&quot;0 0 24 24\&quot;\n                                            stroke=\&quot;currentColor\&quot;\n                                        &gt;\n                                            &lt;path\n                                                strokeLinecap=\&quot;round\&quot;\n                                                strokeLinejoin=\&quot;round\&quot;\n                                                strokeWidth={2}\n                                                d=\&quot;M12 3v2.25M18.364 5.636l-1.59 1.59M21 12h-2.25M18.364 18.364l-1.59-1.59M12 18.75V21M7.226 16.774l-1.59 1.59M5.25 12H3m3.636-6.364l-1.59 1.59M12 8.25A3.75 3.75 0 1015.75 12 3.75 3.75 0 0012 8.25z\&quot;\n                                            /&gt;\n                                        &lt;/svg&gt;\n                                    ) : (\n                                        // Moon icon for switching to dark mode\n                                        &lt;svg\n                                            xmlns=\&quot;http://www.w3.org/2000/svg\&quot;\n                                            className=\&quot;w-6 h-6\&quot;\n                                            fill=\&quot;none\&quot;\n                                            viewBox=\&quot;0 0 24 24\&quot;\n                                            stroke=\&quot;currentColor\&quot;\n                                        &gt;\n                                            &lt;path\n                                                strokeLinecap=\&quot;round\&quot;\n                                                strokeLinejoin=\&quot;round\&quot;\n                                                strokeWidth={2}\n                                                d=\&quot;M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z\&quot;\n                                            /&gt;\n                                        &lt;/svg&gt;\n                                    )}\n                                &lt;/button&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                    &lt;div className=\&quot;flex-none\&quot;&gt;\n                        &lt;div className=\&quot;dropdown dropdown-end\&quot;&gt;\n                            &lt;div tabIndex={0} role=\&quot;button\&quot; className=\&quot;btn btn-ghost btn-circle avatar\&quot;&gt;\n                                &lt;div className=\&quot;w-10 rounded-full bg-primary text-primary-content flex items-center justify-center\&quot;&gt;\n                                    {userProfile?.full_name?.charAt(0).toUpperCase() || user?.email?.charAt(0).toUpperCase() || &#39;U&#39;}\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                            &lt;ul tabIndex={0} className=\&quot;menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52\&quot;&gt;\n                                &lt;li&gt;\n                                    &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;\n                                        {userProfile?.full_name || user?.email || &#39;User&#39;}\n                                    &lt;/div&gt;\n                                &lt;/li&gt;\n                                &lt;li&gt;&lt;a onClick={handleLogout}&gt;Logout&lt;/a&gt;&lt;/li&gt;\n                            &lt;/ul&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n\n                {/* Main Content */}\n                &lt;div className=\&quot;flex-grow\&quot;&gt;\n                    {children}\n                &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Sidebar */}\n            &lt;Sidebar userProfile={userProfile} onLogout={handleLogout} /&gt;\n        &lt;/div&gt;\n    );\n}\n\nexport default Layout;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

The navbar title now reads **“Sales and Stocks Monitoring System”**, and the role badge just below it continues to show the appropriate role-specific label (“Administrator” for admins, “Staff Member” for staff), so the system name is shared while the role is clearly reflected.

---

_**User (2025-11-16 05:55Z)**_

in the manage staff, fix the layout issue, these cards should adjust independent of each other

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Inspecting layout issues**

I notice there’s a layout fix needed in ManageStaff. I’m thinking it's important to inspect the file to understand the issues better. I should use the read_file function to access that information. This will help me figure out what needs to be adjusted in the layout and ensure everything is working smoothly. Alright, let’s get started on that!</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/ManageStaff.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Exploring layout options**

I’m checking the default grid settings, noticing that each row has the same height since they're auto. To create a masonry effect, I’d need to adjust the grid with `grid-auto-rows: minmax(0, 1fr)`. Alternatively, I could consider using a flexbox layout to give cards independent heights by switching to `flex flex-wrap` with appropriate width settings. This seems to meet the requirements better. It looks like I’ll patch the ManageStaff lines as needed.</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/ManageStaff.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;1b091ce1-9361-4f57-95d7-dc2f1b74a8f4&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  \n          {/* Stall Cards */}\n-         &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-3 gap-6\&quot;&gt;\n+         &lt;div className=\&quot;flex flex-wrap gap-6\&quot;&gt;\n            {stalls.map(stall =&gt; (\n-             &lt;div key={stall.stall_id} className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n+             &lt;div\n+               key={stall.stall_id}\n+               className=\&quot;card bg-base-100 shadow-xl w-full lg:w-1/3\&quot;\n+             &gt;\n                &lt;div className=\&quot;card-body\&quot;&gt;\n                  &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;&quot;,
        &quot;oldStart&quot;: 312,
        &quot;newStart&quot;: 312,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 10,
        &quot;linesRemoved&quot;: 2,
        &quot;linesAdded&quot;: 5
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/ManageStaff.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase, supabaseAdmin } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\n\nfunction ManageStaff() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [creating, setCreating] = useState(false);\n  const [staffList, setStaffList] = useState([]);\n\n  // Staff creation states\n  const [staffEmail, setStaffEmail] = useState(&#39;&#39;);\n  const [staffName, setStaffName] = useState(&#39;&#39;);\n  const [staffPassword, setStaffPassword] = useState(&#39;&#39;);\n  const [selectedStall, setSelectedStall] = useState(&#39;&#39;);\n  const [stalls, setStalls] = useState([]);\n\n  // 🧠 Get logged-in user and verify admin role\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          if (profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only admins can manage staff.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // 🧩 Fetch stalls and staff\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;admin&#39;) {\n      const fetchData = async () =&gt; {\n        // Fetch stalls\n        const { data: stallsData, error: stallsError } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name, location&#39;)\n          .order(&#39;stall_name&#39;);\n\n        if (!stallsError &amp;&amp; stallsData) {\n          setStalls(stallsData);\n          if (stallsData.length &gt; 0 &amp;&amp; !selectedStall) {\n            setSelectedStall(stallsData[0].stall_id);\n          }\n        }\n\n        // Fetch staff profiles\n        const { data: staffData, error: staffError } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n          .eq(&#39;role&#39;, &#39;staff&#39;)\n          .order(&#39;full_name&#39;);\n\n        if (!staffError &amp;&amp; staffData) {\n          const staffWithVerification = await fetchStaffWithVerification(staffData);\n          setStaffList(staffWithVerification || []);\n        }\n      };\n      fetchData();\n    }\n  }, [userProfile, selectedStall]);\n\n  // Helper function to fetch staff with email verification status\n  const fetchStaffWithVerification = async (staffData) =&gt; {\n    return await Promise.all(\n      staffData.map(async (staff) =&gt; {\n        try {\n          const { data: userData, error: userError } = await supabaseAdmin.auth.admin.getUserById(staff.id);\n          \n          if (!userError &amp;&amp; userData?.user) {\n            const isEmailConfirmed = !!userData.user.email_confirmed_at;\n            \n            // If email is confirmed and status is inactive, update to active\n            if (isEmailConfirmed &amp;&amp; staff.status === &#39;inactive&#39;) {\n              await supabase\n                .from(&#39;profiles&#39;)\n                .update({ status: &#39;active&#39; })\n                .eq(&#39;id&#39;, staff.id);\n              staff.status = &#39;active&#39;;\n            }\n            \n            return {\n              ...staff,\n              displayStatus: isEmailConfirmed ? &#39;active&#39; : &#39;unverified&#39;\n            };\n          }\n          \n          return {\n            ...staff,\n            displayStatus: staff.status\n          };\n        } catch (err) {\n          console.error(&#96;Error checking email for ${staff.id}:&#96;, err);\n          return {\n            ...staff,\n            displayStatus: staff.status\n          };\n        }\n      })\n    );\n  };\n\n  // 🧱 Create new staff\n  const handleCreateStaff = async () =&gt; {\n    if (!staffEmail || !staffPassword) {\n      alert(&#39;Please fill in email and password.&#39;);\n      return;\n    }\n\n    if (userProfile.role !== &#39;admin&#39;) {\n      alert(&#39;Only admins can create staff accounts.&#39;);\n      return;\n    }\n\n    setCreating(true);\n    try {\n      const { data, error } = await supabaseAdmin.auth.admin.createUser({\n        email: staffEmail,\n        password: staffPassword,\n        email_confirm: false,\n      });\n\n      if (!error) {\n        // Send the confirmation email manually\n        await supabaseAdmin.auth.resend({\n          type: &#39;signup&#39;,\n          email: staffEmail,\n        });\n      } \n\n      if (error) throw error;\n      const newUser = data.user;\n      if (!newUser?.id) throw new Error(&#39;No user ID returned from createUser.&#39;);\n\n      // Create profile with inactive status since email is not confirmed\n      // We&#39;ll display it as &#39;unverified&#39; in the UI based on email confirmation status\n      const { error: profileError } = await supabase\n        .from(&#39;profiles&#39;)\n        .insert([{\n          id: newUser.id,\n          full_name: staffName,\n          email: staffEmail,\n          role: &#39;staff&#39;,\n          status: &#39;inactive&#39;, // Database constraint only allows &#39;active&#39; or &#39;inactive&#39;\n          stall_id: selectedStall,\n        }]);\n\n      if (profileError) throw profileError;\n\n      alert(&#39;Staff account created successfully!&#39;);\n      \n      // Reset form\n      setStaffEmail(&#39;&#39;);\n      setStaffName(&#39;&#39;);\n      setStaffPassword(&#39;&#39;);\n\n      // Refresh staff list\n      const { data: updatedStaff, error: fetchError } = await supabase\n        .from(&#39;profiles&#39;)\n        .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n        .eq(&#39;role&#39;, &#39;staff&#39;)\n        .order(&#39;full_name&#39;);\n\n      if (!fetchError &amp;&amp; updatedStaff) {\n        const staffWithVerification = await fetchStaffWithVerification(updatedStaff);\n        setStaffList(staffWithVerification || []);\n      }\n\n    } catch (error) {\n      console.error(&#39;Error creating staff:&#39;, error);\n      alert(&#39;Error creating staff account: &#39; + error.message);\n    } finally {\n      setCreating(false);\n    }\n  };\n\n  // 🗑️ Delete staff\n  const handleDeleteStaff = async (staffId) =&gt; {\n    if (!window.confirm(&#39;Are you sure you want to delete this staff member?&#39;)) {\n      return;\n    }\n\n    try {\n      const { error: profileError } = await supabase\n        .from(&#39;profiles&#39;)\n        .delete()\n        .eq(&#39;id&#39;, staffId);\n\n      if (profileError) throw profileError;\n\n      const { error: authError } = await supabaseAdmin.auth.admin.deleteUser(staffId);\n      if (authError) console.warn(&#39;Could not delete from auth.users:&#39;, authError);\n\n      alert(&#39;Staff member deleted successfully!&#39;);\n      \n      // Update staff list\n      const { data: updatedStaff } = await supabase\n        .from(&#39;profiles&#39;)\n        .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n        .eq(&#39;role&#39;, &#39;staff&#39;)\n        .order(&#39;full_name&#39;);\n      \n      if (updatedStaff) {\n        const staffWithVerification = await fetchStaffWithVerification(updatedStaff);\n        setStaffList(staffWithVerification || []);\n      }\n\n    } catch (error) {\n      console.error(&#39;Error deleting staff:&#39;, error);\n      alert(&#39;Error deleting staff member: &#39; + error.message);\n    }\n  };\n\n  // Group staff by stall\n  const staffByStall = {};\n  stalls.forEach(stall =&gt; {\n    staffByStall[stall.stall_id] = staffList.filter(staff =&gt; staff.stall_id === stall.stall_id);\n  });\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Manage Staff&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Create and manage staff accounts across all stalls&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Create Staff Form */}\n        &lt;div className=\&quot;card bg-base-100 shadow-xl mb-6\&quot;&gt;\n          &lt;div className=\&quot;card-body\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Create New Staff Account&lt;/h2&gt;\n            &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\&quot;&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Full Name&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;text\&quot; placeholder=\&quot;Doe loe ritoe\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffName} onChange={(e) =&gt; setStaffName(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Email&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;email\&quot; placeholder=\&quot;staff@chickenstall.com\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffEmail} onChange={(e) =&gt; setStaffEmail(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Password&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;password\&quot; placeholder=\&quot;Secure password\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffPassword} onChange={(e) =&gt; setStaffPassword(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Stall&lt;/span&gt;&lt;/label&gt;\n                &lt;select className=\&quot;select select-bordered w-full\&quot;\n                  value={selectedStall} onChange={(e) =&gt; setSelectedStall(e.target.value)}&gt;\n                  {stalls.map(stall =&gt; (\n                    &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                      {stall.stall_name} - {stall.location}\n                    &lt;/option&gt;\n                  ))}\n                &lt;/select&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n            &lt;div className=\&quot;card-actions justify-end mt-4\&quot;&gt;\n              &lt;button className=\&quot;btn btn-error\&quot; onClick={handleCreateStaff} disabled={creating}&gt;\n                {creating ? &lt;span className=\&quot;loading loading-spinner\&quot;&gt;&lt;/span&gt; : null}\n                {creating ? &#39;Creating...&#39; : &#39;Create Account&#39;}\n              &lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Stall Cards */}\n        &lt;div className=\&quot;flex flex-wrap gap-6\&quot;&gt;\n          {stalls.map(stall =&gt; (\n            &lt;div\n              key={stall.stall_id}\n              className=\&quot;card bg-base-100 shadow-xl w-full lg:w-1/3\&quot;\n            &gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                  &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;{stall.stall_name}&lt;/h2&gt;\n                  &lt;div className=\&quot;badge badge-secondary\&quot;&gt;\n                    {staffByStall[stall.stall_id]?.length || 0} staff\n                  &lt;/div&gt;\n                &lt;/div&gt;\n                &lt;p className=\&quot;text-sm text-base-content/70 mb-3\&quot;&gt;{stall.location}&lt;/p&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  {staffByStall[stall.stall_id]?.length &gt; 0 ? (\n                    staffByStall[stall.stall_id].map(staff =&gt; (\n                      &lt;div key={staff.id} className=\&quot;flex items-center justify-between p-3 bg-base-200 rounded-lg\&quot;&gt;\n                        &lt;div&gt;\n                          &lt;div className=\&quot;font-medium\&quot;&gt;{staff.full_name}&lt;/div&gt;\n                          &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;{staff.email}&lt;/div&gt;\n                          &lt;div className={&#96;badge badge-sm ${\n                            staff.displayStatus === &#39;active&#39; \n                              ? &#39;badge-success&#39; \n                              : staff.displayStatus === &#39;unverified&#39;\n                              ? &#39;badge-warning&#39;\n                              : &#39;badge-error&#39;\n                          }&#96;}&gt;\n                            {staff.displayStatus}\n                          &lt;/div&gt;\n                        &lt;/div&gt;\n                        &lt;button className=\&quot;btn btn-sm btn-error\&quot; onClick={() =&gt; handleDeleteStaff(staff.id)}&gt;\n                          Delete\n                        &lt;/button&gt;\n                      &lt;/div&gt;\n                    ))\n                  ) : (\n                    &lt;div className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                      No staff assigned to this stall\n                    &lt;/div&gt;\n                  )}\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          ))}\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default ManageStaff;&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

The stall cards in `ManageStaff` now use a responsive flex layout (`flex flex-wrap` with each card `w-full lg:w-1/3`), so each card’s height adjusts independently to its own staff list instead of being forced to match the tallest card in the row.

---

_**User (2025-11-16 05:55Z)**_

this is not what i wanted, i meant that when other card has bigger height, it should not affect other cards. can you investigate the layouting and composition of the manage staff cards?

---

_**Agent (model default, mode Plan)**_

<think><details><summary>Thought Process</summary>
**Adjusting flex item heights**

I'm noticing how switching to flex allows each row to be independent, but the items still share height due to the default `items-stretch`. It seems users want each card to hug its content without equalizing heights across rows. To achieve that, I can use `items-start` on the flex container and possibly adjust how the cards are styled. Setting the container as `flex flex-wrap gap-6 items-start` should allow for independent heights. That way, Stall1 can be taller than Stall2 as intended.
**Explaining investigation and plan**

The user has asked me to investigate and explain an issue. While they didn't directly say to proceed, I need to clarify the cause and suggest a fix. Since the previous guidance was to only modify when the user gives explicit permission, I should stick with my explanation and proposed plan. I understand they might want a direct fix, but since we're still in plan mode, I need to explain the situation first and then seek their confirmation.
**Proposing code change**

The user didn't explicitly say "don't edit now," so I think it's fine to explain and suggest a code snippet without running any tools. Since we've already changed the card container to flex, this next change is minor. I can clarify that the equal heights are due to the parent using `items-stretch`. I’ll recommend adding `items-start` to the flex container to allow for independent heights. I’ll show the snippet as `className="flex flex-wrap gap-6 items-start"`. This should help achieve the desired independence across all cards!</details></think>

---

### Why the cards still match heights

Right now the stall cards are rendered like this in `ManageStaff.jsx`:

```jsx
<div className="flex flex-wrap gap-6">
  {stalls.map(stall => (
    <div key={stall.stall_id} className="card bg-base-100 shadow-xl w-full lg:w-1/3">
      ...
    </div>
  ))}
</div>
```

Because a flex container defaults to `align-items: stretch`, **all cards in the same row are stretched to the height of the tallest card in that row**. That’s why, when Stall 1’s card gets taller, Stall 2’s card grows to match it.

### Minimal layout fix

To let each card keep its own natural height, even within the same row, you just need to stop the stretch alignment on the flex container:

```jsx
<div className="flex flex-wrap gap-6 items-start">
  {stalls.map(stall => (
    <div
      key={stall.stall_id}
      className="card bg-base-100 shadow-xl w-full lg:w-1/3"
    >
      ...
    </div>
  ))}
</div>
```

- `items-start` → maps to `align-items: flex-start`, so **each card uses its own content height**, independent of other cards.
- The responsive widths (`w-full lg:w-1/3`) stay the same, so layout behavior is unchanged apart from the height stretching.

If you’d like, I can also adjust spacing or add `md:w-1/2` so the cards flow more naturally at medium widths.

---

_**User (2025-11-16 05:55Z)**_

yes implement those, proceed

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Modifying CSS classes**

I need to make a small change by adding the "items-start" class to the existing classes, which already include "flex," "flex-wrap," and "gap-6." I think using "apply_patch" will be the way to go for this modification. Once I implement that change, I should be ready to provide a brief answer about the update. It seems straightforward, so let's keep it concise.</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/ManageStaff.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;2a3e2c23-f922-4a0f-8525-02eab84d95ba&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  \n          {/* Stall Cards */}\n-         &lt;div className=\&quot;flex flex-wrap gap-6\&quot;&gt;\n+         &lt;div className=\&quot;flex flex-wrap gap-6 items-start\&quot;&gt;\n            {stalls.map(stall =&gt; (\n              &lt;div&quot;,
        &quot;oldStart&quot;: 312,
        &quot;newStart&quot;: 312,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/ManageStaff.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase, supabaseAdmin } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\n\nfunction ManageStaff() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [creating, setCreating] = useState(false);\n  const [staffList, setStaffList] = useState([]);\n\n  // Staff creation states\n  const [staffEmail, setStaffEmail] = useState(&#39;&#39;);\n  const [staffName, setStaffName] = useState(&#39;&#39;);\n  const [staffPassword, setStaffPassword] = useState(&#39;&#39;);\n  const [selectedStall, setSelectedStall] = useState(&#39;&#39;);\n  const [stalls, setStalls] = useState([]);\n\n  // 🧠 Get logged-in user and verify admin role\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          if (profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only admins can manage staff.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // 🧩 Fetch stalls and staff\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;admin&#39;) {\n      const fetchData = async () =&gt; {\n        // Fetch stalls\n        const { data: stallsData, error: stallsError } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name, location&#39;)\n          .order(&#39;stall_name&#39;);\n\n        if (!stallsError &amp;&amp; stallsData) {\n          setStalls(stallsData);\n          if (stallsData.length &gt; 0 &amp;&amp; !selectedStall) {\n            setSelectedStall(stallsData[0].stall_id);\n          }\n        }\n\n        // Fetch staff profiles\n        const { data: staffData, error: staffError } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n          .eq(&#39;role&#39;, &#39;staff&#39;)\n          .order(&#39;full_name&#39;);\n\n        if (!staffError &amp;&amp; staffData) {\n          const staffWithVerification = await fetchStaffWithVerification(staffData);\n          setStaffList(staffWithVerification || []);\n        }\n      };\n      fetchData();\n    }\n  }, [userProfile, selectedStall]);\n\n  // Helper function to fetch staff with email verification status\n  const fetchStaffWithVerification = async (staffData) =&gt; {\n    return await Promise.all(\n      staffData.map(async (staff) =&gt; {\n        try {\n          const { data: userData, error: userError } = await supabaseAdmin.auth.admin.getUserById(staff.id);\n          \n          if (!userError &amp;&amp; userData?.user) {\n            const isEmailConfirmed = !!userData.user.email_confirmed_at;\n            \n            // If email is confirmed and status is inactive, update to active\n            if (isEmailConfirmed &amp;&amp; staff.status === &#39;inactive&#39;) {\n              await supabase\n                .from(&#39;profiles&#39;)\n                .update({ status: &#39;active&#39; })\n                .eq(&#39;id&#39;, staff.id);\n              staff.status = &#39;active&#39;;\n            }\n            \n            return {\n              ...staff,\n              displayStatus: isEmailConfirmed ? &#39;active&#39; : &#39;unverified&#39;\n            };\n          }\n          \n          return {\n            ...staff,\n            displayStatus: staff.status\n          };\n        } catch (err) {\n          console.error(&#96;Error checking email for ${staff.id}:&#96;, err);\n          return {\n            ...staff,\n            displayStatus: staff.status\n          };\n        }\n      })\n    );\n  };\n\n  // 🧱 Create new staff\n  const handleCreateStaff = async () =&gt; {\n    if (!staffEmail || !staffPassword) {\n      alert(&#39;Please fill in email and password.&#39;);\n      return;\n    }\n\n    if (userProfile.role !== &#39;admin&#39;) {\n      alert(&#39;Only admins can create staff accounts.&#39;);\n      return;\n    }\n\n    setCreating(true);\n    try {\n      const { data, error } = await supabaseAdmin.auth.admin.createUser({\n        email: staffEmail,\n        password: staffPassword,\n        email_confirm: false,\n      });\n\n      if (!error) {\n        // Send the confirmation email manually\n        await supabaseAdmin.auth.resend({\n          type: &#39;signup&#39;,\n          email: staffEmail,\n        });\n      } \n\n      if (error) throw error;\n      const newUser = data.user;\n      if (!newUser?.id) throw new Error(&#39;No user ID returned from createUser.&#39;);\n\n      // Create profile with inactive status since email is not confirmed\n      // We&#39;ll display it as &#39;unverified&#39; in the UI based on email confirmation status\n      const { error: profileError } = await supabase\n        .from(&#39;profiles&#39;)\n        .insert([{\n          id: newUser.id,\n          full_name: staffName,\n          email: staffEmail,\n          role: &#39;staff&#39;,\n          status: &#39;inactive&#39;, // Database constraint only allows &#39;active&#39; or &#39;inactive&#39;\n          stall_id: selectedStall,\n        }]);\n\n      if (profileError) throw profileError;\n\n      alert(&#39;Staff account created successfully!&#39;);\n      \n      // Reset form\n      setStaffEmail(&#39;&#39;);\n      setStaffName(&#39;&#39;);\n      setStaffPassword(&#39;&#39;);\n\n      // Refresh staff list\n      const { data: updatedStaff, error: fetchError } = await supabase\n        .from(&#39;profiles&#39;)\n        .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n        .eq(&#39;role&#39;, &#39;staff&#39;)\n        .order(&#39;full_name&#39;);\n\n      if (!fetchError &amp;&amp; updatedStaff) {\n        const staffWithVerification = await fetchStaffWithVerification(updatedStaff);\n        setStaffList(staffWithVerification || []);\n      }\n\n    } catch (error) {\n      console.error(&#39;Error creating staff:&#39;, error);\n      alert(&#39;Error creating staff account: &#39; + error.message);\n    } finally {\n      setCreating(false);\n    }\n  };\n\n  // 🗑️ Delete staff\n  const handleDeleteStaff = async (staffId) =&gt; {\n    if (!window.confirm(&#39;Are you sure you want to delete this staff member?&#39;)) {\n      return;\n    }\n\n    try {\n      const { error: profileError } = await supabase\n        .from(&#39;profiles&#39;)\n        .delete()\n        .eq(&#39;id&#39;, staffId);\n\n      if (profileError) throw profileError;\n\n      const { error: authError } = await supabaseAdmin.auth.admin.deleteUser(staffId);\n      if (authError) console.warn(&#39;Could not delete from auth.users:&#39;, authError);\n\n      alert(&#39;Staff member deleted successfully!&#39;);\n      \n      // Update staff list\n      const { data: updatedStaff } = await supabase\n        .from(&#39;profiles&#39;)\n        .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n        .eq(&#39;role&#39;, &#39;staff&#39;)\n        .order(&#39;full_name&#39;);\n      \n      if (updatedStaff) {\n        const staffWithVerification = await fetchStaffWithVerification(updatedStaff);\n        setStaffList(staffWithVerification || []);\n      }\n\n    } catch (error) {\n      console.error(&#39;Error deleting staff:&#39;, error);\n      alert(&#39;Error deleting staff member: &#39; + error.message);\n    }\n  };\n\n  // Group staff by stall\n  const staffByStall = {};\n  stalls.forEach(stall =&gt; {\n    staffByStall[stall.stall_id] = staffList.filter(staff =&gt; staff.stall_id === stall.stall_id);\n  });\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Manage Staff&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Create and manage staff accounts across all stalls&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Create Staff Form */}\n        &lt;div className=\&quot;card bg-base-100 shadow-xl mb-6\&quot;&gt;\n          &lt;div className=\&quot;card-body\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Create New Staff Account&lt;/h2&gt;\n            &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\&quot;&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Full Name&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;text\&quot; placeholder=\&quot;Doe loe ritoe\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffName} onChange={(e) =&gt; setStaffName(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Email&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;email\&quot; placeholder=\&quot;staff@chickenstall.com\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffEmail} onChange={(e) =&gt; setStaffEmail(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Password&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;password\&quot; placeholder=\&quot;Secure password\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffPassword} onChange={(e) =&gt; setStaffPassword(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Stall&lt;/span&gt;&lt;/label&gt;\n                &lt;select className=\&quot;select select-bordered w-full\&quot;\n                  value={selectedStall} onChange={(e) =&gt; setSelectedStall(e.target.value)}&gt;\n                  {stalls.map(stall =&gt; (\n                    &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                      {stall.stall_name} - {stall.location}\n                    &lt;/option&gt;\n                  ))}\n                &lt;/select&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n            &lt;div className=\&quot;card-actions justify-end mt-4\&quot;&gt;\n              &lt;button className=\&quot;btn btn-error\&quot; onClick={handleCreateStaff} disabled={creating}&gt;\n                {creating ? &lt;span className=\&quot;loading loading-spinner\&quot;&gt;&lt;/span&gt; : null}\n                {creating ? &#39;Creating...&#39; : &#39;Create Account&#39;}\n              &lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Stall Cards */}\n        &lt;div className=\&quot;flex flex-wrap gap-6 items-start\&quot;&gt;\n          {stalls.map(stall =&gt; (\n            &lt;div\n              key={stall.stall_id}\n              className=\&quot;card bg-base-100 shadow-xl w-full lg:w-1/3\&quot;\n            &gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                  &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;{stall.stall_name}&lt;/h2&gt;\n                  &lt;div className=\&quot;badge badge-secondary\&quot;&gt;\n                    {staffByStall[stall.stall_id]?.length || 0} staff\n                  &lt;/div&gt;\n                &lt;/div&gt;\n                &lt;p className=\&quot;text-sm text-base-content/70 mb-3\&quot;&gt;{stall.location}&lt;/p&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  {staffByStall[stall.stall_id]?.length &gt; 0 ? (\n                    staffByStall[stall.stall_id].map(staff =&gt; (\n                      &lt;div key={staff.id} className=\&quot;flex items-center justify-between p-3 bg-base-200 rounded-lg\&quot;&gt;\n                        &lt;div&gt;\n                          &lt;div className=\&quot;font-medium\&quot;&gt;{staff.full_name}&lt;/div&gt;\n                          &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;{staff.email}&lt;/div&gt;\n                          &lt;div className={&#96;badge badge-sm ${\n                            staff.displayStatus === &#39;active&#39; \n                              ? &#39;badge-success&#39; \n                              : staff.displayStatus === &#39;unverified&#39;\n                              ? &#39;badge-warning&#39;\n                              : &#39;badge-error&#39;\n                          }&#96;}&gt;\n                            {staff.displayStatus}\n                          &lt;/div&gt;\n                        &lt;/div&gt;\n                        &lt;button className=\&quot;btn btn-sm btn-error\&quot; onClick={() =&gt; handleDeleteStaff(staff.id)}&gt;\n                          Delete\n                        &lt;/button&gt;\n                      &lt;/div&gt;\n                    ))\n                  ) : (\n                    &lt;div className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                      No staff assigned to this stall\n                    &lt;/div&gt;\n                  )}\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          ))}\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default ManageStaff;&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

Each stall card now uses `items-start` on the flex container, so cards keep independent heights and a taller card no longer stretches others in the same row.

---

_**User (2025-11-16 05:55Z)**_

please align these cards horizontally when not compressed by the screen width

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Evaluating layout adjustments**

I need to adjust the ManageStaff layout since there's too much horizontal spacing — the goal is to have three cards in a row when there's enough width. The current setup may be causing issues due to its use of flex instead of grid, which typically ensures equal column widths. If the viewport is below the lg breakpoint of 1024, that could be why the layout isn't working as expected. I think switching to a grid layout with auto-fit and minmax could help solve this!
**Considering card layout options**

I might want to use `grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3` for better alignment, but that could bring back equal heights, which they specifically asked to avoid. However, CSS grid does have auto rows that are equal height per row, and I need to remember that they're looking for more independence in card heights. It seems like the issue could be related to the internal staff list backgrounds stretching. Maybe I need to explore a solution that allows for independence while addressing their concerns!
**Adjusting card responsiveness**

With the updated flex layout, the third card wrapping to a new row at medium width is acceptable, but they want better responsiveness. I think using `w-full md:w-1/2 xl:w-1/3` will display two cards per row at medium and three at extra large widths. The screenshot shows only two, though there's enough space — maybe the container width is less than needed for three. I might need to adjust the card widths and add `flex-1 min-w-[280px] max-w-sm` for better distribution. Horizontal alignment appears to be key!
**Implementing card alignment changes**

To make minimal changes, I can use `flex flex-wrap gap-6 items-start` and add `justify-start` or `justify-between`. The key issue seems to be the width. I'll adjust each card to `flex-1 min-w-[280px] max-w-sm` instead of a fixed one-third width. This way, it'll allow three cards in a row if there's enough space; otherwise, they'll wrap. I'll implement this in the ManageStaff layout by replacing the card class line. This should lead to better horizontal alignment!</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/ManageStaff.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;51b591cf-9a49-410c-9709-709a1ff9680f&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;              &lt;div\n                key={stall.stall_id}\n-               className=\&quot;card bg-base-100 shadow-xl w-full lg:w-1/3\&quot;\n+               className=\&quot;card bg-base-100 shadow-xl flex-1 min-w-[280px] max-w-sm\&quot;\n              &gt;\n                &lt;div className=\&quot;card-body\&quot;&gt;&quot;,
        &quot;oldStart&quot;: 316,
        &quot;newStart&quot;: 316,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/ManageStaff.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase, supabaseAdmin } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\n\nfunction ManageStaff() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [creating, setCreating] = useState(false);\n  const [staffList, setStaffList] = useState([]);\n\n  // Staff creation states\n  const [staffEmail, setStaffEmail] = useState(&#39;&#39;);\n  const [staffName, setStaffName] = useState(&#39;&#39;);\n  const [staffPassword, setStaffPassword] = useState(&#39;&#39;);\n  const [selectedStall, setSelectedStall] = useState(&#39;&#39;);\n  const [stalls, setStalls] = useState([]);\n\n  // 🧠 Get logged-in user and verify admin role\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          if (profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only admins can manage staff.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // 🧩 Fetch stalls and staff\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;admin&#39;) {\n      const fetchData = async () =&gt; {\n        // Fetch stalls\n        const { data: stallsData, error: stallsError } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name, location&#39;)\n          .order(&#39;stall_name&#39;);\n\n        if (!stallsError &amp;&amp; stallsData) {\n          setStalls(stallsData);\n          if (stallsData.length &gt; 0 &amp;&amp; !selectedStall) {\n            setSelectedStall(stallsData[0].stall_id);\n          }\n        }\n\n        // Fetch staff profiles\n        const { data: staffData, error: staffError } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n          .eq(&#39;role&#39;, &#39;staff&#39;)\n          .order(&#39;full_name&#39;);\n\n        if (!staffError &amp;&amp; staffData) {\n          const staffWithVerification = await fetchStaffWithVerification(staffData);\n          setStaffList(staffWithVerification || []);\n        }\n      };\n      fetchData();\n    }\n  }, [userProfile, selectedStall]);\n\n  // Helper function to fetch staff with email verification status\n  const fetchStaffWithVerification = async (staffData) =&gt; {\n    return await Promise.all(\n      staffData.map(async (staff) =&gt; {\n        try {\n          const { data: userData, error: userError } = await supabaseAdmin.auth.admin.getUserById(staff.id);\n          \n          if (!userError &amp;&amp; userData?.user) {\n            const isEmailConfirmed = !!userData.user.email_confirmed_at;\n            \n            // If email is confirmed and status is inactive, update to active\n            if (isEmailConfirmed &amp;&amp; staff.status === &#39;inactive&#39;) {\n              await supabase\n                .from(&#39;profiles&#39;)\n                .update({ status: &#39;active&#39; })\n                .eq(&#39;id&#39;, staff.id);\n              staff.status = &#39;active&#39;;\n            }\n            \n            return {\n              ...staff,\n              displayStatus: isEmailConfirmed ? &#39;active&#39; : &#39;unverified&#39;\n            };\n          }\n          \n          return {\n            ...staff,\n            displayStatus: staff.status\n          };\n        } catch (err) {\n          console.error(&#96;Error checking email for ${staff.id}:&#96;, err);\n          return {\n            ...staff,\n            displayStatus: staff.status\n          };\n        }\n      })\n    );\n  };\n\n  // 🧱 Create new staff\n  const handleCreateStaff = async () =&gt; {\n    if (!staffEmail || !staffPassword) {\n      alert(&#39;Please fill in email and password.&#39;);\n      return;\n    }\n\n    if (userProfile.role !== &#39;admin&#39;) {\n      alert(&#39;Only admins can create staff accounts.&#39;);\n      return;\n    }\n\n    setCreating(true);\n    try {\n      const { data, error } = await supabaseAdmin.auth.admin.createUser({\n        email: staffEmail,\n        password: staffPassword,\n        email_confirm: false,\n      });\n\n      if (!error) {\n        // Send the confirmation email manually\n        await supabaseAdmin.auth.resend({\n          type: &#39;signup&#39;,\n          email: staffEmail,\n        });\n      } \n\n      if (error) throw error;\n      const newUser = data.user;\n      if (!newUser?.id) throw new Error(&#39;No user ID returned from createUser.&#39;);\n\n      // Create profile with inactive status since email is not confirmed\n      // We&#39;ll display it as &#39;unverified&#39; in the UI based on email confirmation status\n      const { error: profileError } = await supabase\n        .from(&#39;profiles&#39;)\n        .insert([{\n          id: newUser.id,\n          full_name: staffName,\n          email: staffEmail,\n          role: &#39;staff&#39;,\n          status: &#39;inactive&#39;, // Database constraint only allows &#39;active&#39; or &#39;inactive&#39;\n          stall_id: selectedStall,\n        }]);\n\n      if (profileError) throw profileError;\n\n      alert(&#39;Staff account created successfully!&#39;);\n      \n      // Reset form\n      setStaffEmail(&#39;&#39;);\n      setStaffName(&#39;&#39;);\n      setStaffPassword(&#39;&#39;);\n\n      // Refresh staff list\n      const { data: updatedStaff, error: fetchError } = await supabase\n        .from(&#39;profiles&#39;)\n        .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n        .eq(&#39;role&#39;, &#39;staff&#39;)\n        .order(&#39;full_name&#39;);\n\n      if (!fetchError &amp;&amp; updatedStaff) {\n        const staffWithVerification = await fetchStaffWithVerification(updatedStaff);\n        setStaffList(staffWithVerification || []);\n      }\n\n    } catch (error) {\n      console.error(&#39;Error creating staff:&#39;, error);\n      alert(&#39;Error creating staff account: &#39; + error.message);\n    } finally {\n      setCreating(false);\n    }\n  };\n\n  // 🗑️ Delete staff\n  const handleDeleteStaff = async (staffId) =&gt; {\n    if (!window.confirm(&#39;Are you sure you want to delete this staff member?&#39;)) {\n      return;\n    }\n\n    try {\n      const { error: profileError } = await supabase\n        .from(&#39;profiles&#39;)\n        .delete()\n        .eq(&#39;id&#39;, staffId);\n\n      if (profileError) throw profileError;\n\n      const { error: authError } = await supabaseAdmin.auth.admin.deleteUser(staffId);\n      if (authError) console.warn(&#39;Could not delete from auth.users:&#39;, authError);\n\n      alert(&#39;Staff member deleted successfully!&#39;);\n      \n      // Update staff list\n      const { data: updatedStaff } = await supabase\n        .from(&#39;profiles&#39;)\n        .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n        .eq(&#39;role&#39;, &#39;staff&#39;)\n        .order(&#39;full_name&#39;);\n      \n      if (updatedStaff) {\n        const staffWithVerification = await fetchStaffWithVerification(updatedStaff);\n        setStaffList(staffWithVerification || []);\n      }\n\n    } catch (error) {\n      console.error(&#39;Error deleting staff:&#39;, error);\n      alert(&#39;Error deleting staff member: &#39; + error.message);\n    }\n  };\n\n  // Group staff by stall\n  const staffByStall = {};\n  stalls.forEach(stall =&gt; {\n    staffByStall[stall.stall_id] = staffList.filter(staff =&gt; staff.stall_id === stall.stall_id);\n  });\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Manage Staff&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Create and manage staff accounts across all stalls&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Create Staff Form */}\n        &lt;div className=\&quot;card bg-base-100 shadow-xl mb-6\&quot;&gt;\n          &lt;div className=\&quot;card-body\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Create New Staff Account&lt;/h2&gt;\n            &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\&quot;&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Full Name&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;text\&quot; placeholder=\&quot;Doe loe ritoe\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffName} onChange={(e) =&gt; setStaffName(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Email&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;email\&quot; placeholder=\&quot;staff@chickenstall.com\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffEmail} onChange={(e) =&gt; setStaffEmail(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Password&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;password\&quot; placeholder=\&quot;Secure password\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffPassword} onChange={(e) =&gt; setStaffPassword(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Stall&lt;/span&gt;&lt;/label&gt;\n                &lt;select className=\&quot;select select-bordered w-full\&quot;\n                  value={selectedStall} onChange={(e) =&gt; setSelectedStall(e.target.value)}&gt;\n                  {stalls.map(stall =&gt; (\n                    &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                      {stall.stall_name} - {stall.location}\n                    &lt;/option&gt;\n                  ))}\n                &lt;/select&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n            &lt;div className=\&quot;card-actions justify-end mt-4\&quot;&gt;\n              &lt;button className=\&quot;btn btn-error\&quot; onClick={handleCreateStaff} disabled={creating}&gt;\n                {creating ? &lt;span className=\&quot;loading loading-spinner\&quot;&gt;&lt;/span&gt; : null}\n                {creating ? &#39;Creating...&#39; : &#39;Create Account&#39;}\n              &lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Stall Cards */}\n        &lt;div className=\&quot;flex flex-wrap gap-6 items-start\&quot;&gt;\n          {stalls.map(stall =&gt; (\n            &lt;div\n              key={stall.stall_id}\n              className=\&quot;card bg-base-100 shadow-xl flex-1 min-w-[280px] max-w-sm\&quot;\n            &gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                  &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;{stall.stall_name}&lt;/h2&gt;\n                  &lt;div className=\&quot;badge badge-secondary\&quot;&gt;\n                    {staffByStall[stall.stall_id]?.length || 0} staff\n                  &lt;/div&gt;\n                &lt;/div&gt;\n                &lt;p className=\&quot;text-sm text-base-content/70 mb-3\&quot;&gt;{stall.location}&lt;/p&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  {staffByStall[stall.stall_id]?.length &gt; 0 ? (\n                    staffByStall[stall.stall_id].map(staff =&gt; (\n                      &lt;div key={staff.id} className=\&quot;flex items-center justify-between p-3 bg-base-200 rounded-lg\&quot;&gt;\n                        &lt;div&gt;\n                          &lt;div className=\&quot;font-medium\&quot;&gt;{staff.full_name}&lt;/div&gt;\n                          &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;{staff.email}&lt;/div&gt;\n                          &lt;div className={&#96;badge badge-sm ${\n                            staff.displayStatus === &#39;active&#39; \n                              ? &#39;badge-success&#39; \n                              : staff.displayStatus === &#39;unverified&#39;\n                              ? &#39;badge-warning&#39;\n                              : &#39;badge-error&#39;\n                          }&#96;}&gt;\n                            {staff.displayStatus}\n                          &lt;/div&gt;\n                        &lt;/div&gt;\n                        &lt;button className=\&quot;btn btn-sm btn-error\&quot; onClick={() =&gt; handleDeleteStaff(staff.id)}&gt;\n                          Delete\n                        &lt;/button&gt;\n                      &lt;/div&gt;\n                    ))\n                  ) : (\n                    &lt;div className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                      No staff assigned to this stall\n                    &lt;/div&gt;\n                  )}\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          ))}\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default ManageStaff;&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

The staff stall cards now use a flexible width (`flex-1 min-w-[280px] max-w-sm` in a `flex flex-wrap` container), so they line up horizontally as many per row as the screen width allows, while still wrapping cleanly on smaller screens and keeping independent heights.

---

_**User (2025-11-16 05:55Z)**_

match the widths, theyre not aligning, but also dont break the height adjusting logic of the cards, thats what i want

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Adjusting layout for card sizes**

I need to ensure that the ManageStaff stall cards have equal widths but maintain independent heights. Right now, using flex with flex-1 causes the width to change based on content or screen size. So, I’m considering using CSS grid again. If I set `align-items: start`, it prevents equal height stretching. Alternatively, I could stick with flex and set a fixed basis, but the grid solution seems easier. Using `grid-cols` will certainly give me the layout I want!
**Revising grid layout**

Earlier, I used the grid setup with `grid grid-cols-1 lg:grid-cols-3 gap-6`, but that meant all cards had equal heights because of the default `align-items: stretch`. To change that, I’ll switch to `grid items-start`, which prevents equal height. So, I need to revert the container `div` back to grid with this new setting, and for the card `div`, I’ll keep it simple without any width classes. Time to implement this patch!</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/ManageStaff.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;100c3453-019a-47bb-aa9c-c0ed7b3d50b3&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  \n          {/* Stall Cards */}\n-         &lt;div className=\&quot;flex flex-wrap gap-6 items-start\&quot;&gt;\n+         &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-start\&quot;&gt;\n            {stalls.map(stall =&gt; (\n              &lt;div\n                key={stall.stall_id}\n-               className=\&quot;card bg-base-100 shadow-xl flex-1 min-w-[280px] max-w-sm\&quot;\n+               className=\&quot;card bg-base-100 shadow-xl\&quot;\n              &gt;\n                &lt;div className=\&quot;card-body\&quot;&gt;&quot;,
        &quot;oldStart&quot;: 312,
        &quot;newStart&quot;: 312,
        &quot;oldLines&quot;: 9,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 2,
        &quot;linesAdded&quot;: 2
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/ManageStaff.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase, supabaseAdmin } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\n\nfunction ManageStaff() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [creating, setCreating] = useState(false);\n  const [staffList, setStaffList] = useState([]);\n\n  // Staff creation states\n  const [staffEmail, setStaffEmail] = useState(&#39;&#39;);\n  const [staffName, setStaffName] = useState(&#39;&#39;);\n  const [staffPassword, setStaffPassword] = useState(&#39;&#39;);\n  const [selectedStall, setSelectedStall] = useState(&#39;&#39;);\n  const [stalls, setStalls] = useState([]);\n\n  // 🧠 Get logged-in user and verify admin role\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          if (profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only admins can manage staff.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // 🧩 Fetch stalls and staff\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;admin&#39;) {\n      const fetchData = async () =&gt; {\n        // Fetch stalls\n        const { data: stallsData, error: stallsError } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name, location&#39;)\n          .order(&#39;stall_name&#39;);\n\n        if (!stallsError &amp;&amp; stallsData) {\n          setStalls(stallsData);\n          if (stallsData.length &gt; 0 &amp;&amp; !selectedStall) {\n            setSelectedStall(stallsData[0].stall_id);\n          }\n        }\n\n        // Fetch staff profiles\n        const { data: staffData, error: staffError } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n          .eq(&#39;role&#39;, &#39;staff&#39;)\n          .order(&#39;full_name&#39;);\n\n        if (!staffError &amp;&amp; staffData) {\n          const staffWithVerification = await fetchStaffWithVerification(staffData);\n          setStaffList(staffWithVerification || []);\n        }\n      };\n      fetchData();\n    }\n  }, [userProfile, selectedStall]);\n\n  // Helper function to fetch staff with email verification status\n  const fetchStaffWithVerification = async (staffData) =&gt; {\n    return await Promise.all(\n      staffData.map(async (staff) =&gt; {\n        try {\n          const { data: userData, error: userError } = await supabaseAdmin.auth.admin.getUserById(staff.id);\n          \n          if (!userError &amp;&amp; userData?.user) {\n            const isEmailConfirmed = !!userData.user.email_confirmed_at;\n            \n            // If email is confirmed and status is inactive, update to active\n            if (isEmailConfirmed &amp;&amp; staff.status === &#39;inactive&#39;) {\n              await supabase\n                .from(&#39;profiles&#39;)\n                .update({ status: &#39;active&#39; })\n                .eq(&#39;id&#39;, staff.id);\n              staff.status = &#39;active&#39;;\n            }\n            \n            return {\n              ...staff,\n              displayStatus: isEmailConfirmed ? &#39;active&#39; : &#39;unverified&#39;\n            };\n          }\n          \n          return {\n            ...staff,\n            displayStatus: staff.status\n          };\n        } catch (err) {\n          console.error(&#96;Error checking email for ${staff.id}:&#96;, err);\n          return {\n            ...staff,\n            displayStatus: staff.status\n          };\n        }\n      })\n    );\n  };\n\n  // 🧱 Create new staff\n  const handleCreateStaff = async () =&gt; {\n    if (!staffEmail || !staffPassword) {\n      alert(&#39;Please fill in email and password.&#39;);\n      return;\n    }\n\n    if (userProfile.role !== &#39;admin&#39;) {\n      alert(&#39;Only admins can create staff accounts.&#39;);\n      return;\n    }\n\n    setCreating(true);\n    try {\n      const { data, error } = await supabaseAdmin.auth.admin.createUser({\n        email: staffEmail,\n        password: staffPassword,\n        email_confirm: false,\n      });\n\n      if (!error) {\n        // Send the confirmation email manually\n        await supabaseAdmin.auth.resend({\n          type: &#39;signup&#39;,\n          email: staffEmail,\n        });\n      } \n\n      if (error) throw error;\n      const newUser = data.user;\n      if (!newUser?.id) throw new Error(&#39;No user ID returned from createUser.&#39;);\n\n      // Create profile with inactive status since email is not confirmed\n      // We&#39;ll display it as &#39;unverified&#39; in the UI based on email confirmation status\n      const { error: profileError } = await supabase\n        .from(&#39;profiles&#39;)\n        .insert([{\n          id: newUser.id,\n          full_name: staffName,\n          email: staffEmail,\n          role: &#39;staff&#39;,\n          status: &#39;inactive&#39;, // Database constraint only allows &#39;active&#39; or &#39;inactive&#39;\n          stall_id: selectedStall,\n        }]);\n\n      if (profileError) throw profileError;\n\n      alert(&#39;Staff account created successfully!&#39;);\n      \n      // Reset form\n      setStaffEmail(&#39;&#39;);\n      setStaffName(&#39;&#39;);\n      setStaffPassword(&#39;&#39;);\n\n      // Refresh staff list\n      const { data: updatedStaff, error: fetchError } = await supabase\n        .from(&#39;profiles&#39;)\n        .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n        .eq(&#39;role&#39;, &#39;staff&#39;)\n        .order(&#39;full_name&#39;);\n\n      if (!fetchError &amp;&amp; updatedStaff) {\n        const staffWithVerification = await fetchStaffWithVerification(updatedStaff);\n        setStaffList(staffWithVerification || []);\n      }\n\n    } catch (error) {\n      console.error(&#39;Error creating staff:&#39;, error);\n      alert(&#39;Error creating staff account: &#39; + error.message);\n    } finally {\n      setCreating(false);\n    }\n  };\n\n  // 🗑️ Delete staff\n  const handleDeleteStaff = async (staffId) =&gt; {\n    if (!window.confirm(&#39;Are you sure you want to delete this staff member?&#39;)) {\n      return;\n    }\n\n    try {\n      const { error: profileError } = await supabase\n        .from(&#39;profiles&#39;)\n        .delete()\n        .eq(&#39;id&#39;, staffId);\n\n      if (profileError) throw profileError;\n\n      const { error: authError } = await supabaseAdmin.auth.admin.deleteUser(staffId);\n      if (authError) console.warn(&#39;Could not delete from auth.users:&#39;, authError);\n\n      alert(&#39;Staff member deleted successfully!&#39;);\n      \n      // Update staff list\n      const { data: updatedStaff } = await supabase\n        .from(&#39;profiles&#39;)\n        .select(&#39;id, full_name, email, role, status, stall_id&#39;)\n        .eq(&#39;role&#39;, &#39;staff&#39;)\n        .order(&#39;full_name&#39;);\n      \n      if (updatedStaff) {\n        const staffWithVerification = await fetchStaffWithVerification(updatedStaff);\n        setStaffList(staffWithVerification || []);\n      }\n\n    } catch (error) {\n      console.error(&#39;Error deleting staff:&#39;, error);\n      alert(&#39;Error deleting staff member: &#39; + error.message);\n    }\n  };\n\n  // Group staff by stall\n  const staffByStall = {};\n  stalls.forEach(stall =&gt; {\n    staffByStall[stall.stall_id] = staffList.filter(staff =&gt; staff.stall_id === stall.stall_id);\n  });\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Manage Staff&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Create and manage staff accounts across all stalls&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Create Staff Form */}\n        &lt;div className=\&quot;card bg-base-100 shadow-xl mb-6\&quot;&gt;\n          &lt;div className=\&quot;card-body\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Create New Staff Account&lt;/h2&gt;\n            &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\&quot;&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Full Name&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;text\&quot; placeholder=\&quot;Doe loe ritoe\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffName} onChange={(e) =&gt; setStaffName(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Email&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;email\&quot; placeholder=\&quot;staff@chickenstall.com\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffEmail} onChange={(e) =&gt; setStaffEmail(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Password&lt;/span&gt;&lt;/label&gt;\n                &lt;input type=\&quot;password\&quot; placeholder=\&quot;Secure password\&quot; className=\&quot;input input-bordered w-full\&quot;\n                  value={staffPassword} onChange={(e) =&gt; setStaffPassword(e.target.value)} /&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;form-control\&quot;&gt;\n                &lt;label className=\&quot;label\&quot;&gt;&lt;span className=\&quot;label-text\&quot;&gt;Stall&lt;/span&gt;&lt;/label&gt;\n                &lt;select className=\&quot;select select-bordered w-full\&quot;\n                  value={selectedStall} onChange={(e) =&gt; setSelectedStall(e.target.value)}&gt;\n                  {stalls.map(stall =&gt; (\n                    &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                      {stall.stall_name} - {stall.location}\n                    &lt;/option&gt;\n                  ))}\n                &lt;/select&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n            &lt;div className=\&quot;card-actions justify-end mt-4\&quot;&gt;\n              &lt;button className=\&quot;btn btn-error\&quot; onClick={handleCreateStaff} disabled={creating}&gt;\n                {creating ? &lt;span className=\&quot;loading loading-spinner\&quot;&gt;&lt;/span&gt; : null}\n                {creating ? &#39;Creating...&#39; : &#39;Create Account&#39;}\n              &lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Stall Cards */}\n        &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-start\&quot;&gt;\n          {stalls.map(stall =&gt; (\n            &lt;div\n              key={stall.stall_id}\n              className=\&quot;card bg-base-100 shadow-xl\&quot;\n            &gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                  &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;{stall.stall_name}&lt;/h2&gt;\n                  &lt;div className=\&quot;badge badge-secondary\&quot;&gt;\n                    {staffByStall[stall.stall_id]?.length || 0} staff\n                  &lt;/div&gt;\n                &lt;/div&gt;\n                &lt;p className=\&quot;text-sm text-base-content/70 mb-3\&quot;&gt;{stall.location}&lt;/p&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  {staffByStall[stall.stall_id]?.length &gt; 0 ? (\n                    staffByStall[stall.stall_id].map(staff =&gt; (\n                      &lt;div key={staff.id} className=\&quot;flex items-center justify-between p-3 bg-base-200 rounded-lg\&quot;&gt;\n                        &lt;div&gt;\n                          &lt;div className=\&quot;font-medium\&quot;&gt;{staff.full_name}&lt;/div&gt;\n                          &lt;div className=\&quot;text-sm text-base-content/70\&quot;&gt;{staff.email}&lt;/div&gt;\n                          &lt;div className={&#96;badge badge-sm ${\n                            staff.displayStatus === &#39;active&#39; \n                              ? &#39;badge-success&#39; \n                              : staff.displayStatus === &#39;unverified&#39;\n                              ? &#39;badge-warning&#39;\n                              : &#39;badge-error&#39;\n                          }&#96;}&gt;\n                            {staff.displayStatus}\n                          &lt;/div&gt;\n                        &lt;/div&gt;\n                        &lt;button className=\&quot;btn btn-sm btn-error\&quot; onClick={() =&gt; handleDeleteStaff(staff.id)}&gt;\n                          Delete\n                        &lt;/button&gt;\n                      &lt;/div&gt;\n                    ))\n                  ) : (\n                    &lt;div className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                      No staff assigned to this stall\n                    &lt;/div&gt;\n                  )}\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          ))}\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default ManageStaff;&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

The stall cards now use a responsive CSS grid (`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-start`), so all cards have matching widths per row while `items-start` prevents row stretching—each card keeps its own height based on its content.

---

_**User (2025-11-16 05:55Z)**_

fix the responsiveness of the screen sizes

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Improving responsiveness for staff management**

The user wants a responsive layout for the Manage Staff screen, focusing on cards and a create form. The current grid setup works, but I think we need better breakpoints for smaller widths. The create form might be too wide on small screens, so I should adjust the grid there. Users likely want cards to wrap better below 1200 pixels. I’ll also consider adding padding to avoid horizontal scrolling. I'll communicate what we've implemented and ask for specific breakpoint issues they want addressed.
**Confirming layout improvements**

I’ll describe the current improvements, highlighting that the layout is now responsive with options for 1, 2, or 3 columns. I want to encourage feedback on any specific breakpoint issues they might notice regarding the width. It’s essential for me to understand if they have particular concerns, so I’m ready to address those directly. Since we’re not making any more tool calls right now, I’ll focus on ensuring clarity and responsiveness in our communication.</details></think>

---

### What I’ve done for responsiveness on Manage Staff

- **Stall cards layout**
  - The stall list now uses a responsive grid:
    - `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-start`
  - Behavior by screen width:
    - Small screens: **1 card per row** (full-width).
    - Medium screens (tablets / small laptops): **2 cards per row**.
    - Large screens: **3 cards per row**.
  - `items-start` keeps **each card’s height independent**, so a tall card no longer stretches others.

- **Create Staff form**
  - The form already uses `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4`, so inputs stack on mobile, move to 2-wide on medium, and 4-wide on desktop, preventing horizontal scroll.

If you’re still seeing issues at a particular width (e.g., a specific laptop or tablet size), tell me roughly the pixel width or device and I can fine‑tune the breakpoints (for example, adjusting to `sm`, `xl`, or `2xl` variants or constraining the container with a `max-w` for better centering).

---

_**User (2025-11-16 05:55Z)**_

so it already has the appropriate responsive design for general devices?

---

_**Agent (model default, mode Agent)**_



---

Yes, with the current setup it’s well‑covered for general devices:

- **Mobile phones**: 1 stall card per row; create‑staff form fields stack vertically.
- **Tablets / small laptops**: 2 stall cards per row; form fields in 2 columns.
- **Desktops / large screens**: 3 stall cards per row; form fields in 4 columns.

That’s a solid, standard responsive layout. If you later target a very specific device (e.g., ultra‑wide monitor or tiny phone), we can fine‑tune breakpoints, but you’re in good shape for typical screen sizes.

---

_**User (2025-11-16 05:55Z)**_

Change reports dashboards to History Reports

also, manage Inventory should show Manage Inventory Header.  



the quick actions tab should have white background for each buttons when it is active. this should be true for staff as well.

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Implementing UI changes**

I'm focusing on modifying text changes and active sidebar styles. Since we're in execution mode, I need to edit the header text in Reports.jsx and for ManageStocks. I'll also adjust the sidebar to show active styling based on the route or possibly the user's role. I should take a closer look at the files to ensure everything is done correctly. Let's get this UI rolling!</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/Reports.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/ManageStocks.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/components/Sidebar.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Implementing button styles**

I’m thinking about simplifying base classes for the buttons, using a common style when active, with a colored variant otherwise. I'm considering whether to maintain color on the left border too. 

For detecting active paths, I’ll create a utility function using `useLocation()`. This will help compute styles based on the current path. For each button, I’ll manage class names, ensuring the disabled state doesn’t conflict with users' roles, especially for admin-only routes. I’ll also check for any unused imports.</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;0cc9b6c5-ba1f-4053-ae16-c124a0aec469&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;        &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n          &lt;div className=\&quot;mb-6\&quot;&gt;\n-           &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n-           &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n+           &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;History Reports&lt;/h1&gt;\n+           &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and historical performance metrics&lt;/p&gt;\n          &lt;/div&gt;\n  &quot;,
        &quot;oldStart&quot;: 674,
        &quot;newStart&quot;: 674,
        &quot;oldLines&quot;: 6,
        &quot;newLines&quot;: 6,
        &quot;linesRemoved&quot;: 2,
        &quot;linesAdded&quot;: 2
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  const [stockHistory, setStockHistory] = useState([]);\n  const [activityHistory, setActivityHistory] = useState([]);\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [stockHistoryFilters, setStockHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [activityHistoryFilters, setActivityHistoryFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Menu items (for editing transaction item / price)\n  const [menuItems, setMenuItems] = useState([]);\n\n  // Helper: apply a date (and optional stall) range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    // Sales overview uses only dates\n    setSalesDateRange({\n      startDate: range.startDate,\n      endDate: range.endDate,\n    });\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setStockHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n    setActivityHistoryFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n      ...(typeof range.stallId !== &#39;undefined&#39; ? { stallId: range.stallId } : {}),\n    }));\n  };\n  \n  // Editing states (admin-only editing via modals)\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editingStockHistory, setEditingStockHistory] = useState(null);\n  const [editingActivityHistory, setEditingActivityHistory] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n\n    const loadMenuItems = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;menu_items&#39;)\n          .select(&#39;item_id, item_name, price&#39;)\n          .order(&#39;item_name&#39;, { ascending: true });\n        if (error) throw error;\n        setMenuItems(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading menu items:&#39;, err);\n      }\n    };\n\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n      loadMenuItems();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters, stockHistoryFilters, activityHistoryFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics(),\n        loadStockHistory(),\n        loadActivityHistory(),\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          if (expensesFilters.stallId === &#39;__none__&#39;) {\n            query = query.is(&#39;stall_id&#39;, null);\n          } else {\n            query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n          }\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Load stock history (admin only)\n  const loadStockHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setStockHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stock_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          stock_level,\n          stock_status,\n          date,\n          created_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (stockHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, stockHistoryFilters.startDate);\n      }\n      if (stockHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, stockHistoryFilters.endDate);\n      }\n      if (stockHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, stockHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;stall_id&#39;, { ascending: true })\n        .limit(150);\n\n      if (error) throw error;\n      setStockHistory(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading stock history:&#39;, err);\n    }\n  };\n\n  // Load activity history (admin only)\n  const loadActivityHistory = async () =&gt; {\n    if (userProfile?.role !== &#39;admin&#39;) {\n      setActivityHistory([]);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from(&#39;stall_status_history&#39;)\n        .select(&#96;\n          id,\n          stall_id,\n          status,\n          date,\n          changed_at,\n          stalls(stall_name)\n        &#96;);\n\n      if (activityHistoryFilters.startDate) {\n        query = query.gte(&#39;date&#39;, activityHistoryFilters.startDate);\n      }\n      if (activityHistoryFilters.endDate) {\n        query = query.lte(&#39;date&#39;, activityHistoryFilters.endDate);\n      }\n      if (activityHistoryFilters.stallId) {\n        query = query.eq(&#39;stall_id&#39;, activityHistoryFilters.stallId);\n      }\n\n      const { data, error } = await query\n        .order(&#39;date&#39;, { ascending: false })\n        .order(&#39;changed_at&#39;, { ascending: false })\n        .limit(500);\n\n      if (error) throw error;\n\n      // Reduce to one row per (stall_id, date) with latest changed_at\n      const latestByStallAndDate = {};\n      data?.forEach((row) =&gt; {\n        const key = &#96;${row.stall_id}-${row.date}&#96;;\n        if (!latestByStallAndDate[key]) {\n          latestByStallAndDate[key] = row;\n        }\n      });\n\n      setActivityHistory(Object.values(latestByStallAndDate));\n    } catch (err) {\n      console.error(&#39;Error loading activity history:&#39;, err);\n    }\n  };\n\n  // Edit transaction (sales record)\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit stock history (stock_status_history)\n  const handleEditStockHistory = async () =&gt; {\n    if (!editingStockHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      // Combine separate date and time fields into a single timestamp for created_at\n      let createdAt = editingStockHistory.created_at;\n      if (editingStockHistory.date &amp;&amp; editingStockHistory.time) {\n        const isoString = &#96;${editingStockHistory.date}T${editingStockHistory.time}:00&#96;;\n        createdAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stock_status_history&#39;)\n        .update({\n          date: editingStockHistory.date,\n          stock_level: editingStockHistory.stock_level,\n          stock_status: editingStockHistory.stock_status,\n          stall_id: editingStockHistory.stall_id,\n          created_at: createdAt,\n        })\n        .eq(&#39;id&#39;, editingStockHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Stock history record updated successfully.&#39;);\n      setEditingStockHistory(null);\n      loadStockHistory();\n    } catch (err) {\n      setError(&#39;Failed to update stock history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit activity history (stall_status_history)\n  const handleEditActivityHistory = async () =&gt; {\n    if (!editingActivityHistory) return;\n\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n\n    try {\n      let changedAt = editingActivityHistory.changed_at;\n      if (editingActivityHistory.date &amp;&amp; editingActivityHistory.time) {\n        const isoString = &#96;${editingActivityHistory.date}T${editingActivityHistory.time}:00&#96;;\n        changedAt = new Date(isoString).toISOString();\n      }\n\n      const { error } = await supabase\n        .from(&#39;stall_status_history&#39;)\n        .update({\n          date: editingActivityHistory.date,\n          status: editingActivityHistory.status,\n          stall_id: editingActivityHistory.stall_id,\n          changed_at: changedAt,\n        })\n        .eq(&#39;id&#39;, editingActivityHistory.id);\n\n      if (error) throw error;\n\n      setSuccess(&#39;Activity history record updated successfully.&#39;);\n      setEditingActivityHistory(null);\n      loadActivityHistory();\n    } catch (err) {\n      setError(&#39;Failed to update activity history record: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;History Reports&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and historical performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date and stall filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date and Stall Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down further.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={globalDateRange.stallId}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          stallId: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                    &lt;tr&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Item&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Amount&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Payment&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr\n                        key={transaction.sale_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          const currentMenuItem =\n                            menuItems.find((mi) =&gt; mi.item_id === transaction.product_id) || null;\n                          const inferredUnitPrice =\n                            currentMenuItem?.price ??\n                            transaction.menu_items?.price ??\n                            (transaction.quantity_sold\n                              ? transaction.total_amount / transaction.quantity_sold\n                              : 0);\n                          setEditingTransaction({\n                            ...transaction,\n                            sale_date: transaction.sale_date?.slice(0, 10) || &#39;&#39;,\n                            product_id: transaction.product_id || currentMenuItem?.item_id || &#39;&#39;,\n                            unit_price: inferredUnitPrice,\n                          });\n                        }}\n                      &gt;\n                        &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                        &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                        &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;\n                          &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                            {transaction.payment_method}\n                          &lt;/span&gt;\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      &lt;option value=\&quot;__none__\&quot;&gt;Non-affiliated (No Stall)&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                    &lt;tr&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Name&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Qty&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Cost&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                      &lt;th className=\&quot;bg-base-100\&quot;&gt;Supplier&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr\n                        key={expense.expense_id}\n                        className={userProfile?.role === &#39;admin&#39; ? &#39;hover cursor-pointer&#39; : &#39;&#39;}\n                        onClick={() =&gt; {\n                          if (userProfile?.role !== &#39;admin&#39;) return;\n                          setEditingExpense({\n                            ...expense,\n                            date: expense.date?.slice(0, 10) || &#39;&#39;,\n                          });\n                        }}\n                      &gt;\n                        &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                        &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                        &lt;td&gt;{expense.date}&lt;/td&gt;\n                        &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                        &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;6\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Third Row - History cards (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\&quot;&gt;\n            {/* Stock History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Stock History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stock levels and sold-out status per stall.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={stockHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={stockHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStockHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStockHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                      &lt;tr&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Time&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Stock Level&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {stockHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.created_at\n                              ? new Date(row.created_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingStockHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.created_at ? new Date(row.created_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;{row.stock_level ?? &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.stock_status === &#39;sold_out&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.stock_status === &#39;not_sold_out&#39;\n                                  ? &#39;badge-success&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.stock_status === &#39;sold_out&#39;\n                                ? &#39;Sold Out&#39;\n                                : row.stock_status === &#39;not_sold_out&#39;\n                                ? &#39;Not Sold Out&#39;\n                                : row.stock_status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {stockHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No stock history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            {/* Activity History */}\n            &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;div className=\&quot;flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4\&quot;&gt;\n                  &lt;div&gt;\n                    &lt;h2 className=\&quot;card-title text-secondary\&quot;&gt;Activity History&lt;/h2&gt;\n                    &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                      Daily stall activity based on Manage Inventory status changes.\n                    &lt;/p&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={activityHistoryFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={activityHistoryFilters.stallId}\n                      onChange={(e) =&gt;\n                        setActivityHistoryFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setActivityHistoryFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                    &lt;thead className=\&quot;sticky top-0 z-10 bg-base-100\&quot;&gt;\n                      &lt;tr&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Date&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Time&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Stall&lt;/th&gt;\n                        &lt;th className=\&quot;bg-base-100\&quot;&gt;Status&lt;/th&gt;\n                      &lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                      {activityHistory.map((row) =&gt; (\n                        &lt;tr\n                          key={row.id}\n                          className=\&quot;hover cursor-pointer\&quot;\n                          onClick={() =&gt; {\n                            const dateStr = row.date\n                              ? new Date(row.date).toISOString().slice(0, 10)\n                              : &#39;&#39;;\n                            const timeStr = row.changed_at\n                              ? new Date(row.changed_at).toTimeString().slice(0, 5)\n                              : &#39;&#39;;\n                            setEditingActivityHistory({\n                              ...row,\n                              date: dateStr,\n                              time: timeStr,\n                            });\n                          }}\n                        &gt;\n                          &lt;td&gt;{new Date(row.date).toLocaleDateString()}&lt;/td&gt;\n                          &lt;td&gt;{row.changed_at ? new Date(row.changed_at).toLocaleTimeString() : &#39;N/A&#39;}&lt;/td&gt;\n                          &lt;td&gt;{row.stalls?.stall_name || &#96;Stall ${row.stall_id}&#96;}&lt;/td&gt;\n                          &lt;td&gt;\n                            &lt;span\n                              className={&#96;badge ${\n                                row.status === &#39;active&#39;\n                                  ? &#39;badge-success&#39;\n                                  : row.status === &#39;inactive&#39;\n                                  ? &#39;badge-error&#39;\n                                  : row.status === &#39;under maintenance&#39;\n                                  ? &#39;badge-warning&#39;\n                                  : &#39;badge-neutral&#39;\n                              }&#96;}\n                            &gt;\n                              {row.status || &#39;Unknown&#39;}\n                            &lt;/span&gt;\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      ))}\n                      {activityHistory.length === 0 &amp;&amp; (\n                        &lt;tr&gt;\n                          &lt;td colSpan=\&quot;4\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                            No activity history records found\n                          &lt;/td&gt;\n                        &lt;/tr&gt;\n                      )}\n                    &lt;/tbody&gt;\n                  &lt;/table&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Edit Modals (admin only) */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingTransaction &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Transaction&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.sale_date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, sale_date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({ ...prev, stall_id: e.target.value }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Item&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.product_id || &#39;&#39;}\n                    onChange={(e) =&gt; {\n                      const nextItemId = e.target.value;\n                      const nextItem =\n                        menuItems.find((mi) =&gt; String(mi.item_id) === String(nextItemId)) || null;\n                      if (!nextItem) {\n                        setEditingTransaction((prev) =&gt; ({\n                          ...prev,\n                          product_id: nextItemId,\n                        }));\n                        return;\n                      }\n                      const qty = Number(editingTransaction.quantity_sold) || 0;\n                      const nextUnitPrice = Number(nextItem.price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        product_id: nextItem.item_id,\n                        unit_price: nextUnitPrice,\n                        total_amount: qty * nextUnitPrice,\n                        menu_items: {\n                          ...(prev.menu_items || {}),\n                          item_name: nextItem.item_name,\n                          price: nextUnitPrice,\n                        },\n                      }));\n                    }}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;Select item&lt;/option&gt;\n                    {menuItems.map((item) =&gt; (\n                      &lt;option key={item.item_id} value={item.item_id}&gt;\n                        {item.item_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.quantity_sold}\n                    min=\&quot;1\&quot;\n                    onChange={(e) =&gt; {\n                      const qty = Number(e.target.value) || 0;\n                      const price = Number(editingTransaction.unit_price) || 0;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        quantity_sold: qty,\n                        total_amount: qty * price,\n                      }));\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Amount&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingTransaction.total_amount}\n                    readOnly\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Payment Method&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingTransaction.payment_method}\n                    onChange={(e) =&gt;\n                      setEditingTransaction((prev) =&gt; ({\n                        ...prev,\n                        payment_method: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                    &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditTransaction(editingTransaction, editingTransaction)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingTransaction(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingExpense &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Expense&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Name&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.expense_name}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, expense_name: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Quantity&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.quantity || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, quantity: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Cost&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.cost}\n                    min=\&quot;0\&quot;\n                    step=\&quot;0.01\&quot;\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, cost: Number(e.target.value) }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingExpense.stall_id || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value || null,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Supplier&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;text\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingExpense.supplier_name || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingExpense((prev) =&gt; ({\n                        ...prev,\n                        supplier_name: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={() =&gt; handleEditExpense(editingExpense, editingExpense)}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingExpense(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingStockHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Stock History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, date: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({ ...prev, time: e.target.value }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stock Level&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;number\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingStockHistory.stock_level ?? &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_level: Number(e.target.value),\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control md:col-span-2\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingStockHistory.stock_status}\n                    onChange={(e) =&gt;\n                      setEditingStockHistory((prev) =&gt; ({\n                        ...prev,\n                        stock_status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;sold_out\&quot;&gt;Sold Out&lt;/option&gt;\n                    &lt;option value=\&quot;not_sold_out\&quot;&gt;Not Sold Out&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditStockHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingStockHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; editingActivityHistory &amp;&amp; (\n          &lt;div className=\&quot;modal modal-open\&quot;&gt;\n            &lt;div className=\&quot;modal-box max-w-3xl\&quot;&gt;\n              &lt;h3 className=\&quot;font-bold text-lg mb-4\&quot;&gt;Edit Activity History&lt;/h3&gt;\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-2 gap-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.date || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        date: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Time&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;time\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={editingActivityHistory.time || &#39;&#39;}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        time: e.target.value,\n                      }))\n                    }\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.stall_id}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        stall_id: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Status&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={editingActivityHistory.status}\n                    onChange={(e) =&gt;\n                      setEditingActivityHistory((prev) =&gt; ({\n                        ...prev,\n                        status: e.target.value,\n                      }))\n                    }\n                  &gt;\n                    &lt;option value=\&quot;active\&quot;&gt;active&lt;/option&gt;\n                    &lt;option value=\&quot;inactive\&quot;&gt;inactive&lt;/option&gt;\n                    &lt;option value=\&quot;under maintenance\&quot;&gt;under maintenance&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;modal-action\&quot;&gt;\n                &lt;button\n                  className=\&quot;btn btn-primary btn-sm\&quot;\n                  onClick={handleEditActivityHistory}\n                  disabled={editLoading}\n                &gt;\n                  Save\n                &lt;/button&gt;\n                &lt;button\n                  className=\&quot;btn btn-ghost btn-sm\&quot;\n                  onClick={() =&gt; setEditingActivityHistory(null)}\n                  disabled={editLoading}\n                &gt;\n                  Cancel\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/ManageStocks.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;112b3bc0-14d7-40fe-a9f5-1300448b44f9&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;      &lt;Layout userProfile={profile}&gt;\n        &lt;div className=\&quot;container mx-auto p-6 space-y-6\&quot;&gt;\n+         &lt;div className=\&quot;mb-4\&quot;&gt;\n+           &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-1\&quot;&gt;Manage Inventory&lt;/h1&gt;\n+           &lt;p className=\&quot;text-base-content/70\&quot;&gt;\n+             Monitor chicken stocks, adjust menu prices, and review inventory expenses.\n+           &lt;/p&gt;\n+         &lt;/div&gt;\n          &lt;ChickenStocksAndStallStatus /&gt;\n          &lt;EditMenuPrices /&gt;&quot;,
        &quot;oldStart&quot;: 61,
        &quot;newStart&quot;: 61,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 10,
        &quot;linesAdded&quot;: 6
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/ManageStocks.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;// src/ManageInventory.jsx\nimport { useEffect, useMemo, useState } from &#39;react&#39;\nimport { useNavigate } from &#39;react-router-dom&#39;\nimport { supabase } from &#39;./supabaseClient&#39;\nimport { useAuth } from &#39;./hooks/useAuth&#39;\nimport Layout from &#39;./components/Layout&#39;\n\nimport ChickenStocksAndStallStatus from &#39;./components/admin/ChickenStocksAndStallStatus&#39;\nimport EditMenuPrices from &#39;./components/admin/EditMenuPrices&#39;\nimport ExpensesOverview from &#39;./components/admin/ExpensesOverview&#39;\n\nasync function fetchUserProfile(userId) {\n  const { data, error } = await supabase\n    .from(&#39;profiles&#39;)\n    .select(&#39;role, full_name, stall_id, status&#39;)\n    .eq(&#39;id&#39;, userId)\n    .single()\n  if (error) throw error\n  return data\n}\n\nexport default function ManageInventory() {\n  const navigate = useNavigate()\n  const { user, loading: authLoading } = useAuth()\n  const [profile, setProfile] = useState(null)\n\n  const canAccess = useMemo(() =&gt; profile?.role === &#39;admin&#39;, [profile])\n\n  useEffect(() =&gt; {\n    let isMounted = true\n    async function loadProfile() {\n      if (!user) return\n      try {\n        const p = await fetchUserProfile(user.id)\n        if (isMounted) setProfile(p)\n      } catch (err) {\n        console.error(&#39;Failed to load profile in ManageInventory:&#39;, err)\n      }\n    }\n    loadProfile()\n    return () =&gt; {\n      isMounted = false\n    }\n  }, [user])\n\n  if (authLoading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    )\n  }\n\n  if (profile &amp;&amp; profile.role !== &#39;admin&#39;) {\n    alert(&#39;Access denied. Only admins can manage inventory.&#39;)\n    navigate(&#39;/dashboard&#39;)\n    return null\n  }\n\n  return (\n    &lt;Layout userProfile={profile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6 space-y-6\&quot;&gt;\n        &lt;div className=\&quot;mb-4\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-1\&quot;&gt;Manage Inventory&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;\n            Monitor chicken stocks, adjust menu prices, and review inventory expenses.\n          &lt;/p&gt;\n        &lt;/div&gt;\n        &lt;ChickenStocksAndStallStatus /&gt;\n        &lt;EditMenuPrices /&gt;\n        &lt;ExpensesOverview /&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  )\n}\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/components/Sidebar.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;abaaa9dc-cc22-4b5a-91fa-4409de9d1735&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;- import { useNavigate } from &#39;react-router-dom&#39;;\n+ import { useNavigate, useLocation } from &#39;react-router-dom&#39;;\n  import { supabase } from &#39;../supabaseClient&#39;;\n  import { canManageUsers, canViewReports, canManageStock, canManageSales, canViewPointOfSales, isStaff } from &#39;../utils/roleUtils&#39;;\n  \n  function Sidebar({ userProfile, onLogout }) {\n      const navigate = useNavigate();\n+     const location = useLocation();\n  \n      const handleLogout = async () =&gt; {&quot;,
        &quot;oldStart&quot;: 1,
        &quot;newStart&quot;: 1,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 2
      },
      {
        &quot;diffString&quot;: &quot;  \n      const staffOnly = isStaff(userProfile);\n+ \n+     const currentPath = location.pathname || &#39;&#39;;\n+ \n+     const isActive = (path) =&gt; currentPath.startsWith(path);\n+ \n+     const activeBtnClasses = &#39;btn w-full justify-start bg-base-100 text-base-content border border-base-300&#39;;\n  \n      return (&quot;,
        &quot;oldStart&quot;: 12,
        &quot;newStart&quot;: 13,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 10,
        &quot;linesAdded&quot;: 6
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/components/Sidebar.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useNavigate, useLocation } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;../supabaseClient&#39;;\nimport { canManageUsers, canViewReports, canManageStock, canManageSales, canViewPointOfSales, isStaff } from &#39;../utils/roleUtils&#39;;\n\nfunction Sidebar({ userProfile, onLogout }) {\n    const navigate = useNavigate();\n    const location = useLocation();\n\n    const handleLogout = async () =&gt; {\n        await supabase.auth.signOut();\n        onLogout();\n    };\n\n    const staffOnly = isStaff(userProfile);\n\n    const currentPath = location.pathname || &#39;&#39;;\n\n    const isActive = (path) =&gt; currentPath.startsWith(path);\n\n    const activeBtnClasses = &#39;btn w-full justify-start bg-base-100 text-base-content border border-base-300&#39;;\n\n    return (\n        &lt;div className=\&quot;drawer-side\&quot;&gt;\n            &lt;label htmlFor=\&quot;my-drawer-2\&quot; aria-label=\&quot;close sidebar\&quot; className=\&quot;drawer-overlay\&quot;&gt;&lt;/label&gt;\n            &lt;ul className=\&quot;menu p-4 w-80 min-h-full bg-base-100 text-base-content gap-2\&quot;&gt;\n                {/* Sidebar Header */}\n                &lt;li className=\&quot;menu-title\&quot;&gt;\n                    &lt;span&gt;Quick Actions&lt;/span&gt;\n                &lt;/li&gt;\n\n                {/* Dashboard - Available to both admin and staff */}\n                &lt;li&gt;\n                    &lt;button \n                        className={&#96;btn w-full justify-start ${canManageSales(userProfile) ? &#39;btn-primary&#39; : &#39;btn-disabled&#39;}&#96;}\n                        onClick={() =&gt; canManageSales(userProfile) &amp;&amp; navigate(&#39;/dashboard&#39;)}\n                        disabled={!canManageSales(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M12 6v6m0 0v6m0-6h6m-6 0H6\&quot; /&gt;\n                        &lt;/svg&gt;\n                        Dashboard\n                    &lt;/button&gt;\n                &lt;/li&gt;\n\n                {/* Point of Sales - Staff quick action only */}\n                {staffOnly &amp;&amp; (\n                    &lt;li&gt;\n                        &lt;button \n                            className={&#96;btn w-full justify-start ${canViewPointOfSales(userProfile) ? &#39;btn-success&#39; : &#39;btn-disabled&#39;}&#96;}\n                            onClick={() =&gt; canViewPointOfSales(userProfile) &amp;&amp; navigate(&#39;/point-of-sale&#39;)}\n                            disabled={!canViewPointOfSales(userProfile)}\n                        &gt;\n                            &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                                &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m0 0L12 20l2.5-2M17 13h-2.5M17 13v5a2 2 0 01-2 2H9a2 2 0 01-2-2v-5m10 0V8a2 2 0 00-2-2H9a2 2 0 00-2 2v5m10 0h-2.5\&quot; /&gt;\n                            &lt;/svg&gt;\n                            Point of Sales\n                        &lt;/button&gt;\n                    &lt;/li&gt;\n                )}\n\n                {/* Admin-only actions - hidden entirely for staff */}\n                {!staffOnly &amp;&amp; (\n                    &lt;&gt;\n                {/* Manage Inventory - Available to admin only */}\n                &lt;li&gt;\n                    &lt;button \n                        className={&#96;btn w-full justify-start ${canManageStock(userProfile) ? &#39;btn-secondary&#39; : &#39;btn-disabled&#39;}&#96;}\n                        onClick={() =&gt; canManageStock(userProfile) &amp;&amp; navigate(&#39;/manage-inventory&#39;)}\n                        disabled={!canManageStock(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\&quot; /&gt;\n                        &lt;/svg&gt;\n                        Manage Inventory\n                    &lt;/button&gt;\n                &lt;/li&gt;\n\n                        {/* View Reports - Available to both admin and staff, but hidden from staff quick actions */}\n                &lt;li&gt;\n                    &lt;button \n                        className={&#96;btn w-full justify-start ${canViewReports(userProfile) ? &#39;btn-accent&#39; : &#39;btn-disabled&#39;}&#96;}\n                        onClick={() =&gt; canViewReports(userProfile) &amp;&amp; navigate(&#39;/reports&#39;)}\n                        disabled={!canViewReports(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\&quot; /&gt;\n                        &lt;/svg&gt;\n                        History Reports\n                    &lt;/button&gt;\n                &lt;/li&gt;\n\n                {/* Manage Staff - Available to admin only */}\n                &lt;li&gt;\n                    &lt;button \n                        className={&#96;btn w-full justify-start ${canManageUsers(userProfile) ? &#39;btn-error&#39; : &#39;btn-disabled&#39;}&#96;}\n                        onClick={() =&gt; canManageUsers(userProfile) &amp;&amp; navigate(&#39;/manage-staff&#39;)}\n                        disabled={!canManageUsers(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\&quot; /&gt;\n                        &lt;/svg&gt;\n                        Manage Staff\n                    &lt;/button&gt;\n                &lt;/li&gt;\n                    &lt;/&gt;\n                )}\n            &lt;/ul&gt;\n        &lt;/div&gt;\n    );\n}\n\nexport default Sidebar;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/components/Sidebar.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;a3d7ba25-1a2b-4e6e-b6a4-25cf2498371b&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                  &lt;li&gt;\n                      &lt;button \n-                         className={&#96;btn w-full justify-start ${canManageSales(userProfile) ? &#39;btn-primary&#39; : &#39;btn-disabled&#39;}&#96;}\n+                         className={\n+                             isActive(&#39;/dashboard&#39;)\n+                                 ? activeBtnClasses\n+                                 : &#96;btn w-full justify-start ${canManageSales(userProfile) ? &#39;btn-primary&#39; : &#39;btn-disabled&#39;}&#96;\n+                         }\n                          onClick={() =&gt; canManageSales(userProfile) &amp;&amp; navigate(&#39;/dashboard&#39;)}\n                          disabled={!canManageSales(userProfile)}&quot;,
        &quot;oldStart&quot;: 32,
        &quot;newStart&quot;: 32,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;                      &lt;li&gt;\n                          &lt;button \n-                             className={&#96;btn w-full justify-start ${canViewPointOfSales(userProfile) ? &#39;btn-success&#39; : &#39;btn-disabled&#39;}&#96;}\n+                             className={\n+                                 isActive(&#39;/point-of-sale&#39;)\n+                                     ? activeBtnClasses\n+                                     : &#96;btn w-full justify-start ${canViewPointOfSales(userProfile) ? &#39;btn-success&#39; : &#39;btn-disabled&#39;}&#96;\n+                             }\n                              onClick={() =&gt; canViewPointOfSales(userProfile) &amp;&amp; navigate(&#39;/point-of-sale&#39;)}\n                              disabled={!canViewPointOfSales(userProfile)}&quot;,
        &quot;oldStart&quot;: 47,
        &quot;newStart&quot;: 51,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;                  &lt;li&gt;\n                      &lt;button \n-                         className={&#96;btn w-full justify-start ${canManageStock(userProfile) ? &#39;btn-secondary&#39; : &#39;btn-disabled&#39;}&#96;}\n+                         className={\n+                             isActive(&#39;/manage-inventory&#39;)\n+                                 ? activeBtnClasses\n+                                 : &#96;btn w-full justify-start ${canManageStock(userProfile) ? &#39;btn-secondary&#39; : &#39;btn-disabled&#39;}&#96;\n+                         }\n                          onClick={() =&gt; canManageStock(userProfile) &amp;&amp; navigate(&#39;/manage-inventory&#39;)}\n                          disabled={!canManageStock(userProfile)}&quot;,
        &quot;oldStart&quot;: 65,
        &quot;newStart&quot;: 73,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;                  &lt;li&gt;\n                      &lt;button \n-                         className={&#96;btn w-full justify-start ${canViewReports(userProfile) ? &#39;btn-accent&#39; : &#39;btn-disabled&#39;}&#96;}\n+                         className={\n+                             isActive(&#39;/reports&#39;)\n+                                 ? activeBtnClasses\n+                                 : &#96;btn w-full justify-start ${canViewReports(userProfile) ? &#39;btn-accent&#39; : &#39;btn-disabled&#39;}&#96;\n+                         }\n                          onClick={() =&gt; canViewReports(userProfile) &amp;&amp; navigate(&#39;/reports&#39;)}\n                          disabled={!canViewReports(userProfile)}&quot;,
        &quot;oldStart&quot;: 79,
        &quot;newStart&quot;: 91,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;                  &lt;li&gt;\n                      &lt;button \n-                         className={&#96;btn w-full justify-start ${canManageUsers(userProfile) ? &#39;btn-error&#39; : &#39;btn-disabled&#39;}&#96;}\n+                         className={\n+                             isActive(&#39;/manage-staff&#39;)\n+                                 ? activeBtnClasses\n+                                 : &#96;btn w-full justify-start ${canManageUsers(userProfile) ? &#39;btn-error&#39; : &#39;btn-disabled&#39;}&#96;\n+                         }\n                          onClick={() =&gt; canManageUsers(userProfile) &amp;&amp; navigate(&#39;/manage-staff&#39;)}\n                          disabled={!canManageUsers(userProfile)}&quot;,
        &quot;oldStart&quot;: 93,
        &quot;newStart&quot;: 109,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 5
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/components/Sidebar.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useNavigate, useLocation } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;../supabaseClient&#39;;\nimport { canManageUsers, canViewReports, canManageStock, canManageSales, canViewPointOfSales, isStaff } from &#39;../utils/roleUtils&#39;;\n\nfunction Sidebar({ userProfile, onLogout }) {\n    const navigate = useNavigate();\n    const location = useLocation();\n\n    const handleLogout = async () =&gt; {\n        await supabase.auth.signOut();\n        onLogout();\n    };\n\n    const staffOnly = isStaff(userProfile);\n\n    const currentPath = location.pathname || &#39;&#39;;\n\n    const isActive = (path) =&gt; currentPath.startsWith(path);\n\n    const activeBtnClasses = &#39;btn w-full justify-start bg-base-100 text-base-content border border-base-300&#39;;\n\n    return (\n        &lt;div className=\&quot;drawer-side\&quot;&gt;\n            &lt;label htmlFor=\&quot;my-drawer-2\&quot; aria-label=\&quot;close sidebar\&quot; className=\&quot;drawer-overlay\&quot;&gt;&lt;/label&gt;\n            &lt;ul className=\&quot;menu p-4 w-80 min-h-full bg-base-100 text-base-content gap-2\&quot;&gt;\n                {/* Sidebar Header */}\n                &lt;li className=\&quot;menu-title\&quot;&gt;\n                    &lt;span&gt;Quick Actions&lt;/span&gt;\n                &lt;/li&gt;\n\n                {/* Dashboard - Available to both admin and staff */}\n                &lt;li&gt;\n                    &lt;button \n                        className={\n                            isActive(&#39;/dashboard&#39;)\n                                ? activeBtnClasses\n                                : &#96;btn w-full justify-start ${canManageSales(userProfile) ? &#39;btn-primary&#39; : &#39;btn-disabled&#39;}&#96;\n                        }\n                        onClick={() =&gt; canManageSales(userProfile) &amp;&amp; navigate(&#39;/dashboard&#39;)}\n                        disabled={!canManageSales(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M12 6v6m0 0v6m0-6h6m-6 0H6\&quot; /&gt;\n                        &lt;/svg&gt;\n                        Dashboard\n                    &lt;/button&gt;\n                &lt;/li&gt;\n\n                {/* Point of Sales - Staff quick action only */}\n                {staffOnly &amp;&amp; (\n                    &lt;li&gt;\n                        &lt;button \n                            className={\n                                isActive(&#39;/point-of-sale&#39;)\n                                    ? activeBtnClasses\n                                    : &#96;btn w-full justify-start ${canViewPointOfSales(userProfile) ? &#39;btn-success&#39; : &#39;btn-disabled&#39;}&#96;\n                            }\n                            onClick={() =&gt; canViewPointOfSales(userProfile) &amp;&amp; navigate(&#39;/point-of-sale&#39;)}\n                            disabled={!canViewPointOfSales(userProfile)}\n                        &gt;\n                            &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                                &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m0 0L12 20l2.5-2M17 13h-2.5M17 13v5a2 2 0 01-2 2H9a2 2 0 01-2-2v-5m10 0V8a2 2 0 00-2-2H9a2 2 0 00-2 2v5m10 0h-2.5\&quot; /&gt;\n                            &lt;/svg&gt;\n                            Point of Sales\n                        &lt;/button&gt;\n                    &lt;/li&gt;\n                )}\n\n                {/* Admin-only actions - hidden entirely for staff */}\n                {!staffOnly &amp;&amp; (\n                    &lt;&gt;\n                {/* Manage Inventory - Available to admin only */}\n                &lt;li&gt;\n                    &lt;button \n                        className={\n                            isActive(&#39;/manage-inventory&#39;)\n                                ? activeBtnClasses\n                                : &#96;btn w-full justify-start ${canManageStock(userProfile) ? &#39;btn-secondary&#39; : &#39;btn-disabled&#39;}&#96;\n                        }\n                        onClick={() =&gt; canManageStock(userProfile) &amp;&amp; navigate(&#39;/manage-inventory&#39;)}\n                        disabled={!canManageStock(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\&quot; /&gt;\n                        &lt;/svg&gt;\n                        Manage Inventory\n                    &lt;/button&gt;\n                &lt;/li&gt;\n\n                        {/* View Reports - Available to both admin and staff, but hidden from staff quick actions */}\n                &lt;li&gt;\n                    &lt;button \n                        className={\n                            isActive(&#39;/reports&#39;)\n                                ? activeBtnClasses\n                                : &#96;btn w-full justify-start ${canViewReports(userProfile) ? &#39;btn-accent&#39; : &#39;btn-disabled&#39;}&#96;\n                        }\n                        onClick={() =&gt; canViewReports(userProfile) &amp;&amp; navigate(&#39;/reports&#39;)}\n                        disabled={!canViewReports(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\&quot; /&gt;\n                        &lt;/svg&gt;\n                        History Reports\n                    &lt;/button&gt;\n                &lt;/li&gt;\n\n                {/* Manage Staff - Available to admin only */}\n                &lt;li&gt;\n                    &lt;button \n                        className={\n                            isActive(&#39;/manage-staff&#39;)\n                                ? activeBtnClasses\n                                : &#96;btn w-full justify-start ${canManageUsers(userProfile) ? &#39;btn-error&#39; : &#39;btn-disabled&#39;}&#96;\n                        }\n                        onClick={() =&gt; canManageUsers(userProfile) &amp;&amp; navigate(&#39;/manage-staff&#39;)}\n                        disabled={!canManageUsers(userProfile)}\n                    &gt;\n                        &lt;svg className=\&quot;w-5 h-5 mr-2\&quot; fill=\&quot;none\&quot; stroke=\&quot;currentColor\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;\n                            &lt;path strokeLinecap=\&quot;round\&quot; strokeLinejoin=\&quot;round\&quot; strokeWidth={2} d=\&quot;M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\&quot; /&gt;\n                        &lt;/svg&gt;\n                        Manage Staff\n                    &lt;/button&gt;\n                &lt;/li&gt;\n                    &lt;/&gt;\n                )}\n            &lt;/ul&gt;\n        &lt;/div&gt;\n    );\n}\n\nexport default Sidebar;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

### Updates made

- **Reports header text**  
  - In `Reports.jsx`, the main heading is now **“History Reports”**, with the subtitle updated to describe historical performance, matching your naming.

- **Manage Inventory header**  
  - In `ManageStocks.jsx`, the page now renders a clear header section above the cards:
    - Title: **“Manage Inventory”**  
    - Subtitle explaining it manages stocks, menu prices, and expenses.

- **Quick Actions active styling (admin + staff)**  
  - In `Sidebar.jsx`, I added route-aware active styling using `useLocation`.  
  - For each Quick Actions button (Dashboard, Point of Sales, Manage Inventory, History Reports, Manage Staff):
    - When its route is active, it uses a **white-style button**: `bg-base-100`, neutral text, subtle border.
    - When inactive, it keeps its colored DaisyUI variant (`btn-primary`, `btn-secondary`, `btn-accent`, `btn-error`, etc.) or disabled style.
  - This behavior works for both **admin and staff**, including the staff-only Point of Sales button.

---

