<!-- Generated by SpecStory, Markdown v2.0.0 -->

<!-- cursor Session 91daaa2f-3b98-4da3-9445-54e2bafefbf3 (2025-11-16 06:12Z) -->

# Improve date filtering for history reports (2025-11-16 06:12Z)

_**User (2025-11-16 05:55Z)**_

In the Admin Role of the System, Review the current date filtering of History Reports. Currently, Aside from sales overview, the date filtering of other three is limited to four selections of date period. i want to make it more flexible, implement the same date filtering method from the sales overview.

---

_**Agent (model default, mode Plan)**_

<think><details><summary>Thought Process</summary>
**Proposing a plan**

I need to focus on proposing a plan without making edits. It’s important to understand the codebase first and to prepare 1-2 critical questions upfront. I’m considering if I need framework information, but I can probably infer it’s React, Next, etc. A key question involves the admin role: Do I choose history reports with four selections or a flexible date range for sales overview? I should also explore the codebase and keep everything moving smoothly.
**Setting initial goals**

I should start by providing brief initial goals and next steps based on the user's update specifications. After that, I can call tools using a parallel approach to scan the repository. I’ll use list_dir and grep to look for “Sales Overview” and similar terms. The limitation of the parallel wrapper to functions in the namespace shouldn’t be an issue. I'll run list_dir on the root first and then grep for "SalesOverview" or "History Report."</details></think>

---

I’ll first locate the admin history report and sales overview components, then compare their date-filter logic and UI, and finally outline how to reuse the flexible date filter across the other three reports. I won’t modify any files yet; I’ll just analyze and then propose a focused implementation plan.

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_directory** • Listed directory undefined • **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "Sales Overview" in "." • 2 matches</summary>

Output mode: files_with_matches


| File |
|------|
| `.\src\Reports.jsx` |
| `.\dist\assets\index-B6c6m1v2.js` |


</details>
</tool-use>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "sales overview" in "." • 1 match</summary>

Output mode: files_with_matches


| File |
|------|
| `.\src\Reports.jsx` |


</details>
</tool-use>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "History Report" in "." • 2 matches</summary>

Output mode: files_with_matches


| File |
|------|
| `.\src\components\Sidebar.jsx` |
| `.\dist\assets\index-B6c6m1v2.js` |


</details>
</tool-use>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "date filter" in "." • 0 matches</summary>

Output mode: files_with_matches


_No matches found_

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Re-evaluating grep command**

It seems like my grep command timed out; maybe it's because the node_modules folder is too large. I'm thinking I might need to restrict my search to just the src directory to make it more manageable. I really want to get this right, so I’ll just re-run it with those tweaks. Let’s see if that helps get the results I need! I’m curious to see what I find.</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "Sales Overview" in "src" • 1 match</summary>

Output mode: files_with_matches


| File |
|------|
| `src\Reports.jsx` |


</details>
</tool-use>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "sales overview" in "src" • 1 match</summary>

Output mode: files_with_matches


| File |
|------|
| `src\Reports.jsx` |


</details>
</tool-use>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "History" in "src" • 1 match</summary>

Output mode: files_with_matches


| File |
|------|
| `src\components\Sidebar.jsx` |


</details>
</tool-use>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "date" in "src" • 11 matches</summary>

Output mode: files_with_matches


| File |
|------|
| `src\Reports.jsx` |
| `src\components\admin\ChickenStocksAndStallStatus.jsx` |
| `src\dashboard.jsx` |
| `src\utils\staffReportsToday.js` |
| `src\components\Layout.jsx` |
| `src\components\PointOfSale.jsx` |
| `src\utils\dateUtils.js` |
| `src\components\UserManagement.jsx` |
| `src\components\admin\ExpensesOverview.jsx` |
| `src\components\admin\EditMenuPrices.jsx` |
| `src\ManageStaff.jsx` |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/Reports.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/components/admin/ExpensesOverview.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/components/admin/ChickenStocksAndStallStatus.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/dashboard.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Planning date filtering changes**

I'm looking at the history reports page, specifically how date filtering works for the Admin role. The user wants more flexibility beyond the current four-date selections for transactions, expenses, and statistics. They suggest implementing a method similar to the sales overview, which uses two free-form date inputs. I need to plan for adjustments that allow a custom date range with quick presets. I might create separate state objects or reuse existing functions but consider dropping or keeping the period field.
**Implementing date filtering changes**

The requirement to implement the sales overview's date filtering method means I need to add start and end date inputs, along with a clear option. I’m wondering if they want to keep the quick selects too; "more flexible" might mean replicating the method but also keeping the four presets could be excessive. I can propose both options. It’s important to ensure staff behavior remains unchanged since they are still restricted to specific filters. The new date inputs will only be visible to admin users.
**Updating admin UI access**

The user mentions the "Admin Role of the System," which means I might need to restrict the UI to admin access only. Currently, Reports.jsx is available to both staff and admin, but filters apply only in the code. The focus here is on enhancing the admin experience. I need to create a plan detailing file paths and key code references without modifying any files. 

The steps include updating the state by replacing existing filters with date range fields like `startDate` and `endDate`. I may also consider creating new state hooks for these date ranges while possibly removing the previous period fields.
**Updating load functions and UI**

I need to update the load functions like `loadTransactions`, `loadExpenses`, and `loadStatistics` to implement the new start/end date filters for admin users. I plan to remove `getDateRangeFromPeriod`, as it wouldn’t be used anymore, keeping things clean. Next, for the UI, I’ll add two date inputs with a "Clear" button in the Transactions filter section, and do the same for Expenses and Statistics. 

I'll keep the filters visible for both staff and admins, but it could be confusing since staff won't be affected by the admin-only controls. I might suggest hiding those filters for clarity, but I’ll maintain simplicity and ensure the functionality won't impact staff.
**Finalizing UI and testing**

Currently, the UI relies on a period select that might confuse staff, who may think the filters apply, though they don’t. Transitioning to date ranges won’t affect functionality, which is fine. For testing, I need to manually verify the flow for both admin and staff, making sure the cards update when changing the date range and that the "Clear" button resets the filters. I also want to note that we’ll use DaisyUI for consistency with classes like `input input-bordered input-sm`. I need to reference the code sections that currently use the select options for clarity in the plan before I create it.</details></think>

---

Cancelled

---

_**User (2025-11-16 05:55Z)**_

this is a repeated reminder:

before implementation, review codes, avoid duplication and misplaced logic at all costs



run tests, then code, then test again



alright, you may now proceed

---

_**Agent (model default, mode Plan)**_

<think><details><summary>Thought Process</summary>
**Planning test execution**

I’m considering the JS/Vite app and realizing there might be no tests currently. I should definitely run `npm test` or `npm run lint`, but first, I need to inspect package.json to see what's there. I can use the tools available carefully, keeping things organized and avoiding duplication in my logic. I'll focus on implementing flexible filtering like in the Sales Overview by using date ranges for history filters. Testing and coding will be done in the right order.
**Executing planned steps**

I already have some todos outlined, so I won't need to use `todo_write`. I'm going to follow my steps: first, I’ll read package.json to see what scripts are available. Next, I'll run the tests, likely starting with `npm test` or `npm run lint` if that’s the only option. It’s crucial to use a command that’s explicitly meant for tests. After that, I'll make code edits in Reports.jsx, adjusting filters' initial states, checking the usage of the `getDateRangeFromPeriod` function, and updating the load functions to use date range filters.
**Considering staff date filters**

I need to be careful not to apply admin-only date filters for staff. Currently, the code checks for "if (userProfile?.role === 'admin')" before setting these filters. For staff, we shouldn't apply filters; instead, we have restricted access to their specific dates. In the UI, I'm thinking of modifying the JSX for three cards to include date inputs while keeping the layout in three columns: start, end, stall vs. clear. We're adding stall selection plus date inputs, which complicates things. A potential solution is to align the layout with the Sales card by placing the Clear button in the third column.
**Designing filter layout**

To minimize significant layout changes, I’m thinking about replacing the 'Period' select with a 'Start Date' input and placing a 'Clear' button below each card's filters. The user wants to maintain the same approach, so I’ll mirror the Sales filter's layout: three columns for start, end, and Clear, followed by a separate row for stall filters. This keeps the grid simple and maintains code clarity for expenses and statistics too. I’m also considering hiding admin-only controls for staff to streamline their experience, using role-based visibility for the filter blocks based on their profile.
**Maintaining filter integrity**

I need to remember not to disrupt the existing filters state, even if some inputs are hidden. The user requested a review to avoid duplication, and I’m considering creating a reusable date filter component, which might add complexity. However, since it’s only three small sections, I could create a `DateRangeFilter` helper component, which would involve a new file. The user emphasized avoiding duplication, but UI duplication is fine. After making edits, I’ll run lint checks for Reports.jsx and then execute tests again. Let's get started with the tools!</details></think>

---

I’ll first check what test command your project uses, run it, then update `Reports.jsx` to switch the three history sections to date-range filters like Sales Overview, and finally re-run tests.

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: package.json</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/Reports.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main && npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main && npm run lint
```

```
At C:\Users\ADZ\AppData\Local\Temp\ps-script-7f8d7838-1292-4b94-93cb-ed5eeb1cc761.ps1:7 char:40
+ cd C:\Users\ADZ\Desktop\itpm-proj-main &amp;&amp; npm run lint
+                                        ~~
The token &#39;&amp;&amp;&#39; is not a valid statement separator in this version.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : InvalidEndOfLine
 

```
</details>
</tool-use>

---

I’ll adjust the way I run commands for PowerShell, then update `Reports.jsx` filter state and query logic to use start/end dates, and finally swap the three history filter UIs to match the Sales Overview pattern before linting again.

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  96:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  506:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  554:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  663:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  674:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  743:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  759:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  766:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;c38ea277-8b77-4ff4-8c7a-67a221c2f008&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    // Filter states\n    const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n-   const [transactionsFilters, setTransactionsFilters] = useState({ period: &#39;&#39;, stallId: &#39;&#39; });\n-   const [expensesFilters, setExpensesFilters] = useState({ period: &#39;&#39;, stallId: &#39;&#39; });\n-   const [statisticsFilters, setStatisticsFilters] = useState({ period: &#39;&#39;, stallId: &#39;&#39; });\n+   const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n+   const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n+   const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n    \n    // Editing states&quot;,
        &quot;oldStart&quot;: 26,
        &quot;newStart&quot;: 26,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 7,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 3
      },
      {
        &quot;diffString&quot;: &quot;    };\n    \n- \n-   // Get date range from period\n-   const getDateRangeFromPeriod = (period) =&gt; {\n-     const today = new Date();\n-     const endDate = today.toISOString().split(&#39;T&#39;)[0];\n-     let startDate = new Date();\n-     \n-     switch (period) {\n-       case &#39;7days&#39;:\n-         startDate.setDate(today.getDate() - 7);\n-         break;\n-       case &#39;month&#39;:\n-         startDate.setMonth(today.getMonth() - 1);\n-         break;\n-       case &#39;year&#39;:\n-         startDate.setFullYear(today.getFullYear() - 1);\n-         break;\n-       default:\n-         return { startDate: null, endDate: null };\n-     }\n-     \n-     return {\n-       startDate: startDate.toISOString().split(&#39;T&#39;)[0],\n-       endDate: endDate\n-     };\n-   };\n  \n    // Load detailed transactions&quot;,
        &quot;oldStart&quot;: 167,
        &quot;newStart&quot;: 167,
        &quot;oldLines&quot;: 30,
        &quot;newLines&quot;: 4,
        &quot;linesRemoved&quot;: 26
      },
      {
        &quot;diffString&quot;: &quot;          &#96;);\n  \n-       // Apply filters\n+       // Apply filters (admin only; staff will be restricted to today via helper)\n        if (userProfile?.role === &#39;admin&#39;) {\n-       if (transactionsFilters.period) {\n-         const { startDate, endDate } = getDateRangeFromPeriod(transactionsFilters.period);\n-         if (startDate) {\n-           query = query.gte(&#39;sale_date&#39;, startDate);\n+         if (transactionsFilters.startDate) {\n+           query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n          }\n-         if (endDate) {\n-           query = query.lte(&#39;sale_date&#39;, endDate);\n-         }\n-       }\n-       if (transactionsFilters.stallId) {\n-         query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n+         if (transactionsFilters.endDate) {\n+           query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n+         }\n+         if (transactionsFilters.stallId) {\n+           query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n          }\n        }&quot;,
        &quot;oldStart&quot;: 211,
        &quot;newStart&quot;: 185,
        &quot;oldLines&quot;: 17,
        &quot;newLines&quot;: 14,
        &quot;linesRemoved&quot;: 11,
        &quot;linesAdded&quot;: 8
      },
      {
        &quot;diffString&quot;: &quot;          .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n  \n-       // Apply filters\n+       // Apply filters (admin only; staff will be restricted to today via helper)\n        if (userProfile?.role === &#39;admin&#39;) {\n-       if (expensesFilters.period) {\n-         const { startDate, endDate } = getDateRangeFromPeriod(expensesFilters.period);\n-         if (startDate) {\n-           query = query.gte(&#39;date&#39;, startDate);\n+         if (expensesFilters.startDate) {\n+           query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n          }\n-         if (endDate) {\n-           query = query.lte(&#39;date&#39;, endDate);\n-         }\n-       }\n-       if (expensesFilters.stallId) {\n-         query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n+         if (expensesFilters.endDate) {\n+           query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n+         }\n+         if (expensesFilters.stallId) {\n+           query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n          }\n        }&quot;,
        &quot;oldStart&quot;: 248,
        &quot;newStart&quot;: 219,
        &quot;oldLines&quot;: 17,
        &quot;newLines&quot;: 14,
        &quot;linesRemoved&quot;: 11,
        &quot;linesAdded&quot;: 8
      },
      {
        &quot;diffString&quot;: &quot;          statsEndDate = endDate;\n          statsStallId = userProfile.stall_id || null;\n-       } else if (statisticsFilters.period) {\n-         const range = getDateRangeFromPeriod(statisticsFilters.period);\n-         statsStartDate = range.startDate;\n-         statsEndDate = range.endDate;\n+       } else if (userProfile?.role === &#39;admin&#39;) {\n+         statsStartDate = statisticsFilters.startDate || null;\n+         statsEndDate = statisticsFilters.endDate || null;\n        }\n  &quot;,
        &quot;oldStart&quot;: 289,
        &quot;newStart&quot;: 257,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 7,
        &quot;linesRemoved&quot;: 4,
        &quot;linesAdded&quot;: 3
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n      if (salesDateRange.startDate) {\n        query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n      }\n      if (salesDateRange.endDate) {\n        query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, startDate: e.target.value })}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, endDate: e.target.value })}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; })}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Period&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={transactionsFilters.period}\n                    onChange={(e) =&gt; setTransactionsFilters({ ...transactionsFilters, period: e.target.value })}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;All Time&lt;/option&gt;\n                    &lt;option value=\&quot;7days\&quot;&gt;Last 7 Days&lt;/option&gt;\n                    &lt;option value=\&quot;month\&quot;&gt;Last Month&lt;/option&gt;\n                    &lt;option value=\&quot;year\&quot;&gt;Last Year&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={transactionsFilters.stallId}\n                    onChange={(e) =&gt; setTransactionsFilters({ ...transactionsFilters, stallId: e.target.value })}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Period&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={expensesFilters.period}\n                    onChange={(e) =&gt; setExpensesFilters({ ...expensesFilters, period: e.target.value })}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;All Time&lt;/option&gt;\n                    &lt;option value=\&quot;7days\&quot;&gt;Last 7 Days&lt;/option&gt;\n                    &lt;option value=\&quot;month\&quot;&gt;Last Month&lt;/option&gt;\n                    &lt;option value=\&quot;year\&quot;&gt;Last Year&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={expensesFilters.stallId}\n                    onChange={(e) =&gt; setExpensesFilters({ ...expensesFilters, stallId: e.target.value })}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Period&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={statisticsFilters.period}\n                    onChange={(e) =&gt; setStatisticsFilters({ ...statisticsFilters, period: e.target.value })}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;All Time&lt;/option&gt;\n                    &lt;option value=\&quot;7days\&quot;&gt;Last 7 Days&lt;/option&gt;\n                    &lt;option value=\&quot;month\&quot;&gt;Last Month&lt;/option&gt;\n                    &lt;option value=\&quot;year\&quot;&gt;Last Year&lt;/option&gt;\n                  &lt;/select&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;select\n                    className=\&quot;select select-bordered select-sm\&quot;\n                    value={statisticsFilters.stallId}\n                    onChange={(e) =&gt; setStatisticsFilters({ ...statisticsFilters, stallId: e.target.value })}\n                  &gt;\n                    &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                    {stalls.map((stall) =&gt; (\n                      &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                        {stall.stall_name}\n                      &lt;/option&gt;\n                    ))}\n                  &lt;/select&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

_**User (2025-11-16 05:55Z)**_

Implement the plan as specified, it is attached for your reference. Do NOT edit the plan file itself.

To-do's from the plan have already been created. Do not create them again. Mark them as in_progress as you work, starting with the first one. Don't stop until you have completed all the to-dos.

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Running lint and tests**

So, I’ll run `npm run lint` again to check for existing global errors. I realize those errors will stay as they are, but I want to make sure I don't make anything worse. The user asked for tests again, so I'll go ahead and run those anyway. It's all about being thorough and ensuring everything's on track! Let's implement this next step.</details></think>

---

I’ll update the three history filter UIs to use start/end date ranges with Clear, keep staff behavior unchanged, then lint just `Reports.jsx` and finally run the full lint command again.

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;82eef6e0-7c8e-4425-88b6-7d24382e73b2&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n-               {/* Filters */}\n-               &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n-                 &lt;div className=\&quot;form-control\&quot;&gt;\n-                   &lt;label className=\&quot;label\&quot;&gt;\n-                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Period&lt;/span&gt;\n-                   &lt;/label&gt;\n-                   &lt;select\n-                     className=\&quot;select select-bordered select-sm\&quot;\n-                     value={transactionsFilters.period}\n-                     onChange={(e) =&gt; setTransactionsFilters({ ...transactionsFilters, period: e.target.value })}\n-                   &gt;\n-                     &lt;option value=\&quot;\&quot;&gt;All Time&lt;/option&gt;\n-                     &lt;option value=\&quot;7days\&quot;&gt;Last 7 Days&lt;/option&gt;\n-                     &lt;option value=\&quot;month\&quot;&gt;Last Month&lt;/option&gt;\n-                     &lt;option value=\&quot;year\&quot;&gt;Last Year&lt;/option&gt;\n-                   &lt;/select&gt;\n-                 &lt;/div&gt;\n-                 &lt;div className=\&quot;form-control\&quot;&gt;\n-                   &lt;label className=\&quot;label\&quot;&gt;\n-                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n-                   &lt;/label&gt;\n-                   &lt;select\n-                     className=\&quot;select select-bordered select-sm\&quot;\n-                     value={transactionsFilters.stallId}\n-                     onChange={(e) =&gt; setTransactionsFilters({ ...transactionsFilters, stallId: e.target.value })}\n-                   &gt;\n-                     &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n-                     {stalls.map((stall) =&gt; (\n-                       &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n-                         {stall.stall_name}\n-                       &lt;/option&gt;\n-                     ))}\n-                   &lt;/select&gt;\n-                 &lt;/div&gt;\n-               &lt;/div&gt;\n+               {/* Filters - admin only */}\n+               {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n+                 &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;input\n+                       type=\&quot;date\&quot;\n+                       className=\&quot;input input-bordered input-sm\&quot;\n+                       value={transactionsFilters.startDate}\n+                       onChange={(e) =&gt;\n+                         setTransactionsFilters({\n+                           ...transactionsFilters,\n+                           startDate: e.target.value,\n+                         })\n+                       }\n+                     /&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;input\n+                       type=\&quot;date\&quot;\n+                       className=\&quot;input input-bordered input-sm\&quot;\n+                       value={transactionsFilters.endDate}\n+                       onChange={(e) =&gt;\n+                         setTransactionsFilters({\n+                           ...transactionsFilters,\n+                           endDate: e.target.value,\n+                         })\n+                       }\n+                     /&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;select\n+                       className=\&quot;select select-bordered select-sm\&quot;\n+                       value={transactionsFilters.stallId}\n+                       onChange={(e) =&gt;\n+                         setTransactionsFilters({\n+                           ...transactionsFilters,\n+                           stallId: e.target.value,\n+                         })\n+                       }\n+                     &gt;\n+                       &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n+                       {stalls.map((stall) =&gt; (\n+                         &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n+                           {stall.stall_name}\n+                         &lt;/option&gt;\n+                       ))}\n+                     &lt;/select&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;button\n+                       className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n+                       onClick={() =&gt;\n+                         setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n+                       }\n+                     &gt;\n+                       Clear\n+                     &lt;/button&gt;\n+                   &lt;/div&gt;\n+                 &lt;/div&gt;\n+               )}\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;&quot;,
        &quot;oldStart&quot;: 581,
        &quot;newStart&quot;: 581,
        &quot;oldLines&quot;: 39,
        &quot;newLines&quot;: 76,
        &quot;linesRemoved&quot;: 35,
        &quot;linesAdded&quot;: 72
      },
      {
        &quot;diffString&quot;: &quot;              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n-               {/* Filters */}\n-               &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n-                 &lt;div className=\&quot;form-control\&quot;&gt;\n-                   &lt;label className=\&quot;label\&quot;&gt;\n-                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Period&lt;/span&gt;\n-                   &lt;/label&gt;\n-                   &lt;select\n-                     className=\&quot;select select-bordered select-sm\&quot;\n-                     value={expensesFilters.period}\n-                     onChange={(e) =&gt; setExpensesFilters({ ...expensesFilters, period: e.target.value })}\n-                   &gt;\n-                     &lt;option value=\&quot;\&quot;&gt;All Time&lt;/option&gt;\n-                     &lt;option value=\&quot;7days\&quot;&gt;Last 7 Days&lt;/option&gt;\n-                     &lt;option value=\&quot;month\&quot;&gt;Last Month&lt;/option&gt;\n-                     &lt;option value=\&quot;year\&quot;&gt;Last Year&lt;/option&gt;\n-                   &lt;/select&gt;\n-                 &lt;/div&gt;\n-                 &lt;div className=\&quot;form-control\&quot;&gt;\n-                   &lt;label className=\&quot;label\&quot;&gt;\n-                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n-                   &lt;/label&gt;\n-                   &lt;select\n-                     className=\&quot;select select-bordered select-sm\&quot;\n-                     value={expensesFilters.stallId}\n-                     onChange={(e) =&gt; setExpensesFilters({ ...expensesFilters, stallId: e.target.value })}\n-                   &gt;\n-                     &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n-                     {stalls.map((stall) =&gt; (\n-                       &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n-                         {stall.stall_name}\n-                       &lt;/option&gt;\n-                     ))}\n-                   &lt;/select&gt;\n-                 &lt;/div&gt;\n-               &lt;/div&gt;\n+               {/* Filters - admin only */}\n+               {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n+                 &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;input\n+                       type=\&quot;date\&quot;\n+                       className=\&quot;input input-bordered input-sm\&quot;\n+                       value={expensesFilters.startDate}\n+                       onChange={(e) =&gt;\n+                         setExpensesFilters({\n+                           ...expensesFilters,\n+                           startDate: e.target.value,\n+                         })\n+                       }\n+                     /&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;input\n+                       type=\&quot;date\&quot;\n+                       className=\&quot;input input-bordered input-sm\&quot;\n+                       value={expensesFilters.endDate}\n+                       onChange={(e) =&gt;\n+                         setExpensesFilters({\n+                           ...expensesFilters,\n+                           endDate: e.target.value,\n+                         })\n+                       }\n+                     /&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;select\n+                       className=\&quot;select select-bordered select-sm\&quot;\n+                       value={expensesFilters.stallId}\n+                       onChange={(e) =&gt;\n+                         setExpensesFilters({\n+                           ...expensesFilters,\n+                           stallId: e.target.value,\n+                         })\n+                       }\n+                     &gt;\n+                       &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n+                       {stalls.map((stall) =&gt; (\n+                         &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n+                           {stall.stall_name}\n+                         &lt;/option&gt;\n+                       ))}\n+                     &lt;/select&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;button\n+                       className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n+                       onClick={() =&gt;\n+                         setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n+                       }\n+                     &gt;\n+                       Clear\n+                     &lt;/button&gt;\n+                   &lt;/div&gt;\n+                 &lt;/div&gt;\n+               )}\n                &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                  &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;&quot;,
        &quot;oldStart&quot;: 757,
        &quot;newStart&quot;: 794,
        &quot;oldLines&quot;: 39,
        &quot;newLines&quot;: 76,
        &quot;linesRemoved&quot;: 35,
        &quot;linesAdded&quot;: 72
      },
      {
        &quot;diffString&quot;: &quot;              &lt;div className=\&quot;card-body\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n-               {/* Filters */}\n-               &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n-                 &lt;div className=\&quot;form-control\&quot;&gt;\n-                   &lt;label className=\&quot;label\&quot;&gt;\n-                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Period&lt;/span&gt;\n-                   &lt;/label&gt;\n-                   &lt;select\n-                     className=\&quot;select select-bordered select-sm\&quot;\n-                     value={statisticsFilters.period}\n-                     onChange={(e) =&gt; setStatisticsFilters({ ...statisticsFilters, period: e.target.value })}\n-                   &gt;\n-                     &lt;option value=\&quot;\&quot;&gt;All Time&lt;/option&gt;\n-                     &lt;option value=\&quot;7days\&quot;&gt;Last 7 Days&lt;/option&gt;\n-                     &lt;option value=\&quot;month\&quot;&gt;Last Month&lt;/option&gt;\n-                     &lt;option value=\&quot;year\&quot;&gt;Last Year&lt;/option&gt;\n-                   &lt;/select&gt;\n-                 &lt;/div&gt;\n-                 &lt;div className=\&quot;form-control\&quot;&gt;\n-                   &lt;label className=\&quot;label\&quot;&gt;\n-                     &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n-                   &lt;/label&gt;\n-                   &lt;select\n-                     className=\&quot;select select-bordered select-sm\&quot;\n-                     value={statisticsFilters.stallId}\n-                     onChange={(e) =&gt; setStatisticsFilters({ ...statisticsFilters, stallId: e.target.value })}\n-                   &gt;\n-                     &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n-                     {stalls.map((stall) =&gt; (\n-                       &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n-                         {stall.stall_name}\n-                       &lt;/option&gt;\n-                     ))}\n-                   &lt;/select&gt;\n-                 &lt;/div&gt;\n-               &lt;/div&gt;\n+               {/* Filters - admin only */}\n+               {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n+                 &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;input\n+                       type=\&quot;date\&quot;\n+                       className=\&quot;input input-bordered input-sm\&quot;\n+                       value={statisticsFilters.startDate}\n+                       onChange={(e) =&gt;\n+                         setStatisticsFilters({\n+                           ...statisticsFilters,\n+                           startDate: e.target.value,\n+                         })\n+                       }\n+                     /&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;input\n+                       type=\&quot;date\&quot;\n+                       className=\&quot;input input-bordered input-sm\&quot;\n+                       value={statisticsFilters.endDate}\n+                       onChange={(e) =&gt;\n+                         setStatisticsFilters({\n+                           ...statisticsFilters,\n+                           endDate: e.target.value,\n+                         })\n+                       }\n+                     /&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;select\n+                       className=\&quot;select select-bordered select-sm\&quot;\n+                       value={statisticsFilters.stallId}\n+                       onChange={(e) =&gt;\n+                         setStatisticsFilters({\n+                           ...statisticsFilters,\n+                           stallId: e.target.value,\n+                         })\n+                       }\n+                     &gt;\n+                       &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n+                       {stalls.map((stall) =&gt; (\n+                         &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n+                           {stall.stall_name}\n+                         &lt;/option&gt;\n+                       ))}\n+                     &lt;/select&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;button\n+                       className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n+                       onClick={() =&gt;\n+                         setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n+                       }\n+                     &gt;\n+                       Clear\n+                     &lt;/button&gt;\n+                   &lt;/div&gt;\n+                 &lt;/div&gt;\n+               )}\n                &lt;div className=\&quot;space-y-4\&quot;&gt;\n                  &lt;div className=\&quot;stat\&quot;&gt;&quot;,
        &quot;oldStart&quot;: 923,
        &quot;newStart&quot;: 997,
        &quot;oldLines&quot;: 39,
        &quot;newLines&quot;: 76,
        &quot;linesRemoved&quot;: 35,
        &quot;linesAdded&quot;: 72
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n      if (salesDateRange.startDate) {\n        query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n      }\n      if (salesDateRange.endDate) {\n        query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, startDate: e.target.value })}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, endDate: e.target.value })}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; })}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `src/Reports.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  96:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  506:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  554:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  663:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  674:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  743:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  759:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  766:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

### What’s been implemented

- **Flexible date filters for Recent Transactions, Expenses, and Key Statistics**:  
  - Each card now uses `startDate` / `endDate` in state (already wired in the data loaders) and exposes matching **Start Date** and **End Date** `<input type="date">` controls with a **Clear** button that resets the filter to `{ startDate: '', endDate: '', stallId: '' }`.  
  - The **Stall** selector is preserved on all three cards so admins can still filter per stall.

- **Admin-only filter UI, staff behavior preserved**:  
  - The new date-range + stall filter grids are wrapped in `userProfile?.role === 'admin'`, so staff see no extra filters but continue to be constrained to today and their own stall by `restrictToStaffStallAndToday` / `buildTodayRangePH`.

- **No new lint issues introduced**:  
  - `src/Reports.jsx` passes lint on its own; the remaining lint errors are pre-existing in other files and unchanged by this work.  

You should now be able to, as an admin, pick arbitrary date ranges for the three history sections, similar to the Sales Overview card, while staff continue to see today-only data.

---

_**User (2025-11-16 05:55Z)**_

actually, also implement a global filter that works for all

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Evaluating date filter logic**

I'm considering creating a function called `applyDateFilters(query, { startDate, endDate, column })` to reduce code duplication. However, it might be simple enough that it's not necessary. The request is to avoid duplicated logic, so I should think about adding a helper function inside the component to apply it.  

For determining effective start and end dates, I want the global date range to take precedence over local settings, unless it's not set. I should document this in the code comments for clarity.
**Refining loader implementation**

I'm reviewing the loader implementation. For admin users, I need to determine the start and end dates based on the global date range and local settings, which needs clarity. If the global date range is set, it should take precedence. 

I also want to adjust the sales overview to integrate the global date range properly. Additionally, the statistics loader will need to use the global range for filtering. I plan to create a user interface for the global date filter, including inputs and adapting relevant dependencies in `useEffect` for changes.
**Clarifying todo handling**

I need to run the lint tool again, but there's a bit of confusion around handling todos related to the plan. The user wants to mark todos as in progress, but I don’t have the right tool for it. Initially, I was told to use `create_plan` for updating todos instead of `todo_write`. Now that the plan is created, I think updating might not be necessary, and I can ignore the conflict for now. 

Next, I’ll apply a patch on `Reports.jsx`, read the lints for that file, and then run the lint command. Let's implement!</details></think>

---

I’ll add an admin-only global date range at the top of `Reports.jsx`, wire it into all four data loaders so it consistently constrains results, and keep the card-specific filters as additional controls without duplicating logic.

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;66753120-983a-4532-ae66-59cb20d84cad&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    });\n    \n-   // Filter states\n+   // Global filter (admin)\n+   const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n+ \n+   // Per-card filter states\n    const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n    const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });&quot;,
        &quot;oldStart&quot;: 24,
        &quot;newStart&quot;: 24,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 4
      },
      {
        &quot;diffString&quot;: &quot;        loadReportsData();\n      }\n-   }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n+   }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n  \n    const loadReportsData = async () =&gt; {&quot;,
        &quot;oldStart&quot;: 94,
        &quot;newStart&quot;: 97,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;        // Apply date range filter for admin; staff will always be restricted to today\n        if (userProfile?.role === &#39;admin&#39;) {\n-       if (salesDateRange.startDate) {\n-         query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n-       }\n-       if (salesDateRange.endDate) {\n-         query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n+         const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n+         const start = useGlobal ? globalDateRange.startDate : salesDateRange.startDate;\n+         const end = useGlobal ? globalDateRange.endDate : salesDateRange.endDate;\n+ \n+         if (start) {\n+           query = query.gte(&#39;sale_date&#39;, start);\n+         }\n+         if (end) {\n+           query = query.lte(&#39;sale_date&#39;, end);\n          }\n        }&quot;,
        &quot;oldStart&quot;: 123,
        &quot;newStart&quot;: 126,
        &quot;oldLines&quot;: 9,
        &quot;newLines&quot;: 13,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 9
      },
      {
        &quot;diffString&quot;: &quot;        // Apply filters (admin only; staff will be restricted to today via helper)\n        if (userProfile?.role === &#39;admin&#39;) {\n-         if (transactionsFilters.startDate) {\n-           query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n-         }\n-         if (transactionsFilters.endDate) {\n-           query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n+         const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n+         const start = useGlobal ? globalDateRange.startDate : transactionsFilters.startDate;\n+         const end = useGlobal ? globalDateRange.endDate : transactionsFilters.endDate;\n+ \n+         if (start) {\n+           query = query.gte(&#39;sale_date&#39;, start);\n+         }\n+         if (end) {\n+           query = query.lte(&#39;sale_date&#39;, end);\n          }\n          if (transactionsFilters.stallId) {&quot;,
        &quot;oldStart&quot;: 187,
        &quot;newStart&quot;: 194,
        &quot;oldLines&quot;: 9,
        &quot;newLines&quot;: 13,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 9
      },
      {
        &quot;diffString&quot;: &quot;        // Apply filters (admin only; staff will be restricted to today via helper)\n        if (userProfile?.role === &#39;admin&#39;) {\n-         if (expensesFilters.startDate) {\n-           query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n-         }\n-         if (expensesFilters.endDate) {\n-           query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n+         const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n+         const start = useGlobal ? globalDateRange.startDate : expensesFilters.startDate;\n+         const end = useGlobal ? globalDateRange.endDate : expensesFilters.endDate;\n+ \n+         if (start) {\n+           query = query.gte(&#39;date&#39;, start);\n+         }\n+         if (end) {\n+           query = query.lte(&#39;date&#39;, end);\n          }\n          if (expensesFilters.stallId) {&quot;,
        &quot;oldStart&quot;: 221,
        &quot;newStart&quot;: 232,
        &quot;oldLines&quot;: 9,
        &quot;newLines&quot;: 13,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 9
      },
      {
        &quot;diffString&quot;: &quot;          statsStallId = userProfile.stall_id || null;\n        } else if (userProfile?.role === &#39;admin&#39;) {\n-         statsStartDate = statisticsFilters.startDate || null;\n-         statsEndDate = statisticsFilters.endDate || null;\n+         const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n+         statsStartDate = (useGlobal ? globalDateRange.startDate : statisticsFilters.startDate) || null;\n+         statsEndDate = (useGlobal ? globalDateRange.endDate : statisticsFilters.endDate) || null;\n        }\n  &quot;,
        &quot;oldStart&quot;: 258,
        &quot;newStart&quot;: 273,
        &quot;oldLines&quot;: 6,
        &quot;newLines&quot;: 7,
        &quot;linesRemoved&quot;: 2,
        &quot;linesAdded&quot;: 3
      },
      {
        &quot;diffString&quot;: &quot;            &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n          &lt;/div&gt;\n+ \n+         {/* Global date filter - admin only */}\n+         {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n+           &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n+             &lt;div className=\&quot;card-body\&quot;&gt;\n+               &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n+                 &lt;div&gt;\n+                   &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n+                   &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n+                     Applies to all report sections. Local filters can still narrow down by stall.\n+                   &lt;/p&gt;\n+                 &lt;/div&gt;\n+                 &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;input\n+                       type=\&quot;date\&quot;\n+                       className=\&quot;input input-bordered input-sm\&quot;\n+                       value={globalDateRange.startDate}\n+                       onChange={(e) =&gt;\n+                         setGlobalDateRange({\n+                           ...globalDateRange,\n+                           startDate: e.target.value,\n+                         })\n+                       }\n+                     /&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;input\n+                       type=\&quot;date\&quot;\n+                       className=\&quot;input input-bordered input-sm\&quot;\n+                       value={globalDateRange.endDate}\n+                       onChange={(e) =&gt;\n+                         setGlobalDateRange({\n+                           ...globalDateRange,\n+                           endDate: e.target.value,\n+                         })\n+                       }\n+                     /&gt;\n+                   &lt;/div&gt;\n+                   &lt;div className=\&quot;form-control\&quot;&gt;\n+                     &lt;label className=\&quot;label\&quot;&gt;\n+                       &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n+                     &lt;/label&gt;\n+                     &lt;button\n+                       className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n+                       onClick={() =&gt; setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; })}\n+                     &gt;\n+                       Clear\n+                     &lt;/button&gt;\n+                   &lt;/div&gt;\n+                 &lt;/div&gt;\n+               &lt;/div&gt;\n+             &lt;/div&gt;\n+           &lt;/div&gt;\n+         )}\n  \n          {error &amp;&amp; (&quot;,
        &quot;oldStart&quot;: 436,
        &quot;newStart&quot;: 452,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 65,
        &quot;linesAdded&quot;: 61
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin)\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const start = useGlobal ? globalDateRange.startDate : salesDateRange.startDate;\n        const end = useGlobal ? globalDateRange.endDate : salesDateRange.endDate;\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const start = useGlobal ? globalDateRange.startDate : transactionsFilters.startDate;\n        const end = useGlobal ? globalDateRange.endDate : transactionsFilters.endDate;\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const start = useGlobal ? globalDateRange.startDate : expensesFilters.startDate;\n        const end = useGlobal ? globalDateRange.endDate : expensesFilters.endDate;\n\n        if (start) {\n          query = query.gte(&#39;date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;date&#39;, end);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        statsStartDate = (useGlobal ? globalDateRange.startDate : statisticsFilters.startDate) || null;\n        statsEndDate = (useGlobal ? globalDateRange.endDate : statisticsFilters.endDate) || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt;\n                        setGlobalDateRange({\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt;\n                        setGlobalDateRange({\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; })}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, startDate: e.target.value })}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, endDate: e.target.value })}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; })}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `src/Reports.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  99:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  506:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  554:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  663:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  674:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  743:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  759:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  766:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

### What the global filter does

- **New global date range (admin only)**  
  - At the top of `Reports.jsx` there is now a **Global Date Filter** card with **Start Date**, **End Date**, and a **Clear** button.  
  - State: `globalDateRange = { startDate, endDate }`.

- **How it applies to all four report sections**

  For **admin** users:
  - **Sales Overview by Stall**  
    - Uses the global date range if either global start or end is set; otherwise falls back to the card’s own `salesDateRange`.  
    - Filters on `sale_date`.
  - **Recent Transactions**  
    - Global date range (when set) filters `sale_date` for the transactions query; if global is empty, it uses `transactionsFilters.startDate` / `endDate`.  
    - The card’s **Stall** dropdown still filters by stall on top of the date range.
  - **Recent Expenses**  
    - Global date range (when set) filters `date` on the expenses query; otherwise it uses `expensesFilters.startDate` / `endDate`.  
    - The **Stall** dropdown continues to narrow results by stall.
  - **Key Statistics**  
    - Global date range (when set) defines `statsStartDate` / `statsEndDate` used for all three statistics queries (sales total, expenses total, and stall performance).  
    - If global is empty, the card’s own `statisticsFilters.startDate` / `endDate` are used instead; the **Stall** filter continues to work as before.

- **Staff behavior unchanged**
  - Staff are still restricted to **today + their stall** via `restrictToStaffStallAndToday` / `buildTodayRangePH`, and the global filter UI is hidden for them.

- **Tests / lint**
  - `src/Reports.jsx` has no new lint issues; project-level lint still shows only pre-existing errors in other files.

---

_**User (2025-11-16 05:55Z)**_

make this implementation, when making individual filtering of the four data displays or making global filtering, make sure it overrides the filtering of the previous

---

_**Agent (model default, mode Plan)**_

<think><details><summary>Thought Process</summary>
**Clarifying filter behavior**

I need to be concise about the behavior of new filters overriding previous ones. It's crucial to adjust the logic to ensure both global and local precedence with clear semantics. When setting a global filter, I need to make sure to clear specific card dates, and when changing per-card settings, I should clear the global settings for that effect. If I adjust any global dates, local ranges should clear, and vice versa. It'll take code changes, but it seems there's confusion about the implementation status due to system reminders about edit permissions.
**Explaining plan modifications**

I've already edited the plan earlier, so now I'm focusing on describing any needed modifications instead of making direct changes. There's some confusion, since the system says to use the create_plan tool to update plans, but the user specifically requested not to edit the plan file. To avoid conflict, I think I'll just explain how to adjust the logic without calling any tools. I'll mention that in the code, onChange handlers in Reports.jsx should reset other filters, ensuring we clear previous filters to maintain correct global precedence.</details></think>

---

### Behavior you’re asking for

- **When you change the global date filter:**  
  - It should override any existing per-card date ranges on all four displays.
- **When you change a card’s own date filter (Sales, Transactions, Expenses, Stats):**  
  - That card’s local filter should override any previous global filter (for that card’s data).

### How to adjust the current implementation

To get that clear “last action wins / overrides previous filter” behavior, you can do this in `Reports.jsx`:

- **1. When global filter changes, clear all local date ranges**

  In the global filter `onChange` handlers (for start/end date), after updating `globalDateRange`, also reset the per-card ranges:

  ```jsx
  setGlobalDateRange({ ...globalDateRange, startDate: e.target.value });
  setSalesDateRange({ startDate: '', endDate: '' });
  setTransactionsFilters(prev => ({ ...prev, startDate: '', endDate: '' }));
  setExpensesFilters(prev => ({ ...prev, startDate: '', endDate: '' }));
  setStatisticsFilters(prev => ({ ...prev, startDate: '', endDate: '' }));
  ```

  Do the same in the global **Clear** button so that you fully clear all date filtering:

  ```jsx
  setGlobalDateRange({ startDate: '', endDate: '' });
  setSalesDateRange({ startDate: '', endDate: '' });
  setTransactionsFilters({ startDate: '', endDate: '', stallId: '' });
  setExpensesFilters({ startDate: '', endDate: '', stallId: '' });
  setStatisticsFilters({ startDate: '', endDate: '', stallId: '' });
  ```

- **2. When a card’s local date filter changes, clear the global filter**

  For each card’s Start/End Date input, after updating its own filter, also clear `globalDateRange` so that card-specific filters take over:

  ```jsx
  // Example for Sales Overview card
  onChange={(e) => {
    setSalesDateRange({ ...salesDateRange, startDate: e.target.value });
    setGlobalDateRange({ startDate: '', endDate: '' });
  }}
  ```

  Repeat the same pattern for:
  - `transactionsFilters.startDate` / `endDate`
  - `expensesFilters.startDate` / `endDate`
  - `statisticsFilters.startDate` / `endDate`

- **3. Simplify query precedence (optional but clearer)**

  Once you’re clearing the “other side” when one filter changes, you can simplify your query logic to:

  - For each loader (`loadSalesByStall`, `loadTransactions`, `loadExpenses`, `loadStatistics` for admin):
    - Prefer `globalDateRange` if it has values.
    - Otherwise, use that card’s local date range.
  - This is essentially what you already have, but with the explicit clearing above, it guarantees that only the **most recent** filter (global or local) is active, so there’s no confusion or leftover constraints.

With these small state-reset tweaks, any new filter action (global or per-card) will explicitly override what was applied before.

---

_**User (2025-11-16 05:55Z)**_

yes,

before implementation, review codes, avoid duplication and misplaced logic at all costs



run tests, then code, then test again



alright, you may now proceed

---

_**Agent (model default, mode Plan)**_

<think><details><summary>Thought Process</summary>
**Implementing override behavior**

I need to implement override behavior based on the user’s direction to proceed with editing. First, I’ll review the code to avoid any duplication. It’s essential to run tests, or lint, before and after modifications. Although I’ve done this before, I’ll repeat it per the user’s request. I’ll modify the handlers for global and local filters, maybe create helper functions to keep things simple and avoid repetition. Steps include running lint, editing Reports.jsx, and updating date ranges for both global and local filters.
**Clarifying clear actions**

The "Clear" action needs careful consideration. If a user clears only a card, they might expect the global filter to remain active, but overriding previous options suggests that it should also neutralize any previous filters. It would be consistent to clear both global and local filters, resulting in no date filters at all. My plan includes resetting global dates while keeping per-card stall IDs intact. Also, local changes should only affect the specific card and reset the global date range, allowing that one card to take precedence while others remain under the old global filter.
**Understanding filtering requirements**

I need to focus on the user requirement: when making individual filtering or global filtering, it should override previous filters. This means that a change made for a specific card should not clear the global filter for other cards. However, our current logic gives precedence to the global filter if it's set. Simply clearing the global filter when a local change is made could lead to confusion. To achieve the desired functionality, I might need to implement more complex logic, like tracking active filters for each card or using timestamps for updates.
**Adjusting filtering logic**

I need to treat the global filter as having the highest precedence, but the user wants local changes to override the global filter for that specific card. This suggests that I should adjust the logic: prioritize local dates when available, defaulting to global only if local is empty, and defaulting to none if neither is set. This would allow local settings to override global without clearing it. However, I also need to implement a mechanism to track the last modified filter source, requiring recency tracking for accurate overrides. Maintaining a `lastFilterSource` state per card could help here.
**Implementing filter versioning**

I’m considering using a single `globalLastUpdated` timestamp alongside individual `localLastUpdated` timestamps for each card. This avoids unnecessary clearing while keeping the logic manageable without overengineering. I would set up state for global and transaction filter versions. Changes to either would increment the respective version. 

For filtering logic, if a card’s version exceeds the global version, it uses that card’s filter; otherwise, it defaults to global. Also, I plan to ensure that a global change that occurs after a local one can still take precedence. Lastly, I’ll run tests before and after any code changes in Reports.jsx to ensure everything’s compliant.</details></think>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  99:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  506:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  554:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  663:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  674:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  743:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  759:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  766:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;ff1f0b76-87b9-4520-bc67-9fa1b2de681e&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    // Global filter (admin)\n    const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n+   const [globalFilterVersion, setGlobalFilterVersion] = useState(0);\n  \n    // Per-card filter states\n    const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n+   const [salesFilterVersion, setSalesFilterVersion] = useState(0);\n    const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n    const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n    const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n+   const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);\n+   const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);\n+   const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);\n    \n    // Editing states&quot;,
        &quot;oldStart&quot;: 26,
        &quot;newStart&quot;: 26,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 15,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;        // Apply date range filter for admin; staff will always be restricted to today\n        if (userProfile?.role === &#39;admin&#39;) {\n-         const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n-         const start = useGlobal ? globalDateRange.startDate : salesDateRange.startDate;\n-         const end = useGlobal ? globalDateRange.endDate : salesDateRange.endDate;\n+         const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n+         const hasLocal = salesDateRange.startDate || salesDateRange.endDate;\n+         let start = null;\n+         let end = null;\n+ \n+         if (hasLocal &amp;&amp; salesFilterVersion &gt;= globalFilterVersion) {\n+           start = salesDateRange.startDate || null;\n+           end = salesDateRange.endDate || null;\n+         } else if (hasGlobal) {\n+           start = globalDateRange.startDate || null;\n+           end = globalDateRange.endDate || null;\n+         }\n  \n          if (start) {&quot;,
        &quot;oldStart&quot;: 126,
        &quot;newStart&quot;: 131,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 16,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 12
      },
      {
        &quot;diffString&quot;: &quot;        // Apply filters (admin only; staff will be restricted to today via helper)\n        if (userProfile?.role === &#39;admin&#39;) {\n-         const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n-         const start = useGlobal ? globalDateRange.startDate : transactionsFilters.startDate;\n-         const end = useGlobal ? globalDateRange.endDate : transactionsFilters.endDate;\n+         const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n+         const hasLocal = transactionsFilters.startDate || transactionsFilters.endDate;\n+         let start = null;\n+         let end = null;\n+ \n+         if (hasLocal &amp;&amp; transactionsFilterVersion &gt;= globalFilterVersion) {\n+           start = transactionsFilters.startDate || null;\n+           end = transactionsFilters.endDate || null;\n+         } else if (hasGlobal) {\n+           start = globalDateRange.startDate || null;\n+           end = globalDateRange.endDate || null;\n+         }\n  \n          if (start) {&quot;,
        &quot;oldStart&quot;: 194,
        &quot;newStart&quot;: 208,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 16,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 12
      },
      {
        &quot;diffString&quot;: &quot;        // Apply filters (admin only; staff will be restricted to today via helper)\n        if (userProfile?.role === &#39;admin&#39;) {\n-         const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n-         const start = useGlobal ? globalDateRange.startDate : expensesFilters.startDate;\n-         const end = useGlobal ? globalDateRange.endDate : expensesFilters.endDate;\n+         const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n+         const hasLocal = expensesFilters.startDate || expensesFilters.endDate;\n+         let start = null;\n+         let end = null;\n+ \n+         if (hasLocal &amp;&amp; expensesFilterVersion &gt;= globalFilterVersion) {\n+           start = expensesFilters.startDate || null;\n+           end = expensesFilters.endDate || null;\n+         } else if (hasGlobal) {\n+           start = globalDateRange.startDate || null;\n+           end = globalDateRange.endDate || null;\n+         }\n  \n          if (start) {&quot;,
        &quot;oldStart&quot;: 232,
        &quot;newStart&quot;: 255,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 16,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 12
      },
      {
        &quot;diffString&quot;: &quot;          statsStallId = userProfile.stall_id || null;\n        } else if (userProfile?.role === &#39;admin&#39;) {\n-         const useGlobal = globalDateRange.startDate || globalDateRange.endDate;\n-         statsStartDate = (useGlobal ? globalDateRange.startDate : statisticsFilters.startDate) || null;\n-         statsEndDate = (useGlobal ? globalDateRange.endDate : statisticsFilters.endDate) || null;\n+         const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n+         const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n+ \n+         if (hasLocal &amp;&amp; statisticsFilterVersion &gt;= globalFilterVersion) {\n+           statsStartDate = statisticsFilters.startDate || null;\n+           statsEndDate = statisticsFilters.endDate || null;\n+         } else if (hasGlobal) {\n+           statsStartDate = globalDateRange.startDate || null;\n+           statsEndDate = globalDateRange.endDate || null;\n+         } else {\n+           statsStartDate = null;\n+           statsEndDate = null;\n+         }\n        }\n  &quot;,
        &quot;oldStart&quot;: 273,
        &quot;newStart&quot;: 305,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 17,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 13
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin)\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [globalFilterVersion, setGlobalFilterVersion] = useState(0);\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [salesFilterVersion, setSalesFilterVersion] = useState(0);\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);\n  const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);\n  const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = salesDateRange.startDate || salesDateRange.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; salesFilterVersion &gt;= globalFilterVersion) {\n          start = salesDateRange.startDate || null;\n          end = salesDateRange.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = transactionsFilters.startDate || transactionsFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; transactionsFilterVersion &gt;= globalFilterVersion) {\n          start = transactionsFilters.startDate || null;\n          end = transactionsFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = expensesFilters.startDate || expensesFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; expensesFilterVersion &gt;= globalFilterVersion) {\n          start = expensesFilters.startDate || null;\n          end = expensesFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;date&#39;, end);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n\n        if (hasLocal &amp;&amp; statisticsFilterVersion &gt;= globalFilterVersion) {\n          statsStartDate = statisticsFilters.startDate || null;\n          statsEndDate = statisticsFilters.endDate || null;\n        } else if (hasGlobal) {\n          statsStartDate = globalDateRange.startDate || null;\n          statsEndDate = globalDateRange.endDate || null;\n        } else {\n          statsStartDate = null;\n          statsEndDate = null;\n        }\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt;\n                        setGlobalDateRange({\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt;\n                        setGlobalDateRange({\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; })}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, startDate: e.target.value })}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, endDate: e.target.value })}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; })}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;5edebf14-eecf-45ae-888c-53201110e1c6&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                        className=\&quot;input input-bordered input-sm\&quot;\n                        value={globalDateRange.startDate}\n-                       onChange={(e) =&gt;\n-                         setGlobalDateRange({\n-                           ...globalDateRange,\n+                       onChange={(e) =&gt; {\n+                         setGlobalDateRange((prev) =&gt; ({\n+                           ...prev,\n                            startDate: e.target.value,\n-                         })\n-                       }\n+                         }));\n+                         setGlobalFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      /&gt;\n                    &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 515,
        &quot;newStart&quot;: 515,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 6
      },
      {
        &quot;diffString&quot;: &quot;                        className=\&quot;input input-bordered input-sm\&quot;\n                        value={globalDateRange.endDate}\n-                       onChange={(e) =&gt;\n-                         setGlobalDateRange({\n-                           ...globalDateRange,\n+                       onChange={(e) =&gt; {\n+                         setGlobalDateRange((prev) =&gt; ({\n+                           ...prev,\n                            endDate: e.target.value,\n-                         })\n-                       }\n+                         }));\n+                         setGlobalFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      /&gt;\n                    &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 531,
        &quot;newStart&quot;: 532,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 6
      },
      {
        &quot;diffString&quot;: &quot;                      &lt;button\n                        className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n-                       onClick={() =&gt; setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; })}\n+                       onClick={() =&gt; {\n+                         setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n+                         setGlobalFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      &gt;\n                        Clear&quot;,
        &quot;oldStart&quot;: 545,
        &quot;newStart&quot;: 547,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 4
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin)\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [globalFilterVersion, setGlobalFilterVersion] = useState(0);\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [salesFilterVersion, setSalesFilterVersion] = useState(0);\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);\n  const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);\n  const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = salesDateRange.startDate || salesDateRange.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; salesFilterVersion &gt;= globalFilterVersion) {\n          start = salesDateRange.startDate || null;\n          end = salesDateRange.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = transactionsFilters.startDate || transactionsFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; transactionsFilterVersion &gt;= globalFilterVersion) {\n          start = transactionsFilters.startDate || null;\n          end = transactionsFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = expensesFilters.startDate || expensesFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; expensesFilterVersion &gt;= globalFilterVersion) {\n          start = expensesFilters.startDate || null;\n          end = expensesFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;date&#39;, end);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n\n        if (hasLocal &amp;&amp; statisticsFilterVersion &gt;= globalFilterVersion) {\n          statsStartDate = statisticsFilters.startDate || null;\n          statsEndDate = statisticsFilters.endDate || null;\n        } else if (hasGlobal) {\n          statsStartDate = globalDateRange.startDate || null;\n          statsEndDate = globalDateRange.endDate || null;\n        } else {\n          statsStartDate = null;\n          statsEndDate = null;\n        }\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, startDate: e.target.value })}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, endDate: e.target.value })}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; })}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;81c6bb80-1e50-477e-be41-e7f4f9805bdf&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n-                     onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, startDate: e.target.value })}\n+                     onChange={(e) =&gt; {\n+                       setSalesDateRange((prev) =&gt; ({\n+                         ...prev,\n+                         startDate: e.target.value,\n+                       }));\n+                       setSalesFilterVersion((prev) =&gt; prev + 1);\n+                     }}\n                    /&gt;\n                  &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 618,
        &quot;newStart&quot;: 618,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 7
      },
      {
        &quot;diffString&quot;: &quot;                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n-                     onChange={(e) =&gt; setSalesDateRange({ ...salesDateRange, endDate: e.target.value })}\n+                     onChange={(e) =&gt; {\n+                       setSalesDateRange((prev) =&gt; ({\n+                         ...prev,\n+                         endDate: e.target.value,\n+                       }));\n+                       setSalesFilterVersion((prev) =&gt; prev + 1);\n+                     }}\n                    /&gt;\n                  &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 629,
        &quot;newStart&quot;: 635,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 7
      },
      {
        &quot;diffString&quot;: &quot;                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n-                     onClick={() =&gt; setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; })}\n+                     onClick={() =&gt; {\n+                       setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n+                       setSalesFilterVersion((prev) =&gt; prev + 1);\n+                     }}\n                    &gt;\n                      Clear&quot;,
        &quot;oldStart&quot;: 638,
        &quot;newStart&quot;: 650,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 4
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin)\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [globalFilterVersion, setGlobalFilterVersion] = useState(0);\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [salesFilterVersion, setSalesFilterVersion] = useState(0);\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);\n  const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);\n  const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = salesDateRange.startDate || salesDateRange.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; salesFilterVersion &gt;= globalFilterVersion) {\n          start = salesDateRange.startDate || null;\n          end = salesDateRange.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = transactionsFilters.startDate || transactionsFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; transactionsFilterVersion &gt;= globalFilterVersion) {\n          start = transactionsFilters.startDate || null;\n          end = transactionsFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = expensesFilters.startDate || expensesFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; expensesFilterVersion &gt;= globalFilterVersion) {\n          start = expensesFilters.startDate || null;\n          end = expensesFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;date&#39;, end);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n\n        if (hasLocal &amp;&amp; statisticsFilterVersion &gt;= globalFilterVersion) {\n          statsStartDate = statisticsFilters.startDate || null;\n          statsEndDate = statisticsFilters.endDate || null;\n        } else if (hasGlobal) {\n          statsStartDate = globalDateRange.startDate || null;\n          statsEndDate = globalDateRange.endDate || null;\n        } else {\n          statsStartDate = null;\n          statsEndDate = null;\n        }\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        startDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        endDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; {\n                      setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters({\n                          ...transactionsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;a6736e12-d4d7-4834-bb25-7868b8b86202&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                        className=\&quot;input input-bordered input-sm\&quot;\n                        value={transactionsFilters.startDate}\n-                       onChange={(e) =&gt;\n-                         setTransactionsFilters({\n-                           ...transactionsFilters,\n+                       onChange={(e) =&gt; {\n+                         setTransactionsFilters((prev) =&gt; ({\n+                           ...prev,\n                            startDate: e.target.value,\n-                         })\n-                       }\n+                         }));\n+                         setTransactionsFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      /&gt;\n                    &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 731,
        &quot;newStart&quot;: 731,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 6
      },
      {
        &quot;diffString&quot;: &quot;                        className=\&quot;input input-bordered input-sm\&quot;\n                        value={transactionsFilters.endDate}\n-                       onChange={(e) =&gt;\n-                         setTransactionsFilters({\n-                           ...transactionsFilters,\n+                       onChange={(e) =&gt; {\n+                         setTransactionsFilters((prev) =&gt; ({\n+                           ...prev,\n                            endDate: e.target.value,\n-                         })\n-                       }\n+                         }));\n+                         setTransactionsFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      /&gt;\n                    &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 747,
        &quot;newStart&quot;: 748,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 6
      },
      {
        &quot;diffString&quot;: &quot;                        value={transactionsFilters.stallId}\n                        onChange={(e) =&gt;\n-                         setTransactionsFilters({\n-                           ...transactionsFilters,\n+                         setTransactionsFilters((prev) =&gt; ({\n+                           ...prev,\n                            stallId: e.target.value,\n-                         })\n+                         }))\n                        }\n                      &gt;&quot;,
        &quot;oldStart&quot;: 763,
        &quot;newStart&quot;: 765,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 3
      },
      {
        &quot;diffString&quot;: &quot;                      &lt;button\n                        className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n-                       onClick={() =&gt;\n-                         setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n-                       }\n+                       onClick={() =&gt; {\n+                         setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n+                         setTransactionsFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      &gt;\n                        Clear&quot;,
        &quot;oldStart&quot;: 783,
        &quot;newStart&quot;: 785,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 4
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin)\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [globalFilterVersion, setGlobalFilterVersion] = useState(0);\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [salesFilterVersion, setSalesFilterVersion] = useState(0);\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);\n  const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);\n  const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = salesDateRange.startDate || salesDateRange.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; salesFilterVersion &gt;= globalFilterVersion) {\n          start = salesDateRange.startDate || null;\n          end = salesDateRange.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = transactionsFilters.startDate || transactionsFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; transactionsFilterVersion &gt;= globalFilterVersion) {\n          start = transactionsFilters.startDate || null;\n          end = transactionsFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = expensesFilters.startDate || expensesFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; expensesFilterVersion &gt;= globalFilterVersion) {\n          start = expensesFilters.startDate || null;\n          end = expensesFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;date&#39;, end);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n\n        if (hasLocal &amp;&amp; statisticsFilterVersion &gt;= globalFilterVersion) {\n          statsStartDate = statisticsFilters.startDate || null;\n          statsEndDate = statisticsFilters.endDate || null;\n        } else if (hasGlobal) {\n          statsStartDate = globalDateRange.startDate || null;\n          statsEndDate = globalDateRange.endDate || null;\n        } else {\n          statsStartDate = null;\n          statsEndDate = null;\n        }\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        startDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        endDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; {\n                      setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters({\n                          ...expensesFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;3d12a593-6123-4c57-a8b5-0ae01d555bbb&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                        className=\&quot;input input-bordered input-sm\&quot;\n                        value={expensesFilters.startDate}\n-                       onChange={(e) =&gt;\n-                         setExpensesFilters({\n-                           ...expensesFilters,\n+                       onChange={(e) =&gt; {\n+                         setExpensesFilters((prev) =&gt; ({\n+                           ...prev,\n                            startDate: e.target.value,\n-                         })\n-                       }\n+                         }));\n+                         setExpensesFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      /&gt;\n                    &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 947,
        &quot;newStart&quot;: 947,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 6
      },
      {
        &quot;diffString&quot;: &quot;                        className=\&quot;input input-bordered input-sm\&quot;\n                        value={expensesFilters.endDate}\n-                       onChange={(e) =&gt;\n-                         setExpensesFilters({\n-                           ...expensesFilters,\n+                       onChange={(e) =&gt; {\n+                         setExpensesFilters((prev) =&gt; ({\n+                           ...prev,\n                            endDate: e.target.value,\n-                         })\n-                       }\n+                         }));\n+                         setExpensesFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      /&gt;\n                    &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 963,
        &quot;newStart&quot;: 964,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 6
      },
      {
        &quot;diffString&quot;: &quot;                        value={expensesFilters.stallId}\n                        onChange={(e) =&gt;\n-                         setExpensesFilters({\n-                           ...expensesFilters,\n+                         setExpensesFilters((prev) =&gt; ({\n+                           ...prev,\n                            stallId: e.target.value,\n-                         })\n+                         }))\n                        }\n                      &gt;&quot;,
        &quot;oldStart&quot;: 979,
        &quot;newStart&quot;: 981,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 3
      },
      {
        &quot;diffString&quot;: &quot;                      &lt;button\n                        className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n-                       onClick={() =&gt;\n-                         setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n-                       }\n+                       onClick={() =&gt; {\n+                         setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n+                         setExpensesFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      &gt;\n                        Clear&quot;,
        &quot;oldStart&quot;: 999,
        &quot;newStart&quot;: 1001,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 4
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin)\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [globalFilterVersion, setGlobalFilterVersion] = useState(0);\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [salesFilterVersion, setSalesFilterVersion] = useState(0);\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);\n  const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);\n  const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = salesDateRange.startDate || salesDateRange.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; salesFilterVersion &gt;= globalFilterVersion) {\n          start = salesDateRange.startDate || null;\n          end = salesDateRange.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = transactionsFilters.startDate || transactionsFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; transactionsFilterVersion &gt;= globalFilterVersion) {\n          start = transactionsFilters.startDate || null;\n          end = transactionsFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = expensesFilters.startDate || expensesFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; expensesFilterVersion &gt;= globalFilterVersion) {\n          start = expensesFilters.startDate || null;\n          end = expensesFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;date&#39;, end);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n\n        if (hasLocal &amp;&amp; statisticsFilterVersion &gt;= globalFilterVersion) {\n          statsStartDate = statisticsFilters.startDate || null;\n          statsEndDate = statisticsFilters.endDate || null;\n        } else if (hasGlobal) {\n          statsStartDate = globalDateRange.startDate || null;\n          statsEndDate = globalDateRange.endDate || null;\n        } else {\n          statsStartDate = null;\n          statsEndDate = null;\n        }\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        startDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        endDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; {\n                      setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          startDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          endDate: e.target.value,\n                        })\n                      }\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters({\n                          ...statisticsFilters,\n                          stallId: e.target.value,\n                        })\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt;\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n                      }\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;be711e44-15bb-4195-a19a-4d1565899b0e&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                        className=\&quot;input input-bordered input-sm\&quot;\n                        value={statisticsFilters.startDate}\n-                       onChange={(e) =&gt;\n-                         setStatisticsFilters({\n-                           ...statisticsFilters,\n+                       onChange={(e) =&gt; {\n+                         setStatisticsFilters((prev) =&gt; ({\n+                           ...prev,\n                            startDate: e.target.value,\n-                         })\n-                       }\n+                         }));\n+                         setStatisticsFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      /&gt;\n                    &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 1153,
        &quot;newStart&quot;: 1153,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 6
      },
      {
        &quot;diffString&quot;: &quot;                        className=\&quot;input input-bordered input-sm\&quot;\n                        value={statisticsFilters.endDate}\n-                       onChange={(e) =&gt;\n-                         setStatisticsFilters({\n-                           ...statisticsFilters,\n+                       onChange={(e) =&gt; {\n+                         setStatisticsFilters((prev) =&gt; ({\n+                           ...prev,\n                            endDate: e.target.value,\n-                         })\n-                       }\n+                         }));\n+                         setStatisticsFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      /&gt;\n                    &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 1169,
        &quot;newStart&quot;: 1170,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 5,
        &quot;linesAdded&quot;: 6
      },
      {
        &quot;diffString&quot;: &quot;                        value={statisticsFilters.stallId}\n                        onChange={(e) =&gt;\n-                         setStatisticsFilters({\n-                           ...statisticsFilters,\n+                         setStatisticsFilters((prev) =&gt; ({\n+                           ...prev,\n                            stallId: e.target.value,\n-                         })\n+                         }))\n                        }\n                      &gt;&quot;,
        &quot;oldStart&quot;: 1185,
        &quot;newStart&quot;: 1187,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 3
      },
      {
        &quot;diffString&quot;: &quot;                      &lt;button\n                        className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n-                       onClick={() =&gt;\n-                         setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; })\n-                       }\n+                       onClick={() =&gt; {\n+                         setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n+                         setStatisticsFilterVersion((prev) =&gt; prev + 1);\n+                       }}\n                      &gt;\n                        Clear&quot;,
        &quot;oldStart&quot;: 1205,
        &quot;newStart&quot;: 1207,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 4
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin)\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [globalFilterVersion, setGlobalFilterVersion] = useState(0);\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [salesFilterVersion, setSalesFilterVersion] = useState(0);\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);\n  const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);\n  const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = salesDateRange.startDate || salesDateRange.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; salesFilterVersion &gt;= globalFilterVersion) {\n          start = salesDateRange.startDate || null;\n          end = salesDateRange.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = transactionsFilters.startDate || transactionsFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; transactionsFilterVersion &gt;= globalFilterVersion) {\n          start = transactionsFilters.startDate || null;\n          end = transactionsFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = expensesFilters.startDate || expensesFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (hasLocal &amp;&amp; expensesFilterVersion &gt;= globalFilterVersion) {\n          start = expensesFilters.startDate || null;\n          end = expensesFilters.endDate || null;\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;date&#39;, end);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n\n        if (hasLocal &amp;&amp; statisticsFilterVersion &gt;= globalFilterVersion) {\n          statsStartDate = statisticsFilters.startDate || null;\n          statsEndDate = statisticsFilters.endDate || null;\n        } else if (hasGlobal) {\n          statsStartDate = globalDateRange.startDate || null;\n          statsEndDate = globalDateRange.endDate || null;\n        } else {\n          statsStartDate = null;\n          statsEndDate = null;\n        }\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        startDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        endDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; {\n                      setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `src/Reports.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  104:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  506:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  554:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  663:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  674:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  743:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  759:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  766:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

### Updated override behavior

- **Last change wins per card vs. global**  
  - I added lightweight “versions” to track which filter was changed most recently:
    - Global: `globalFilterVersion`  
    - Per card: `salesFilterVersion`, `transactionsFilterVersion`, `expensesFilterVersion`, `statisticsFilterVersion`.
  - Whenever you change:
    - The **global date filter**, its version increments.
    - A **card’s local date range**, that card’s version increments.

- **How loaders decide which filter to use**

  For **admin** in each loader:

  - **Sales Overview (`loadSalesByStall`)**  

    ```startLine:endLine:src/Reports.jsx
    if (userProfile?.role === 'admin') {
      const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;
      const hasLocal = salesDateRange.startDate || salesDateRange.endDate;
      let start = null;
      let end = null;

      if (hasLocal && salesFilterVersion >= globalFilterVersion) {
        start = salesDateRange.startDate || null;
        end = salesDateRange.endDate || null;
      } else if (hasGlobal) {
        start = globalDateRange.startDate || null;
        end = globalDateRange.endDate || null;
      }

      if (start) query = query.gte('sale_date', start);
      if (end) query = query.lte('sale_date', end);
    }
    ```

  - **Recent Transactions (`loadTransactions`)** uses the same pattern (with `transactionsFilters` / `transactionsFilterVersion`) to decide whether to filter `sale_date` by the card’s range or by the global range.

  - **Recent Expenses (`loadExpenses`)** uses the same logic on `date` with `expensesFilters` / `expensesFilterVersion`.

  - **Key Statistics (`loadStatistics`)**:

    ```startLine:endLine:src/Reports.jsx
    } else if (userProfile?.role === 'admin') {
      const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;
      const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;

      if (hasLocal && statisticsFilterVersion >= globalFilterVersion) {
        statsStartDate = statisticsFilters.startDate || null;
        statsEndDate = statisticsFilters.endDate || null;
      } else if (hasGlobal) {
        statsStartDate = globalDateRange.startDate || null;
        statsEndDate = globalDateRange.endDate || null;
      } else {
        statsStartDate = null;
        statsEndDate = null;
      }
    }
    ```

- **What this means in practice**

  - If you **change the global date filter last**, its version becomes highest, and all four sections use the **global dates**, overriding any earlier local filters.
  - If you then **change a specific card’s date filter**, that card’s version becomes highest, so **that card switches to its local dates**, overriding the global filter just for that display; the others still follow the global filter.
  - Staff behavior (always today + their stall) remains unchanged, and all changes pass lint for `Reports.jsx`; project-level lint issues remain only in other files you haven’t touched.

---

_**User (2025-11-16 05:55Z)**_

the clear button should also work againsts the global filtering

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Evaluating clear button functionality**

I need to adjust the local Clear button so it also resets the global filter for the card. The user wants it to work against any previously applied global filters. Right now, if the global date range is still active and has a version that's equal to or higher than local’s, pressing Clear won't truly remove that constraint. To improve this, I could set a card-level flag to ignore the global filter when Clear is clicked.
**Simplifying card filtering logic**

For the card's Clear button, I want it to clear the global date range and update the global filter version, resulting in no date filter. However, users might want to clear only one card while keeping the global setting for others. Their mention of "against the global filtering" suggests the Clear action should override the global settings for that specific card. I think we should implement a card-local override, like a boolean flag `salesIgnoreGlobal`. While this adds complexity, it meets the requirement for the Clear button to handle individual filtering effectively.
**Implementing Clear button logic**

I want to treat the Clear action as a local function that sets the card filter version higher than the global one and marks it as "no filter." Currently, if the Clear action empties the dates, it sets `hasLocal` to false, which defaults to the global filter. I could introduce a per-card `salesFilterMode` to track its state more accurately. While we could incorporate booleans for overrides, I’m thinking it might be simpler to keep things clean by adopting explicit modes for each card and minimizing versioning complexity.
**Refining loader logic**

I can enhance the loader logic to consider the local version even when no local dates are set. If `salesFilterVersion` is greater than or equal to `globalFilterVersion`, and there are no local dates, we can apply a "no filter" condition. This fits user expectations perfectly. The Clear action will still increment the `salesFilterVersion` while keeping dates empty. I'll adjust the code to check versions correctly and ensure the global Clear action works as intended, making sure it keeps the global date range empty.
**Implementing global Clear functionality**

After pressing the global Clear, the global version will be the highest while the card version remains lower, resulting in no date filter applied. This setup meets the requirement that the Clear button should override global filtering. When the card Clear is pressed later, the card version will be greater than or equal to the global version, and since there’s no local data, the loader won’t apply the global filter. I’ll implement a small patch now and then lint `Reports.jsx`, possibly doing a full lint check as well.</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;77a19150-9e05-4f95-9dd1-a9e34716772c&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;          let end = null;\n  \n-         if (hasLocal &amp;&amp; salesFilterVersion &gt;= globalFilterVersion) {\n-           start = salesDateRange.startDate || null;\n-           end = salesDateRange.endDate || null;\n+         if (salesFilterVersion &gt;= globalFilterVersion) {\n+           // Latest action was on this card; use local dates if present, otherwise no date filter\n+           if (hasLocal) {\n+             start = salesDateRange.startDate || null;\n+             end = salesDateRange.endDate || null;\n+           }\n          } else if (hasGlobal) {\n+           // Global filter is newer\n            start = globalDateRange.startDate || null;\n            end = globalDateRange.endDate || null;&quot;,
        &quot;oldStart&quot;: 136,
        &quot;newStart&quot;: 136,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 12,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 7
      },
      {
        &quot;diffString&quot;: &quot;          let end = null;\n  \n-         if (hasLocal &amp;&amp; transactionsFilterVersion &gt;= globalFilterVersion) {\n-           start = transactionsFilters.startDate || null;\n-           end = transactionsFilters.endDate || null;\n+         if (transactionsFilterVersion &gt;= globalFilterVersion) {\n+           if (hasLocal) {\n+             start = transactionsFilters.startDate || null;\n+             end = transactionsFilters.endDate || null;\n+           }\n          } else if (hasGlobal) {\n            start = globalDateRange.startDate || null;&quot;,
        &quot;oldStart&quot;: 213,
        &quot;newStart&quot;: 217,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;          let end = null;\n  \n-         if (hasLocal &amp;&amp; expensesFilterVersion &gt;= globalFilterVersion) {\n-           start = expensesFilters.startDate || null;\n-           end = expensesFilters.endDate || null;\n+         if (expensesFilterVersion &gt;= globalFilterVersion) {\n+           if (hasLocal) {\n+             start = expensesFilters.startDate || null;\n+             end = expensesFilters.endDate || null;\n+           }\n          } else if (hasGlobal) {\n            start = globalDateRange.startDate || null;&quot;,
        &quot;oldStart&quot;: 260,
        &quot;newStart&quot;: 266,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 5
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin)\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [globalFilterVersion, setGlobalFilterVersion] = useState(0);\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [salesFilterVersion, setSalesFilterVersion] = useState(0);\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);\n  const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);\n  const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = salesDateRange.startDate || salesDateRange.endDate;\n        let start = null;\n        let end = null;\n\n        if (salesFilterVersion &gt;= globalFilterVersion) {\n          // Latest action was on this card; use local dates if present, otherwise no date filter\n          if (hasLocal) {\n            start = salesDateRange.startDate || null;\n            end = salesDateRange.endDate || null;\n          }\n        } else if (hasGlobal) {\n          // Global filter is newer\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = transactionsFilters.startDate || transactionsFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (transactionsFilterVersion &gt;= globalFilterVersion) {\n          if (hasLocal) {\n            start = transactionsFilters.startDate || null;\n            end = transactionsFilters.endDate || null;\n          }\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = expensesFilters.startDate || expensesFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (expensesFilterVersion &gt;= globalFilterVersion) {\n          if (hasLocal) {\n            start = expensesFilters.startDate || null;\n            end = expensesFilters.endDate || null;\n          }\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;date&#39;, end);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n\n        if (hasLocal &amp;&amp; statisticsFilterVersion &gt;= globalFilterVersion) {\n          statsStartDate = statisticsFilters.startDate || null;\n          statsEndDate = statisticsFilters.endDate || null;\n        } else if (hasGlobal) {\n          statsStartDate = globalDateRange.startDate || null;\n          statsEndDate = globalDateRange.endDate || null;\n        } else {\n          statsStartDate = null;\n          statsEndDate = null;\n        }\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        startDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        endDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; {\n                      setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;323d1c12-a0bb-4f51-a3f2-fcb5e5a3dc79&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;          const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n  \n-         if (hasLocal &amp;&amp; statisticsFilterVersion &gt;= globalFilterVersion) {\n-           statsStartDate = statisticsFilters.startDate || null;\n-           statsEndDate = statisticsFilters.endDate || null;\n+         if (statisticsFilterVersion &gt;= globalFilterVersion) {\n+           if (hasLocal) {\n+             statsStartDate = statisticsFilters.startDate || null;\n+             statsEndDate = statisticsFilters.endDate || null;\n+           } else {\n+             // Local clear is the latest action: no date filter for statistics\n+             statsStartDate = null;\n+             statsEndDate = null;\n+           }\n          } else if (hasGlobal) {\n            statsStartDate = globalDateRange.startDate || null;&quot;,
        &quot;oldStart&quot;: 316,
        &quot;newStart&quot;: 316,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 13,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 9
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin)\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [globalFilterVersion, setGlobalFilterVersion] = useState(0);\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [salesFilterVersion, setSalesFilterVersion] = useState(0);\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);\n  const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);\n  const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = salesDateRange.startDate || salesDateRange.endDate;\n        let start = null;\n        let end = null;\n\n        if (salesFilterVersion &gt;= globalFilterVersion) {\n          // Latest action was on this card; use local dates if present, otherwise no date filter\n          if (hasLocal) {\n            start = salesDateRange.startDate || null;\n            end = salesDateRange.endDate || null;\n          }\n        } else if (hasGlobal) {\n          // Global filter is newer\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = transactionsFilters.startDate || transactionsFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (transactionsFilterVersion &gt;= globalFilterVersion) {\n          if (hasLocal) {\n            start = transactionsFilters.startDate || null;\n            end = transactionsFilters.endDate || null;\n          }\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;sale_date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;sale_date&#39;, end);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = expensesFilters.startDate || expensesFilters.endDate;\n        let start = null;\n        let end = null;\n\n        if (expensesFilterVersion &gt;= globalFilterVersion) {\n          if (hasLocal) {\n            start = expensesFilters.startDate || null;\n            end = expensesFilters.endDate || null;\n          }\n        } else if (hasGlobal) {\n          start = globalDateRange.startDate || null;\n          end = globalDateRange.endDate || null;\n        }\n\n        if (start) {\n          query = query.gte(&#39;date&#39;, start);\n        }\n        if (end) {\n          query = query.lte(&#39;date&#39;, end);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n        const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n\n        if (statisticsFilterVersion &gt;= globalFilterVersion) {\n          if (hasLocal) {\n            statsStartDate = statisticsFilters.startDate || null;\n            statsEndDate = statisticsFilters.endDate || null;\n          } else {\n            // Local clear is the latest action: no date filter for statistics\n            statsStartDate = null;\n            statsEndDate = null;\n          }\n        } else if (hasGlobal) {\n          statsStartDate = globalDateRange.startDate || null;\n          statsEndDate = globalDateRange.endDate || null;\n        } else {\n          statsStartDate = null;\n          statsEndDate = null;\n        }\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        startDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        endDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; {\n                      setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `src/Reports.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  104:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  506:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  554:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  663:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  674:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  743:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  759:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  766:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

### Updated clear behavior vs global filter

- **Per-card Clear now overrides global for that card**
  - Each card has a simple “version” counter (`salesFilterVersion`, `transactionsFilterVersion`, `expensesFilterVersion`, `statisticsFilterVersion`) and the global filter has `globalFilterVersion`.
  - The loaders now use **version precedence**:
    - If a card’s version is **≥ global’s version**, that card is considered the latest action.
      - If the card has dates, those dates are used.
      - If the card has no dates (because you pressed Clear), it applies **no date filter at all** for that card, even if the global filter still has values.
    - If the global version is newer and has dates, its date range is used.

- **What this means in the UI**

  - Scenario: set a global range, then:
    - **Sales Overview**: if you hit Clear on the Sales card, it increments `salesFilterVersion` and empties its dates; the loader sees `salesFilterVersion ≥ globalFilterVersion` and applies **no date filter** for sales while the other cards still obey the global range.
    - Same for **Transactions**, **Expenses**, and **Statistics**: their Clear buttons “win” over the global filter for that specific card only.

- **Code behavior in loaders (example)**

  For sales:

  ```startLine:endLine:src/Reports.jsx
  if (userProfile?.role === 'admin') {
    const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;
    const hasLocal = salesDateRange.startDate || salesDateRange.endDate;
    let start = null;
    let end = null;

    if (salesFilterVersion >= globalFilterVersion) {
      if (hasLocal) {
        start = salesDateRange.startDate || null;
        end = salesDateRange.endDate || null;
      }
    } else if (hasGlobal) {
      start = globalDateRange.startDate || null;
      end = globalDateRange.endDate || null;
    }

    if (start) query = query.gte('sale_date', start);
    if (end) query = query.lte('sale_date', end);
  }
  ```

  The same pattern is applied in `loadTransactions`, `loadExpenses`, and `loadStatistics`.

- **Tests / lint**

  - `src/Reports.jsx` has no lint errors; project-level lint still only shows pre-existing issues in other files.

---

_**User (2025-11-16 05:55Z)**_

investigate the clear action from every card, why does feel like it has delays, or that i need to click it multiple times before reflecting results? is there duplication? fix or optimized it. but make sure individual clear buttons, or change in date period wont affect other cards. 



review codes, and avoid duplication at all costs

---

_**Agent (model default, mode Plan)**_



---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/Reports.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Simplifying state management**

I’m thinking about how loaders will only consider local states rather than a global range during queries. This approach simplifies things, eliminates duplication logic, and ensures that any changes to a card only affect that specific card by clearing its own state. We can still add a global filter for convenience, but the user prefers that changing a date in one card doesn't change others. It's important that local changes remain isolated after a global impact, which fits the requirements.
**Planning code changes**

I need to adjust the code based on the user’s request, but I’m in a plan mode right now, which means I can't implement any changes or run non-readonly tools. The system emphasizes that I should explain the design instead. I’ll propose a simplified design and address the performance issue related to multiple clicks and the removal of versioning and duplication. I need to provide a conceptual description of the patch without actually applying it, keeping my response concise yet informative. Let’s outline the key points.
**Diagnosing filter issues**

I’m diagnosing a problem caused by `globalFilterVersion` conflicting with local versions. Clearing only affects local filters, while global ones, which have a higher version when changed recently, remain unaffected. This leads to users feeling like they need multiple clicks. There's also repeated precedence logic across four loaders. 

For a proposed refactor, I suggest removing `globalFilterVersion` and related states. In the filter UIs, changing or clearing the global filter should update each card’s local date ranges and filters simultaneously.
**Clarifying filter usage**

The global filter's only role is to "broadcast" values. Each card only reads its local state, meaning that the Clear function resets just that specific card without affecting the global state.

For the loaders, especially for admins, I suggest using local card filters. In `loadSalesByStall`, I can apply filters based on `salesDateRange.startDate` and `endDate`. This way, we eliminate duplication and prevent inter-card coupling. This makes Clear a single click that immediately affects only one card, while global updates affect all cards at once. If a global Clear is needed, we can maintain the logic to reset local states.</details></think>

---

### Why Clear feels delayed / needs multiple clicks

The “laggy” or multi-click Clear behavior is coming from the **version-based precedence** between the global and local filters:

- We currently track:
  - `globalFilterVersion`
  - `salesFilterVersion`, `transactionsFilterVersion`, `expensesFilterVersion`, `statisticsFilterVersion`
- In each loader we do logic like:

```startLine:endLine:src/Reports.jsx
if (userProfile?.role === 'admin') {
  const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;
  const hasLocal = salesDateRange.startDate || salesDateRange.endDate;
  let start = null;
  let end = null;

  if (salesFilterVersion >= globalFilterVersion) {
    if (hasLocal) {
      start = salesDateRange.startDate || null;
      end = salesDateRange.endDate || null;
    }
  } else if (hasGlobal) {
    start = globalDateRange.startDate || null;
    end = globalDateRange.endDate || null;
  }
  // ...
}
```

Effect in practice:

- If **global** was changed more recently than a card, `globalFilterVersion > salesFilterVersion`.
- When you hit **Clear** on that card:
  - We clear the card’s dates and increment `salesFilterVersion`.
  - But **as long as `salesFilterVersion` is still < `globalFilterVersion`, the loader keeps using the global range**, so the Clear appears to “do nothing”.
  - Only once `salesFilterVersion` catches up (after one or more changes) does the card start ignoring global and reflect the Clear.

That’s why it can feel like you must click Clear multiple times or wait for a “refresh”: the precedence logic is fighting you.

There’s also duplicated precedence code in all four loaders (`loadSalesByStall`, `loadTransactions`, `loadExpenses`, `loadStatistics`), which makes the behavior harder to reason about and tweak.

---

### Target behavior (based on your latest requirements)

1. **Each card is independent**:
   - Changing or clearing the date filter on one card **must not affect** the others.
2. **Global filter is a convenience**:
   - When you change it, it should apply that range to all cards at that moment.
   - After that, each card can be changed or cleared independently.
3. **Clear is always immediate and single-click**:
   - Pressing Clear on a card should **always** immediately remove its date filter and reload that card using only its own state.

Given these constraints, the *simplest and cleanest* model is:

- **Global filter only writes into each card’s local state.**
- All query logic reads **only local state** (`salesDateRange`, `transactionsFilters`, `expensesFilters`, `statisticsFilters`).
- No version counters, no global-vs-local precedence checks.

---

### Concrete refactor (no duplication, no delay)

#### 1. Remove version-based precedence

In `Reports.jsx`:

- Remove these states entirely:

```startLine:endLine:src/Reports.jsx
const [globalFilterVersion, setGlobalFilterVersion] = useState(0);
const [salesFilterVersion, setSalesFilterVersion] = useState(0);
const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);
const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);
const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);
```

- In **all loaders**, delete the `*_FilterVersion` / `globalFilterVersion` logic and replace it with simple local-only checks:

Example for **sales**:

```startLine:endLine:src/Reports.jsx
if (userProfile?.role === 'admin') {
  if (salesDateRange.startDate) {
    query = query.gte('sale_date', salesDateRange.startDate);
  }
  if (salesDateRange.endDate) {
    query = query.lte('sale_date', salesDateRange.endDate);
  }
}
```

For **transactions**:

```startLine:endLine:src/Reports.jsx
if (userProfile?.role === 'admin') {
  if (transactionsFilters.startDate) {
    query = query.gte('sale_date', transactionsFilters.startDate);
  }
  if (transactionsFilters.endDate) {
    query = query.lte('sale_date', transactionsFilters.endDate);
  }
  if (transactionsFilters.stallId) {
    query = query.eq('stall_id', transactionsFilters.stallId);
  }
}
```

For **expenses**, same pattern on the `date` column using `expensesFilters`, and for **statistics**, derive `statsStartDate` / `statsEndDate` purely from `statisticsFilters` when `role === 'admin'`.

This removes all cross-entity precedence logic and duplication.

#### 2. Make the global filter just broadcast its range once

Keep `globalDateRange` for UI, but change its handlers so it just sets the **local** filters on all cards:

- When global **Start Date** or **End Date** changes:

```jsx
onChange={(e) => {
  const next = { ...globalDateRange, startDate: e.target.value }; // or endDate for the other
  setGlobalDateRange(next);

  // Broadcast to all cards
  setSalesDateRange(next);
  setTransactionsFilters((prev) => ({ ...prev, startDate: next.startDate, endDate: next.endDate }));
  setExpensesFilters((prev) => ({ ...prev, startDate: next.startDate, endDate: next.endDate }));
  setStatisticsFilters((prev) => ({ ...prev, startDate: next.startDate, endDate: next.endDate }));
}}
```

- When global **Clear** is pressed, it can reset everything (if you want that behavior):

```jsx
onClick={() => {
  setGlobalDateRange({ startDate: '', endDate: '' });
  setSalesDateRange({ startDate: '', endDate: '' });
  setTransactionsFilters({ startDate: '', endDate: '', stallId: transactionsFilters.stallId });
  setExpensesFilters({ startDate: '', endDate: '', stallId: expensesFilters.stallId });
  setStatisticsFilters({ startDate: '', endDate: '', stallId: statisticsFilters.stallId });
}}
```

Key points:

- Global filter **does not participate in query logic** anymore.
- It only sets the starting point for each card’s local filters.
- After that, each card’s Clear or date changes are local and don’t affect other cards.

#### 3. Keep individual Clear buttons purely local

Your existing Clear handlers on the cards are already local to each filter object; they only need to reset that card’s state and nothing else:

- Sales Clear: reset `salesDateRange`.
- Transactions Clear: reset `transactionsFilters.startDate` / `endDate` (and optionally stall).
- Expenses Clear: reset `expensesFilters.startDate` / `endDate`.
- Statistics Clear: reset `statisticsFilters.startDate` / `endDate`.

With the version logic gone and loaders reading only local state, Clear is now:

- **Single click**, no version comparisons.
- Completely independent of global state and other cards.

---

### Resulting UX

- **Global filter**:
  - Set a range → all four cards immediately reflect that (because their local filters were updated).
  - Clear → all cards’ date ranges are cleared (if you choose to broadcast the clear).

- **Per-card filters**:
  - Any change (dates or Clear) immediately affects only that card’s data.
  - No need to click multiple times; there’s no hidden global precedence.

If you’d like, I can next give you the exact minimal patch code for `Reports.jsx` following this refactor, but conceptually this is the cleanest, non-duplicated way to remove the lag and keep cards independent.

---

_**User (2025-11-16 05:55Z)**_

this is a repeated reminder:

before implementation, review codes, avoid duplication and misplaced logic at all costs



run tests, then code, then test again



alright, you may now proceed

---

_**Agent (model default, mode Plan)**_

<think><details><summary>Thought Process</summary>
**Refactoring Reports.jsx**

I need to refactor the `Reports.jsx` file as planned. I’ll run tests, including linting, before and after the changes. My steps will involve calling `run_terminal_cmd`, then applying the patch, followed by reading lints, and linting again. I want to avoid duplication, so I’ll remove version states and precedence logic. I’m also adjusting the `useEffect` dependencies to optimize it. While I want to keep the `globalDateRange` for UI purposes, it should probably not be part of the effect dependencies anymore.
**Implementing Changes in Reports.jsx**

I'm planning to make several changes in `Reports.jsx`. First, I’ll run linting with `npm run lint` before making any modifications. I need to remove `globalFilterVersion` and `salesFilterVersion`, simplifying loaders to solely rely on local filters. When global filters change, I’ll update `globalDateRange` and broadcast to local filters without affecting `stallId`. For global clear actions, it’s fine to adjust all cards. My implementation will involve adjusting the global start and end date inputs appropriately.
**Updating Clear Functions**

When implementing the clear functions, I’ll reset the date ranges for both global and sales filters to empty values. I’ll also update the transaction filters accordingly. For loading data, I'll ensure that the correct date ranges and IDs are used for sales, transactions, expenses, and statistics. My goal is to remove `globalDateRange` from the `useEffect` dependencies to optimize performance, even though it could lead to double fetching. I’ll be careful about avoiding duplication while making sure the logic stays clear!
**Creating a Helper Function**

I'm thinking of creating a helper function called `applyGlobalRangeToCards` to reduce code duplication within the component. This function will streamline setting the `salesDateRange` and updating transactions filters. Although having a function inside the component might seem excessive, it can improve readability. I'll make sure to define this helper after the state declarations and before it's called in the handlers. After implementing this, I’ll run linting on `Reports.jsx` again and proceed with the necessary tools.</details></think>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  104:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  506:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  554:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  663:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  674:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  743:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  759:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  766:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;9dbc3721-fa4c-4eb5-bc95-55bc5f03c402&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    });\n    \n-   // Global filter (admin)\n+   // Global filter (admin) - used only to broadcast into per-card filters\n    const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n-   const [globalFilterVersion, setGlobalFilterVersion] = useState(0);\n  \n    // Per-card filter states\n    const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n-   const [salesFilterVersion, setSalesFilterVersion] = useState(0);\n    const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n    const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n    const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n-   const [transactionsFilterVersion, setTransactionsFilterVersion] = useState(0);\n-   const [expensesFilterVersion, setExpensesFilterVersion] = useState(0);\n-   const [statisticsFilterVersion, setStatisticsFilterVersion] = useState(0);\n+ \n+   // Helper: apply a date range to all cards (used by global filter)\n+   const applyGlobalRangeToCards = (range) =&gt; {\n+     setSalesDateRange(range);\n+     setTransactionsFilters((prev) =&gt; ({\n+       ...prev,\n+       startDate: range.startDate,\n+       endDate: range.endDate,\n+     }));\n+     setExpensesFilters((prev) =&gt; ({\n+       ...prev,\n+       startDate: range.startDate,\n+       endDate: range.endDate,\n+     }));\n+     setStatisticsFilters((prev) =&gt; ({\n+       ...prev,\n+       startDate: range.startDate,\n+       endDate: range.endDate,\n+     }));\n+   };\n    \n    // Editing states&quot;,
        &quot;oldStart&quot;: 24,
        &quot;newStart&quot;: 24,
        &quot;oldLines&quot;: 17,
        &quot;newLines&quot;: 32,
        &quot;linesRemoved&quot;: 6,
        &quot;linesAdded&quot;: 21
      },
      {
        &quot;diffString&quot;: &quot;        loadReportsData();\n      }\n-   }, [userProfile, globalDateRange, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n+   }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n  \n    const loadReportsData = async () =&gt; {&quot;,
        &quot;oldStart&quot;: 102,
        &quot;newStart&quot;: 117,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;        // Apply date range filter for admin; staff will always be restricted to today\n        if (userProfile?.role === &#39;admin&#39;) {\n-         const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n-         const hasLocal = salesDateRange.startDate || salesDateRange.endDate;\n-         let start = null;\n-         let end = null;\n- \n-         if (salesFilterVersion &gt;= globalFilterVersion) {\n-           // Latest action was on this card; use local dates if present, otherwise no date filter\n-           if (hasLocal) {\n-             start = salesDateRange.startDate || null;\n-             end = salesDateRange.endDate || null;\n-           }\n-         } else if (hasGlobal) {\n-           // Global filter is newer\n-           start = globalDateRange.startDate || null;\n-           end = globalDateRange.endDate || null;\n-         }\n- \n-         if (start) {\n-           query = query.gte(&#39;sale_date&#39;, start);\n-         }\n-         if (end) {\n-           query = query.lte(&#39;sale_date&#39;, end);\n+         if (salesDateRange.startDate) {\n+           query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n+         }\n+         if (salesDateRange.endDate) {\n+           query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n          }\n        }&quot;,
        &quot;oldStart&quot;: 131,
        &quot;newStart&quot;: 146,
        &quot;oldLines&quot;: 26,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 22,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;        // Apply filters (admin only; staff will be restricted to today via helper)\n        if (userProfile?.role === &#39;admin&#39;) {\n-         const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n-         const hasLocal = transactionsFilters.startDate || transactionsFilters.endDate;\n-         let start = null;\n-         let end = null;\n- \n-         if (transactionsFilterVersion &gt;= globalFilterVersion) {\n-           if (hasLocal) {\n-             start = transactionsFilters.startDate || null;\n-             end = transactionsFilters.endDate || null;\n-           }\n-         } else if (hasGlobal) {\n-           start = globalDateRange.startDate || null;\n-           end = globalDateRange.endDate || null;\n-         }\n- \n-         if (start) {\n-           query = query.gte(&#39;sale_date&#39;, start);\n-         }\n-         if (end) {\n-           query = query.lte(&#39;sale_date&#39;, end);\n+         if (transactionsFilters.startDate) {\n+           query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n+         }\n+         if (transactionsFilters.endDate) {\n+           query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n          }\n          if (transactionsFilters.stallId) {&quot;,
        &quot;oldStart&quot;: 212,
        &quot;newStart&quot;: 210,
        &quot;oldLines&quot;: 24,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 20,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;        // Apply filters (admin only; staff will be restricted to today via helper)\n        if (userProfile?.role === &#39;admin&#39;) {\n-         const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n-         const hasLocal = expensesFilters.startDate || expensesFilters.endDate;\n-         let start = null;\n-         let end = null;\n- \n-         if (expensesFilterVersion &gt;= globalFilterVersion) {\n-           if (hasLocal) {\n-             start = expensesFilters.startDate || null;\n-             end = expensesFilters.endDate || null;\n-           }\n-         } else if (hasGlobal) {\n-           start = globalDateRange.startDate || null;\n-           end = globalDateRange.endDate || null;\n-         }\n- \n-         if (start) {\n-           query = query.gte(&#39;date&#39;, start);\n-         }\n-         if (end) {\n-           query = query.lte(&#39;date&#39;, end);\n+         if (expensesFilters.startDate) {\n+           query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n+         }\n+         if (expensesFilters.endDate) {\n+           query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n          }\n          if (expensesFilters.stallId) {&quot;,
        &quot;oldStart&quot;: 261,
        &quot;newStart&quot;: 244,
        &quot;oldLines&quot;: 24,
        &quot;newLines&quot;: 9,
        &quot;linesRemoved&quot;: 20,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;          statsStallId = userProfile.stall_id || null;\n        } else if (userProfile?.role === &#39;admin&#39;) {\n-         const hasGlobal = globalDateRange.startDate || globalDateRange.endDate;\n-         const hasLocal = statisticsFilters.startDate || statisticsFilters.endDate;\n- \n-         if (statisticsFilterVersion &gt;= globalFilterVersion) {\n-           if (hasLocal) {\n-             statsStartDate = statisticsFilters.startDate || null;\n-             statsEndDate = statisticsFilters.endDate || null;\n-           } else {\n-             // Local clear is the latest action: no date filter for statistics\n-             statsStartDate = null;\n-             statsEndDate = null;\n-           }\n-         } else if (hasGlobal) {\n-           statsStartDate = globalDateRange.startDate || null;\n-           statsEndDate = globalDateRange.endDate || null;\n-         } else {\n-           statsStartDate = null;\n-           statsEndDate = null;\n-         }\n+         statsStartDate = statisticsFilters.startDate || null;\n+         statsEndDate = statisticsFilters.endDate || null;\n        }\n  &quot;,
        &quot;oldStart&quot;: 313,
        &quot;newStart&quot;: 281,
        &quot;oldLines&quot;: 23,
        &quot;newLines&quot;: 6,
        &quot;linesRemoved&quot;: 19,
        &quot;linesAdded&quot;: 2
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Helper: apply a date range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    setSalesDateRange(range);\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n    }));\n  };\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setGlobalDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                        setGlobalFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        startDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        endDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; {\n                      setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

The model made no changes to the file.

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/Reports.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;ad26d484-8530-415f-8f46-90a63b44f313&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                        value={globalDateRange.startDate}\n                        onChange={(e) =&gt; {\n-                         setGlobalDateRange((prev) =&gt; ({\n-                           ...prev,\n+                         const next = {\n+                           ...globalDateRange,\n                            startDate: e.target.value,\n-                         }));\n-                         setGlobalFilterVersion((prev) =&gt; prev + 1);\n+                         };\n+                         setGlobalDateRange(next);\n+                         applyGlobalRangeToCards(next);\n                        }}\n                      /&gt;&quot;,
        &quot;oldStart&quot;: 481,
        &quot;newStart&quot;: 481,
        &quot;oldLines&quot;: 9,
        &quot;newLines&quot;: 10,
        &quot;linesRemoved&quot;: 4,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;                        value={globalDateRange.endDate}\n                        onChange={(e) =&gt; {\n-                         setGlobalDateRange((prev) =&gt; ({\n-                           ...prev,\n+                         const next = {\n+                           ...globalDateRange,\n                            endDate: e.target.value,\n-                         }));\n-                         setGlobalFilterVersion((prev) =&gt; prev + 1);\n+                         };\n+                         setGlobalDateRange(next);\n+                         applyGlobalRangeToCards(next);\n                        }}\n                      /&gt;&quot;,
        &quot;oldStart&quot;: 498,
        &quot;newStart&quot;: 499,
        &quot;oldLines&quot;: 9,
        &quot;newLines&quot;: 10,
        &quot;linesRemoved&quot;: 4,
        &quot;linesAdded&quot;: 5
      },
      {
        &quot;diffString&quot;: &quot;                        className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                        onClick={() =&gt; {\n-                         setGlobalDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n-                         setGlobalFilterVersion((prev) =&gt; prev + 1);\n+                         const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39; };\n+                         setGlobalDateRange(cleared);\n+                         applyGlobalRangeToCards(cleared);\n                        }}\n                      &gt;&quot;,
        &quot;oldStart&quot;: 513,
        &quot;newStart&quot;: 515,
        &quot;oldLines&quot;: 6,
        &quot;newLines&quot;: 7,
        &quot;linesRemoved&quot;: 2,
        &quot;linesAdded&quot;: 3
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Helper: apply a date range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    setSalesDateRange(range);\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n    }));\n  };\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.startDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        startDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                    value={salesDateRange.endDate}\n                    onChange={(e) =&gt; {\n                      setSalesDateRange((prev) =&gt; ({\n                        ...prev,\n                        endDate: e.target.value,\n                      }));\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                    onClick={() =&gt; {\n                      setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      setSalesFilterVersion((prev) =&gt; prev + 1);\n                    }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setExpensesFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                        setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;src/Reports.jsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;bc66909e-fc10-4348-911f-60a7795c7cbc&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n-                     value={salesDateRange.startDate}\n-                     onChange={(e) =&gt; {\n-                       setSalesDateRange((prev) =&gt; ({\n-                         ...prev,\n-                         startDate: e.target.value,\n-                       }));\n-                       setSalesFilterVersion((prev) =&gt; prev + 1);\n-                     }}\n+                       value={salesDateRange.startDate}\n+                       onChange={(e) =&gt; {\n+                         setSalesDateRange((prev) =&gt; ({\n+                           ...prev,\n+                           startDate: e.target.value,\n+                         }));\n+                       }}\n                    /&gt;\n                  &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 585,
        &quot;newStart&quot;: 585,
        &quot;oldLines&quot;: 12,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 8,
        &quot;linesAdded&quot;: 7
      },
      {
        &quot;diffString&quot;: &quot;                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n-                     value={salesDateRange.endDate}\n-                     onChange={(e) =&gt; {\n-                       setSalesDateRange((prev) =&gt; ({\n-                         ...prev,\n-                         endDate: e.target.value,\n-                       }));\n-                       setSalesFilterVersion((prev) =&gt; prev + 1);\n-                     }}\n+                       value={salesDateRange.endDate}\n+                       onChange={(e) =&gt; {\n+                         setSalesDateRange((prev) =&gt; ({\n+                           ...prev,\n+                           endDate: e.target.value,\n+                         }));\n+                       }}\n                    /&gt;\n                  &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 602,
        &quot;newStart&quot;: 601,
        &quot;oldLines&quot;: 12,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 8,
        &quot;linesAdded&quot;: 7
      },
      {
        &quot;diffString&quot;: &quot;                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n-                     onClick={() =&gt; {\n-                       setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n-                       setSalesFilterVersion((prev) =&gt; prev + 1);\n-                     }}\n+                       onClick={() =&gt; {\n+                         setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n+                       }}\n                    &gt;\n                      Clear&quot;,
        &quot;oldStart&quot;: 618,
        &quot;newStart&quot;: 616,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 7,
        &quot;linesRemoved&quot;: 4,
        &quot;linesAdded&quot;: 3
      },
      {
        &quot;diffString&quot;: &quot;                            startDate: e.target.value,\n                          }));\n-                         setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                        }}\n                      /&gt;&quot;,
        &quot;oldStart&quot;: 704,
        &quot;newStart&quot;: 701,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 4,
        &quot;linesRemoved&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                            endDate: e.target.value,\n                          }));\n-                         setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                        }}\n                      /&gt;&quot;,
        &quot;oldStart&quot;: 721,
        &quot;newStart&quot;: 717,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 4,
        &quot;linesRemoved&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                        onClick={() =&gt; {\n                          setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n-                         setTransactionsFilterVersion((prev) =&gt; prev + 1);\n                        }}\n                      &gt;&quot;,
        &quot;oldStart&quot;: 755,
        &quot;newStart&quot;: 750,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 4,
        &quot;linesRemoved&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                            startDate: e.target.value,\n                          }));\n-                         setExpensesFilterVersion((prev) =&gt; prev + 1);\n                        }}\n                      /&gt;&quot;,
        &quot;oldStart&quot;: 920,
        &quot;newStart&quot;: 914,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 4,
        &quot;linesRemoved&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                            endDate: e.target.value,\n                          }));\n-                         setExpensesFilterVersion((prev) =&gt; prev + 1);\n                        }}\n                      /&gt;&quot;,
        &quot;oldStart&quot;: 937,
        &quot;newStart&quot;: 930,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 4,
        &quot;linesRemoved&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                        onClick={() =&gt; {\n                          setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n-                         setExpensesFilterVersion((prev) =&gt; prev + 1);\n                        }}\n                      &gt;&quot;,
        &quot;oldStart&quot;: 971,
        &quot;newStart&quot;: 963,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 4,
        &quot;linesRemoved&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                            startDate: e.target.value,\n                          }));\n-                         setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                        }}\n                      /&gt;&quot;,
        &quot;oldStart&quot;: 1126,
        &quot;newStart&quot;: 1117,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 4,
        &quot;linesRemoved&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                            endDate: e.target.value,\n                          }));\n-                         setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                        }}\n                      /&gt;&quot;,
        &quot;oldStart&quot;: 1143,
        &quot;newStart&quot;: 1133,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 4,
        &quot;linesRemoved&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                        onClick={() =&gt; {\n                          setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n-                         setStatisticsFilterVersion((prev) =&gt; prev + 1);\n                        }}\n                      &gt;&quot;,
        &quot;oldStart&quot;: 1177,
        &quot;newStart&quot;: 1166,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 4,
        &quot;linesRemoved&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM src/Reports.jsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { useState, useEffect } from &#39;react&#39;;\nimport { useNavigate } from &#39;react-router-dom&#39;;\nimport { supabase } from &#39;./supabaseClient&#39;;\nimport Layout from &#39;./components/Layout&#39;;\nimport { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, Legend, LabelList } from &#39;recharts&#39;;\nimport { buildTodayRangePH, restrictToStaffStallAndToday } from &#39;./utils/staffReportsToday&#39;;\n\nfunction Reports() {\n  const navigate = useNavigate();\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Data states\n  const [salesByStall, setSalesByStall] = useState([]);\n  const [transactions, setTransactions] = useState([]);\n  const [expenses, setExpenses] = useState([]);\n  const [stalls, setStalls] = useState([]);\n  const [chartMetric, setChartMetric] = useState(&#39;sales&#39;);\n  const [statistics, setStatistics] = useState({\n    totalSales: 0,\n    totalExpenses: 0,\n    highestEarningStall: null,\n    lowestEarningStall: null\n  });\n  \n  // Global filter (admin) - used only to broadcast into per-card filters\n  const [globalDateRange, setGlobalDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n\n  // Per-card filter states\n  const [salesDateRange, setSalesDateRange] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n  const [transactionsFilters, setTransactionsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [expensesFilters, setExpensesFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n  const [statisticsFilters, setStatisticsFilters] = useState({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n\n  // Helper: apply a date range to all cards (used by global filter)\n  const applyGlobalRangeToCards = (range) =&gt; {\n    setSalesDateRange(range);\n    setTransactionsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n    }));\n    setExpensesFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n    }));\n    setStatisticsFilters((prev) =&gt; ({\n      ...prev,\n      startDate: range.startDate,\n      endDate: range.endDate,\n    }));\n  };\n  \n  // Editing states\n  const [editingTransaction, setEditingTransaction] = useState(null);\n  const [editingExpense, setEditingExpense] = useState(null);\n  const [editLoading, setEditLoading] = useState(false);\n  \n  // Error states\n  const [error, setError] = useState(&#39;&#39;);\n  const [success, setSuccess] = useState(&#39;&#39;);\n\n  // Get logged-in user and verify access\n  useEffect(() =&gt; {\n    const getUser = async () =&gt; {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (user) {\n        const { data: profile, error } = await supabase\n          .from(&#39;profiles&#39;)\n          .select(&#39;role, full_name, stall_id, status&#39;)\n          .eq(&#39;id&#39;, user.id)\n          .single();\n\n        if (error) {\n          console.error(&#39;Error fetching profile:&#39;, error);\n        } else {\n          setUserProfile(profile);\n          // Both admin and staff can access reports\n          if (profile.role !== &#39;staff&#39; &amp;&amp; profile.role !== &#39;admin&#39;) {\n            alert(&#39;Access denied. Only staff and admin can view reports.&#39;);\n            navigate(&#39;/dashboard&#39;);\n            return;\n          }\n        }\n      }\n\n      setLoading(false);\n    };\n\n    getUser();\n  }, [navigate]);\n\n  // Load stalls list\n  useEffect(() =&gt; {\n    const loadStalls = async () =&gt; {\n      try {\n        const { data, error } = await supabase\n          .from(&#39;stalls&#39;)\n          .select(&#39;stall_id, stall_name&#39;)\n          .order(&#39;stall_name&#39;, { ascending: true });\n        if (error) throw error;\n        setStalls(data || []);\n      } catch (err) {\n        console.error(&#39;Error loading stalls:&#39;, err);\n      }\n    };\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadStalls();\n    }\n  }, [userProfile]);\n\n  // Load all reports data\n  useEffect(() =&gt; {\n    if (userProfile?.role === &#39;staff&#39; || userProfile?.role === &#39;admin&#39;) {\n      loadReportsData();\n    }\n  }, [userProfile, salesDateRange, transactionsFilters, expensesFilters, statisticsFilters]);\n\n  const loadReportsData = async () =&gt; {\n    try {\n      await Promise.all([\n        loadSalesByStall(),\n        loadTransactions(),\n        loadExpenses(),\n        loadStatistics()\n      ]);\n    } catch (err) {\n      setError(&#39;Failed to load reports data: &#39; + err.message);\n    }\n  };\n\n  // Load sales overview by stall\n  const loadSalesByStall = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          sale_date,\n          stalls(stall_name)\n        &#96;);\n\n      // Apply date range filter for admin; staff will always be restricted to today\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (salesDateRange.startDate) {\n          query = query.gte(&#39;sale_date&#39;, salesDateRange.startDate);\n        }\n        if (salesDateRange.endDate) {\n          query = query.lte(&#39;sale_date&#39;, salesDateRange.endDate);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false });\n  \n      if (error) throw error;\n  \n      // Group by stall and calculate totals\n      const stallSales = {};\n      data?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallSales[stallId]) {\n          stallSales[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total_sales: 0,\n            transaction_count: 0,\n            last_sale: null\n          };\n        }\n        stallSales[stallId].total_sales += Number(sale.total_amount || 0);\n        stallSales[stallId].transaction_count += 1;\n        if (\n          !stallSales[stallId].last_sale ||\n          new Date(sale.sale_date) &gt; new Date(stallSales[stallId].last_sale)\n        ) {\n          stallSales[stallId].last_sale = sale.sale_date;\n        }\n      });\n  \n      setSalesByStall(Object.values(stallSales));\n    } catch (err) {\n      console.error(&#39;Error loading sales by stall:&#39;, err);\n    }\n  };\n  \n\n  // Load detailed transactions\n  const loadTransactions = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          sale_id,\n          sale_date,\n          quantity_sold,\n          total_amount,\n          payment_method,\n          stall_id,\n          product_id,\n          stalls(stall_name),\n          menu_items(item_name, price)\n        &#96;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (transactionsFilters.startDate) {\n          query = query.gte(&#39;sale_date&#39;, transactionsFilters.startDate);\n        }\n        if (transactionsFilters.endDate) {\n          query = query.lte(&#39;sale_date&#39;, transactionsFilters.endDate);\n        }\n        if (transactionsFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, transactionsFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;sale_date&#39; });\n\n      const { data, error } = await query.order(&#39;sale_date&#39;, { ascending: false }).limit(50);\n  \n      if (error) throw error;\n      setTransactions(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading transactions:&#39;, err);\n    }\n  };\n  \n\n\n  // Load expenses\n  const loadExpenses = async () =&gt; {\n    try {\n      let query = supabase\n        .from(&#39;expenses&#39;)\n        .select(&#39;expense_id, expense_name, quantity, cost, date, supplier_name, stall_id, created_at, stalls(stall_name)&#39;);\n\n      // Apply filters (admin only; staff will be restricted to today via helper)\n      if (userProfile?.role === &#39;admin&#39;) {\n        if (expensesFilters.startDate) {\n          query = query.gte(&#39;date&#39;, expensesFilters.startDate);\n        }\n        if (expensesFilters.endDate) {\n          query = query.lte(&#39;date&#39;, expensesFilters.endDate);\n        }\n        if (expensesFilters.stallId) {\n          query = query.eq(&#39;stall_id&#39;, expensesFilters.stallId);\n        }\n      }\n\n      // Staff: always limit to their stall and today&#39;s date\n      query = restrictToStaffStallAndToday(query, userProfile, { dateColumn: &#39;date&#39; });\n\n      const { data, error } = await query.order(&#39;date&#39;, { ascending: false }).limit(50);\n\n      if (error) throw error;\n      setExpenses(data || []);\n    } catch (err) {\n      console.error(&#39;Error loading expenses:&#39;, err);\n    }\n  };\n\n  // Load statistics\n  const loadStatistics = async () =&gt; {\n    try {\n      let statsStartDate = null;\n      let statsEndDate = null;\n      let statsStallId = statisticsFilters.stallId || null;\n\n      if (userProfile?.role === &#39;staff&#39;) {\n        // Staff: always today + their stall\n        const { startDate, endDate } = buildTodayRangePH();\n        statsStartDate = startDate;\n        statsEndDate = endDate;\n        statsStallId = userProfile.stall_id || null;\n      } else if (userProfile?.role === &#39;admin&#39;) {\n        statsStartDate = statisticsFilters.startDate || null;\n        statsEndDate = statisticsFilters.endDate || null;\n      }\n\n      // Get total sales with filters\n      let salesQuery = supabase.from(&#39;sales&#39;).select(&#39;total_amount&#39;);\n      if (statsStartDate) {\n        salesQuery = salesQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        salesQuery = salesQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        salesQuery = salesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: salesData, error: salesError } = await salesQuery;\n      if (salesError) throw salesError;\n\n      // Get total expenses with filters\n      let expensesQuery = supabase.from(&#39;expenses&#39;).select(&#39;cost&#39;);\n      if (statsStartDate) {\n        expensesQuery = expensesQuery.gte(&#39;date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        expensesQuery = expensesQuery.lte(&#39;date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        expensesQuery = expensesQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: expensesData, error: expensesError } = await expensesQuery;\n      if (expensesError) throw expensesError;\n\n      const totalSales = salesData?.reduce((sum, sale) =&gt; sum + sale.total_amount, 0) || 0;\n      const totalExpenses = expensesData?.reduce((sum, expense) =&gt; sum + expense.cost, 0) || 0;\n\n      // Get stall performance for highest/lowest\n      let stallQuery = supabase\n        .from(&#39;sales&#39;)\n        .select(&#96;\n          stall_id,\n          total_amount,\n          stalls(stall_name)\n        &#96;);\n      if (statsStartDate) {\n        stallQuery = stallQuery.gte(&#39;sale_date&#39;, statsStartDate);\n      }\n      if (statsEndDate) {\n        stallQuery = stallQuery.lte(&#39;sale_date&#39;, statsEndDate);\n      }\n      if (statsStallId) {\n        stallQuery = stallQuery.eq(&#39;stall_id&#39;, statsStallId);\n      }\n      const { data: stallData, error: stallError } = await stallQuery;\n      if (stallError) throw stallError;\n\n      // Calculate stall totals\n      const stallTotals = {};\n      stallData?.forEach(sale =&gt; {\n        const stallId = sale.stall_id;\n        if (!stallTotals[stallId]) {\n          stallTotals[stallId] = {\n            stall_id: stallId,\n            stall_name: sale.stalls?.stall_name || &#96;Stall ${stallId}&#96;,\n            total: 0\n          };\n        }\n        stallTotals[stallId].total += sale.total_amount;\n      });\n\n      const stallArray = Object.values(stallTotals);\n      const highestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((max, stall) =&gt; \n        stall.total &gt; max.total ? stall : max, stallArray[0]) : null;\n      const lowestEarningStall = stallArray.length &gt; 0 ? stallArray.reduce((min, stall) =&gt; \n        stall.total &lt; min.total ? stall : min, stallArray[0]) : null;\n\n      setStatistics({\n        totalSales,\n        totalExpenses,\n        highestEarningStall,\n        lowestEarningStall\n      });\n    } catch (err) {\n      console.error(&#39;Error loading statistics:&#39;, err);\n    }\n  };\n\n  // Edit transaction\n  const handleEditTransaction = async (transaction, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;sales&#39;)\n        .update({\n          sale_date: updatedData.sale_date,\n          quantity_sold: updatedData.quantity_sold,\n          total_amount: updatedData.total_amount,\n          payment_method: updatedData.payment_method,\n          stall_id: updatedData.stall_id,\n          product_id: updatedData.product_id\n        })\n        .eq(&#39;sale_id&#39;, transaction.sale_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Transaction updated successfully.&#39;);\n      setEditingTransaction(null);\n      loadTransactions();\n      loadSalesByStall();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update transaction: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  // Edit expense\n  const handleEditExpense = async (expense, updatedData) =&gt; {\n    setEditLoading(true);\n    setError(&#39;&#39;);\n    setSuccess(&#39;&#39;);\n    try {\n      const { error } = await supabase\n        .from(&#39;expenses&#39;)\n        .update({\n          expense_name: updatedData.expense_name,\n          quantity: updatedData.quantity,\n          cost: updatedData.cost,\n          date: updatedData.date,\n          supplier_name: updatedData.supplier_name,\n          stall_id: updatedData.stall_id\n        })\n        .eq(&#39;expense_id&#39;, expense.expense_id);\n      \n      if (error) throw error;\n      setSuccess(&#39;Expense updated successfully.&#39;);\n      setEditingExpense(null);\n      loadExpenses();\n      loadStatistics();\n    } catch (err) {\n      setError(&#39;Failed to update expense: &#39; + err.message);\n    } finally {\n      setEditLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;loading loading-spinner loading-lg text-primary\&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      &lt;div className=\&quot;min-h-screen bg-base-200 flex items-center justify-center\&quot;&gt;\n        &lt;div className=\&quot;card w-96 bg-base-100 shadow-xl\&quot;&gt;\n          &lt;div className=\&quot;card-body text-center\&quot;&gt;\n            &lt;h2 className=\&quot;card-title text-error justify-center\&quot;&gt;Access Denied&lt;/h2&gt;\n            &lt;p&gt;You need to be logged in to access this page.&lt;/p&gt;\n            &lt;div className=\&quot;card-actions justify-center mt-4\&quot;&gt;\n              &lt;button onClick={() =&gt; navigate(&#39;/login&#39;)} className=\&quot;btn btn-primary\&quot;&gt;Go to Login&lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  return (\n    &lt;Layout userProfile={userProfile}&gt;\n      &lt;div className=\&quot;container mx-auto p-6\&quot;&gt;\n        &lt;div className=\&quot;mb-6\&quot;&gt;\n          &lt;h1 className=\&quot;text-3xl font-bold text-primary mb-2\&quot;&gt;Reports Dashboard&lt;/h1&gt;\n          &lt;p className=\&quot;text-base-content/70\&quot;&gt;Comprehensive overview of sales, expenses, and performance metrics&lt;/p&gt;\n        &lt;/div&gt;\n\n        {/* Global date filter - admin only */}\n        {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n          &lt;div className=\&quot;card bg-base-100 shadow-md mb-6\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex flex-col md:flex-row md:items-end md:justify-between gap-4\&quot;&gt;\n                &lt;div&gt;\n                  &lt;h2 className=\&quot;card-title text-primary text-base\&quot;&gt;Global Date Filter&lt;/h2&gt;\n                  &lt;p className=\&quot;text-xs text-base-content/70\&quot;&gt;\n                    Applies to all report sections. Local filters can still narrow down by stall.\n                  &lt;/p&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 w-full md:w-auto\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          startDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={globalDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        const next = {\n                          ...globalDateRange,\n                          endDate: e.target.value,\n                        };\n                        setGlobalDateRange(next);\n                        applyGlobalRangeToCards(next);\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        const cleared = { startDate: &#39;&#39;, endDate: &#39;&#39; };\n                        setGlobalDateRange(cleared);\n                        applyGlobalRangeToCards(cleared);\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n\n        {error &amp;&amp; (\n          &lt;div className=\&quot;alert alert-error mb-6\&quot;&gt;\n            &lt;span&gt;{error}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setError(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {success &amp;&amp; (\n          &lt;div className=\&quot;alert alert-success mb-6\&quot;&gt;\n            &lt;span&gt;{success}&lt;/span&gt;\n            &lt;button \n              className=\&quot;btn btn-sm btn-circle btn-ghost\&quot;\n              onClick={() =&gt; setSuccess(&#39;&#39;)}\n            &gt;\n              ×\n            &lt;/button&gt;\n          &lt;/div&gt;\n        )}\n\n        {/* Cards Grid - 2 per row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\&quot;&gt;\n          {/* Card 1: Sales Overview by Stall */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;div className=\&quot;flex items-center justify-between mb-4\&quot;&gt;\n                &lt;h2 className=\&quot;card-title text-primary\&quot;&gt;Sales Overview by Stall&lt;/h2&gt;\n                &lt;div className=\&quot;flex gap-2\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;div className=\&quot;input-group\&quot;&gt;\n                      &lt;span className=\&quot;btn btn-ghost btn-sm\&quot;&gt;Metric&lt;/span&gt;\n                      &lt;select\n                        className=\&quot;select select-bordered select-sm\&quot;\n                        value={chartMetric}\n                        onChange={(e) =&gt; setChartMetric(e.target.value)}\n                      &gt;\n                        &lt;option value=\&quot;sales\&quot;&gt;Total Sales&lt;/option&gt;\n                        &lt;option value=\&quot;transactions\&quot;&gt;Transactions&lt;/option&gt;\n                      &lt;/select&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {/* Date Range Filter */}\n              &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-3 gap-2 mb-4\&quot;&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.startDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;input\n                    type=\&quot;date\&quot;\n                    className=\&quot;input input-bordered input-sm\&quot;\n                      value={salesDateRange.endDate}\n                      onChange={(e) =&gt; {\n                        setSalesDateRange((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                  /&gt;\n                &lt;/div&gt;\n                &lt;div className=\&quot;form-control\&quot;&gt;\n                  &lt;label className=\&quot;label\&quot;&gt;\n                    &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                  &lt;/label&gt;\n                  &lt;button\n                    className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setSalesDateRange({ startDate: &#39;&#39;, endDate: &#39;&#39; });\n                      }}\n                  &gt;\n                    Clear\n                  &lt;/button&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n              {salesByStall.length &gt; 0 ? (\n                &lt;div className=\&quot;w-full h-96\&quot;&gt;\n                  &lt;ResponsiveContainer width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n                    &lt;BarChart\n                      data={[...salesByStall].sort((a, b) =&gt; (chartMetric === &#39;sales&#39; ? b.total_sales - a.total_sales : b.transaction_count - a.transaction_count))}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    &gt;\n                      &lt;CartesianGrid strokeDasharray=\&quot;3 3\&quot; stroke=\&quot;#374151\&quot; opacity={0.3} /&gt;\n                      &lt;XAxis \n                        dataKey=\&quot;stall_name\&quot; \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        interval={0}\n                        angle={-25}\n                        textAnchor=\&quot;end\&quot;\n                        height={60}\n                        tickLine={false}\n                        axisLine={false}\n                      /&gt;\n                      &lt;YAxis \n                        tick={{ fill: &#39;#9CA3AF&#39;, fontSize: 12 }}\n                        tickFormatter={(v) =&gt; (chartMetric === &#39;sales&#39; ? &#96;₱${Number(v).toLocaleString()}&#96; : &#96;${v}&#96;)}\n                        width={chartMetric === &#39;sales&#39; ? 80 : 50}\n                        axisLine={false}\n                        tickLine={false}\n                      /&gt;\n                      &lt;Tooltip\n                        formatter={(value) =&gt;\n                          chartMetric === &#39;sales&#39;\n                            ? [&#96;₱${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}&#96;, &#39;Total Sales&#39;]\n                            : [value, &#39;Transactions&#39;]\n                        }\n                        contentStyle={{\n                          backgroundColor: &#39;#1F2937&#39;,\n                          border: &#39;1px solid #374151&#39;,\n                          borderRadius: &#39;8px&#39;,\n                          color: &#39;#F9FAFB&#39;,\n                          fontSize: &#39;14px&#39;,\n                          boxShadow: &#39;0 10px 25px rgba(0, 0, 0, 0.3)&#39;\n                        }}\n                        cursor={{ fill: &#39;rgba(59, 130, 246, 0.1)&#39; }}\n                      /&gt;\n                      &lt;Bar\n                        dataKey={chartMetric === &#39;sales&#39; ? &#39;total_sales&#39; : &#39;transaction_count&#39;}\n                        name={chartMetric === &#39;sales&#39; ? &#39;Total Sales&#39; : &#39;Transactions&#39;}\n                        fill={chartMetric === &#39;sales&#39; ? &#39;#3B82F6&#39; : &#39;#10B981&#39;}\n                        radius={[8, 8, 0, 0]}\n                        maxBarSize={60}\n                      /&gt;\n                    &lt;/BarChart&gt;\n                  &lt;/ResponsiveContainer&gt;\n                &lt;/div&gt;\n              ) : (\n                &lt;div className=\&quot;text-center text-base-content/50 py-6\&quot;&gt;No sales data available&lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 2: Detailed Transactions */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-secondary mb-4\&quot;&gt;Recent Transactions&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={transactionsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={transactionsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setTransactionsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setTransactionsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Item&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Amount&lt;/th&gt;\n                      &lt;th&gt;Payment&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {transactions.map((transaction) =&gt; (\n                      &lt;tr key={transaction.sale_id}&gt;\n                        {editingTransaction?.sale_id === transaction.sale_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.sale_date}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, sale_date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.stall_id}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, stall_id: e.target.value })}\n                              &gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.quantity_sold}\n                                onChange={(e) =&gt; {\n                                  const qty = Number(e.target.value);\n                                  const price = transaction.menu_items?.price || (transaction.total_amount / transaction.quantity_sold);\n                                  setEditingTransaction({\n                                    ...editingTransaction,\n                                    quantity_sold: qty,\n                                    total_amount: qty * price\n                                  });\n                                }}\n                                min=\&quot;1\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingTransaction.total_amount}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, total_amount: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingTransaction.payment_method}\n                                onChange={(e) =&gt; setEditingTransaction({ ...editingTransaction, payment_method: e.target.value })}\n                              &gt;\n                                &lt;option value=\&quot;cash\&quot;&gt;Cash&lt;/option&gt;\n                                &lt;option value=\&quot;Gcash\&quot;&gt;Gcash&lt;/option&gt;\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditTransaction(transaction, editingTransaction)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingTransaction(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td&gt;{new Date(transaction.sale_date).toLocaleDateString()}&lt;/td&gt;\n                            &lt;td&gt;{transaction.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.menu_items?.item_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{transaction.quantity_sold}&lt;/td&gt;\n                            &lt;td className=\&quot;text-success font-bold\&quot;&gt;₱{transaction.total_amount.toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;span className={&#96;badge ${transaction.payment_method === &#39;cash&#39; ? &#39;badge-primary&#39; : &#39;badge-secondary&#39;}&#96;}&gt;\n                                {transaction.payment_method}\n                              &lt;/span&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingTransaction({ ...transaction })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {transactions.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No transactions found\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Second Row */}\n        &lt;div className=\&quot;grid grid-cols-1 lg:grid-cols-2 gap-6\&quot;&gt;\n          {/* Card 3: Expenses Report */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-error mb-4\&quot;&gt;Recent Expenses&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={expensesFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={expensesFilters.stallId}\n                      onChange={(e) =&gt;\n                        setExpensesFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setExpensesFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;overflow-x-auto max-h-96\&quot;&gt;\n                &lt;table className=\&quot;table table-zebra w-full\&quot;&gt;\n                  &lt;thead&gt;\n                    &lt;tr&gt;\n                      &lt;th&gt;Name&lt;/th&gt;\n                      &lt;th&gt;Qty&lt;/th&gt;\n                      &lt;th&gt;Cost&lt;/th&gt;\n                      &lt;th&gt;Date&lt;/th&gt;\n                      &lt;th&gt;Stall&lt;/th&gt;\n                      &lt;th&gt;Supplier&lt;/th&gt;\n                      &lt;th&gt;Actions&lt;/th&gt;\n                    &lt;/tr&gt;\n                  &lt;/thead&gt;\n                  &lt;tbody&gt;\n                    {expenses.map((expense) =&gt; (\n                      &lt;tr key={expense.expense_id}&gt;\n                        {editingExpense?.expense_id === expense.expense_id ? (\n                          &lt;&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.expense_name}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, expense_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.quantity || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, quantity: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;number\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.cost}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, cost: Number(e.target.value) })}\n                                step=\&quot;0.01\&quot;\n                                min=\&quot;0\&quot;\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;date\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.date}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, date: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;select\n                                className=\&quot;select select-bordered select-sm w-full\&quot;\n                                value={editingExpense.stall_id || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, stall_id: e.target.value || null })}\n                              &gt;\n                                &lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n                                {stalls.map((stall) =&gt; (\n                                  &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                                    {stall.stall_name}\n                                  &lt;/option&gt;\n                                ))}\n                              &lt;/select&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;input\n                                type=\&quot;text\&quot;\n                                className=\&quot;input input-bordered input-sm w-full\&quot;\n                                value={editingExpense.supplier_name || &#39;&#39;}\n                                onChange={(e) =&gt; setEditingExpense({ ...editingExpense, supplier_name: e.target.value })}\n                              /&gt;\n                            &lt;/td&gt;\n                            &lt;td&gt;\n                              &lt;div className=\&quot;flex gap-1\&quot;&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-success\&quot;\n                                  onClick={() =&gt; handleEditExpense(expense, editingExpense)}\n                                  disabled={editLoading}\n                                &gt;\n                                  Save\n                                &lt;/button&gt;\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-ghost\&quot;\n                                  onClick={() =&gt; setEditingExpense(null)}\n                                &gt;\n                                  Cancel\n                                &lt;/button&gt;\n                              &lt;/div&gt;\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        ) : (\n                          &lt;&gt;\n                            &lt;td className=\&quot;font-medium\&quot;&gt;{expense.expense_name}&lt;/td&gt;\n                            &lt;td&gt;{expense.quantity || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td className=\&quot;text-error font-bold\&quot;&gt;₱{Number(expense.cost).toFixed(2)}&lt;/td&gt;\n                            &lt;td&gt;{expense.date}&lt;/td&gt;\n                            &lt;td&gt;{expense.stalls?.stall_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;{expense.supplier_name || &#39;N/A&#39;}&lt;/td&gt;\n                            &lt;td&gt;\n                              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                                &lt;button\n                                  className=\&quot;btn btn-xs btn-primary\&quot;\n                                  onClick={() =&gt; setEditingExpense({ ...expense })}\n                                &gt;\n                                  Edit\n                                &lt;/button&gt;\n                              )}\n                            &lt;/td&gt;\n                          &lt;/&gt;\n                        )}\n                      &lt;/tr&gt;\n                    ))}\n                    {expenses.length === 0 &amp;&amp; (\n                      &lt;tr&gt;\n                        &lt;td colSpan=\&quot;7\&quot; className=\&quot;text-center text-base-content/50 py-4\&quot;&gt;\n                          No expenses recorded\n                        &lt;/td&gt;\n                      &lt;/tr&gt;\n                    )}\n                  &lt;/tbody&gt;\n                &lt;/table&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* Card 4: Statistics */}\n          &lt;div className=\&quot;card bg-base-100 shadow-xl\&quot;&gt;\n            &lt;div className=\&quot;card-body\&quot;&gt;\n              &lt;h2 className=\&quot;card-title text-accent mb-4\&quot;&gt;Key Statistics&lt;/h2&gt;\n              {/* Filters - admin only */}\n              {userProfile?.role === &#39;admin&#39; &amp;&amp; (\n                &lt;div className=\&quot;grid grid-cols-1 md:grid-cols-4 gap-2 mb-4\&quot;&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Start Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.startDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          startDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;End Date&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;input\n                      type=\&quot;date\&quot;\n                      className=\&quot;input input-bordered input-sm\&quot;\n                      value={statisticsFilters.endDate}\n                      onChange={(e) =&gt; {\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          endDate: e.target.value,\n                        }));\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;Stall&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;select\n                      className=\&quot;select select-bordered select-sm\&quot;\n                      value={statisticsFilters.stallId}\n                      onChange={(e) =&gt;\n                        setStatisticsFilters((prev) =&gt; ({\n                          ...prev,\n                          stallId: e.target.value,\n                        }))\n                      }\n                    &gt;\n                      &lt;option value=\&quot;\&quot;&gt;All Stalls&lt;/option&gt;\n                      {stalls.map((stall) =&gt; (\n                        &lt;option key={stall.stall_id} value={stall.stall_id}&gt;\n                          {stall.stall_name}\n                        &lt;/option&gt;\n                      ))}\n                    &lt;/select&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\&quot;form-control\&quot;&gt;\n                    &lt;label className=\&quot;label\&quot;&gt;\n                      &lt;span className=\&quot;label-text text-xs\&quot;&gt;&amp;nbsp;&lt;/span&gt;\n                    &lt;/label&gt;\n                    &lt;button\n                      className=\&quot;btn btn-sm btn-ghost mt-5 border-primary\&quot;\n                      onClick={() =&gt; {\n                        setStatisticsFilters({ startDate: &#39;&#39;, endDate: &#39;&#39;, stallId: &#39;&#39; });\n                      }}\n                    &gt;\n                      Clear\n                    &lt;/button&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              )}\n              &lt;div className=\&quot;space-y-4\&quot;&gt;\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Sales&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-success\&quot;&gt;₱{statistics.totalSales.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n                \n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Total Expenses&lt;/div&gt;\n                  &lt;div className=\&quot;stat-value text-error\&quot;&gt;₱{statistics.totalExpenses.toFixed(2)}&lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;stat\&quot;&gt;\n                  &lt;div className=\&quot;stat-title\&quot;&gt;Net Profit&lt;/div&gt;\n                  &lt;div className={&#96;stat-value ${(statistics.totalSales - statistics.totalExpenses) &gt;= 0 ? &#39;text-success&#39; : &#39;text-error&#39;}&#96;}&gt;\n                    ₱{(statistics.totalSales - statistics.totalExpenses).toFixed(2)}\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div className=\&quot;divider\&quot;&gt;&lt;/div&gt;\n\n                &lt;div className=\&quot;space-y-2\&quot;&gt;\n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Highest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-success font-bold\&quot;&gt;\n                      {statistics.highestEarningStall ? \n                        &#96;${statistics.highestEarningStall.stall_name} (₱${statistics.highestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  \n                  &lt;div className=\&quot;flex justify-between items-center\&quot;&gt;\n                    &lt;span className=\&quot;text-sm font-medium\&quot;&gt;Lowest Earning Stall:&lt;/span&gt;\n                    &lt;span className=\&quot;text-warning font-bold\&quot;&gt;\n                      {statistics.lowestEarningStall ? \n                        &#96;${statistics.lowestEarningStall.stall_name} (₱${statistics.lowestEarningStall.total.toFixed(2)})&#96; : \n                        &#39;N/A&#39;\n                      }\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/Layout&gt;\n  );\n}\n\nexport default Reports;\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `src/Reports.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint</summary>

```bash
cd C:\Users\ADZ\Desktop\itpm-proj-main; npm run lint
```

```

&gt; itpm_project@0.0.0 lint
&gt; eslint .


C:\Users\ADZ\Desktop\itpm-proj-main\src\ManageStocks.jsx
  27:9  error  &#39;canAccess&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\Reports.jsx
  119:6  warning  React Hook useEffect has a missing dependency: &#39;loadReportsData&#39;. Either include it or remove the dependency array  react-hooks/exhaustive-deps

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Layout.jsx
  4:49  error  &#39;isAdmin&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\Sidebar.jsx
  8:11  error  &#39;handleLogout&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\components\UserManagement.jsx
  2:10  error  &#39;supabase&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u     no-unused-vars
  3:10  error  &#39;getUserRole&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u  no-unused-vars

C:\Users\ADZ\Desktop\itpm-proj-main\src\dashboard.jsx
    4:52  error    &#39;getPHDateDaysAgo&#39; is defined but never used. Allowed unused vars must match /^[A-Z_]/u                                                          no-unused-vars
  506:11  error    &#39;donutSalesByStall&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                no-unused-vars
  554:11  error    &#39;last7DaysBar&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                     no-unused-vars
  663:8   warning  React Hook useMemo has an unnecessary dependency: &#39;last7DaysSales&#39;. Either exclude it or remove the dependency array                             react-hooks/exhaustive-deps
  674:11  error    &#39;barOptions&#39; is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u                                                       no-unused-vars
  743:8   warning  React Hook useEffect has missing dependencies: &#39;loadTimeBasedSales&#39; and &#39;userProfile?.role&#39;. Either include them or remove the dependency array  react-hooks/exhaustive-deps
  759:8   warning  React Hook useEffect has missing dependencies: &#39;loadChartData&#39; and &#39;refreshChartData&#39;. Either include them or remove the dependency array        react-hooks/exhaustive-deps
  766:8   warning  React Hook useEffect has a missing dependency: &#39;loadStaffDashboardData&#39;. Either include it or remove the dependency array                        react-hooks/exhaustive-deps

✖ 14 problems (9 errors, 5 warnings)


```
</details>
</tool-use>

---

### What I changed and why the Clear delay should be gone

- **Removed the global-vs-local “version” precedence system**
  - All `*FilterVersion` and `globalFilterVersion` state and logic were removed from `src/Reports.jsx`.
  - Each loader now reads **only its own local date filter state**:
    - Sales uses `salesDateRange`.
    - Transactions uses `transactionsFilters.startDate` / `endDate`.
    - Expenses uses `expensesFilters.startDate` / `endDate`.
    - Statistics uses `statisticsFilters.startDate` / `endDate`.
  - This eliminates the situation where a newer global version could silently override a local Clear, which is what made Clear feel like it needed multiple clicks.

- **Made the global filter a one-time broadcaster, not query logic**
  - `globalDateRange` is now used only to **broadcast its range into each card’s local state** via `applyGlobalRangeToCards`:

```startLine:endLine:src/Reports.jsx
const applyGlobalRangeToCards = (range) => {
  setSalesDateRange(range);
  setTransactionsFilters((prev) => ({
    ...prev,
    startDate: range.startDate,
    endDate: range.endDate,
  }));
  setExpensesFilters((prev) => ({
    ...prev,
    startDate: range.startDate,
    endDate: range.endDate,
  }));
  setStatisticsFilters((prev) => ({
    ...prev,
    startDate: range.startDate,
    endDate: range.endDate,
  }));
};
```

  - Global Start/End handlers now:
    - Update `globalDateRange`.
    - Call `applyGlobalRangeToCards(next)`, so all cards immediately pick up that range.
  - Global Clear sets `globalDateRange` to empty and **also clears dates on all cards**, which is expected because the global filter is meant to affect all four displays.

- **Kept each card’s Clear and date changes fully independent**
  - Each card’s Start/End inputs and Clear button now only touch that card’s local state:
    - Sales Clear only resets `salesDateRange`.
    - Transactions Clear only resets `transactionsFilters.startDate` / `endDate` (and `stallId` locally).
    - Expenses Clear only resets `expensesFilters` dates.
    - Statistics Clear only resets `statisticsFilters` dates.
  - Since the loaders now depend only on their own local state, **a single Clear click immediately removes the date filter for that card**, regardless of what the global filter used to be, and does not affect any other card.

- **Tests / lint**
  - Ran `npm run lint` before and after; `src/Reports.jsx` has no new errors, and remaining lint errors are in other files that weren’t touched.

You should now see each card respond instantly to its Clear button or date changes, with no “sticking” due to global precedence, while the global filter still works as a convenient way to set an initial date range across all four cards.

---

